!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=Object.freeze({__proto__:null,get getKeys(){return dn},get isAuditLog(){return cn},get messages(){return mn},get logCustom(){return gn},get logDebug(){return fn}});const t=14200704e5,n=/<(a?):([A-Za-z_\-0-9]+):([0-9]+)>/gi,i=/(discordapp.com\/invite|discord.me|discord.gg|discord.com\/invite)(?:\/#)?(?:\/invite)?\/([a-z0-9\-]+)/gi,a=/(https?:\/\/[^\s]+)/gi,s=/\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67)\uDB40\uDC7F|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC68(?:\uD83C\uDFFF\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFE])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFC-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|[\u2695\u2696\u2708]\uFE0F|\uD83D[\uDC66\uDC67]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|(?:\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708]|\uD83C\uDFFB\u200D[\u2695\u2696\u2708])\uFE0F|\uD83C[\uDFFB-\uDFFF])|\uD83E\uDDD1(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83E\uDD1D\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD]))|\uD83D\uDC69(?:\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69])|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFF\u200D(?:\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD]))|\uD83D\uDC69\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFE])|\uD83D\uDC69\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83D\uDC69\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83D\uDC69\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83D\uDC69\uD83C\uDFFB\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69])(?:\uD83C[\uDFFC-\uDFFF])|\uD83D\uDC69\u200D\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708]|\uD83C\uDFFB\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\uD83C\uDFF3\uFE0F\u200D\u26A7|\uD83E\uDDD1(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\uD83D\uDC3B\u200D\u2744|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uFE0F\u200D[\u2640\u2642]|(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642])|\uD83C\uDFF4\u200D\u2620|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E-\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3C-\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDF])\u200D[\u2640\u2642])\uFE0F|\uD83D\uDC69\u200D\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|\uD83D\uDC69\u200D\uD83D\uDC67|\uD83D\uDC69\u200D\uD83D\uDC66|\uD83D\uDC15\u200D\uD83E\uDDBA|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDF4\uD83C\uDDF2|\uD83D\uDC08\u200D\u2B1B|\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|[#\*0-9]\uFE0F\u20E3|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD0C\uDD0F\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDED5-\uDED7\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6])\uFE0F?|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0C\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3C-\uDD3E\uDD77\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD])/g,o=new RegExp(["̍","̎","̄","̅","̿","̑","̆","̐","͒","͗","͑","̇","̈","̊","͂","̓","̈́","͊","͋","͌","̃","̂","̌","͐","̀","̋","̏","̒","̓","̔","̽","̉","ͣ","ͤ","ͥ","ͦ","ͧ","ͨ","ͩ","ͪ","ͫ","ͬ","ͭ","ͮ","ͯ","̾","͛","͆","̚","̕","̛","̀","́","͘","̡","̢","̧","̨","̴","̵","̶","͏","͜","͝","͞","͟","͠","͢","̸","̷","͡","҉","̖","̗","̘","̙","̜","̝","̞","̟","̠","̤","̥","̦","̩","̪","̫","̬","̭","̮","̯","̰","̱","̲","̳","̹","̺","̻","̼","ͅ","͇","͈","͉","͍","͎","͓","͔","͕","͖","͙","͚","̣"].join("|"),"gi"),r=/[^\x00-\x7F]/g,l={CREATE_INSTANT_INVITE:1,KICK_MEMBERS:2,BAN_MEMBERS:4,ADMINISTRATOR:8,MANAGE_CHANNELS:16,MANAGE_GUILD:32,ADD_REACTIONS:64,VIEW_AUDIT_LOG:128,PRIORITY_SPEAKER:256,STREAM:512,VIEW_CHANNEL:1024,SEND_MESSAGES:2048,SEND_TTS_MESSAGES:4096,MANAGE_MESSAGES:8192,EMBED_LINKS:16384,ATTACH_FILES:32768,READ_MESSAGE_HISTORY:65536,MENTION_EVERYONE:1<<17,USE_EXTERNAL_EMOJIS:1<<18,VIEW_GUILD_INSIGHTS:1<<19,CONNECT:1<<20,SPEAK:1<<21,MUTE_MEMBERS:1<<22,DEAFEN_MEMBERS:1<<23,MOVE_MEMBERS:1<<24,USE_VOICE_ACTIVITY:1<<25,CHANGE_NICKNAME:1<<26,MANAGE_NICKNAMES:1<<27,MANAGE_ROLES:1<<28,MANAGE_WEBHOOKS:1<<29,MANAGE_EMOJIS_AND_STICKERS:1<<30,USE_SLASH_COMMANDS:BigInt(BigInt(1)<<BigInt(31)),REQUEST_TO_SPEAK:BigInt(BigInt(1)<<BigInt(32)),MANAGE_THREADS:BigInt(BigInt(1)<<BigInt(34)),USE_PUBLIC_THREADS:BigInt(BigInt(1)<<BigInt(35)),USE_PRIVATE_THREADS:BigInt(BigInt(1)<<BigInt(36)),USE_EXTERNAL_STICKERS:BigInt(BigInt(1)<<BigInt(37))},u={STAFF:1,PARTNER:2,HYPESQUAD_EVENTS:4,BUG_HUNTER:8,HYPESQUAD_BRAVERY:64,HYPESQUAD_BRILLIANCE:128,HYPESQUAD_BALANCE:256,EARLY_SUPPORTER:512,TEAM_USER:1024,SYSTEM:4096,BUG_HUNTER_GOLDEN:16384,VERIFIED_BOT:65536,VERIFIED_BOT_DEVELOPER:1<<17,CERTIFIED_MODERATOR:1<<18},d="AL_",c={CHANNEL_CREATE:"OnChannelCreate",CHANNEL_DELETE:"OnChannelDelete",CHANNEL_UPDATE:"OnChannelUpdate",CHANNEL_PINS_UPDATE:"OnChannelPinsUpdate",GUILD_CREATE:"OnGuildCreate",GUILD_BAN_ADD:"OnGuildBanAdd",GUILD_BAN_REMOVE:"OnGuildBanRemove",GUILD_EMOJIS_UPDATE:"OnGuildEmojisUpdate",GUILD_INTEGRATIONS_UPDATE:"OnGuildIntegrationsUpdate",GUILD_MEMBER_ADD:"OnGuildMemberAdd",GUILD_MEMBER_REMOVE:"OnGuildMemberRemove",GUILD_MEMBER_UPDATE:"OnGuildMemberUpdate",GUILD_ROLE_CREATE:"OnGuildRoleCreate",GUILD_ROLE_UPDATE:"OnGuildRoleUpdate",GUILD_ROLE_DELETE:"OnGuildRoleDelete",GUILD_UPDATE:"OnGuildUpdate",MESSAGE_CREATE:"OnMessageCreate",MESSAGE_DELETE:"OnMessageDelete",MESSAGE_DELETE_BULK:"OnMessageDeleteBulk",MESSAGE_REACTION_ADD:"OnMessageReactionAdd",MESSAGE_REACTION_REMOVE:"OnMessageReactionRemove",MESSAGE_REACTION_REMOVE_ALL:"OnMessageReactionRemoveAll",MESSAGE_UPDATE:"OnMessageUpdate",TYPING_START:"OnTypingStart",VOICE_STATE_UPDATE:"OnVoiceStateUpdate",VOICE_SERVER_UPDATE:"OnVoiceServerUpdate",WEBHOOKS_UPDATE:"OnWebhooksUpdate",USER_UPDATE:"OnUserUpdate"},m={CHANNEL_CREATE:"CHANNEL_CREATE",CHANNEL_DELETE:"CHANNEL_DELETE",CHANNEL_UPDATE:"CHANNEL_UPDATE",CHANNEL_PINS_UPDATE:"CHANNEL_PINS_UPDATE",GUILD_CREATE:"GUILD_CREATE",GUILD_BAN_ADD:"GUILD_BAN_ADD",GUILD_BAN_REMOVE:"GUILD_BAN_REMOVE",GUILD_EMOJIS_UPDATE:"GUILD_EMOJIS_UPDATE",GUILD_INTEGRATIONS_UPDATE:"GUILD_INTEGRATIONS_UPDATE",GUILD_MEMBER_ADD:"GUILD_MEMBER_ADD",GUILD_MEMBER_REMOVE:"GUILD_MEMBER_REMOVE",GUILD_MEMBER_UPDATE:"GUILD_MEMBER_UPDATE",GUILD_ROLE_CREATE:"GUILD_ROLE_CREATE",GUILD_ROLE_UPDATE:"GUILD_ROLE_UPDATE",GUILD_ROLE_DELETE:"GUILD_ROLE_DELETE",GUILD_UPDATE:"GUILD_UPDATE",MESSAGE_CREATE:"MESSAGE_CREATE",MESSAGE_DELETE:"MESSAGE_DELETE",MESSAGE_DELETE_BULK:"MESSAGE_DELETE_BULK",MESSAGE_REACTION_ADD:"MESSAGE_REACTION_ADD",MESSAGE_REACTION_REMOVE:"MESSAGE_REACTION_REMOVE",MESSAGE_REACTION_REMOVE_ALL:"MESSAGE_REACTION_REMOVE_ALL",MESSAGE_UPDATE:"MESSAGE_UPDATE",VOICE_STATE_UPDATE:"VOICE_STATE_UPDATE",VOICE_SERVER_UPDATE:"VOICE_SERVER_UPDATE",TYPING_START:"TYPING_START",WEBHOOKS_UPDATE:"WEBHOOKS_UPDATE",USER_UPDATE:"USER_UPDATE"},g=new Map;let f;g.set(1,"Direct Message"),g.set(0,"Text"),g.set(2,"Voice"),g.set(13,"Stage"),g.set(4,"Category"),g.set(5,"News"),g.set(6,"Store");const p=discord.getGuildId();class h extends Error{constructor(e,t){return super(t),this.name="ConfigError",this.configPath=e,this}}var w;!function(e){e[e.Guest=0]="Guest",e[e.Authorized=10]="Authorized",e[e.Moderator=50]="Moderator",e[e.Administrator=100]="Administrator",e[e.Owner=200]="Owner"}(w||(w={}));const y="1.8.14",E={masterWebhook:"",botUsersWebhook:"",controlUsersRole:"",metalApi:{key:"",url:"",botToken:""},github:{token:"",org:"weebsquad",deployments:{pyboat:"node.js.deploy.yml"}},localization:{cdnUrl:"https://pyboat.i0.tf/i18n/",default:"source/base"},ranks:w,Ranks:w},D={admins:[],botsCommands:[],disabled:!1,showErrors:!0,blacklist:[],masterChannel:null,whitelistedGuilds:[]},_=0===E.github.token.length&&0===E.metalApi.key.length,b=new Date(1628673707258),A={guildId:p,language:E.localization.default,levels:{users:{},roles:{}},modules:{queue:!1,reddit:{enabled:!1,subs:[]},logging:{enabled:!1,auditLogs:!0,logChannels:{},messages:{},messagesAuditLogs:{},ignores:{channels:[],users:[],self:!1,selfAuditLogs:!1,extendUsersToAuditLogs:!0,blacklistedUsers:!1,logChannels:!0},userTag:"{MENTION}",actorTag:"{MENTION}",suffixReasonToAuditlog:!0,reasonSuffix:" with reason `{REASON_RAW}`",timezone:"Etc/GMT+0"},commands:{enabled:!1,allowMentionPrefix:!1,hideNoAccess:!1,duplicateRegistry:!0,overrides:{}},translation:{enabled:!1,googleApi:{key:""}},infractions:{enabled:!1,checkLogs:!0,integrate:!0,muteRole:"",defaultDeleteDays:0,targeting:{reqDiscordPermissions:!0,checkLevels:!0,checkRoles:!0,allowSelf:!1,othersEditLevel:100},confirmation:{reaction:!0,message:!0,expiry:10,deleteOriginal:!1}},utilities:{enabled:!1,snipe:{enabled:!1,delay:120},customUserRoles:{enabled:!1,clearOnKick:!0,clearOnBan:!0,clearOnLeave:!0}},antiPing:{enabled:!1,actualCaughtMessage:"",caughtMessages:[],instaDeletePings:!1,banOnLeave:!1,pingsForAutoMute:3,emojiActions:{},targets:{users:{include:[],exclude:[]},roles:{include:[],exclude:[]},channels:{include:[],exclude:[]},categories:{include:[],exclude:[]}},staff:w.Moderator,bypass:{users:[],roles:[],level:w.Moderator}},counting:{enabled:!1,channels:[],autoPins:{single:[1,69,100,200,420,666,1e3,1337,6969,9001,1e4,99999],repeating:[1e3],repeatingLast:[69]},useWebhook:!1,webhook:""},starboard:{enabled:!1,channels:{}},censor:{enabled:!1,nameChecks:{},channels:{},categories:{},levels:{}},antiSpam:{enabled:!1,antiRaidPingRole:"",antiRaidPingChannel:"",antiRaid:{},channels:{},categories:{},levels:{}},tags:{enabled:!1,maxLength:200,levelEditOthers:50},admin:{enabled:!1,defaultRole:"",persist:{enabled:!1,levels:{},saveOnBan:!0},voiceLink:{enabled:!1,global:"",channels:{}},groupRoles:{},lockedRoles:[],autoroles:{enabled:!1,human:[],bot:[]},reactroles:{enabled:!1,definitions:[]},autoPrune:{enabled:!1,channels:{}}},customCode:{enabled:!1,url:""}}},I={};function v(e,t){for(const n in e){const i=e[n];if(null===i||"object"!=typeof i)void 0===t[n]&&(t[n]=i);else{if(Array.isArray(i)&&!Array.isArray(t[n])){t[n]=i;continue}if(Array.isArray(t[n])&&t[n].length>0&&!Array.isArray(i)&&"object"==typeof i&&null!==i){const e={};if(t[n].forEach((t=>{if(void 0!==t.__key){let n=t.__key;"number"==typeof n&&(n=n.toString()),delete t.__key;const i=Object.keys(t);1===i.length?e[n]=t[i[0]]:e[n]={...t}}})),e!=={}){t[n]=e;continue}}"object"!=typeof t[n]&&(t[n]={}),t[n]=v(i,t[n])}}return t}function C(e){return e=v(A,e)}const S=new pylon.KVNamespace("config");let M=!1,T=Date.now();async function O(e=!1){return await async function(e){if(M){Date.now()-T>6e4&&(M=!1)}if(M&&!e){const e=Date.now();let t=3;for(;void 0===f&&void 0===f&&M&&!(Date.now()-e>=1e4);)t++,await sleep(Math.min(1e3,Math.pow(2,t)));return void 0!==f}e||(f=void 0);T=Date.now(),M=!0;try{const e=await(await fetch("https://pyboat.i0.tf/globalconf.json")).json();for(const t in e){const n=e[t];E[t]=n}}catch(e){if(console.warn("Loading globals error (1)"),!_)return!1}if("object"!=typeof E&&(console.warn("Loading globals error (2)"),!_))return!1;if(_)for(const e in D)E[e]=D[e];if(!(E.botUser=await discord.getBotUser(),_||E.botUser&&E.botUser.id===E.botId))return console.warn("Couldnt fetch bot user account details"),!1;if(null===await discord.getGuild())return console.warn("Couldnt fetch guild"),M=!1,!1;E.version||(E.version=y);const t=+E.version.split(".").join(""),n=+y.split(".").join("");n<t&&console.warn(`Version mismatch! Current=1.8.14, New=${E.version} | Bot needs update.`);const i=await pylon.kv.get("__botVersion");if(i){if(i!==E.version&&n>=t){try{await pylon.kv.delete("__botVersionLastCheck")}catch(e){}await async function(e,t){const n=+e.split(".").join(""),i=+t.split(".").join(""),a=[];for(const e in ui){const t=+e.split(".").join("");t>n&&t<=i&&a.push(e)}if(a.length>0){const e=a.sort(((e,t)=>+e.split(".").join("")-+t.split(".").join("")));console.info("Running updates!",e);for(const t in e)await ui[e[t]]()}await pylon.kv.put("__botVersion",t)}("string"==typeof i?i:"",y)}}else await pylon.kv.put("__botVersion",y);const a=await S.items();let s;if(a.length>0){const e=a.map((e=>e.value)).join("");s=JSON.parse(e)}void 0!==I[p]&&(s=I[p]);"object"!=typeof s&&(console.warn("No user config - using default config"),s=JSON.parse(JSON.stringify(A)));await async function(e,t){U=await $(e,t)}(A.language,s.language),A.modules.logging.messages=U.modules.logging.l_messages,A.modules.logging.messagesAuditLogs=U.modules.logging.l_messages_logs,A.modules.logging.messages.DEBUG={BOT_ERROR:"⛔ Bot error\n```js\n{ERROR}\n```",BOT_STARTED:"✅ Bot code reloaded",RAW_EVENT:"📥 received `{EVENT}` / Queue: **{QUEUE}**",CRON_RAN:"⌚ Cron task `{CRON_NAME}` executed.",BLACKLISTED_USER_ACTION:"⛔ global-blacklisted user {USERTAG} tried to perform {ACTION}"},f=C(s);const o=Math.floor(await pylon.getCpuTime());return console.info(`Initialized on VM Cpu time so far: ${o}ms`),!0}(e)}function R(e){const t=new ArrayBuffer(2*e.length),n=new Uint16Array(t);for(let t=0,i=e.length;t<i;t++)n[t]=e.charCodeAt(t);return t}function N(e){return(".config."===e.content||".config. delete"===e.content)&&(e.author instanceof discord.User&&(!e.author.bot&&(null===e.webhookId&&(e instanceof discord.GuildMemberMessage&&e.member instanceof discord.GuildMember?0!==e.type?"Not a normal message":e.mentions.length>0?"Mentioning someone in the message":0!==e.flags?"Message contains flags":e.attachments.length>1?"Contains too many attachments":e.member.can(8)||"object"==typeof E&&Array.isArray(E.admins)&&E.admins.includes(e.author.id)?1===e.attachments.length&&"config.json"===e.attachments[0].filename?"update":".config. delete"===e.content?"delete":"check":"Author not sufficient permissions to change config (needs Administrator permission)":"Msg is not a guild message"))))}const L=["\0",""];discord.on("MESSAGE_CREATE",(async e=>{void 0===f&&await O();const t=N(e);if(t)if(["update","check","delete"].includes(t)){if("update"===t)try{let t;t=await fetch(e.attachments[0].url),t.ok||await e.reply(B(U.config.cant_download_file,["user_mention",e.author.toMention()]));try{await e.delete()}catch(t){await e.reply(B(U.config.cant_delete_message,["user_mention",e.author.toMention()]))}t=await t.text();let n=t.split("");n=n.filter((e=>"string"==typeof e&&!L.includes(e)));for(let e=0;e<n.length&&"{"!==n[e];e+=1)n.splice(e,1);for(let e=n.length-1;e>0&&"}"!==n[e];e-=1)n.splice(e,1);n=n.filter((e=>"string"==typeof e&&e.length>0)),t=n.join("");const i=JSON.parse(t);if("string"!=typeof i.guildId||i.guildId!==p)return void await e.reply(B(U.config.incorrect_guild_id,["user_mention",e.author.toMention()]));const a=t.match(/[\S\s]{1,5800}/g);await S.clear();for(let e=0;e<a.length;e+=1)await S.put(e.toString(),a[e]);await O(!0),await e.reply(B(U.config.updated_config,["user_mention",e.author.toMention()]))}catch(t){await e.reply(B(U.config.error_updating_config,["user_mention",e.author.toMention(),"error",`\`\`\`\n${t.message}\n\`\`\``]))}else if("check"===t){try{await e.delete()}catch(e){}let t=!1;const n=await S.items();let i;n.length>0&&(i=n.map((e=>e.value)).join("")),void 0!==I[p]&&(i=I[p]),i||(i=A,t=!0),"object"!=typeof i||"string"==typeof i.guildId&&i.guildId===p||(i.guildId=p);const a="string"!=typeof i?JSON.stringify(i,null,2):i,s=await e.reply({content:B(!0===t?U.config.get_default_config:U.config.get_config,["user_mention",e.author.toMention()]),attachments:[{name:"config.json",data:R(a)}]});await sleep(15e3),await s.delete()}else if("delete"===t){try{await e.delete()}catch(e){}await S.clear(),await O(!0),await e.reply(B(U.config.deleted_config,["user_mention",e.author.toMention()]))}}else console.warn(`${e.author?e.author.getTag():""} tried to run a config command: ${t}`)}));var k=Object.freeze({__proto__:null,get config(){return f},guildId:p,ConfigError:h,get Ranks(){return w},version:y,globalConfig:E,isPublic:_,deployDate:b,guildConfigs:I,InitializeConfig:O,isMessageConfigUpdate:N});async function G(e){if(e.length<1)throw new Error("invalid language code!");const t=await fetch(`${E.localization.cdnUrl}${e}.json`);return await t.json()}async function $(e,t){if(e===t){return await G(e)}try{return await async function(e){if(e.length<1)throw new Error("invalid language code!");const t=await fetch(`${E.localization.cdnUrl}/defaults/${e}.json`);return await t.json()}(t)}catch(t){return await G(e)}}let U;function B(e,t){if(0===t.length||t.length%2!=0)throw new Error("placeholders' length needs to be a multiple of two");let n="";for(let i=0;i<t.length;i++)i%2!=0?e=e.split(`{${n}}`).join(t[i]):n=t[i].toUpperCase();return e}class F extends discord.User{constructor(){super(...arguments),this.public_flags=0,this.bot=!1,this.system=!1,this.premium_type=0}}async function P(e,t,n,i,a=!1){n=n.toUpperCase();const s={"content-type":"application/json",accept:"application/json","proxy-key":E.metalApi.key,"api-url":e};a&&(s.Authorization=`Bot ${E.metalApi.botToken}`);for(const e in t)s[e]||(s[e]=t[e]);const o=new Request(E.metalApi.url,{method:n,headers:s,body:i||void 0});return await fetch(o)}const j={author:{iconUrl:"icon_url",proxyIconUrl:"proxy_icon_url"},thumbnail:{proxyUrl:"proxy_url"},footer:{iconUrl:"icon_url",proxyIconUrl:"proxy_icon_url"},image:{proxyUrl:"proxy_url"}};async function x(e,t,n,i,a,s=!1,o){const[r,l]=function(e){return(e=e.split("https://discord.com/api/webhooks/").join("").split("https://discord.com/api/webhooks/").join("").split("https://discordapp.com/api/webhooks/").join("").split("https://discordapp.com/api/webhooks/").join("")).split("/")}(e),u=`webhooks/${r}/${l}`;Array.isArray(n)&&n.length>0&&(n=n.map((e=>{for(const t in j){const n=e[t];if(!(void 0===e[t]||null===e[t]||Array.isArray(e[t])&&0===e[t].length))for(const i in n){const n=j[t][i];null!=n&&(e[t][n]=e[t][i],delete e[t][i])}}for(const t in e){const n=e[t];(null==n||Array.isArray(n)&&0===n.length)&&delete e[t]}return e})));const d={content:t.length>0?t:"",username:i,avatar_url:a,tts:!!s,embeds:Array.isArray(n)&&n.length>0?n:[],allowed_mentions:o||{}};for(const e in d)void 0===d[e]&&delete d[e];const c=await P(u,{},"POST",JSON.stringify(d),!1),{status:m}=c;if(204!==m){const e=await c.json();return Zn(`Webhook - ${m} - `,JSON.stringify(e)),!1}return!0}async function H(e,t=!1){let n;try{t&&!_||(n=await discord.getUser(e))}catch(e){}if(void 0!==n)return n;if(_)return null;const i=await P(`users/${e}`,{},"GET",null,!0);try{const e=await i.json();return!e.id||e.code||e.message?null:ei(e,F)}catch(e){return Zn(e),null}}class V{constructor(e){this.timeout=null,this.toRender=[],this.rendered="",this.messages=[],this.channel=e}async timeoutHandler(){this.timeout=null;const e=this.toRender;this.toRender=[];const t=e.map((e=>"object"==typeof e?JSON.stringify(e):"symbol"==typeof e?e.toString():`${e}`)).join("\n");this.rendered+=t;const n=this.renderedToMessageContent(),i=this.messages.map(((e,t)=>e.content!==n[t]?e.edit({content:n[t]}):null)).filter((e=>null!=e)),a=n.slice(this.messages.length,n.length).map((e=>this.channel.sendMessage(e)));await Promise.all(i.concat(a))}renderedToMessageContent(){const e=this.rendered.match(/[\S\s]{1,1991}/g);if(null==e)throw new Error("Expectation failed.");return e.map((e=>`\`\`\`\n${e}\`\`\``))}log(e){null!=this.timeout&&clearTimeout(this.timeout),this.toRender.push(e);const t=setTimeout(this.timeoutHandler.bind(this),50);"number"==typeof t&&(this.timeout=t)}}async function K(e){const t=new Map,n=new Map,i=new Map;let a=e.match(/<@![0-9]{18}>/g);a=a?a.map((e=>e=(e=e.split(" ").join("")).substr(3).slice(0,-1))):[];let s=e.match(/<@[0-9]{18}>/g);s=s?s.map((e=>e=(e=e.split(" ").join("")).substr(2).slice(0,-1))):[];const o=[...a,...s];let r=e.match(/<@&[0-9]{18}>/g);Array.isArray(r)&&(r=r.map((e=>e=(e=e.split(" ").join("")).substr(3).slice(0,-1))));let l=e.match(/<#[0-9]{18}>/g);if(Array.isArray(l)&&(l=l.map((e=>e=(e=e.split(" ").join("")).substr(2).slice(0,-1)))),o.length>0){await Promise.allSettled(o.map((async e=>{if(!t.has(e)){const n=await discord.getUser(e);if(!n)return;t.set(e,n.getTag())}})));for(const[n,i]of t)e=(e=e.replace(`<@!${n}>`,`@${i}`)).replace(`<@${n}>`,`@${i}`)}if(Array.isArray(l)){await Promise.all(l.map((async e=>{if(!n.has(e)&&e!==discord.getBotId()){const t=await discord.getChannel(e);if(t instanceof discord.DmChannel)return;if(!t)return;n.set(e,t)}})));for(const[t,i]of n){let t="#";2===i.type&&(t="🔊"),13===i.type&&(t="🎙️"),4===i.type&&(t="‣"),e=e.split(`<#${i.id}>`).join(t+i.name)}}if(Array.isArray(r)){const t=await discord.getGuild(),a=await t.getRoles();r.map((async e=>{if(!n.has(e)){const t=a.find((t=>t.id===e));t&&i.set(e,t)}}));for(const[n,a]of i){if(n===t.id){e=e.split(`<@&${n}>`).join(Qn("@everyone"));continue}const i="🛡️";e=e.split(`<@&${n}>`).join(i+a.name)}}return e}function Y(e,t){return e instanceof Date&&(e=e.getTime()),e>1e12&&(e/=1e3),`<t:${e=Math.floor(e)}${t?`:${t}`:""}>`}let W=0;function z(e=Date.now()){e instanceof Date&&(e=e.getTime()),W>=4095&&(W=0);return function(e,t=10){t=BigInt(t);let n=BigInt(0);for(let i=0;i<e.length;i+=1){let a=e[e.length-1-i].charCodeAt(0)-48;a>=10&&(a-=39),n+=t**BigInt(i)*BigInt(a)}return n}(`${ii((e-t).toString(2),42)}0000100000${ii((W+=1).toString(2),12)}`,2).toString()}function q(e){const n=ii(BigInt(e).toString(2),64);return{timestamp:parseInt(n.substring(0,42),2)+t,workerID:parseInt(n.substring(42,47),2),processID:parseInt(n.substring(47,52),2),increment:parseInt(n.substring(52,64),2),binary:n}}function J(e,t){const n={added:[],removed:[],changed:[]},i=e.permissionOverwrites,a=t.permissionOverwrites;i.map((e=>{const t=a.find((t=>t.id===e.id));t?e.allow===t.allow&&e.deny===t.deny&&e.type===t.type||n.changed.find((t=>t.id===e.id))||n.changed.push({...e,allow:BigInt(e.allow),deny:BigInt(e.deny)}):n.added.find((t=>t.id===e.id))||n.added.push({...e,allow:BigInt(e.allow),deny:BigInt(e.deny)})})),a.map((e=>{const t=i.find((t=>t.id===e.id));t?e.allow===t.allow&&e.deny===t.deny&&e.type===t.type||n.changed.find((t=>t.id===e.id))||n.changed.push({...e,allow:BigInt(e.allow),deny:BigInt(e.deny)}):n.removed.find((t=>t.id===e.id))||n.removed.push({...e,allow:BigInt(e.allow),deny:BigInt(e.deny)})}));for(const e in n)for(const t in n[e])n[e][t].allow=BigInt(n[e][t].allow),n[e][t].deny=BigInt(n[e][t].deny);return n}async function Q(e){const t=e.roles,n=[];return(await(await discord.getGuild(e.guildId)).getRoles()).forEach((e=>{t.indexOf(e.id)>-1&&n.push(e)})),n}async function Z(e){const t=await e.getGuild(),n=(await t.getRoles()).filter((t=>e.roles.includes(t.id))).sort(((e,t)=>t.position-e.position));if(Array.isArray(n)&&0===n.length){const e=await t.getRole(t.id);return e||ei({},discord.Role)}return n[0]}class X{constructor(e){this.FLAGS={},"string"==typeof e&&Yn(e)&&(e=BigInt(e)),"string"!=typeof e&&(this.bitfield=BigInt(this.resolve(e)))}any(e){return(this.bitfield&this.resolve(e))!==BigInt("0")}equals(e){return this.bitfield===this.resolve(e)}has(e){return Array.isArray(e)?e.every((e=>this.has(e))):(e=this.resolve(e),"bigint"==typeof this.bitfield&&"bigint"!=typeof e&&(e=BigInt(e)),(this.bitfield&e)===e)}missing(e){return Array.isArray(e)||(e=this.constructor(e).toArray(!1)),e.filter((e=>!this.has(e)))}freeze(){return Object.freeze(this)}add(...e){let t=BigInt("0");for(const n of e)t|=this.resolve(n);return"bigint"==typeof this.bitfield&&(t=BigInt(t)),Object.isFrozen(this)?this.constructor(this.bitfield|t):(this.bitfield|=t,this)}remove(...e){let t=BigInt("0");for(const n of e)t|=this.resolve(n);return Object.isFrozen(this)?this.constructor(this.bitfield&~t):(this.bitfield&=~t,this)}serialize(){const e={};for(const[t,n]of Object.entries(this.FLAGS))e[t]=this.has(n);return e}toArray(){return Object.keys(this.FLAGS).filter((e=>this.has(e)))}toJSON(){return this.bitfield}valueOf(){return this.bitfield}*[Symbol.iterator](){yield*this.toArray()}resolve(e=0){if("number"==typeof e&&e>=0)return"bigint"==typeof this.bitfield&&(e=BigInt(e)),e;if(e instanceof X)return e.bitfield;if("bigint"==typeof e)return e;if(Array.isArray(e))return e.map((e=>this.resolve(e))).reduce(((e,t)=>e|t),0);if("string"==typeof e&&void 0!==this.FLAGS[e]){let t=this.FLAGS[e];return"number"==typeof t&&(t=BigInt(t)),t}throw new Error("BITFIELD_INVALID")}}class ee extends X{constructor(){super(...arguments),this.FLAGS=l,this.ALL=Object.values(this.FLAGS).reduce(((e,t)=>("bigint"==typeof t&&(e=BigInt(e)),e|t)),0),this.DEFAULT=104324673}any(e,t=!0){return t&&super.has(this.FLAGS.ADMINISTRATOR)||super.any(e)}has(e,t=!0){return t&&super.has(this.FLAGS.ADMINISTRATOR)||super.has(e)}serialize(e=!0){const t={};for(const[n,i]of Object.entries(this.FLAGS))t[n]=this.has(i,e);return t}}class te extends X{constructor(){super(...arguments),this.FLAGS=u,this.ALL=Object.values(this.FLAGS).reduce(((e,t)=>("bigint"==typeof t&&(e=BigInt(e)),e|t)),0),this.DEFAULT=0}any(e){return super.any(e)}has(e){return super.has(e)}}function ne(e=!1){return(e||p===E.masterGuild)&&"boolean"==typeof f.modules.logging.debug&&!0===f.modules.logging.debug}function ie(e){e instanceof discord.GuildChannel&&(e=e.id);const{ignores:t}=f.modules.logging;if(!t||"object"!=typeof t)return!1;let n=Array.isArray(t.channels)?[].concat(t.channels):[];if(!0===t.logChannels){const e=Array.from(Object.keys(f.modules.logging.logChannels));n=n.concat(e)}return n.includes(e)}function ae(e){e instanceof discord.User&&(e=e.id),e instanceof discord.GuildMember&&(e=e.user.id);const{ignores:t}=f.modules.logging;if(!t)return!1;const n=Array.isArray(t.users)?[].concat(t.users):[];return!0===t.self&&n.push(discord.getBotId()),!(!t.blacklistedUsers||!hn(e))||n.includes(e)}function se(e){e instanceof discord.User&&(e=e.id),e instanceof discord.GuildMember&&(e=e.user.id);const{ignores:t}=f.modules.logging;if(!t)return!1;const n=Array.isArray(t.users)&&!0===f.modules.logging.extendUsersToAuditLogs?[].concat(t.users):[];return!0===t.selfAuditLogs&&n.push(discord.getBotId()),!(!t.blacklistedUsers||!hn(e))||n.includes(e)}function oe(){return p===E.masterGuild}function re(e=p){return e!==E.masterGuild}function le(e){return 0===e.type?"<:channel:735780703983239218>":2===e.type?"<:voice:735780703928844319>":13===e.type?"🎙️":6===e.type?"<:store:735780704130170880>":5===e.type?"<:news:735780703530385470>":4===e.type?"<:category:754241739258069043>":""}function ue(e){if(null===e||"object"!=typeof e)return e;const t=e.nick??e.user.username,n=new Map([["{TAG}",Qn(e.user.getTag())],["{USERNAME}",Qn(e.user.username)],["{DISCRIMINATOR}",e.user.discriminator],["{NICKNAME}",Qn(t)],["{ID}",e.user.id],["{MENTION}",e.toMention()]]);let i=f.modules.logging.userTag;for(const[e,t]of n)i=i.split(e).join(t);return i}function de(e){if(null===e||"object"!=typeof e)return e;e instanceof discord.GuildMember&&(e=e.user);const t=new Map([["{TAG}",Qn(e.getTag())],["{USERNAME}",Qn(e.username)],["{DISCRIMINATOR}",e.discriminator],["{ID}",e.id],["{NICKNAME}",Qn(e.username)],["{MENTION}",e.toMention()]]);let n=f.modules.logging.userTag;for(const[e,i]of t)n=n.split(e).join(i);return n}async function ce(e,t=!1){let n=e.content,i=1400;t&&(i=Math.floor(i/2)),n=n.split("\t").join(" ");let a=n.split("\n");a=a.filter((e=>""!==e));let s=!1;return a.length>=25&&(a=a.slice(0,Math.min(a.length,25)),s=!0),n=Qn(a.join("\n"),!1,!0),e.mentions.length>0&&e.mentions.forEach((e=>{n=n.split(`<@!${e.id}>`).join(`@${e.username}#${e.discriminator}`).split(`<@${e.id}>`).join(`@${e.username}#${e.discriminator}`)})),n=await K(n),n.length>=i?n=`${n.substring(0,Math.min(n.length,i))} [...]`:s&&(n+="\n[...]"),n.length>0&&(n.includes("\n")||!n.includes("\n")&&n.length>=200||n.length>=400?n=`\`\`\`\n${Qn(n,!1,!0)}\n\`\`\``:(n=Qn(n,!0,!1),!s&&n.length>200&&(n=`${n.substring(0,Math.min(n.length,200))} [...]`),n=`\`${n}\``)),n}function me(e){if(null===e||"object"!=typeof e)return e;let t;e instanceof discord.GuildMember?(t=e.nick??e.user.username,e=e.user):t=e.username;const n=new Map([["{TAG}",Qn(e.getTag())],["{USERNAME}",Qn(e.username)],["{DISCRIMINATOR}",e.discriminator],["{ID}",e.id],["{MENTION}",e.toMention()],["{NICKNAME}",Qn(t)]]);let i=f.modules.logging.actorTag;for(const[e,t]of n)i=i.split(e).join(t);return i}function ge(e,t,n=!1,i=!1){if(!0===n){let n=f.modules.logging.messagesAuditLogs[e][t];return f.modules.logging.suffixReasonToAuditlog&&-1===n.indexOf("{REASON}")&&-1===n.indexOf("{REASON_RAW}")&&!i&&(n+="{REASON}"),n}return f.modules.logging.messages[e][t]}function fe(e,t){for(let[n,i]of t)n=n.split("{").join("").split("}").join(""),e=e.split(`{${n}}`).join(i);return e}const pe={boost(e,t,n){const i=new Map([["USERTAG",ue(t)],["USER_ID",t.user.id],["USER",t.user]]);let a="";return null!==t.premiumSince&&null===n.premiumSince?a="BOOSTING_STARTED":null===t.premiumSince&&null!==n.premiumSince&&(a="BOOSTING_STOPPED"),""!==a&&(i.set("TYPE",a),i)},discriminator:(e,t,n)=>new Map([["USERTAG",ue(t)],["TYPE","DISCRIMINATOR_CHANGED"],["OLD_DISCRIMINATOR",n.user.discriminator],["NEW_DISCRIMINATOR",t.user.discriminator],["USER_ID",t.user.id],["USER",t.user]]),username:(e,t,n)=>new Map([["USERTAG",ue(t)],["TYPE","USERNAME_CHANGED"],["OLD_USERNAME",n.user.username],["NEW_USERNAME",t.user.username],["USER_ID",t.user.id],["USER",t.user]]),async avatar(e,t,n){const i=new Map([["USERTAG",ue(t)],["USER_ID",t.user.id],["USER",t.user]]);let a="";if(null===t.user.avatar&&null!==n.user.avatar){a="AVATAR_REMOVED",i.set("OLD_AVATAR",n.user.getAvatarUrl());const e=await(await fetch(n.user.getAvatarUrl())).arrayBuffer();i.set("ATTACHMENTS",[{name:`avatar.${n.user.getAvatarUrl().split(".").slice(-1)[0].split("?")[0]}`,data:e,url:n.user.getAvatarUrl()}])}else if(null!==t.user.avatar&&null===n.user.avatar){a="AVATAR_ADDED",i.set("NEW_AVATAR",t.user.getAvatarUrl());const e=await(await fetch(t.user.getAvatarUrl())).arrayBuffer();i.set("ATTACHMENTS",[{name:`avatar.${t.user.getAvatarUrl().split(".").slice(-1)[0].split("?")[0]}`,data:e,url:t.user.getAvatarUrl()}])}else{a="AVATAR_CHANGED",i.set("NEW_AVATAR",t.user.getAvatarUrl()),i.set("OLD_AVATAR",n.user.getAvatarUrl());const e=await(await fetch(t.user.getAvatarUrl())).arrayBuffer();i.set("ATTACHMENTS",[{name:`avatar.${t.user.getAvatarUrl().split(".").slice(-1)[0].split("?")[0]}`,data:e,url:t.user.getAvatarUrl()}])}return i.set("TYPE",a),i},roles(e,t,n){const i=[],a=[];let s="";const o=new Map([["USERTAG",ue(t)],["USER_ID",t.user.id],["USER",t.user]]);return t.roles.forEach((e=>{-1===n.roles.indexOf(e)&&i.push(e)})),n.roles.forEach((e=>{-1===t.roles.indexOf(e)&&a.push(e)})),i.length>0&&0===a.length?(s="ROLES_ADDED",o.set("ADDED_ROLES",i.map((e=>`<@&${e}>`)).join("  "))):0===i.length&&a.length>0?(s="ROLES_REMOVED",o.set("REMOVED_ROLES",a.map((e=>`<@&${e}>`)).join("  "))):(s="ROLES_CHANGED",o.set("CHANGED_ROLES",i.map((e=>`**+**<@&${e}>`)).concat(a.map((e=>`**-**<@&${e}>`))).join("  "))),o.set("TYPE",s),o},nickname(e,t,n){let i="";const a=new Map([["USERTAG",ue(t)],["USER_ID",t.user.id],["USER",t.user]]);return null===n.nick&&null!==t.nick?(i="NICK_ADDED",a.set("NEW_NICK",t.nick)):null!==n.nick&&null===t.nick?(i="NICK_REMOVED",a.set("OLD_NICK",n.nick)):null!==n.nick&&null!==t.nick&&(i="NICK_CHANGED",a.set("NEW_NICK",t.nick),a.set("OLD_NICK",n.nick)),a.set("TYPE",i),a}};async function he(e,t,n,i,a){await un(e,t,"GUILD_MEMBER_UPDATE",n,i,a)}var we=Object.freeze({__proto__:null,getKeys:function(e,t,n){if(ae(t))return[];const i=[];t.nick!==n.nick&&i.push("nickname");let a=!1;return t.roles.forEach((e=>{-1===n.roles.indexOf(e)&&(a=!0)})),n.roles.forEach((e=>{-1===t.roles.indexOf(e)&&(a=!0)})),a&&i.push("roles"),t.user.username!==n.user.username&&i.push("username"),t.user.avatar!==n.user.avatar&&i.push("avatar"),t.premiumSince!==n.premiumSince&&i.push("boost"),t.user.discriminator!==n.user.discriminator&&i.push("discriminator"),i},isAuditLog:function(e,t,n){return!(["avatar","username","boost"].indexOf(t)>-1)&&e.userId!==n.user.id},messages:pe,AL_OnGuildMemberUpdate:he});const ye={name:(e,t,n)=>new Map([["TYPE","NAME_CHANGED"],["OLD_NAME",Qn(n.name,!0)],["NEW_NAME",Qn(t.name,!0)]]),region:(e,t,n)=>new Map([["TYPE","REGION_CHANGED"],["OLD_REGION",n.region],["NEW_REGION",t.region]]),description:(e,t,n)=>new Map([["TYPE","DESCRIPTION_CHANGED"],["OLD_DESC","string"==typeof n.description?U.modules.logging.l_terms.none:Qn(n.description,!0)],["NEW_DESC","string"==typeof t.description?U.modules.logging.l_terms.none:Qn(t.description,!0)]]),defaultMessageNotifications(e,t,n){const i={0:U.modules.logging.l_terms.default_message_notifs.all_messages,1:U.modules.logging.l_terms.default_message_notifs.only_mentions};return new Map([["TYPE","DMN_CHANGED"],["OLD_DMN",i[n.defaultMessageNotifications]],["NEW_DMN",i[t.defaultMessageNotifications]]])},explicitContentFilter(e,t,n){const i={0:U.modules.logging.l_terms.explicit_filter.disabled,1:U.modules.logging.l_terms.explicit_filter.without_roles,2:U.modules.logging.l_terms.explicit_filter.all_members};return new Map([["TYPE","EXPLICIT_FILTER_CHANGED"],["OLD_FILTER",i[n.explicitContentFilter]],["NEW_FILTER",i[t.explicitContentFilter]]])},verificationLevel(e,t,n){const i={0:U.modules.logging.l_terms.verification_level.none,1:U.modules.logging.l_terms.verification_level.low,2:U.modules.logging.l_terms.verification_level.medium,3:U.modules.logging.l_terms.verification_level.high,4:U.modules.logging.l_terms.verification_level.very_high};return new Map([["TYPE","VERIFICATION_LEVEL_CHANGED"],["OLD_LEVEL",i[n.verificationLevel]],["NEW_LEVEL",i[t.verificationLevel]]])},async banner(e,t,n){const i=null!==n.banner?"":null,a=null!==t.banner?t.getBannerUrl():null,s=a?await(await fetch(a)).arrayBuffer():null;let o="";return null!==i&&null!==a?o="BANNER_CHANGED":null!==i&&null===a?o="BANNER_REMOVED":null===i&&null!==a&&(o="BANNER_ADDED"),""===o?null:new Map([["TYPE",o],["OLD_BANNER",i],["NEW_BANNER",a],["ATTACHMENTS",s?[{name:`banner.${a.split(".").slice(-1)[0].split("?")[0]}`,data:s,url:a}]:[]]])},async icon(e,t,n){const i=null!==n.icon?"":null,a=null!==t.icon?t.getIconUrl():null,s=a?await(await fetch(a)).arrayBuffer():null;let o="";return null!==i&&null!==a?o="ICON_CHANGED":null!==i&&null===a?o="ICON_REMOVED":null===i&&null!==a&&(o="ICON_ADDED"),""===o?null:new Map([["TYPE",o],["OLD_ICON",i],["NEW_ICON",a],["ATTACHMENTS",s?[{name:`icon.${a.split(".").slice(-1)[0].split("?")[0]}`,data:s,url:a}]:[]]])},maxPresences:(e,t,n)=>new Map([["TYPE","PRESENCES_CHANGED"],["OLD_PRES",n.maxPresences.toString()],["NEW_PRES",t.maxPresences.toString()]]),mfaLevel(e,t,n){const i={0:U.modules.logging.l_terms.disabled,1:U.modules.logging.l_terms.enabled};return new Map([["TYPE","MFA_LEVEL_CHANGED"],["OLD_LEVEL",i[n.mfaLevel]],["NEW_LEVEL",i[t.mfaLevel]]])},ownerId:(e,t,n)=>new Map([["TYPE","OWNER_CHANGED"],["OLD_OWNER",n.ownerId],["NEW_OWNER",t.ownerId]]),afkChannelId(e,t,n){let i="";return null!==n.afkChannelId&&null!==t.afkChannelId?i="AFKCHANNEL_CHANGED":null!==n.afkChannelId&&null===t.afkChannelId?i="AFKCHANNEL_REMOVED":null===n.afkChannelId&&null!==t.afkChannelId&&(i="AFKCHANNEL_ADDED"),""===i?null:new Map([["TYPE",i],["OLD_CHANNEL",n.afkChannelId],["NEW_CHANNEL",t.afkChannelId]])},afkTimeout:(e,t,n)=>new Map([["TYPE","AFKTIMEOUT_CHANGED"],["OLD_TIMEOUT",n.afkTimeout.toString()],["NEW_TIMEOUT",t.afkTimeout.toString()]]),premiumTier(e,t,n){const i=null!==n.premiumTier?n.premiumTier.toString():U.modules.logging.l_terms.none,a=null!==t.premiumTier?t.premiumTier.toString():U.modules.logging.l_terms.none;return new Map([["TYPE","BOOST_TIER_CHANGED"],["OLD_TIER",i],["NEW_TIER",a]])},premiumSubscriptionCount:(e,t,n)=>new Map([["TYPE","BOOST_SUBSCRIPTIONS_CHANGED"],["OLD_SUBS",n.premiumSubscriptionCount.toString()],["NEW_SUBS",t.premiumSubscriptionCount.toString()]]),preferredLocale:(e,t,n)=>new Map([["TYPE","PREFERRED_LOCALE_CHANGED"],["OLD_LOCALE",n.preferredLocale],["NEW_LOCALE",t.preferredLocale]]),async splash(e,t,n){const i=null!==n.splash?"":null,a=null!==t.splash?t.getSplashUrl():null,s=a?await(await fetch(a)).arrayBuffer():null;let o="";return null!==i&&null!==a?o="SPLASH_CHANGED":null!==i&&null===a?o="SPLASH_REMOVED":null===i&&null!==a&&(o="SPLASH_ADDED"),""===o?null:new Map([["TYPE",o],["OLD_SPLASH",i],["NEW_SPLASH",a],["ATTACHMENTS",s?[{name:`splash.${a.split(".").slice(-1)[0].split("?")[0]}`,data:s,url:a}]:[]]])},systemChannelId(e,t,n){const i=null!==n.systemChannelId?n.systemChannelId:null,a=null!==t.systemChannelId?t.systemChannelId:null;let s="";return null!==i&&null!==a?s="SYSTEM_CHANNEL_CHANGED":null!==i&&null===a?s="SYSTEM_CHANNEL_REMOVED":null===i&&null!==a&&(s="SYSTEM_CHANNEL_ADDED"),""===s?null:new Map([["TYPE",s],["OLD_CHANNEL",i],["NEW_CHANNEL",a]])},vanityUrlCode(e,t,n){const i=null!==n.vanityUrlCode?n.vanityUrlCode:null,a=null!==t.vanityUrlCode?t.vanityUrlCode:null;let s="";return null!==i&&null!==a?s="VANITY_URL_CHANGED":null!==i&&null===a?s="VANITY_URL_REMOVED":null===i&&null!==a&&(s="VANITY_URL_ADDED"),""===s?null:new Map([["TYPE",s],["OLD_VANITY",i],["NEW_VANITY",a]])},widgetEnabled(e,t,n){const i=!0===t.widgetEnabled?U.modules.logging.l_terms.enabled:U.modules.logging.l_terms.disabled,a=!0===n.widgetEnabled?U.modules.logging.l_terms.enabled:U.modules.logging.l_terms.disabled;return new Map([["TYPE","WIDGET_CHANGED"],["OLD_WIDGET",a],["NEW_WIDGET",i]])},widgetChannelId(e,t,n){const i=null!==n.widgetChannelId?n.widgetChannelId:null,a=null!==t.widgetChannelId?t.widgetChannelId:null;let s="";return null!==i&&null!==a?s="WIDGET_CHANNEL_CHANGED":null!==i&&null===a?s="WIDGET_CHANNEL_REMOVED":null===i&&null!==a&&(s="WIDGET_CHANNEL_ADDED"),""===s?null:new Map([["TYPE",s],["OLD_CHANNEL",i],["NEW_CHANNEL",a]])},features(e,t,n){const i=[],a=[];let s="";const o=new Map;return t.features.forEach((e=>{-1===n.features.indexOf(e)&&i.push(e)})),n.features.forEach((e=>{-1===t.features.indexOf(e)&&a.push(e)})),i.length>0&&0===a.length?(s="FEATURES_ADDED",o.set("ADDED_FEATURES",i.join(", "))):0===i.length&&a.length>0?(s="FEATURES_REMOVED",o.set("REMOVED_FEATURES",a.join(", "))):(s="FEATURES_CHANGED",o.set("CHANGED_FEATURES",i.map((e=>`**+**${e}`)).concat(a.map((e=>`**-**${e}`))).join(", "))),o.set("TYPE",s),o}};async function Ee(e,t,n,...i){await un(e,t,"GUILD_UPDATE",n,...i)}var De=Object.freeze({__proto__:null,getKeys:function(e,t,n){const i=[];t.name!==n.name&&i.push("name"),t.region!==n.region&&i.push("region"),t.description!==n.description&&i.push("description"),t.defaultMessageNotifications!==n.defaultMessageNotifications&&i.push("defaultMessageNotifications"),t.explicitContentFilter!==n.explicitContentFilter&&i.push("explicitContentFilter"),t.verificationLevel!==n.verificationLevel&&i.push("verificationLevel"),t.banner!==n.banner&&i.push("banner"),t.icon!==n.icon&&i.push("icon"),t.maxPresences!==n.maxPresences&&i.push("maxPresences"),t.mfaLevel!==n.mfaLevel&&i.push("mfaLevel"),t.ownerId!==n.ownerId&&i.push("ownerId"),t.afkChannelId!==n.afkChannelId&&i.push("afkChannelId"),t.afkTimeout!==n.afkTimeout&&i.push("afkTimeout"),t.premiumTier!==n.premiumTier&&i.push("premiumTier"),t.premiumSubscriptionCount!==n.premiumSubscriptionCount&&i.push("premiumSubscriptionCount"),t.preferredLocale!==n.preferredLocale&&i.push("preferredLocale"),t.splash!==n.splash&&i.push("splash"),t.systemChannelId!==n.systemChannelId&&i.push("systemChannelId"),t.vanityUrlCode!==n.vanityUrlCode&&i.push("vanityUrlCode"),t.widgetEnabled!==n.widgetEnabled&&i.push("widgetEnabled"),t.widgetChannelId!==n.widgetChannelId&&i.push("widgetChannelId");let a=!1;return t.features.forEach((e=>{n.features.includes(e)||(a=!0)})),n.features.forEach((e=>{t.features.includes(e)||(a=!0)})),a&&i.push("features"),i},isAuditLog:function(e,t,n,i){return!(["maxPresences","features","premiumSubscriptionCount","premiumTier","features"].indexOf(t)>-1)},messages:ye,AL_OnGuildUpdate:Ee});const _e={async startTyping(e,t){if(!(t.channelId!==discord.getBotId()&&t.guildId&&t.member instanceof discord.GuildMember)){const e=await H(t.userId);return null===e?null:new Map([["USERTAG",de(e)],["USER_ID",e.id],["USER",e],["CHANNEL_ID",t.channelId],["TYPE","START_TYPING_DM"]])}return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["CHANNEL_ID",t.channelId],["TYPE","START_TYPING_GUILD"]])}};async function be(e,t,n){await un(e,t,"TYPING_START",void 0,n)}var Ae=Object.freeze({__proto__:null,getKeys:function(e,t){return ie(t.channelId)||ae(t.userId)?[]:new Array("startTyping")},messages:_e,OnTypingStart:be});const Ie={async messageDeleted(e,t,n){const i=new Map;return i.set("AUTHOR",de(n.author)),i.set("USER_ID",n.author.id),i.set("USERTAG",de(n.author)),i.set("USER",n.author),i.set("TYPE","MESSAGE_DELETED_DM"),i.set("CONTENT",await ce(n)),i.set("CHANNEL_ID",t.channelId),i.set("MESSAGE_ID",t.id),i},async messageDeletedGuild(e,t,n){const i=new Map;return i.set("AUTHOR",de(n.author)),i.set("USER_ID",n.author.id),i.set("USERTAG",de(n.author)),i.set("USER",n.author),i.set("TYPE","MESSAGE_DELETED_GUILD"),i.set("CHANNEL_ID",t.channelId),i.set("CONTENT",await ce(n)),i.set("MESSAGE_ID",t.id),i},async messageDeletedGuildWebhook(e,t,n){const i=new Map;return i.set("AUTHOR",`${U.modules.logging.l_terms.webhook} #${n.webhookId}`),i.set("TYPE","MESSAGE_DELETED_GUILD_WEBHOOK"),i.set("CHANNEL_ID",t.channelId),i.set("CONTENT",await ce(n)),i.set("MESSAGE_ID",t.id),i},messageDeletedNoCache(e,t){const n=new Map;return n.set("TYPE","MESSAGE_DELETED_DM_NO_CACHE"),n.set("MESSAGE_ID",t.id),n},messageDeletedGuildNoCache(e,t){const n=new Map;return n.set("TYPE","MESSAGE_DELETED_GUILD_NO_CACHE"),n.set("CHANNEL_ID",t.channelId),n.set("MESSAGE_ID",t.id),n}};async function ve(e,t,n,i,a){a&&0!==a.type||await un(e,t,"MESSAGE_DELETE",n,i,a)}var Ce=Object.freeze({__proto__:null,getKeys:function(e,t,n){return null!==n&&ae(n.author.id)?[]:t.guildId?ie(t.channelId)||e instanceof discord.AuditLogEntry&&22===e.actionType?[]:null===n?["messageDeletedGuildNoCache"]:null!==n.webhookId?["messageDeletedGuildWebhook"]:["messageDeletedGuild"]:oe()?null===n?["messageDeletedNoCache"]:["messageDeleted"]:[]},isAuditLog:function(e,t,...n){return!["messageDeleted","messageDeletedNoCache","messageDeletedGuildNoCache","messageDeletedGuildWebhook"].includes(t)&&e instanceof discord.AuditLogEntry},messages:Ie,AL_OnMessageDelete:ve});const Se={async guildMessageContent(e,t,n){if(null===t.author||!(n instanceof discord.Message))return;const i=new Map;return i.set("AUTHOR",ue(t.member)),i.set("USERTAG",ue(t.member)),i.set("USER",t.author),i.set("USER_ID",t.author.id),i.set("TYPE","MESSAGE_CONTENT_UPDATED_GUILD"),i.set("CHANNEL_ID",t.channelId),i.set("CONTENT_BEFORE",await ce(n,!0)),i.set("CONTENT_AFTER",await ce(t,!0)),i.set("MESSAGE_ID",t.id),i},async dmMessageContent(e,t,n){if(null===t.author||!(n instanceof discord.Message))return;const i=new Map;return i.set("AUTHOR",de(t.author)),i.set("USERTAG",de(t.author)),i.set("USER",t.author),i.set("USER_ID",t.author.id),i.set("TYPE","MESSAGE_CONTENT_UPDATED_DM"),i.set("CHANNEL_ID",t.channelId),i.set("CONTENT_BEFORE",await ce(n,!0)),i.set("CONTENT_AFTER",await ce(t,!0)),i.set("MESSAGE_ID",t.id),i}};async function Me(e,t,n,i){null!==i&&await un(e,t,"MESSAGE_UPDATE",null,n,i)}var Te=Object.freeze({__proto__:null,getKeys:function(e,t,n){if(null===n)return[];if(ae(t.author))return[];const i=new Array;if(null===t.guildId)t.content!==n.content&&oe()&&i.push("dmMessageContent");else if(t.content!==n.content){if(ie(t.channelId))return[];i.push("guildMessageContent")}return i},messages:Se,OnMessageUpdate:Me});const Oe={async messagesDeleted(e,t){const n=new Map;return n.set("TYPE","MESSAGES_DELETED"),n.set("COUNT",t.ids.length),n.set("CHANNEL_ID",t.channelId),n}};async function Re(e,t,n,i){await un(e,t,"MESSAGE_DELETE_BULK",n,i)}var Ne=Object.freeze({__proto__:null,getKeys:function(e,t){return ie(t.channelId)?[]:["messagesDeleted"]},isAuditLog:function(e){return e instanceof discord.AuditLogEntry},messages:Oe,AL_OnMessageDeleteBulk:Re});const Le={async guildReaction(e,t){const n=new Map,i=t.emoji;let a=i.toMention();if("GUILD"===i.type){a=`https://cdn.discordapp.com/emojis/${i.id}.png?v=1`;const e=await(await fetch(a)).arrayBuffer();n.set("ATTACHMENTS",[{name:`emoji.${a.split(".").slice(-1)[0].split("?")[0]}`,data:e,url:a}]),a=""}return n.set("TYPE","ADD_REACTION"),n.set("CHANNEL_ID",t.channelId),n.set("MESSAGE_ID",t.messageId),n.set("EMOJI_MENTION",a),n.set("USERTAG",ue(t.member)),n.set("USER_ID",t.userId),n.set("USER",t.member.user),n},async dmReaction(e,t){const n=new Map,i=t.emoji;let a=i.toMention();const s=await H(t.userId);if("GUILD"===i.type){a=`https://cdn.discordapp.com/emojis/${i.id}.png?v=1`;const e=await(await fetch(a)).arrayBuffer();n.set("ATTACHMENTS",[{name:`emoji.${a.split(".").slice(-1)[0].split("?")[0]}`,data:e,url:a}]),a=""}return n.set("TYPE","ADD_REACTION"),n.set("CHANNEL_ID",t.channelId),n.set("MESSAGE_ID",t.messageId),n.set("EMOJI_MENTION",a),n.set("USERTAG",de(s)),n.set("USER",s),n}};async function ke(e,t,n){await un(e,t,"MESSAGE_REACTION_ADD",null,n)}var Ge=Object.freeze({__proto__:null,getKeys:function(e,t){return t.userId&&null!==t.userId&&ae(t.userId)?[]:null===t.guildId||void 0===t.guildId?["dmReaction"]:ie(t.channelId)?[]:["guildReaction"]},isAuditLog:function(e){return!1},messages:Le,OnMessageReactionAdd:ke});const $e={async guildReaction(e,t){const n=new Map,i=t.emoji;let a=i.toMention();if("GUILD"===i.type){a=`https://cdn.discordapp.com/emojis/${i.id}.png?v=1`;const e=await(await fetch(a)).arrayBuffer();n.set("ATTACHMENTS",[{name:`emoji.${a.split(".").slice(-1)[0].split("?")[0]}`,data:e,url:a}]),a=""}return n.set("TYPE","REMOVED_REACTION"),n.set("CHANNEL_ID",t.channelId),n.set("MESSAGE_ID",t.messageId),n.set("EMOJI_MENTION",a),n.set("USERTAG",ue(t.member)),n.set("USER_ID",t.userId),n.set("USER",t.member.user),n},async dmReaction(e,t){const n=new Map,i=t.emoji;let a=i.toMention();const s=await H(t.userId);if("GUILD"===i.type){a=`https://cdn.discordapp.com/emojis/${i.id}.png?v=1`;const e=await(await fetch(a)).arrayBuffer();n.set("ATTACHMENTS",[{name:`emoji.${a.split(".").slice(-1)[0].split("?")[0]}`,data:e,url:a}]),a=""}return n.set("TYPE","REMOVED_REACTION"),n.set("CHANNEL_ID",t.channelId),n.set("MESSAGE_ID",t.messageId),n.set("EMOJI_MENTION",a),n.set("USERTAG",de(s)),n.set("USER",s),n}};async function Ue(e,t,n){await un(e,t,"MESSAGE_REACTION_REMOVE",null,n)}var Be=Object.freeze({__proto__:null,getKeys:function(e,t){return t.userId&&null!==t.userId&&ae(t.userId)?[]:null===t.guildId||void 0===t.guildId?["dmReaction"]:ie(t.channelId)?[]:["guildReaction"]},isAuditLog:function(e){return!1},messages:$e,OnMessageReactionRemove:Ue});const Fe={async reaction(e,t){const n=new Map;return n.set("TYPE","REMOVED_ALL_REACTIONS"),n.set("CHANNEL_ID",t.channelId),n.set("MESSAGE_ID",t.messageId),n}};async function Pe(e,t,n){await un(e,t,"MESSAGE_REACTION_REMOVE_ALL",null,n)}var je=Object.freeze({__proto__:null,getKeys:function(e,t){return ie(t.channelId)?[]:["reaction"]},isAuditLog:function(e){return!1},messages:Fe,OnMessageReactionRemoveAll:Pe});const xe={memberJoin(e,t){const n=new Map;return n.set("TYPE","MEMBER_JOIN"),n.set("USER_ID",t.user.id),n.set("ACCOUNT_AGE",Y(q(t.user.id).timestamp,"R")),n.set("USERTAG",ue(t)),n.set("USER",t.user),n},botAdd(e,t){const n=new Map;return n.set("TYPE","BOT_ADDED"),n.set("USER_ID",t.user.id),n.set("USERTAG",ue(t)),n.set("USER",t.user),n}};async function He(e,t,n,i){await un(e,t,"GUILD_MEMBER_ADD",n,i)}var Ve=Object.freeze({__proto__:null,getKeys:function(e,t){return ae(t)?[]:t.user.bot?["botAdd"]:["memberJoin"]},isAuditLog:function(e,t,n){return!!n.user.bot&&e instanceof discord.AuditLogEntry},messages:xe,AL_OnGuildMemberAdd:He});const Ke={memberLeft(e,t,n){const i=new Map;return i.set("TYPE","MEMBER_LEFT"),i.set("USER_ID",t.user.id),i.set("USERTAG",de(t.user)),i.set("USER",t.user),i.set("RESIDENCE_DURATION","?"),n instanceof discord.GuildMember&&i.set("RESIDENCE_DURATION",Y(new Date(n.joinedAt).getTime(),"R")),i},memberKicked(e,t){const n=new Map;return n.set("TYPE","MEMBER_KICKED"),n.set("USER_ID",t.user.id),n.set("USERTAG",de(t.user)),n.set("USER",t.user),n}};async function Ye(e,t,n,i,a){await un(e,t,"GUILD_MEMBER_REMOVE",n,i,a)}var We=Object.freeze({__proto__:null,getKeys:function(e,t){return ae(t.user.id)?[]:e instanceof discord.AuditLogEntry?22===e.actionType?[]:21===e.actionType?["memberPruned"]:["memberKicked"]:["memberLeft"]},isAuditLog:function(e,t,n){return e instanceof discord.AuditLogEntry&&22!==e.actionType},messages:Ke,AL_OnGuildMemberRemove:Ye});const ze={memberBanned:(e,t)=>new Map([["USERTAG",de(t.user)],["USER",t.user],["TYPE","MEMBER_BANNED"],["USER_ID",t.user.id]])};async function qe(e,t,n,i){await un(e,t,"GUILD_BAN_ADD",n,i)}var Je=Object.freeze({__proto__:null,getKeys:function(e,t){return ae(t.user.id)?[]:["memberBanned"]},isAuditLog:function(e){return e instanceof discord.AuditLogEntry},messages:ze,AL_OnGuildBanAdd:qe});const Qe={memberUnbanned:(e,t)=>new Map([["USERTAG",de(t.user)],["USER",t.user],["TYPE","MEMBER_UNBANNED"],["USER_ID",t.user.id]])};async function Ze(e,t,n,i){await un(e,t,"GUILD_BAN_REMOVE",n,i)}var Xe=Object.freeze({__proto__:null,getKeys:function(e,t){return ae(t.user.id)?[]:["memberUnbanned"]},isAuditLog:function(e){return e instanceof discord.AuditLogEntry},messages:Qe,AL_OnGuildBanRemove:Ze});const et={reconnected:(e,t)=>new Map([["TYPE","RECONNECTED"],["GUILD_ID",t.id],["GUILD_NAME",Qn(t.name,!0)]]),newGuild:(e,t)=>new Map([["TYPE","NEW_GUILD"],["GUILD_ID",t.id],["GUILD_NAME",t.name]])};async function tt(e,t,n){await un(e,t,"GUILD_CREATE",null,n)}var nt=Object.freeze({__proto__:null,getKeys:async function(e,t){const n=await t.getMember(discord.getBotId());return null===n||(new Date).getTime()-new Date(n.joinedAt).getTime()>6e4?["reconnected"]:!0===oe()?["newGuild"]:[]},isAuditLog:function(){return!1},messages:et,OnGuildCreate:tt});const it={name(e,t,n){const i=new Map([["ROLE_ID",t.id],["TYPE","NAME_CHANGED"],["ROLE_MENTION",t.id!==t.guildId?`<@&${t.id}>`:Qn("@everyone")]]);return i.set("OLD_NAME",Qn(n.name,!0)),i.set("NEW_NAME",Qn(t.name,!0)),i},color(e,t,n){const i=new Map([["ROLE_ID",t.id],["TYPE","COLOR_CHANGED"],["ROLE_MENTION",t.id!==t.guildId?`<@&${t.id}>`:Qn("@everyone")]]);return i.set("OLD_COLOR",n.color.toString(16)),i.set("NEW_COLOR",t.color.toString(16)),i},hoist(e,t,n){const i=new Map([["ROLE_ID",t.id],["TYPE","HOIST_CHANGED"],["ROLE_MENTION",t.id!==t.guildId?`<@&${t.id}>`:Qn("@everyone")]]);return i.set("OLD_HOIST",!0===n.hoist?U.modules.logging.l_terms.enabled:U.modules.logging.l_terms.disabled),i.set("NEW_HOIST",!0===t.hoist?U.modules.logging.l_terms.enabled:U.modules.logging.l_terms.disabled),i},mentionable(e,t,n){const i=new Map([["ROLE_ID",t.id],["TYPE","MENTIONABLE_CHANGED"],["ROLE_MENTION",t.id!==t.guildId?`<@&${t.id}>`:Qn("@everyone")]]);return i.set("OLD_MENTIONABLE",!0===n.mentionable?U.modules.logging.l_terms.enabled:U.modules.logging.l_terms.disabled),i.set("NEW_MENTIONABLE",!0===t.mentionable?U.modules.logging.l_terms.enabled:U.modules.logging.l_terms.disabled),i},position(e,t,n){const i=new Map([["ROLE_ID",t.id],["TYPE","POSITION_CHANGED"],["ROLE_MENTION",t.id!==t.guildId?`<@&${t.id}>`:Qn("@everyone")]]);return i.set("OLD_POSITION",n.position.toString()),i.set("NEW_POSITION",t.position.toString()),i},managed(e,t,n){const i=new Map([["ROLE_ID",t.id],["TYPE","MANAGED_CHANGED"],["ROLE_MENTION",t.id!==t.guildId?`<@&${t.id}>`:Qn("@everyone")]]);return i.set("OLD_MANAGED",!0===n.mentionable?U.modules.logging.l_terms.enabled:U.modules.logging.l_terms.disabled),i.set("NEW_MANAGED",!0===t.mentionable?U.modules.logging.l_terms.enabled:U.modules.logging.l_terms.disabled),i},permissions(e,t,n){const i=new Map([["ROLE_ID",t.id]]);let a="";const s=new ee(t.permissions).serialize(!1),o=new ee(n.permissions).serialize(!1),r=[],l=[];for(const e in s)!0===s[e]&&!1===o[e]&&r.push(e),!1===s[e]&&!0===o[e]&&l.push(e);function u(e){return e.split("_").join(" ").split(" ").map((e=>(e.length>1&&(e=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase()),e))).join(" ")}if(r.length>0&&0===l.length)a="PERMS_ADDED",i.set("ADDED_PERMS",r.map((e=>`\`${u(e)}\``)).join(",  "));else if(0===r.length&&l.length>0)a="PERMS_REMOVED",i.set("REMOVED_PERMS",l.map((e=>`\`${u(e)}\``)).join(",  "));else{a="PERMS_CHANGED";let e=r.map((e=>`+ ${u(e)}`)).concat(l.map((e=>`- ${u(e)}`))).join("\n");e=`\`\`\`diff\n${0===e.length?"\nCan't resolve perms":e}\n\`\`\``,i.set("CHANGED_PERMS",e)}if(""!==a)return i.set("TYPE",a),i.set("ROLE_MENTION",t.id!==t.guildId?`<@&${t.id}>`:Qn("@everyone")),i}};async function at(e,t,n,i,a){await un(e,t,"GUILD_ROLE_UPDATE",n,i,a)}var st=Object.freeze({__proto__:null,getKeys:function(e,t,n){const i=[];return t.name!==n.name&&i.push("name"),t.color!==n.color&&i.push("color"),t.hoist!==n.hoist&&i.push("hoist"),t.mentionable!==n.mentionable&&i.push("mentionable"),t.managed!==n.managed&&i.push("managed"),t.position!==n.position&&i.push("position"),t.permissions!==n.permissions&&i.push("permissions"),i},isAuditLog:function(e){return e instanceof discord.AuditLogEntry},messages:it,AL_OnGuildRoleUpdate:at});const ot={newRole:(e,t)=>new Map([["ROLE_ID",t.id],["TYPE","NEW_ROLE"],["ROLE_MENTION",t.id!==t.guildId?`<@&${t.id}>`:Qn("@everyone")]])};async function rt(e,t,n,i){await un(e,t,"GUILD_ROLE_CREATE",n,i)}var lt=Object.freeze({__proto__:null,getKeys:function(){return["newRole"]},isAuditLog:function(e){return e instanceof discord.AuditLogEntry},messages:ot,AL_OnGuildRoleCreate:rt});const ut={removedRole:(e,t)=>new Map([["ROLE_ID",t.id],["TYPE","REMOVED_ROLE"],["ROLE_NAME",Qn(t.name,!0)]])};async function dt(e,t,n,i){await un(e,t,"GUILD_ROLE_DELETE",n,i)}var ct=Object.freeze({__proto__:null,getKeys:function(){return["removedRole"]},isAuditLog:function(e){return e instanceof discord.AuditLogEntry},messages:ut,AL_OnGuildRoleDelete:dt});const mt={async integrationsUpdate(e,t){const n=await discord.getGuild(t.guildId);if(null!==n)return new Map([["TYPE","INTEGRATIONS_UPDATED"],["GUILD_ID",n.id],["GUILD_NAME",n.name]])}};async function gt(e,t,n){await un(e,t,"GUILD_INTEGRATIONS_UPDATE",null,n)}var ft=Object.freeze({__proto__:null,getKeys:async function(e,t){return["integrationsUpdate"]},isAuditLog:function(){return!1},messages:mt,OnGuildIntegrationsUpdate:gt});const pt={webhooksUpdate:async(e,t)=>new Map([["TYPE","WEBHOOK_UPDATED"],["CHANNEL_ID",t.channelId]])};async function ht(e,t,n){await un(e,t,"WEBHOOKS_UPDATE",null,n)}var wt=Object.freeze({__proto__:null,getKeys:async function(e,t){return ie(t.channelId)?[]:["webhooksUpdate"]},isAuditLog:function(){return!1},messages:pt,OnWebhooksUpdate:ht});const yt={userUpdate:(e,t)=>new Map([["TYPE","USER_UPDATED"],["USER_ID",t.id],["USER",t],["USERTAG",de(t)]])};async function Et(e,t,n){await un(e,t,"USER_UPDATE",null,n)}var Dt=Object.freeze({__proto__:null,getKeys:async function(e,t){return["userUpdate"]},isAuditLog:function(){return!1},messages:yt,OnUserUpdate:Et});const _t={async serverDeaf(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","SERVER_DEAFENED"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async serverUndeaf(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","SERVER_UNDEAFENED"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async serverMute(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","SERVER_MUTED"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async serverUnmute(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","SERVER_UNMUTED"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async selfDeaf(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","SELF_DEAFENED"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async selfUndeaf(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","SELF_UNDEAFENED"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async selfMute(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","SELF_MUTED"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async selfUnmute(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","SELF_UNMUTED"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async startStream(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","START_STREAM"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async stopStream(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","STOP_STREAM"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async startVideo(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","START_VIDEO"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async stopVideo(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","STOP_VIDEO"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async channelJoined(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","ENTERED_CHANNEL"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async channelLeft(e,t,n){const i=await n.getChannel();if(null===i)return;const a="string"==typeof i.parentId?await discord.getGuildCategory(i.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","LEFT_CHANNEL"],["CHANNEL_ID",n.channelId],["CHANNEL_NAME",`🔈${Qn(i.name,!0)}`],["CHANNEL_MENTION",`${null!==a?`${le(a)}\`${Qn(a.name,!0)}\`**>**`:""}${le(i)}\`${Qn(i.name,!0)}\``]])},async channelMove(e,t,n){const i=await t.getChannel(),a=await n.getChannel();if(null===i||null===a)return;const s="string"==typeof i.parentId?await discord.getGuildCategory(i.parentId):null,o="string"==typeof a.parentId?await discord.getGuildCategory(a.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","MOVED_CHANNEL"],["OLD_CHANNEL_ID",n.channelId],["NEW_CHANNEL_NAME",`🔈${Qn(i.name,!0)}`],["NEW_CHANNEL_ID",t.channelId],["OLD_CHANNEL_NAME",`🔈${Qn(a.name,!0)}`],["OLD_CHANNEL_MENTION",`${null!==o?`${le(o)}\`${Qn(o.name,!0)}\`**>**`:""}${le(a)}\`${Qn(a.name,!0)}\``],["NEW_CHANNEL_MENTION",`${null!==s?`${le(s)}\`${Qn(s.name,!0)}\`**>**`:""}${le(i)}\`${Qn(i.name,!0)}\``]])},async requestedSpeak(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","REQUESTED_SPEAK"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async stageSpeaking(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","STAGE_SPEAKING"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])},async stageAudience(e,t){const n=await t.getChannel();if(null===n)return;const i="string"==typeof n.parentId?await discord.getGuildCategory(n.parentId):null;return new Map([["USERTAG",ue(t.member)],["USER_ID",t.userId],["USER",t.member.user],["TYPE","STAGE_AUDIENCE"],["CHANNEL_ID",t.channelId],["CHANNEL_NAME",`🔈${Qn(n.name,!0)}`],["CHANNEL_MENTION",`${null!==i?`${le(i)}\`${Qn(i.name,!0)}\`**>**`:""}${le(n)}\`${Qn(n.name,!0)}\``]])}};async function bt(e,t,n,i,a){await un(e,t,"VOICE_STATE_UPDATE",n,i,a)}var At=Object.freeze({__proto__:null,getKeys:function(e,t,n){if(ie(t.channelId))return[];if(ae(t.userId))return[];const i=[];return t.channelId!==n.channelId&&(null!==t.channelId&&void 0!==t.channelId||null===n.channelId||void 0===n.channelId?null===t.channelId||void 0===t.channelId||null!==n.channelId&&void 0!==n.channelId?i.push("channelMove"):i.push("channelJoined"):i.push("channelLeft")),t.deaf!==n.deaf&&!0===t.deaf&&i.push("serverDeaf"),t.deaf!==n.deaf&&!1===t.deaf&&i.push("serverUndeaf"),t.mute!==n.mute&&!0===t.mute&&i.push("serverMute"),t.mute!==n.mute&&!1===t.mute&&i.push("serverUnmute"),t.selfDeaf!==n.selfDeaf&&!0===t.selfDeaf&&i.push("selfDeaf"),t.selfDeaf!==n.selfDeaf&&!1===t.selfDeaf&&i.push("selfUndeaf"),t.selfMute!==n.selfMute&&!0===t.selfMute&&i.push("selfMute"),t.selfMute!==n.selfMute&&!1===t.selfMute&&i.push("selfUnmute"),t.selfStream!==n.selfStream&&!0===t.selfStream&&i.push("startStream"),t.selfStream!==n.selfStream&&!1===t.selfStream&&i.push("stopStream"),t.selfVideo!==n.selfVideo&&!0===t.selfVideo&&i.push("startVideo"),t.selfVideo!==n.selfVideo&&!1===t.selfVideo&&i.push("stopVideo"),t.requestToSpeakTimestamp!==n.requestToSpeakTimestamp&&"string"==typeof t.requestToSpeakTimestamp&&i.push("requestedSpeak"),t.suppress!==n.suppress&&(!1===t.suppress?i.push("stageSpeaking"):!0===t.suppress&&i.push("stageAudience")),i},isAuditLog:function(e,t,...n){return!(!t.includes("server")&&!t.includes("channel"))&&("channelJoined"!==t&&(e instanceof discord.AuditLogEntry&&e.userId!==n[0].userId))},messages:_t,AL_OnVoiceStateUpdate:bt});const It={connection:(e,t)=>new Map([["TYPE","CONNECTED"],["TOKEN",t.token],["ENDPOINT",t.endpoint]])};async function vt(e,t,n){await un(e,t,"VOICE_SERVER_UPDATE",null,n)}var Ct=Object.freeze({__proto__:null,getKeys:function(e,...t){return!0===oe()?["connection"]:[]},isAuditLog:function(){return!1},messages:It,OnVoiceServerUpdate:vt});function St(e,t){const n={added:new Array,removed:new Array,changed:new Map};return e.emojis.forEach((e=>{const i=t.emojis.find((t=>e.id===t.id));if(i)for(const t in e){if(typeof e[t]!=typeof i[t])continue;if(e[t]===i[t]&&"roles"!==t)continue;if("roles"===t){const t=i.roles,{roles:n}=e;let a=!1;if(n.forEach((e=>{t.includes(e)||(a=!0)})),t.forEach((e=>{n.includes(e)||(a=!0)})),!a)continue}n.changed.has(e.id)||n.changed.set(e.id,new Array);const a=n.changed.get(e.id);a.push(t),n.changed.set(e.id,a)}else n.added.push(e)})),t.emojis.forEach((t=>{e.emojis.find((e=>t.id===e.id))||n.removed.push(t)})),n}const Mt={editedEmoji(e,t,n){const i=St(t,n),{changed:a}=i,s=new Map;let o="";s.set("TYPE","EDITED_EMOJIS");for(const[e,i]of a){const a=t.emojis.find((t=>t.id===e)),s=n.emojis.find((t=>t.id===e));a&&s&&i.forEach((e=>{let t=s[e],n=a[e];if("boolean"==typeof e&&(t=!0===s[e]?U.modules.logging.l_terms.trueval:U.modules.logging.l_terms.falseval,n=!0===a[e]?U.modules.logging.l_terms.trueval:U.modules.logging.l_terms.falseval),""!==o&&(o+="\n"),"roles"!==e)o+=B(U.modules.logging.l_terms.edited_emoji,["emoji_mention",a.toMention(),"emoji_id",a.id,"old_value",t,"new_value",n]);else{const e=[],t=[];a.roles.forEach((t=>{s.roles.includes(t)||e.push(t)})),s.roles.forEach((e=>{a.roles.includes(e)||t.push(e)}));const n=e.map((e=>`**+**<@&${e}>`)).concat(t.map((e=>`**-**<@&${e}>`))).join("  ");o+=B(U.modules.logging.l_terms.edited_emoji_roles,["emoji_mention",a.toMention(),"emoji_id",a.id,"new_value",n])}}))}return s.set("MESSAGE",o),s},addedEmoji(e,t,n){const i=St(t,n),{added:a}=i,s=new Map([["TYPE","ADDED_EMOJIS"]]);let o="";return a.forEach((e=>{""!==o&&(o+="\n"),o+=B(U.modules.logging.l_terms.added_emoji,["emoji_mention",e.toMention(),"emoji_id",e.id])})),s.set("MESSAGE",o),s},removedEmoji(e,t,n){const i=St(t,n),{removed:a}=i,s=new Map([["TYPE","REMOVED_EMOJIS"]]);let o="";return a.forEach((e=>{""!==o&&(o+="\n"),o+=B(U.modules.logging.l_terms.removed_emoji,["emoji_mention",e.toMention(),"emoji_id",e.id])})),s.set("MESSAGE",o),s}};async function Tt(e,t,n,i,a){await un(e,t,"GUILD_EMOJIS_UPDATE",n,i,a)}var Ot=Object.freeze({__proto__:null,getKeys:function(e,t,n){const i=St(t,n),{changed:a}=i,s=[];return i.added.length>0&&s.push("addedEmoji"),i.removed.length>0&&s.push("removedEmoji"),a.size>0&&s.push("editedEmoji"),s},isAuditLog:function(e){return e instanceof discord.AuditLogEntry},messages:Mt,AL_OnGuildEmojisUpdate:Tt});const Rt={async pin(e,t){if(!(e instanceof discord.AuditLogEntry.MessagePin))return;const n=await H(e.targetId),i=new Map([["TYPE","MESSAGE_PINNED"],["CHANNEL_ID",t.channelId],["MESSAGE_ID",e.options.messageId],["USER_ID",e.targetId]]);return i.set("USERTAG",""),null!==n&&(i.set("USERTAG",de(n)),i.set("USER",n)),i},async unpin(e,t){if(!(e instanceof discord.AuditLogEntry.MessageUnpin))return;const n=await H(e.targetId),i=new Map([["TYPE","MESSAGE_UNPINNED"],["CHANNEL_ID",t.channelId],["MESSAGE_ID",e.options.messageId],["USER_ID",e.targetId]]);return i.set("USERTAG",""),null!==n&&(i.set("USERTAG",de(n)),i.set("USER",n)),i}};async function Nt(e,t,n,i){await un(e,t,"CHANNEL_PINS_UPDATE",n,i)}var Lt=Object.freeze({__proto__:null,getKeys:function(e,t){return ie(t.channelId)||e instanceof discord.AuditLogEntry&&ae(e.targetId)?[]:void 0===t.lastPinTimestamp?["unpin"]:["pin"]},isAuditLog:function(e,t){return e instanceof discord.AuditLogEntry},messages:Rt,AL_OnChannelPinsUpdate:Nt});const kt={async channelCreated(e,t){const n="string"==typeof t.parentId?await discord.getGuildCategory(t.parentId):null;return new Map([["TYPE","CHANNEL_CREATED"],["CHANNEL_ID",t.id],["CHANNEL_MENTION",`${null!==n?`${le(n)}\`${Qn(n.name,!0)}\`**>**`:""}${0===t.type?t.toMention():`${le(t)}\`${Qn(t.name,!0)}\``}`]])},async dmChannelOpened(e,t){const n=await H(t.id);if(null!==n)return new Map([["TYPE","DM_CHANNEL_OPENED"],["USERTAG",de(n)]])}};async function Gt(e,t,n,i){await un(e,t,"CHANNEL_CREATE",n,i)}var $t=Object.freeze({__proto__:null,getKeys:function(e,t){return 1===t.type?!0===oe()?["dmChannelOpened"]:[]:ie(t)?[]:["channelCreated"]},isAuditLog:function(e,t,n){return"dmChannelOpened"!==t&&e instanceof discord.AuditLogEntry},messages:kt,AL_OnChannelCreate:Gt});const Ut={async channelDeleted(e,t){const n="string"==typeof t.parentId?await discord.getGuildCategory(t.parentId):null;return new Map([["TYPE","CHANNEL_DELETED"],["CHANNEL_ID",t.id],["CHANNEL_MENTION",`${null!==n?`${le(n)}\`${Qn(n.name,!0)}\`**>**`:""}${le(t)}\`${Qn(t.name,!0)}\``]])}};async function Bt(e,t,n,i){await un(e,t,"CHANNEL_DELETE",n,i)}var Ft=Object.freeze({__proto__:null,getKeys:function(e,t){return 1===t.type||ie(t)?[]:["channelDeleted"]},isAuditLog:function(e,t,n){return"dmChannelOpened"!==t&&e instanceof discord.AuditLogEntry},messages:Ut,AL_OnChannelDelete:Bt});async function Pt(e,t){return void 0===t&&(t="string"==typeof e.parentId?await discord.getGuildCategory(e.parentId):null),`${null!==t?`${le(t)}\`${Qn(t.name,!0)}\`**>**`:""}${0===e.type?e.toMention():`${le(e)}\`${Qn(e.name,!0)}\``}`}const jt={async name(e,t,n){const i=await Pt(t);return new Map([["TYPE","NAME_CHANGED"],["CHANNEL_ID",t.id],["CHANNEL_MENTION",i],["NEW_NAME",Qn(t.name,!0)],["OLD_NAME",Qn(n.name,!0)]])},async parentId(e,t,n){const i="string"==typeof t.parentId?t.parentId:"None",a="None"!==i?await discord.getGuildCategory(t.parentId):null,s="string"==typeof n.parentId?n.parentId:"None",o="None"!==s?await discord.getGuildCategory(n.parentId):null,r=await Pt(t,a);return new Map([["TYPE","CATEGORY_CHANGED"],["CHANNEL_ID",t.id],["CHANNEL_MENTION",r],["NEW_MENTION",null!==a?`${le(a)}\`${Qn(a.name,!0)}\``:`\`${i}\``],["OLD_MENTION",null!==o?`${le(o)}\`${Qn(o.name,!0)}\``:`\`${s}\``]])},async type(e,t,n){const i=await Pt(t),a=g.get(t.type),s=g.get(n.type);return new Map([["CHANNEL_ID",t.id],["CHANNEL_MENTION",i],["NEW_TYPE",a],["OLD_TYPE",s],["TYPE","TYPE_CHANGED"]])},async nsfw(e,t,n){const i=await Pt(t);return new Map([["CHANNEL_ID",t.id],["CHANNEL_MENTION",i],["NEW_NSFW",!0===t.nsfw?U.modules.logging.l_terms.yes:U.modules.logging.l_terms.no],["OLD_NSFW",!0===n.nsfw?U.modules.logging.l_terms.yes:U.modules.logging.l_terms.no],["TYPE","NSFW_CHANGED"]])},async topic(e,t,n){const i=await Pt(t);return new Map([["CHANNEL_ID",t.id],["CHANNEL_MENTION",i],["NEW_TOPIC",Qn(null!==t.topic&&void 0!==t.topic?t.topic:"None",!0)],["OLD_TOPIC",Qn(null!==n.topic&&void 0!==n.topic?n.topic:"None",!0)],["TYPE","TOPIC_CHANGED"]])},async rateLimitPerUser(e,t,n){const i=await Pt(t);return new Map([["CHANNEL_ID",t.id],["CHANNEL_MENTION",i],["NEW_SLOWMODE",t.rateLimitPerUser.toString()],["OLD_SLOWMODE",0===n.type?n.rateLimitPerUser.toString():"???"],["TYPE","SLOWMODE_CHANGED"]])},async bitrate(e,t,n){const i=await Pt(t);return new Map([["CHANNEL_ID",t.id],["CHANNEL_MENTION",i],["NEW_BITRATE",Math.floor(t.bitrate/1e3).toString()],["OLD_BITRATE",Math.floor(n.bitrate/1e3).toString()],["TYPE","BITRATE_CHANGED"]])},async userLimit(e,t,n){const i=await Pt(t);return new Map([["CHANNEL_ID",t.id],["CHANNEL_MENTION",i],["NEW_LIMIT",t.userLimit.toString()],["OLD_LIMIT",n.userLimit.toString()],["TYPE","USERLIMIT_CHANGED"]])},async parentPermissionSynchronization(e,t){const n=await Pt(t),i="string"==typeof t.parentId?t.parentId:"None",a="None"!==i?await discord.getGuildCategory(t.parentId):null;return new Map([["CHANNEL_ID",t.id],["CHANNEL_MENTION",n],["PARENT_MENTION",null!==a?`${le(a)}\`${Qn(a.name,!0)}\``:`\`${i}\``],["TYPE","PERMS_SYNCED"]])},async permissionsChanged(e,t,n){const i=J(t,n),a=await Pt(t),s=await t.getGuild();let o="";const{added:r}=i,{removed:l}=i,u=i.changed,d=new Array;return r.map((e=>{d.includes(e.id)||d.push(e.id)})),u.map((e=>{d.includes(e.id)||d.push(e.id)})),l.map((e=>{d.includes(e.id)||d.push(e.id)})),d.forEach((e=>{const i=n.permissionOverwrites.find((t=>t.id===e)),a=t.permissionOverwrites.find((t=>t.id===e));let r=void 0!==a?a.type:i.type;r=1==r?"member":"role";let l=void 0!==a?a.id:i.id;i&&!a&&(l=i.id);let u=""+("role"===r?`<@&${l}>`:`<@!${l}>`);"role"===r&&l===s.id&&(u=Qn("@everyone"));const d=void 0!==i?new ee(i.allow).serialize(!1):new ee(0).serialize(),c=void 0!==i?new ee(i.deny).serialize(!1):new ee(0).serialize(),m=void 0!==a?new ee(a.allow).serialize(!1):new ee(0).serialize(),g=void 0!==a?new ee(a.deny).serialize(!1):new ee(0).serialize();!i&&a?o+=`\n${U.modules.logging.l_terms.added} ${r} ${u}`:i&&!a?o+=`\n${U.modules.logging.l_terms.removed} ${r} ${u}`:i&&a&&(o+=`\n${U.modules.logging.l_terms.changed} ${r} ${u}`);const f={},p={};for(const e in d)!0===d[e]?f[e]=1:!0===c[e]?f[e]=-1:f[e]=0;for(const e in m)!0===m[e]?p[e]=1:!0===g[e]?p[e]=-1:p[e]=0;const h={};for(const e in f)f[e]!==p[e]&&(h[e]=p[e]);if(i&&!a)for(const e in d)!0===d[e]?h[e]=1:!0===c[e]&&(h[e]=-1);if(!i&&a)for(const e in m)!0===m[e]?h[e]=1:!0===g[e]&&(h[e]=-1);if(Object.keys(h).length>0){o+="\n```diff\n";for(let e in h){const t=h[e];let n="";0===t?n="•":1===t?n="+":-1===t&&(n="-"),""!==n&&(e=e.split("_").join(" "),e=e.split(" ").map((e=>`${e.substr(0,1).toUpperCase()}${e.substr(1).toLowerCase()}`)).join(" "),o+=`\n${n} ${e}`)}o+="\n```\n"}})),new Map([["CHANNEL_ID",t.id],["CHANNEL_MENTION",a],["CHANGES",o],["TYPE","PERMS_CHANGED"]])}};async function xt(e,t,n,i,a){await un(e,t,"CHANNEL_UPDATE",n,i,a)}var Ht=Object.freeze({__proto__:null,getKeys:async function(e,t,n){if(1===t.type||1===n.type)return[];if(ie(t))return[];const i=[];4===t.type||4===n.type||t.parentId===n.parentId&&typeof t.parentId==typeof n.parentId||i.push("parentId"),t.position,n.position,t.name!==n.name&&i.push("name"),t.type!==n.type&&i.push("type"),5!==t.type&&0!==t.type||5!==n.type&&0!==n.type||(t.nsfw!==n.nsfw&&i.push("nsfw"),t.topic!==n.topic&&i.push("topic")),0===t.type&&5===n.type?0!==t.rateLimitPerUser&&i.push("rateLimitPerUser"):0!==t.type||0!==n.type||t.rateLimitPerUser===n.rateLimitPerUser&&typeof t.rateLimitPerUser==typeof n.rateLimitPerUser||i.push("rateLimitPerUser"),(2===t.type&&2===n.type||13===t.type&&13===n.type)&&(t.bitrate!==n.bitrate&&i.push("bitrate"),t.userLimit!==n.userLimit&&i.push("userLimit"));const a=J(t,n);if(a.added.length>0||a.changed.length>0||a.removed.length>0){await async function(e){if("string"!=typeof e.parentId)return!1;const t=await discord.getGuildCategory(e.parentId),n=e.permissionOverwrites,i=t.permissionOverwrites;let a=!0;return n.map((e=>{const t=i.find((t=>t.id===e.id));t&&e.allow===t.allow&&e.deny===t.deny&&e.type===t.type||(a=!1)})),i.map((e=>{const t=n.find((t=>t.id===e.id));t&&e.allow===t.allow&&e.deny===t.deny&&e.type===t.type||(a=!1)})),a}(t)?i.push("parentPermissionSynchronization"):i.push("permissionsChanged")}return i},isAuditLog:function(e,t,n,i){return!["userLimit","position","parentId","parentPermissionSynchronization"].includes(t)&&e instanceof discord.AuditLogEntry},messages:jt,AL_OnChannelUpdate:xt});const Vt=new Map;Vt.set("CUSTOM",e),Vt.set("DEBUG",e),Vt.set("GUILD_MEMBER_UPDATE",we),Vt.set("GUILD_UPDATE",De),Vt.set("TYPING_START",Ae),Vt.set("MESSAGE_DELETE",Ce),Vt.set("MESSAGE_UPDATE",Te),Vt.set("MESSAGE_DELETE_BULK",Ne),Vt.set("MESSAGE_REACTION_ADD",Ge),Vt.set("MESSAGE_REACTION_REMOVE",Be),Vt.set("MESSAGE_REACTION_REMOVE_ALL",je),Vt.set("GUILD_MEMBER_ADD",Ve),Vt.set("GUILD_MEMBER_REMOVE",We),Vt.set("GUILD_BAN_ADD",Je),Vt.set("GUILD_BAN_REMOVE",Xe),Vt.set("GUILD_CREATE",nt),Vt.set("GUILD_ROLE_UPDATE",st),Vt.set("GUILD_ROLE_CREATE",lt),Vt.set("GUILD_ROLE_DELETE",ct),Vt.set("GUILD_INTEGRATIONS_UPDATE",ft),Vt.set("WEBHOOKS_UPDATE",wt),Vt.set("USER_UPDATE",Dt),Vt.set("VOICE_STATE_UPDATE",At),Vt.set("VOICE_SERVER_UPDATE",Ct),Vt.set("GUILD_EMOJIS_UPDATE",Ot),Vt.set("CHANNEL_PINS_UPDATE",Lt),Vt.set("CHANNEL_CREATE",$t),Vt.set("CHANNEL_DELETE",Ft),Vt.set("CHANNEL_UPDATE",Ht);var Kt=Object.freeze({__proto__:null,eventData:Vt,_ForceIndividualEvents:!1,AL_OnBatchEvents:async function(e){ne(),await async function(e){try{if(!0!==f.modules.logging.enabled)return;const t=new Map;(new Date).getTime();for(let n=0;n<e.length;n+=1){const i=e[n];i.guildId!==Xt&&"string"==typeof Xt&&(i.guildId=Xt),"DEBUG"===i.eventName&&ne();const a=new Date(q(i.id).timestamp);let s=Vt.get(i.eventName);if(s||"|"!==i.eventName.substr(0,1)||(s=Vt.get("CUSTOM")),!s||null===s)continue;if("function"!=typeof s.getKeys||"object"!=typeof s.messages)continue;if(i.auditLogEntry instanceof discord.AuditLogEntry&&f.modules.logging.ignores&&se(i.auditLogEntry.userId))continue;i.auditLogEntry instanceof discord.AuditLogEntry&&!1===f.modules.logging.auditLogs&&(i.auditLogEntry=null);"DEBUG"===i.eventName&&re()&&(i.guildId=E.masterGuild);const o=await s.getKeys(i.auditLogEntry,...i.payload);if(0===o.length)continue;const r=i.auditLogEntry,l=new tn(z(a.getTime()),Xt,s,o,i.eventName,r,...i.payload),u=await on(l),d=await rn(u,l);for(const[e,n]of d){t.has(e)||t.set(e,[]);const i=t.get(e);i&&(i.push(...n),t.set(e,i))}}for(const[e,n]of t)Zt(e,n)}catch(e){await Zn(e),fn("BOT_ERROR",new Map([["ERROR",`Error at logging.handleMultiEvents\n${e.stack}`]]))}}(e)},OnAnyEvent:async function(e,t){await fn("RAW_EVENT",new Map([["EVENT",e],["QUEUE","N/A"]]))},AL_OnGuildMemberUpdate:he,AL_OnGuildUpdate:Ee,OnTypingStart:be,AL_OnMessageDelete:ve,OnMessageUpdate:Me,AL_OnMessageDeleteBulk:Re,OnMessageReactionAdd:ke,OnMessageReactionRemove:Ue,OnMessageReactionRemoveAll:Pe,AL_OnGuildMemberAdd:He,AL_OnGuildMemberRemove:Ye,AL_OnGuildBanAdd:qe,AL_OnGuildBanRemove:Ze,OnGuildCreate:tt,AL_OnGuildRoleUpdate:at,AL_OnGuildRoleCreate:rt,AL_OnGuildRoleDelete:dt,OnGuildIntegrationsUpdate:gt,OnWebhooksUpdate:ht,OnUserUpdate:Et,AL_OnVoiceStateUpdate:bt,OnVoiceServerUpdate:vt,AL_OnGuildEmojisUpdate:Tt,AL_OnChannelPinsUpdate:Nt,AL_OnChannelCreate:Gt,AL_OnChannelDelete:Bt,AL_OnChannelUpdate:xt});let Yt={};const Wt=2e3;let zt;function qt(){if(void 0!==zt&&"number"==typeof zt){const e=(new Date).getTime()-zt;if(e<Wt)return Wt-e}return!0}async function Jt(){if(!0!==qt())return!1;zt=(new Date).getTime();const e=new Map;for(const t in Yt)e.set(t,Yt[t]);Yt={};const t=ln(e);return await sn(t),zt=(new Date).getTime(),!0}async function Qt(e=!0){const t=qt();!0===t?setTimeout(Jt,Math.ceil(1e3)):!0===e&&setTimeout((()=>{Qt(!1)}),t+100)}function Zt(e,t){Array.isArray(Yt[e])||(Yt[e]=[]),Yt[e].push(...t),Qt()}const Xt="string"==typeof p?p:discord.getGuildId(),en=["png","jpg","jpeg","svg","bmp"];class tn{constructor(e,t,n,i,a,s,...o){this.guildId=void 0,this.auditLogEntry=null,this.id=e,this.keys=i,this.data=n,this.guildId=t,this.auditLogEntry=s,this.eventName=a,this.payload=o}}const nn=/(?:(?:https?|ftp|file):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$])/gim,an=/\<[^<>@&!\-=_]*\>\[[^\[\]@&!\-=_]*\]\(https:.*channels\/[^ ]{18}\/[^ ]{18}\/[^ ]{18}\)$/g;async function sn(e,t=!1,n){const i=await discord.getGuild(Xt);if(null===i)return;const a=E.botUser;for(const[s,o]of e){let e=1;let r=f.modules.logging.logChannels[s];if(r||E.masterChannel&&E.masterChannel[s]&&(r=E.masterChannel[s]),!r)continue;let l=!1,u=r.webhookUrl;"string"!=typeof r.webhookUrl||_||(l=!0),t&&"string"==typeof n&&!_&&(l=!0,u=n),l&&u.length<3&&(l=!1);const d=await discord.getGuildTextChannel(s);if(!(null===d&&!l||o.length<1))if(l&&(t||o.length>1)){const n=[];for(let s=0;s<o.length;s+=1){const r=o[s];if(r.embed instanceof discord.Embed)t?(r.embed.setDescription(`__Crosslog from__: \`${i.name}\` **[**||\`${i.id}\`||**]**:\n ${r.embed.description}`),await x(u,"",[r.embed],a.username,a.getAvatarUrl(),!1,{}),e+=1):n.push(r.embed);else{let n=r.content;t?(n=`__Crosslog from__: \`${i.name}\` **[**||\`${i.id}\`||**]**:\n ${n}`,await x(u,n,void 0,a.username,a.getAvatarUrl(),!1,{}),e+=1):e%3==0&&e>0?(await d.sendMessage(r),e=1):(await x(u,n,void 0,a.username,a.getAvatarUrl(),!1,{}),e+=1)}}if(n.length>1)if(n.length<10)await x(u,"",n,a.username,a.getAvatarUrl(),!1,{}),e+=1;else{const t=new Array;for(let e=0;e<n.length;e+=1){const i=Math.floor(e/10);Array.isArray(t[i])||(t[i]=[]),t[i].push(n[e])}for(let n=0;n<t.length;n+=1)await x(u,"",t[n],a.username,a.getAvatarUrl(),!1,{}),e++}else d&&d instanceof discord.GuildChannel&&await d.sendMessage({embed:n[0],allowedMentions:{}})}else for(let e=0;e<o.length;e+=1){const t=o[e];(""!==t.content||t.embed instanceof discord.Embed)&&await d.sendMessage({...t,allowedMentions:{}})}}}async function on(e){const t=new Map;let n=[];return await Promise.all(e.keys.map((async t=>{if("function"!=typeof e.data.messages[t])return null;const i=await e.data.messages[t](e.auditLogEntry,...e.payload);i instanceof Map&&(i.set("KEY",t),n.push({id:e.keys.indexOf(t),val:i}))}))),n=n.sort(((e,t)=>e.id-t.id)).map((e=>e.val)),n=n.filter((e=>e instanceof Map&&e.has("TYPE"))),n.map((n=>{if(!n.has("TYPE")||!n.has("KEY"))return;const i=n.get("TYPE")??"",a=n.get("KEY"),s=e.auditLogEntry instanceof discord.AuditLogEntry&&!0===f.modules.logging.auditLogs&&e.data.isAuditLog(e.auditLogEntry,a,...e.payload);if(n.has("GUILD_ID")||n.set("GUILD_ID",e.guildId),n.set("isAuditLog",s),e.auditLogEntry instanceof discord.AuditLogEntry&&!["MESSAGE_DELETE","MESSAGE_DELETE_BULK","VOICE_STATE_UPDATE"].includes(e.eventName)&&(q(e.id).timestamp,e.id=e.auditLogEntry.id),s&&e.auditLogEntry instanceof discord.AuditLogEntry){const{reason:t}=e.auditLogEntry;n.set("ACTORTAG",me(e.auditLogEntry.user)),n.set("ACTOR_ID",e.auditLogEntry.user.id),n.set("ACTOR",e.auditLogEntry.user),""!==t?(n.set("REASON_RAW",t),n.set("REASON",f.modules.logging.reasonSuffix.replace("{REASON_RAW}",t))):(n.set("REASON",""),n.set("REASON_RAW",""))}if(n.has("USERTAG")&&!n.has("USER_ID")&&""!==n.get("USERTAG")){let e=`${n.get("USERTAG")}`;"MENTION"===f.modules.logging.userTag&&(e=e.substr(2).slice(0,-1),e.includes("!")&&(e=e.substr(1)),n.set("USER_ID",e))}const o=function(e,t,n){const i=new Array;let a=f.modules.logging.logChannels;if(!a)return i;if(e===E.masterGuild){p!==e&&(a={});for(const e in E.masterChannel)a[e]=E.masterChannel[e]}if(t.length<2)return i;"|"===t.substr(0,1)&&(t=t.substr(1));for(const e in a){const s=a[e];if("object"!=typeof s.scopes)break;if(!Array.isArray(s.scopes.include)&&!Array.isArray(s.scopes.exclude))break;if(Array.isArray(s.scopes.include)&&(s.scopes.include.includes("*")||s.scopes.include.includes(t)||s.scopes.include.includes(`${t}.*`)||s.scopes.include.includes(`${t}.${n}`))){if(Array.isArray(s.scopes.exclude)&&(s.scopes.exclude.includes(t)||s.scopes.exclude.includes(`${t}.*`)||s.scopes.exclude.includes(`${t}.${n}`)))continue;i.push(e)}}return i}(e.guildId,e.eventName,i);return Array.isArray(o)?(o.forEach((e=>{t.has(e)||t.set(e,new Array);const i=t.get(e);if(!i)throw new Error("");i.push(n),t.set(e,i)})),""):void 0})),t}async function rn(e,t){const n=new Map,i=new Date(q(t.id).timestamp);for(const[a,s]of e){const e=f.modules.logging.logChannels;if(!e)continue;let o=e[a];if(!o){if(!E.masterChannel||!E.masterChannel[a])throw new Error("h");o=E.masterChannel[a]}if(o.embed){const e=new Array;await Promise.all(s.map((async n=>{if(null==n)return;const a=`${n.get("TYPE")}`;let s=!1;const r=new discord.Embed,l=n.get("isAuditLog");"true"!==l&&!0!==l||(s=!0);let u="",d=ge(t.eventName,a,s,s);if("string"!=typeof d)return;if(n.has("ACTORTAG")){let e=!1;if(0===d.indexOf("ACTORTAG"))e=!0;else{e=oi(d.substring(0,d.indexOf("ACTORTAG")).split(" ").join(""))}if(e){let e;if(n.has("ACTOR"))e=n.get("ACTOR");else if(n.get("ACTORTAG")===U.ranks.system)e="SYSTEM";else if(t.auditLogEntry instanceof discord.AuditLogEntry)e=t.auditLogEntry.user;else{let t="";n.has("ACTOR_ID")?t=n.get("ACTOR_ID"):"MENTION"===f.modules.logging.actorTag&&(t=n.get("ACTORTAG"),t=t.substr(2).slice(0,-1),t.includes("!")&&(t=t.substr(1))),""===t||e instanceof discord.User||"SYSTEM"===e||(e=await H(t))}e instanceof discord.User?(r.setAuthor({name:e.getTag(),iconUrl:e.getAvatarUrl()}),u=`Actor: ${e.id}`,d=d.replace("ACTORTAG","")):"string"==typeof e&&"SYSTEM"===e&&(r.setAuthor({name:e}),u=`Actor: ${e}`,d=d.replace("ACTORTAG",""))}}else if(n.has("USERTAG")&&""!==n.get("USERTAG")){let e=!1;if(0===d.indexOf("USERTAG"))e=!0;else{e=oi(d.substring(0,d.indexOf("USERTAG")).split(" ").join(""))}if(e){let e,t="";n.has("USER")?e=n.get("USER"):n.has("USER_ID")?t=n.get("USER_ID"):"MENTION"===f.modules.logging.userTag&&(t=n.get("USERTAG"),t=t.substr(2).slice(0,-1),t.includes("!")&&(t=t.substr(1))),""===t||e instanceof discord.User||(e=await H(t)),e instanceof discord.User&&(d=d.replace("USERTAG",""),r.setAuthor({name:e.getTag(),iconUrl:e.getAvatarUrl()}),u=`User: ${e.id}`)}}let c=fe(d,n);const m=c.match(nn);if(Array.isArray(m)){const e=m.filter((e=>e.includes("cdn.discordapp.com")));Array.isArray(e)&&1===e.length&&(c=c.split(e[0]).join(""),r.setThumbnail({url:e[0]}))}if(!r.thumbnail||!r.thumbnail.url){const e=n.get("ATTACHMENTS");if(e&&Array.isArray(e)){const t=e.find((e=>en.includes(e.name.split(".").slice(-1)[0])));t&&r.setThumbnail({url:t.url})}}const g=c.match(an);if(null!==g&&1===g.length&&g[0].includes("discord.com")){c=c.split(g[0]).join("");let e=g[0].match(/\<[^<>]*\>/g)[0].split("<").join("").split(">").join("");0===e.length&&(e="​‍‍‌‌‌");const t=g[0].match(/\[[^\[\]]*\]\(https:.*channels\/.{18}\/.{18}\/.{18}\)$/g)[0];r.setFields([{name:e,value:t,inline:!1}])}if(r.setDescription(c),o.showTimestamps&&r.setTimestamp(i.toISOString()),o.embedColor&&"string"==typeof o.embedColor&&o.embedColor.length>=6&&o.embedColor.length<8){const e=o.embedColor.split("#").join("");r.setColor(parseInt(e,16))}if(o.showEventName){let e=t.eventName;"|"!==e.substr(0,1)&&"DEBUG"!==e||(e=`${"|"===e.substr(0,1)?e.substr(1):e} - ${a}`),e.includes("_")&&(e=e.split("_").join(" ")),e=e.split(" ").map((e=>(e.length>1&&(e=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase()),e))).join(" "),r.setTitle(e)}let p,h="";ne()&&(h+=`${t.eventName}.${a}`),o.description&&o.description.length>0&&"default"!==o.description&&(""!==h&&(h+=" • "),h+=o.description),""!==u&&(""!==h&&(h+=" • "),h+=u),s&&t.auditLogEntry instanceof discord.AuditLogEntry&&(t.auditLogEntry.reason&&t.auditLogEntry.reason.length>0?r.setFields([{inline:!1,name:"Reason",value:t.auditLogEntry.reason}]):n.has("REASON")&&n.get("REASON").length>0&&r.setFields([{inline:!1,name:"Reason",value:n.get("REASON")}])),"string"==typeof o.footerAvatar&&""!==o.footerAvatar&&(p=o.footerAvatar),""!==h&&r.setFooter({text:h,iconUrl:p??void 0}),e.push(r)}))),e.forEach((async e=>{n.has(a)||n.set(a,new Array);const t=n.get(a);t&&(t.push({embed:e}),n.set(a,t))}))}else{let e="";const r=`\`[\`${Y(i,"T")}\`]\``;if("string"!=typeof r||""===r)throw new Error("logging timestamps improperly formatted!");const l=[];if(s.forEach((n=>{if(null==n)return;const i=`${n.get("TYPE")}`;let a=!1;const s=n.get("isAuditLog");if(n.has("ATTACHMENTS")){const e=n.get("ATTACHMENTS");l.push(...e)}"true"!==s&&!0!==s||(a=!0);const u=ge(t.eventName,i,a);if("string"!=typeof u)return;let d=fe(u,n);const c=d.match(an);if(null!==c&&c.forEach((e=>{d=d.split(e).join("")})),""!==e&&(e+="\n"),o.showTimestamps&&(e+=`${r} `),o.showEventName){let n=t.eventName;"|"!==n.substr(0,1)&&"DEBUG"!==n||(n=`${"|"===n.substr(0,1)?n.substr(1):n} - ${i}`),n.includes("_")&&(n=n.split("_").join(" ")),n=n.split(" ").map((e=>(e.length>1&&(e=e.substring(0,1).toUpperCase()+e.substring(1).toLowerCase()),e))).join(" "),e+=`(\`${n}\`) `}e+=`${d}`})),""!==e&&e.length>0){n.has(a)||n.set(a,new Array);const t=n.get(a);if(t){const i={content:e};l.length>0&&(i.attachments=l.map((e=>({name:e.name,data:e.data})))),t.push(i),n.set(a,t)}}}}return n}function ln(e){const t=e;for(const[n,i]of e){const e=new Array;let a="";if(!(i.length<1)){if(i.map((t=>{(t.embed instanceof discord.Embed||"string"==typeof t.content&&""!==t.content)&&(t.embed instanceof discord.Embed?("string"==typeof t.content&&(t.content=void 0),e.push(t)):Array.isArray(t.attachments)&&t.attachments.length>0?e.push(t):a+=`${t.content}\n`)})),""!==a&&a.length>=1990){let t;if(a.includes("```")){let e;const n=[],i=a.split("\n");for(let t=0;t<i.length;t++){const a=i[t];if(a.includes("```")){if("number"==typeof e&&t>e){const a=i.slice(e,t+1);n.push(a.join("\n")),e=void 0;continue}e=t}else void 0===e&&n.push(a)}t=n.filter((()=>!0))}else t=a.split("\n");let n=[];for(let i=0;i<t.length;i+=1){const a=(n.join("\n")+t[i]).length;if(a>1985&&i!==t.length-1){let t=n.join("\n");t+="\n",e.push({content:t}),n=[]}else if(i===t.length-1){a<1985&&n.push(t[i]);let s=n.join("\n");s+="\n",e.push({content:s}),n=[],a>=1985&&e.push({content:`\n${t[i]}\n`})}i!==t.length-1&&n.push(t[i])}}else a.length>0&&e.push({content:a});0!==e.length&&t.set(n,e)}}return t}async function un(e,t,n,i,...a){try{if(!0!==f.modules.logging.enabled)return;"string"!=typeof t&&(t="0"),"0"===t&&(t=Xt),"DEBUG"===n&&ne();const s="DEBUG"===n&&re();s&&(t=E.masterGuild);const o=new Date(q(e).timestamp);let r,l=Vt.get(n);if(l||"|"!==n.substr(0,1)||(l=Vt.get("CUSTOM")),!l||null===l)throw new Error(`handleEvent missing data definition for event ${n}`);if("function"!=typeof l.getKeys||"object"!=typeof l.messages)throw new Error(`handleEvent missing getKeys/messages definitions for event ${n}`);if(i instanceof discord.AuditLogEntry&&f.modules.logging.ignores){if(se(i.userId))return;if(!0===f.modules.logging.ignores.extendUsersToAuditLogs&&ae(i.userId))return}if(i instanceof discord.AuditLogEntry&&!1===f.modules.logging.auditLogs&&(i=null),"function"==typeof l.getKeys&&(r=await l.getKeys(i,...a)),!Array.isArray(r))throw new Error("handleEvent keys not an array!");if(0===r.length)return;const u=new tn(z(o.getTime()),t,l,r,n,i,...a);if(s){const e=await on(u);let t=await rn(e,u);return t=ln(t),void await sn(t,!0,E.masterWebhook)}const d=await on(u),c=await rn(d,u);for(const[e,t]of c)Zt(e,t)}catch(t){if("DEBUG"===n||!t||!t.stack)return;Zn(t),fn("BOT_ERROR",new Map([["ERROR",`Error at logging.handleEvent.${n}\n${t.stack}`]]),e)}}function dn(e,...t){return["customLog"]}function cn(){return!1}const mn={customLog(e,t,n){const i=new Map;return i.set("TYPE",t),void 0!==n&&n.forEach(((e,t)=>{"_"===t.substring(0,1)&&(t=t.substring(1)),"_"===t.slice(-1)&&(t=t.slice(0,-1)),t=t.toUpperCase(),"string"!=typeof e&&("AUTHOR"===t&&(i.set("USERTAG",de(e)),i.set("USER",e)),"MEMBER"===t&&(i.set("USERTAG",ue(e)),i.set("USER",e))),"string"==typeof e&&i.set(t,e)})),i}};async function gn(e,t,n,i=z()){if(void 0===f)return;if(_)return;if(e=e.toUpperCase(),t=t.toUpperCase(),n&&n.has("USER_ID")&&ae(n.get("USER_ID")))return;"|"!==e.substr(0,1)&&(e=`|${e}`);const a=f.modules.logging.messages[e];if(!a)throw new Error(`Tried to log ${e}.${t} but category not defined in messages!`);if(!a[t])throw new Error(`Tried to log ${e}.${t} but subtype not defined in messages!`);await un(i,p,e,null,t,n)}async function fn(e,t,n=z()){if(void 0===f)return;if(_)return;if(void 0===f.modules.logging.messages.DEBUG[e])throw new Error(`Tried to log ${e} but not defined in config!`);await un(n,p,"DEBUG",null,e,t)}function pn(e){const t="string"==typeof e?e:e.user.id;let n=0,i=0;if("object"!=typeof f.levels)return 0;const a=f.levels.users[t];if("number"==typeof a&&a>n?n=a:"number"==typeof a&&a<0&&(i=-1),e instanceof discord.GuildMember)for(const t in f.levels.roles){const i=f.levels.roles[t];e.roles.includes(t)&&i>n&&(n=i)}return i<0&&!yn(t)&&(n=i),Math.min(999,n)}function hn(e,t=!1){if(e instanceof discord.GuildMember&&(e=e.user.id),e instanceof discord.User&&(e=e.id),yn(e))return!1;if(_n(e)&&!t)return!0;return pn(e)<0}async function wn(e,t){if(!0===await Dn(t.user.id))return!0;return pn(t)>=e}function yn(e){return!!Array.isArray(E.admins)&&E.admins.includes(e)}const En=new pylon.KVNamespace("globalAdminOverrides");async function Dn(e){if(Array.isArray(E.admins)||await O(),!yn(e))return!1;if(p===E.masterGuild)return!0;return void 0!==await En.get(e)}function _n(e){return E.blacklist.includes(e)}function bn(e){return e.user.bot?!0===e.user.bot&&E.botsCommands.includes(e.user.id)&&!hn(e):!hn(e)}const An=new pylon.KVNamespace("blacklistReportCooldownds");async function In(e,t){const n=`GLOBAL_${e.user.id}`,i=`SERVER_${e.user.id}`;if(!yn(e.user.id)&&hn(e)){if(_n(e.user.id)){if(await An.get(n))return;await An.put(n,!0,{ttl:1e4}),fn("BLACKLISTED_USER_ACTION",new Map([["USERTAG",ue(e)],["USER_ID",e.user.id],["USER",e.user],["ACTION",t]]))}if(hn(e,!0)){if(await An.get(n))return;await An.put(i,!0,{ttl:1e4}),gn("CORE","BLACKLISTED_USER_ACTION",new Map([["USERTAG",ue(e)],["USER_ID",e.user.id],["USER",e.user],["ACTION",t]]))}}}function vn(e){const t=encodeURIComponent;return Object.keys(e).map((n=>`${t(n)}=${t(e[n])}`)).join("&")}async function Cn(e,t){const n=`?${function(e,t,n){return vn({q:t,target:n,format:"text",key:e})}(f.modules.translation.googleApi.key,e,t)}`,i=new Request(`https://translation.googleapis.com/language/translate/v2${n}`,{method:"POST"}),a=await(await fetch(i)).json();if("object"==typeof a.error)throw new Error(a.error.message);if(!Array.isArray(a.data.translations)||1!==a.data.translations.length)throw new Error(a);return a.data.translations[0]}const Sn=new pylon.KVNamespace("kv-manager"),Mn="header",Tn="data",On=8100,Rn={blocks:[],dataptr:{},nextID:161},Nn={size:0,data:{}};function Ln(e){return(new TextEncoder).encode(JSON.stringify(e)).byteLength}function kn(e){let t="";do{t+=String.fromCharCode(e%65535),e=e/65535>>0}while(e>0);return t}function Gn(e){let t=0;for(let n=e.length-1;n>=0;n--)t=65535*t+e.charCodeAt(n);return t}async function $n(e,t,n){return Promise.all(e.map((async e=>{const n=await t(e);if(void 0!==n)throw n}))).then(n).catch((e=>e))}class Un{static async getHeader(e){const t=await Sn.get(e);return void 0===t?(Sn.put(e,Rn),Rn):t}static async findKeyHeader(e){return $n((await Sn.list({from:Mn})).filter((e=>e.startsWith(Mn))),(async t=>{const n=await Un.getHeader(t);if(e in n.dataptr)return[t,n]}),(async()=>["",void 0]))}static async findDataPtr(e){const[t,n]=await Un.findKeyHeader(e);return void 0===n?[{tag:-1,id:""},void 0]:[(i=n.dataptr[e],{tag:Gn(i[0])-161,id:i.substr(1)}),t];var i}static async incrementID(){return(await Sn.transactWithResult("header0",((e=Rn)=>({next:{...e,nextID:e.nextID+1},result:e.nextID})))).result}static async updateKeyHdr(e,t,n){Sn.transact(e,((e=Rn)=>{var i;return{...e,dataptr:{...e.dataptr,[t]:(i=n,kn(i.tag+161)+i.id)}}}))}static async deleteKeyHdr(e,t){Sn.transact(e,(n=>{if(void 0===n)return;if("header0"!==e&&1===Object.keys(n.dataptr).length)return;const i={...n,dataptr:{...n.dataptr}};return delete i.dataptr[t],i}))}static async addBlock(e){Sn.transact("header0",((t=Rn)=>e in t.blocks?t:{...t,blocks:[...t.blocks,e]}))}static async removeBlock(e){Sn.transact("header0",((t=Rn)=>{if(e in t.blocks){const n={...t,blocks:[...t.blocks]};return n.blocks.splice(n.blocks.indexOf(e),1),n}}))}static async updateKeyTag(e,t){Sn.transact(Tn+e.tag,((n=Nn)=>{const i={...n,data:{...n.data,[e.id]:t}};return i.size=Ln(i),i}))}static async deleteKeyTag(e){const t=Tn+e.tag;await Sn.transact(t,(t=>{if(void 0===t)return;if(1===Object.keys(t.data).length)return;const n={...t,data:{...t.data}};return delete n.data[e.id],n.size=Ln(n),n}));void 0===await Sn.get(t)&&Un.removeBlock(e.tag)}static async getData(e){const t=Tn+e.tag,n=await Sn.get(t);return n?n.data[e.id]:void 0}static async itemUpdateWillFit(e,t){const n=await Sn.get(Tn+e.tag);if(void 0===n)return!1;const i=Ln({[e.id]:n.data[e.id]}),a=Ln({[e.id]:t});return n.size-i+a<On}static async findEmptyTag(e){const t=await Un.getHeader("header0");return $n(t.blocks,(async t=>{const n=await Sn.get(Tn+t);if((n?n.size:0)+e<On)return t}),(async()=>{const e=t.blocks.length>0?Math.max(...t.blocks)+1:0;return e in t.blocks||Un.addBlock(e),e}))}static async findEmptyHdr(e){const t=(await Sn.list({from:Mn})).filter((e=>e.startsWith(Mn)));return $n(t,(async t=>{if(Ln(await Un.getHeader(t))+e<On)return t}),(async()=>(async e=>{for(let t=1;t<e.length;++t){const n=e[t]<0?-e[t]:e[t];n<e.length&&e[n]>0&&(e[n]*=-1)}for(let t=1;t<e.length;++t)if(e[t]>0)return Mn+t;return Mn+e.length})(t.map((e=>parseInt(e.substr(Mn.length),10))))))}static async get(e){const[t,n]=await Un.findDataPtr(e);return n?Un.getData(t):void 0}static async set(e,t){let[n,i]=await Un.findDataPtr(e),a=!0;if(i?(a=!await Un.itemUpdateWillFit(n,t),a&&Un.deleteKeyTag(n)):n.id=kn(await Un.incrementID()),a){const a=Ln({[n.id]:t});if(n.tag=await Un.findEmptyTag(a),void 0===i){const t=Ln({[e]:n});i=await Un.findEmptyHdr(t)}Un.updateKeyHdr(i,e,n)}Un.updateKeyTag(n,t)}static async delete(e){const[t,n]=await Un.findDataPtr(e);void 0!==n&&(Un.deleteKeyHdr(n,e),Un.deleteKeyTag(t))}static async tagsUsed(){return Sn.count()}static async listKeys(){const e=(await Sn.list({from:Mn})).filter((e=>e.startsWith(Mn)));return(await Promise.all(e.map((async e=>{const t=await Un.getHeader(e);return Object.keys(t.dataptr)})))).flat(1)}static async numKeys(){return(await Un.listKeys()).length}static async clear(){return Sn.clear()}static async items(){return Sn.items()}}function Bn(e){const t={};return Object.keys(e).forEach((n=>{t[e[n]]=n})),t}function Fn(e,t=!1){const n=Math.floor(Number(e));return n!==1/0&&String(n)===e&&(n>=0||!t)}let Pn;const jn={},xn={};function Hn(){Pn||(Pn=new Map([[U.time_units.ti_full.singular.decade,31536e7],[U.time_units.ti_full.singular.year,31536e6],[U.time_units.ti_full.singular.month,26784e5],[U.time_units.ti_full.singular.week,6048e5],[U.time_units.ti_full.singular.day,864e5],[U.time_units.ti_full.singular.hour,36e5],[U.time_units.ti_full.singular.minute,6e4],[U.time_units.ti_full.singular.second,1e3],[U.time_units.ti_full.singular.millisecond,1]]),jn[U.time_units.ti_full.singular.decade]=[U.time_units.ti_short.decade,"dec","dc"],jn[U.time_units.ti_full.singular.year]=[U.time_units.ti_short.year,"y","yr"],jn[U.time_units.ti_full.singular.month]=[U.time_units.ti_short.month,"mo","mon"],jn[U.time_units.ti_full.singular.week]=[U.time_units.ti_short.week,"w","we"],jn[U.time_units.ti_full.singular.day]=[U.time_units.ti_short.day,"d","da"],jn[U.time_units.ti_full.singular.hour]=[U.time_units.ti_short.hour,"h","hr"],jn[U.time_units.ti_full.singular.minute]=[U.time_units.ti_short.minute,"m","min"],jn[U.time_units.ti_full.singular.second]=[U.time_units.ti_short.second,"s","sec"],jn[U.time_units.ti_full.singular.millisecond]=[U.time_units.ti_short.millisecond,"ms"],xn.decade=U.time_units.ti_full.singular.decade,xn.year=U.time_units.ti_full.singular.year,xn.month=U.time_units.ti_full.singular.month,xn.week=U.time_units.ti_full.singular.week,xn.day=U.time_units.ti_full.singular.day,xn.hour=U.time_units.ti_full.singular.hour,xn.minute=U.time_units.ti_full.singular.minute,xn.second=U.time_units.ti_full.singular.second,xn.millisecond=U.time_units.ti_full.singular.millisecond)}function Vn(e,t,n=!0,i){Hn(),n&&(e=new Date((new Date).getTime()-e).getTime());let a=e+0;const s=new Map;for(const[e,n]of Pn){if(a<n||s.entries.length>=t)continue;const i=Math.ceil(a/n)+1;for(let t=0;t<=i&&!(a<n);t+=1)s.has(e)?s.set(e,s.get(e)+1):s.set(e,1),a-=n}const o=[];let r=0,l=!1;for(const[e,n]of s){if(r>=t||!0===l)break;i===e&&(l=!0);let a=e;if(n>1)for(const t in xn)xn[t]===e&&(a=U.time_units.ti_full.plural[t]);a=`${a.substr(0,1).toUpperCase()}${a.substr(1).toLowerCase()}`,o.push(`${n} ${a}`),r+=1}return o.join(", ")}function Kn(e){Hn(),e=e.split(" ").join("")+" ";let t=new Array,n="",i="";const a=e.split("");for(var s=0;s<a.length;s+=1){const e=a[s];if(Yn(e)||" "===e){if(""!==n){let e=[parseInt(i,10),n];t.push(e),n="",i=""}i+=e}else n+=e}let o=0;for(s=0;s<t.length;s+=1){const e=t[s][0];let n=t[s][1];if("number"==typeof e&&"string"==typeof n)for(var r in n=n.toLowerCase(),jn){const t=jn[r];(r===n||t.includes(n))&&(o+=e*Pn.get(r))}}return o}function Yn(e){return/^-?[\d.]+(?:e-?\d+)?$/.test(e)}const Wn=["\t","‏","","‮","‭","ٴ"],zn=["*","_","||","`","@everyone","@here","~~"],qn=["```"],Jn=["`"];function Qn(e,t=!1,n=!1){Wn.forEach((t=>{e=e.split(t.toLowerCase()).join("")}));let i=[];return t||n?t&&!n?i=Jn:!t&&n&&(i=qn):i=zn,i.forEach((t=>{if("@everyone"!==t&&"@here"!==t)if("`"===t||"```"===t)e=e.split(t).join("'");else if("```"===t)e=e.split(t).join("'''");else{const n=t.split("").map((e=>`\\${e}`)).join("");e=e.split(t).join(n)}else{const n=`${t.substr(0,1)}​${t.substr(1)}`;e=e.split(t).join(n)}})),0===e.length&&(e="‌"),e}function Zn(...e){console.error(...e)}function Xn(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1)+e)}function ei(e,t){return Object.assign(Object.create(t.prototype),e)}function ti(e,t){for(var n=[],i=0;i<e.length;i+=t)n.push(e.slice(i,i+t));return n}function ni(e,t){var n=e,i=t;e.length<t.length&&(n=t,i=e);var a=n.length;return 0==a?1:(a-function(e,t){e=e.toLowerCase(),t=t.toLowerCase();for(var n=new Array,i=0;i<=e.length;i++){for(var a=i,s=0;s<=t.length;s++)if(0==i)n[s]=s;else if(s>0){var o=n[s-1];e.charAt(i-1)!=t.charAt(s-1)&&(o=Math.min(Math.min(o,a),n[s])+1),n[s-1]=a,a=o}i>0&&(n[t.length]=a)}return n[t.length]}(n,i))/a}function ii(e,t,n="0"){return String(e).length>=t?String(e):(String(n).repeat(t)+e).slice(-t)}function ai(e){const t=`000000${e.toString(16)}`.slice(-6);return`#${t.substr(0,2)+t.substr(2,2)+t.substr(4,2)}`}function si(...e){let t,n,i,a;function s(e,t){let n;if(isNaN(e)&&isNaN(t)&&"number"==typeof e&&"number"==typeof t)return!0;if(e===t)return!0;if("function"==typeof e&&"function"==typeof t||e instanceof Date&&t instanceof Date||e instanceof RegExp&&t instanceof RegExp||e instanceof String&&t instanceof String||e instanceof Number&&t instanceof Number)return e.toString()===t.toString();if(!(e instanceof Object&&t instanceof Object))return!1;if(e.isPrototypeOf(t)||t.isPrototypeOf(e))return!1;if(e.constructor!==t.constructor)return!1;if(e.prototype!==t.prototype)return!1;if(i.indexOf(e)>-1||a.indexOf(t)>-1)return!1;for(n in t){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!=typeof e[n])return!1}for(n in e){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;if(typeof t[n]!=typeof e[n])return!1;switch(typeof e[n]){case"object":case"function":if(i.push(e),a.push(t),!s(e[n],t[n]))return!1;i.pop(),a.pop();break;default:if(e[n]!==t[n])return!1}}return!0}if(e.length<1)return!0;for(t=1,n=e.length;t<n;t+=1)if(i=[],a=[],!s(e[0],e[t]))return!1;return!0}function oi(e){const t=e.replace(new RegExp("[\0-ữf]","g"),""),i=e.replace(new RegExp(n,"g"),""),a=e.replace(new RegExp("[\n\rs]+|( )+","g"),"");return t.length===a.length&&i.length===a.length}const ri=[];class li{constructor(e){this.localStore=[],this.cache=[],this.kv=new pylon.KVNamespace(e.name),this.options=e;return ri.find((e=>e.options.name===this.options.name))||ri.push(this),this}isCacheInitialized(){return this.cache.length>0}isCacheEnabled(){return!1}async getItems(e=!1){if(this.isCacheInitialized()&&!e&&this.isCacheEnabled())return this.cache;const t=await this.kv.list();let n;if(t.length>100){n=[];const e=Math.floor(t.length/100);for(let t=0;t<e;t+=1)if(0!==t){const e=await this.kv.items({from:n.slice(-1)[0].key});n=n.concat(e)}else n=await this.kv.items()}else n=await this.kv.items();return this.isCacheEnabled()&&(this.cache=[...n]),n}async err(e){throw new TypeError(`[Storage Pool]: ${this.options.name}: ${e}`)}async exists(e){return void 0!==(await this.getAll(void 0,!1)).find((t=>t[this.options.idProperty]===e))}async delete(e){await this.editPool(e,null)}getTimestamp(e){if("string"==typeof this.options.timestampProperty&&"number"==typeof e[this.options.timestampProperty])return e[this.options.timestampProperty];if("string"==typeof this.options.timestampProperty&&"string"==typeof e[this.options.timestampProperty])return q(e[this.options.timestampProperty]).timestamp;if("string"!=typeof e[this.options.idProperty])return this.err("Can't parse timestamps on a non-string unique identifier"),!1;return q(e[this.options.idProperty]).timestamp}async clear(){await this.kv.clear(),this.cache=[]}async clean(){if("number"!=typeof this.options.itemDuration||0===this.options.itemDuration){if(!0===this.options.local)return;const e=await this.getItems();return void await Promise.all(e.map((async e=>{const t=e.value,{key:n}=e;if(void 0!==t.find((e=>null==e))){let e;if(await this.kv.transact(n,(t=>{const n=t.filter((e=>null!==e));return e=n,n})),Array.isArray(e)&&0===e.length)try{await this.kv.delete(n,{prevValue:[]})}catch(e){Zn("StoragePools, error deleting empty key",e)}}else if(0===e.value.length)try{await this.kv.delete(n,{prevValue:[]})}catch(e){Zn("StoragePools, error deleting empty key",e)}})))}let e=Date.now()-this.options.itemDuration;if(!0===this.options.local){const t=this.localStore.filter((t=>null===t||e>this.getTimestamp(t))).map((e=>null===e?null:e[this.options.idProperty]));return void(t.length>0&&(this.localStore=this.localStore.filter((e=>null!==e&&!t.includes(e[this.options.idProperty])))))}const t=await this.getItems();if("number"==typeof this.options.reduceAt&&this.options.reduceAt>0){const n=t.length;if(n>this.options.reduceAt){const t=256-this.options.reduceAt,i=this.options.itemDuration/Math.max(1,t),a=Math.floor(i*(n-this.options.reduceAt));e+=a}}await Promise.all(t.map((async t=>{const n=t.value,{key:i}=t,a=n.filter((t=>null===t||e>this.getTimestamp(t))).map((e=>null===e?null:e[this.options.idProperty]));if(a.length>0){let e;if(await this.kv.transact(i,(t=>{const n=t.filter((e=>null!==e&&!a.includes(e[this.options.idProperty])));return e=n,n})),Array.isArray(e)&&0===e.length)try{await this.kv.delete(i,{prevValue:[]})}catch(e){Zn("StoragePools, error deleting empty key",e)}}else if(0===t.value.length)try{await this.kv.delete(i,{prevValue:[]})}catch(e){Zn("StoragePools, error deleting empty key",e)}})))}async saveToPool(e,t=0,n=!1){if(null==e)return;if(e[this.options.idProperty]||(e[this.options.idProperty]=z()),!0===this.options.local){if(void 0!==this.localStore.find((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e[this.options.idProperty]))){return await this.editPool(e[this.options.idProperty],e)}return void this.localStore.push(e)}let i=await pylon.getCpuTime();const a=await this.getItems();let s,o,r=Math.floor(await pylon.getCpuTime()-i);if(i=await pylon.getCpuTime(),n){if(void 0!==await this.exists(e[this.options.idProperty])){return await this.editPool(e[this.options.idProperty],e)}r=Math.floor(await pylon.getCpuTime()-i),i=await pylon.getCpuTime()}if(a.length>0){const e=a[a.length-1].value;if("number"==typeof this.options.maxObjects&&this.options.maxObjects>0)e.length<this.options.maxObjects&&(s=a[a.length-1].key,o=e.length);else{if((new TextEncoder).encode(JSON.stringify(e)).byteLength+undefined<7900)return s=a[a.length-1].key,o=e.length,!1}}s||(s=z(),o=0),r=Math.floor(await pylon.getCpuTime()-i),i=await pylon.getCpuTime();try{const{result:n}=await this.kv.transactWithResult(s,(t=>{let n;return n=t?[...t]:[],n.length!==o?{result:!1,next:n.length>0?n:void 0}:(n.push(e),{next:n,result:!0})}));if(!n){if(t>3)return!1;return await this.saveToPool(e,t+1)}return r=Math.floor(await pylon.getCpuTime()-i),!0}catch(n){if(Zn("[StoragePools] Transact:",n),t>3)return!1;return await this.saveToPool(e,t+1)}}async editTransact(e,t){if(!0===this.options.local){const n=this.localStore.findIndex((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e));if(-1!==n){const e=t({...this.localStore[n]});return null==e?delete this.localStore[n]:this.localStore[n]=e,!0}return!1}const n=(await this.getItems()).find((t=>void 0!==t.value.find((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e))));if(n){try{return await this.kv.transact(n.key,(n=>{const i=[...n],a=i.findIndex((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e));if(-1!==a){let e=t({...i[a]});null===e&&(e=void 0),i[a]=e}return i})),!0}catch(e){console.error("pools.editTransact error",e)}return!1}return console.warn("pools.editTransact couldnt find matching key in a pool"),!1}async editTransactWithResult(e,t){if(!0===this.options.local){const n=this.localStore.findIndex((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e));if(-1!==n){const{next:e,result:i}=t({...this.localStore[n]});if(null==e)delete this.localStore[n];else if(!0===i)return this.localStore[n]=e,!0}return!1}const n=(await this.getItems()).find((t=>void 0!==t.value.find((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e))));if(n){try{const{result:i}=await this.kv.transactWithResult(n.key,(n=>{const i=[...n],a=i.findIndex((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e));let s=!1;if(-1!==a){let{next:e,result:n}=t({...i[a]});null===e&&(e=void 0),!0===n&&(s=!0,i[a]=e)}return{result:s,next:i}}));return i}catch(e){}return!1}return!1}async editPool(e,t){if(!0===this.options.local){const n=this.localStore.findIndex((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e));return-1!==n&&(null==t?delete this.localStore[n]:this.localStore[n]=t,!0)}const n=(await this.getItems()).find((t=>void 0!==t.value.find((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e))));if(n){for(let i=0;i<2;i+=1)try{return await this.kv.transact(n.key,(n=>{const i=[...n],a=i.findIndex((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e));return-1!==a&&("object"==typeof t&&null!==t?i[a]=t:delete i[a]),i})),!0}catch(e){}return!1}return!1}async editPools(e,t){if(!0===this.options.local)return this.localStore=this.localStore.map((n=>null===n?n:e.includes(n[this.options.idProperty])?t(n):n)).filter((e=>null!==e&&"object"==typeof e&&void 0!==e)),!1;const n=(await this.getItems()).filter((t=>{if(Array.isArray(t.value)){return!!t.value.find((t=>null!==t&&"object"==typeof t&&e.includes(t[this.options.idProperty])))}return!1}));return n.length>0&&(await this.kv.transactMulti(n.map((e=>e.key)),(n=>{let i=n.filter((()=>!0));return i=i.map((n=>n=n.filter((e=>null!=e&&"object"==typeof e)).map((n=>e.includes(n[this.options.idProperty])?t(n):n)).filter((e=>null!=e&&"object"==typeof e)))),i})),!0)}async editTransactMultiWithResult(e,t){const n=new Map;if(e.forEach((e=>n.set(e,!1))),!0===this.options.local)return this.localStore=this.localStore.map((i=>{if(null===i)return i;if(!e.includes(i[this.options.idProperty]))return i;const a=t({...i});return!0===a.result&&n.set(i[this.options.idProperty],!0),a.next})).filter((e=>null!==e&&"object"==typeof e&&void 0!==e)),n;const i=(await this.getItems()).filter((t=>{if(Array.isArray(t.value)){return!!t.value.find((t=>null!==t&&"object"==typeof t&&e.includes(t[this.options.idProperty])))}return!1}));return i.length>0&&await this.kv.transactMulti(i.map((e=>e.key)),(i=>{let a=i.filter((()=>!0));return a=a.map((i=>i=i.filter((e=>null!=e&&"object"==typeof e)).map((i=>{if(!e.includes(i[this.options.idProperty]))return i;const a=t({...i});return!0===a.result&&n.set(i[this.options.idProperty],!0),a.next})).filter((e=>null!=e&&"object"==typeof e)))),a})),n}async getAll(e,t=!0){const n=Date.now();let i=[];if(i=!0===this.options.local?this.localStore:Array.isArray(e)?e:await this.getItems(),0===i.length)return[];if(Array.isArray(e)||this.options.local||(i=i.map((e=>e.value)).flat(1)),i=i.filter((e=>"object"==typeof e&&null!=e)),"string"==typeof this.options.timestampProperty||"string"==typeof this.options.idProperty){if(this.options.itemDuration&&this.options.itemDuration>0){const e=n-this.options.itemDuration;i=i.filter((t=>{const n=this.getTimestamp(t);return"number"==typeof n&&n>=e}))}!0===t&&(i=i.sort(((e,t)=>this.getTimestamp(t)-this.getTimestamp(e))))}return i}async getById(e){const t=(await this.getAll(void 0,!1)).find((t=>null!==t&&"object"==typeof t&&t[this.options.idProperty]===e));if(void 0!==t)return t}async getByQuery(e,t=!1){await this.getAll();return(await this.getAll()).filter((n=>{for(const i in e)if(void 0!==e[i]){if(!0===t&&e[i]===n[i])return!0;if(e[i]!==n[i])return!1}return!0}))}}new pylon.KVNamespace("config");const ui={"1.8.1":async()=>{await new pylon.KVNamespace("roleLock").clear()},"1.7.15":async()=>{const e=new li({name:"infractions",idProperty:"id",local:!1,timestampProperty:"ts"}),t=await e.getAll(void 0,!1),n=[];t.forEach((e=>{e.guild&&n.push(e.id)})),n.length>0&&await e.editPools(n,(e=>(e.guild=void 0,e)))},"1.0.0":async()=>{}};const di=["missing permissions"],ci=[],mi=[],gi=[];function fi(e){return mi.filter((t=>t.extras.parent===e)).length>0}function pi(){return[...mi.filter((e=>!e.extras.parent)),...gi.filter((e=>!e.extras.parent))]}function hi(e,t){if(!t)return e;const n=gi.find((e=>e.config.name===t));return n&&n.extras?hi(`${n.config.name} ${e}`,n.extras.parent):`${n.config.name} ${e}`}async function wi(e,t,n,i,...a){const s=hi(e.name,t.parent);if("object"!=typeof f||null==f){if(!await O())return}if(!t.module||Nl(t.module)){if("number"==typeof Oi[i.member.user.id]){if(Date.now()-Oi[i.member.user.id]<750)return}if(!i.member.user.bot||bn(i.member)){if(!bn(i.member))return await i.acknowledge({ephemeral:!0}),void await In(i.member,`slash command execution: \`${s}\``);if(t.permissions){const e=await i.getGuild(),n=await To(i.member,e,i.channelId,t.permissions.overrideableInfo,t.permissions.level,t.permissions.owner,t.permissions.globalAdmin);if(!n.access){try{await i.acknowledge({ephemeral:!0})}catch(e){}return void(n.errors.length>0&&(n.errors.includes(U.modules.commands.command_disabled)?await i.respondEphemeral(U.modules.commands.command_disabled):await i.respondEphemeral(B(U.modules.commands.cant_use_command_description,["execution_criteria",n.errors.join("\n")]))))}}try{const e=await n(i,...a);if("boolean"==typeof e&&!1===e){try{await i.acknowledge({ephemeral:!0})}catch(e){}return}if("boolean"==typeof t.staticAck)try{await i.acknowledge(!0===t.staticAck?{ephemeral:!1}:{ephemeral:!0})}catch(e){}}catch(e){try{await i.acknowledge({ephemeral:!0})}catch(e){}if(Zn(e),e.messageExtended&&"string"==typeof e.messageExtended)try{const t=JSON.parse(e.messageExtended).message;if(t&&di.includes(t.toLowerCase()))return void await i.respondEphemeral(B(U.modules.commands.error_executing_command,["error",t]))}catch(e){}await i.respondEphemeral(_?U.modules.commands.error_not_logged:U.modules.commands.error_logged),fn("BOT_ERROR",new Map([["ERROR",`Slash Command Error on '${s}': \n${e.stack}`]]))}if(Oi[i.member.user.id]=Date.now(),!ie(i.channelId)&&!ae(i.member)){let t="";if(e.options&&a.length>0)for(const e in a)for(const n in a[e]){const i=a[e][n];let s="";"string"==typeof i?s=i:"boolean"==typeof i?s=!0===i?"true":"false":"number"==typeof i?s=`${i}`:i instanceof discord.GuildMember?s=i.user.getTag():i instanceof discord.Role||i instanceof discord.GuildChannel?s=i.name:console.warn(`Argument ${n} typing not found??`),""!==s&&(""!==t&&(t+=" , "),t+=`\`${n}\`:\`${Qn(s,!0)}\``)}""!==t&&(t=B(U.modules.commands.arguments_string,["args",t])),gn("COMMANDS","SLASH_COMMAND_USED",new Map([["COMMAND_NAME",s],["AUTHOR",i.member.user],["USER",i.member.user],["USER_ID",i.member.user.id],["MEMBER",i.member],["CHANNEL_ID",i.channelId],["ARGUMENTS",t]]))}}}else{try{await i.acknowledge({ephemeral:!0})}catch(e){}await i.respondEphemeral(U.modules.commands.command_disabled)}}function yi(e,t,n){pi().length>=10||(e.ackBehavior=2,discord.interactions.commands.register(e,(async(i,...a)=>{await wi(e,n,t,i,...a)})),mi.push({config:e,extras:n}))}function Ei(e,t,n){return pi().length>=10?null:(e.ackBehavior=2,gi.push({config:e,extras:t}),n?n.registerGroup(e):discord.interactions.commands.registerGroup(e))}function Di(e,t,n,i){e&&(t.ackBehavior=2,e.register(t,(async(e,...a)=>{await wi(t,i,n,e,...a)})),mi.push({config:t,extras:i}))}async function _i(e,t){const n=await e.getChannel();if(!(n instanceof discord.GuildTextChannel||n instanceof discord.GuildNewsChannel))return!1;const i=await n.sendMessage(t);return i instanceof discord.Message&&(await zi(i),i)}async function bi(e,t,n,i,...a){if(ci.push(i.id),i.member.user.bot&&!bn(i.member))return;if(!bn(i.member))return;if(t.permissions){const e=await i.getGuild(),n=await To(i.member,e,i.channelId,t.permissions.overrideableInfo,t.permissions.level,t.permissions.owner,t.permissions.globalAdmin);if(!n.access){if(n.errors.length>0){let e="";e=n.errors.includes(U.modules.commands.command_disabled)?U.modules.commands.command_disabled:B(U.modules.commands.must_meet_criteria,["execution_criteria",n.errors.join("\n")]);const t=new discord.Embed;let a;t.setTitle(U.modules.commands.cant_use_command_title),t.setColor(16712965),t.setDescription(e);try{a=await i.inlineReply({allowedMentions:{},content:"",embed:t})}catch(e){a=await i.reply({allowedMentions:{},content:"",embed:t})}a&&await zi(a,!0)}return}}const s=await n(i,...a),o=ci.findIndex((e=>e===i.id));o>-1&&ci.splice(o,1),"boolean"==typeof s&&!1===s&&ci.push(i.id)}function Ai(e,t,n,i,a){e.on(t,n,(async(...e)=>{await bi(t,a,i,...e)}))}function Ii(e,t,n,i){e.raw(t,(async(...e)=>{await bi(t,i,n,...e)}))}function vi(e,t,n,i=!0){return e.subcommand(t,(e=>{n(e),i&&e.defaultRaw((async t=>{await Si(t,e)}))}))}async function Ci({message:e,command:t},n){try{ci.push(e.id);let i,a="";if(e.content.includes(" ")){i=[];const n=e.content.split(" ");for(const e in n){const a=n[e];if(i.push(a),a===t.options.name)break}i=i.join(" ")}else i=e.content;if(n instanceof discord.command.ArgumentError){const e={},s=`${i} ${t.argumentConfigList.map((t=>{let n=t[1].type,i=t[0];const a=n.includes("Optional");n=n.split("Optional").join("");for(const a in Mi)if(Mi[a]===i||t[1].options&&(Mi[a]===t[1].options.description||Mi[a]===t[1].options.name)){n=null,i=Mi[a],e[t[0]]=i;break}return a?`[${i}${n?`: ${n}`:""}]`:`<${i}${n?`: ${n}`:""}>`})).join(" ")}`;let o=t.argumentConfigList.find((e=>{const t=e[1].type.toLowerCase();return n.argumentConfig.type.toLowerCase()===t}));o&&([o]=o),e[o]&&(o=e[o]),a=B(U.modules.commands.argument_error,["arg_name",o,"error",n.message,"usage",s])}else di.includes(n.message.toLowerCase())?a=B(U.modules.commands.other_error,["error_name",n.name,"error_message",n.message]):(Zn(n),a=_?U.modules.commands.error_not_logged:U.modules.commands.error_logged,fn("BOT_ERROR",new Map([["ERROR",`Command Error on [${i}]\nMessage: '${e.content}'\n${n.stack}`]])));if(a.length>0){let t;try{t=await e.inlineReply({allowedMentions:{},content:a})}catch(n){t=await e.reply({allowedMentions:{},content:a})}await zi(t)}}catch(e){Zn(e)}}async function Si(e,t){let n,i="";if(e.content.includes(" ")){n=[];const i=e.content.split(" ");for(const e in i){const a=i[e];if(n.push(a),a===t.options.name)break}n=n.join(" ")}else n=e.content;const a=[];for(const[e,n]of t.commandExecutors)n.aliasOf||a.push(e);if(a.length>0&&(i=B(U.modules.commands.unknown_subcommand,["command_parent",Qn(n,!0),"sub_commands",a.join(", ")])),i.length>0){let t;try{t=await e.inlineReply({allowedMentions:{},content:i})}catch(n){t=await e.reply({allowedMentions:{},content:i})}t&&await zi(t)}}var Mi;async function Ti(e,t,n,i,a){const s=e instanceof discord.GuildMemberMessage?e.author.id:e.member.user.id;let o="";if(i===Mi.UserResolvable){if(o=U.modules.infractions.inf_terms.user_not_found,a instanceof discord.User||a instanceof F)return a;if(a instanceof discord.GuildMember)return a.user;let e;if((a=a.replace(/\D/g,"")).length>9)try{e=await H(a,yn(s))}catch(e){}if(e&&e.id)return e}if(e instanceof discord.interactions.commands.SlashCommandInteraction)return null;const r=new discord.command.ArgumentError;throw r.argumentConfig={type:n,options:{name:t,description:i}},r.argumentName=t,r.name="ArgumentError",r.message=o,r}!function(e){e.UserResolvable="UserResolvable"}(Mi||(Mi={}));const Oi={};var Ri=Object.freeze({__proto__:null,errorsDisplay:di,registeredSlashCommands:mi,registeredSlashCommandGroups:gi,SlashGroupHasSubcommands:fi,registerSlash:yi,registerSlashGroup:Ei,registerSlashSub:Di,interactionChannelRespond:_i,executeChatCommand:bi,registerChatOn:Ai,registerChatRaw:Ii,registerChatSubCallback:vi,registerChatSub:function(e,t,n=!0){return vi(e,t,(()=>{}),n)},chatErrorHandler:Ci,unknownHandler:Si,get CustomArgumentType(){return Mi},resolveArgument:Ti,OnMessageCreate:async function(e,t,n){if(ci.length>50&&console.error("Memory leak on commands cmdErrorDebounces"),n.content&&"string"==typeof n.content&&0===n.type&&null!==n.author)if(n.member){if(n.author.bot&&!bn(n.member))return;if("number"==typeof Oi[n.author.id]){if(Date.now()-Oi[n.author.id]<750)return}if(!await async function(e){if(Co().includes(e.channelId))return!1;for(const t in vo){const n=vo[t];if(!0===await n.checkMessage(e))return!0}return!1}(n))return;const e=await n.getGuild(),t=await e.getMember(discord.getBotId()),i=await n.getChannel();if(!i||!t||i instanceof discord.DmChannel)return;let a=!1;if("string"==typeof E.devPrefix&&n.content.length>E.devPrefix.length&&n.content.substr(0,E.devPrefix.length)===E.devPrefix&&(a=!0),!(a&&yn(n.author.id)||i.canMember(t,1024)&&i.canMember(t,2048)&&i.canMember(t,16384)&&i.canMember(t,262144)))return;if(!0===a&&!yn(n.author.id))return;if(!bn(n.member))return void await In(n.member,`command execution: \`${Qn(n.content,!0)}\``);Oi[n.author.id]=Date.now();const s=await async function(e){if(Co().includes(e.channelId))return!1;for(const t in vo){const n=vo[t];if(!0===await n.checkMessage(e))try{return await n.handleMessage(e),!0}catch(e){return e}}return!1}(n);if(await pylon.getCpuTime()<75&&await zi(n,!0),"boolean"==typeof s&&!0===s){const e=ci.findIndex((e=>e===n.id));if(e>-1)return void ci.splice(e,1);if(!a&&!ie(n.channelId)&&!ae(n.member)){const e=await K(n.content);gn("COMMANDS","CHAT_COMMAND_USED",new Map([["COMMAND_NAME",Qn(e,!0)],["AUTHOR",n.author],["USER",n.author],["USER_ID",n.author.id],["MEMBER",n.member],["CHANNEL_ID",n.channelId]]))}}}else;}});const Ni=1e3,Li=50,ki=new li({name:"persist",itemDuration:27648e5,idProperty:"memberId",timestampProperty:"ts",local:!1,maxObjects:30}),Gi=new li({name:"admin",itemDuration:12096e5,idProperty:"id",timestampProperty:"ts",maxObjects:61,reduceAt:55,local:!1}),$i=new pylon.KVNamespace("channelPersists"),Ui=new li({name:"actions",itemDuration:27648e5,idProperty:"id",timestampProperty:"id",reduceAt:30,local:!1});var Bi;!function(e){e.CLEAN="CLEAN",e.LOCK_GUILD="LOCK_GUILD",e.LOCK_CHANNEL="LOCK_CHANNEL",e.SLOWMODE="SLOWMODE",e.TEMPROLE="TEMPROLE",e.ROLE="ROLE",e.NICKNAME="NICKNAME"}(Bi||(Bi={}));class Fi{constructor(e,t,n,i="",a=""){this.reason="";const s=z();return this.id=s,this.ts=q(this.id).timestamp,this.type=e,this.actorId=t,this.targetId=n,e===Bi.LOCK_GUILD&&(this.targetId=void 0),this.reason=a,"string"!=typeof this.reason&&(this.reason=""),void 0!==i&&""!==i||(i=s),this.expiresAt=i,this.active=this.expiresAt!==this.id,this}async updateStorage(){await Ui.editPool(this.id,this)}async checkActive(){if(!this.active)return!1;const e=await discord.getGuild(p);if(this.type===Bi.SLOWMODE){const t=await e.getChannel(this.targetId);null!==t&&t instanceof discord.GuildTextChannel?t.rateLimitPerUser===this.previous&&(this.active=!1):this.active=!1}else if(this.type===Bi.LOCK_CHANNEL){const t=await e.getChannel(this.targetId);if(null!==t&&t instanceof discord.GuildTextChannel){const n=t.permissionOverwrites.find((t=>t.id===e.id));if(n){new ee(n.deny).has("SEND_MESSAGES",!1)||(this.active=!1)}else this.active=!1}else this.active=!1}else if(this.type===Bi.LOCK_GUILD){const t="string"==typeof f.modules.admin.defaultRole&&f.modules.admin.defaultRole.length>6?f.modules.admin.defaultRole:e.id,n=await e.getRole(t);if(n instanceof discord.Role){new ee(n.permissions).has("SEND_MESSAGES",!1)&&(this.active=!1)}else this.active=!1}else if(this.type===Bi.TEMPROLE){const t=await e.getMember(this.targetId);null===t?this.active=!1:"string"==typeof this.targetValue&&t.roles.includes(this.targetValue)||(this.active=!1)}return this.active||await this.updateStorage(),this.active}async checkExpired(){if(!this.active||!this.isExpired())return;if(!await this.checkActive())return;const e=await discord.getGuild(p);if(this.type===Bi.SLOWMODE){const t=await e.getChannel(this.targetId);null!==t&&t instanceof discord.GuildTextChannel&&(await Qi(null,t,this.previous,void 0,U.modules.admin.slowmode_expired),this.active=!1)}else if(this.type===Bi.LOCK_CHANNEL){const t=await e.getChannel(this.targetId);null!==t&&t instanceof discord.GuildTextChannel?(this.active=!1,await Zi(null,t,!1,0,U.modules.admin.channel_lock_expired)):this.active=!1}else if(this.type===Bi.LOCK_GUILD)this.active=!1,await Xi(null,!1,0,U.modules.admin.guild_lock_expired);else if(this.type===Bi.TEMPROLE){const t=await e.getMember(this.targetId);null===t?this.active=!1:"string"==typeof this.targetValue&&t.roles.includes(this.targetValue)?(await t.removeRole(this.targetValue),gn("ADMIN","TEMPROLE_EXPIRED",new Map([["USERTAG",ue(t)],["ROLE_MENTION",`<@&${this.targetValue}>`]]))):this.active=!1}this.active||await this.updateStorage()}isExpired(){if(this.id===this.expiresAt)return!1;const e=q(this.expiresAt).timestamp;return Date.now()-e>0}}class Pi{constructor(e){return this.authorId=e.author.id,this.channelId=e.channelId,this.id=e.id,this.ts=q(this.id).timestamp,this.bot=e.author.bot,(null!==e.webhookId||e.application&&20===e.type)&&(this.bot=!0),this}}const ji=new pylon.KVNamespace("roleAll"),xi=new pylon.KVNamespace("roleNuke");let Hi,Vi=!0;async function Ki(){if("number"==typeof Hi){const e=Date.now()-Hi;if(e<7e3){if(!1===Vi){Vi=!0;setTimeout(Ki,7e3-e+100)}return}}Hi=Date.now();const e=await discord.getGuild(),t=await e.getRoles(),n=await ji.items(),i=await xi.items(),a=[],s=[],o=await e.getMember(discord.getBotId());if(!o.can(268435456))return;const r=await Z(o);if(await Promise.all(n.map((async e=>{if("string"==typeof e.value){t.find((t=>t.id===e.value&&t.position<r.position))?a.push(e.value):await ji.delete(e.key)}}))),await Promise.all(i.map((async e=>{if("string"==typeof e.value){t.find((t=>t.id===e.value&&t.position<r.position))?s.push(e.value):await xi.delete(e.key)}}))),0===a.length&&0===s.length)return;let l=0;for await(const t of e.iterMembers()){if(Hi=Date.now(),t.user.id===o.user.id)continue;if(l>=5)break;let e=!1,n=t.roles.filter((t=>{const n=s.includes(t);return n&&(e=!0),!n}));if(a.length>0){const t=n.length;a.forEach((e=>{n.includes(e)||n.push(e)})),t!==n.length&&(e=!0)}!0===e&&(n=[...new Set(n)],3===l&&(Vi=!1),await t.edit({roles:n}),l++)}if(Vi=!1,l<5){const e=a.filter((e=>!0));e.push(...s),await Promise.all(n.map((async t=>{if("string"==typeof t.value){e.find((e=>e===t.value))&&await ji.delete(t.key)}}))),await Promise.all(i.map((async t=>{if("string"==typeof t.value){e.find((e=>e===t.value))&&await xi.delete(t.key)}})))}}async function Yi(){await async function(){if(!f)return;if(!f.modules.admin.autoPrune||"object"!=typeof f.modules.admin.autoPrune||!f.modules.admin.autoPrune.enabled||!f.modules.admin.autoPrune.channels)return;const e=Date.now();for(const t in f.modules.admin.autoPrune.channels){const n=Kn(f.modules.admin.autoPrune.channels[t]);if(n<1e4||n>6048e5)continue;const i=await discord.getChannel(t);if(!(i instanceof discord.GuildTextChannel||i instanceof discord.GuildNewsChannel))continue;const a=e-n,s=(await Gi.getByQuery({channelId:t})).filter((e=>e.ts<a)),o=s.map((e=>e.id));if(0!==s.length){if(1===s.length){const e=await i.getMessage(s[0].id);await e.delete()}else if(s.length<=100)await i.bulkDeleteMessages(o);else{const e=ti(o,99);await Promise.all(e.map((async e=>{await i.bulkDeleteMessages(e)})))}await Gi.editPools(o,(()=>null))}}}(),Ki(),await async function(){if(!ra())return;const e=f.modules.admin.voiceLink,t=await discord.getGuild(),n=[],i={};for await(const e of t.iterVoiceStates())n.push(e);const a=await t.getChannels();if(e.global&&"string"==typeof e.global&&e.global.length>3){const t=a.find((t=>t.id===e.global));t&&(t instanceof discord.GuildTextChannel||t instanceof discord.GuildNewsChannel)&&(n.forEach((e=>{t.canMember(e.member,1024)||la(e.member,t)||(i[t.id]||(i[t.id]=t.permissionOverwrites),i[t.id]=[...i[t.id],{allow:1024,deny:0,id:e.member.user.id,type:1}])})),t.permissionOverwrites.forEach((e=>{if(1024===e.allow&&1===e.type&&0===e.deny){if(!n.find((t=>t.member.user.id===e.id))){i[t.id]||(i[t.id]=t.permissionOverwrites);const n=i[t.id].findIndex((t=>e.allow===t.allow&&e.deny===t.deny&&e.id===t.id));n>-1&&i[t.id].splice(n,1)}}})))}if(e.channels&&"object"==typeof e.channels&&!Array.isArray(e.channels)&&Object.keys(e.channels).length>0)for(const t in e.channels){const s=a.find((n=>n.id===e.channels[t]));s&&(s instanceof discord.GuildTextChannel||s instanceof discord.GuildNewsChannel)&&(n.forEach((e=>{const n=a.find((t=>t.id===e.channelId));(n.id===t||n.parentId&&n.parentId===t)&&(s.canMember(e.member,1024)||la(e.member,s)||(i[s.id]||(i[s.id]=s.permissionOverwrites),i[s.id]=[...i[s.id],{allow:1024,deny:0,id:e.member.user.id,type:1}]))})),s.permissionOverwrites.forEach((e=>{if(1024===e.allow&&1===e.type&&0===e.deny){if(!n.find((n=>{const i=a.find((e=>e.id===n.channelId));return!(i.id!==t||i.parentId&&i.parentId!==t)&&n.member.user.id===e.id}))){i[s.id]||(i[s.id]=s.permissionOverwrites);const t=i[s.id].findIndex((t=>e.allow===t.allow&&e.deny===t.deny&&e.id===t.id));t>-1&&i[s.id].splice(t,1)}}})))}if(Object.keys(i).length>0)for(const e in i){const t=a.find((t=>t.id===e));await t.edit({permissionOverwrites:i[e]})}}(),await oa();try{const e=await Ui.getByQuery({active:!0}),t=e.map((e=>ei(e,Fi))).filter((e=>!0===e.active&&e.isExpired()));if(t.length>0){const e=[];for(let n=0;n<t.length;n+=1){const i=t[n];i.isExpired()&&(await sleep(200),e.push(i.checkExpired()))}await Promise.all(e)}const n=await Ui.getByQuery({active:!1});n.length>0&&await Ui.editPools(n.map((e=>e.id)),(()=>null))}catch(e){Zn(e)}}async function Wi(e,t,n,i="",a,s,o=""){if(""===i||void 0===i)return;let r,l;if(null===t&&(t=discord.getBotId()),r=e instanceof discord.GuildMember?e.user.id:e.id,void 0===r)return!1;"string"!=typeof o&&(o=""),o.length>101&&(o=o.substr(0,100)),"string"==typeof t&&(l=t),t instanceof discord.User&&(l=t.id),t instanceof discord.GuildMember&&(l=t.user.id);const u=new Fi(n,l,r,i,o);return u.previous=a,u.targetValue=s,await Ui.saveToPool(u),u}async function zi(e,t=!1){if("object"!=typeof f.modules||"object"!=typeof f.modules.admin||"boolean"!=typeof f.modules.admin.enabled||!f.modules.admin.enabled)return!1;const n=new Pi(e);t&&(n.bot=!0);return await Gi.saveToPool(n,0,!0)}async function qi(e){e=e.toLowerCase();for(const t in f.modules.admin.roleAliases){const n=f.modules.admin.roleAliases[t];if("string"==typeof n&&(t===e||n.toLowerCase()===e))return t}for(const t in f.modules.admin.roleAliases){const n=f.modules.admin.roleAliases[t];if("string"==typeof n&&n.toLowerCase().includes(e))return t}const t=await(await discord.getGuild(p)).getRoles();for(const n in t){if(t[n].id===e||t[n].name.toLowerCase()===e)return t[n].id;const i=["<",">","&","@"],a=e.split("").filter((e=>!i.includes(e))).join("");if(t[n].id===a)return t[n].id}for(const n in t)if(t[n].name.toLowerCase().includes(e))return t[n].id;return null}async function Ji(e,t,n,i,a){let s;if(null!==t&&(s=t instanceof discord.GuildMember?t.user.id:t.id),null===e&&s===discord.getBotId())return!1;if(null===e)return"string"!=typeof s||!yn(s);let o=!1;yn(e.user.id)&&(o=await Dn(e.user.id));const r="string"==typeof s&&yn(s),l=await e.getGuild(),u=l.ownerId===e.user.id;if(!o&&!u&&s===discord.getBotId())return U.modules.admin.no_target_bot;const d=await l.getMember(discord.getBotId()),c=l.ownerId===d.user.id;if(!c&&a===Bi.CLEAN&&!n.canMember(d,8192))return U.modules.admin.bot_cant_manage_messages;if(!(c||a!==Bi.ROLE&&a!==Bi.TEMPROLE||d.can(268435456)))return U.modules.admin.bot_cant_manage_roles;if(!c&&a===Bi.NICKNAME&&!d.can(134217728))return U.modules.admin.bot_cant_manage_nicknames;const m=await Z(d),g=t instanceof discord.GuildMember?await Z(t):null;if(!c&&t instanceof discord.GuildMember&&g instanceof discord.Role&&a===Bi.NICKNAME&&t.user.id!==discord.getBotId()&&g.position>=m.position)return U.modules.admin.bot_cant_manage_target;if(i instanceof discord.Role&&(a===Bi.TEMPROLE||a===Bi.ROLE)){if(!c&&i.position>=m.position)return U.modules.admin.bot_cant_manage_role;if(null!==e&&!o&&!u){const t=await Z(e);if(i.position>=t.position)return U.modules.admin.actor_cant_assign_role_hierarchy}}if(f.modules.infractions&&f.modules.infractions.targeting&&!o&&!u){const i="boolean"!=typeof f.modules.infractions.targeting.checkLevels||f.modules.infractions.targeting.checkLevels,o="boolean"!=typeof f.modules.infractions.targeting.checkRoles||f.modules.infractions.targeting.checkRoles,r="boolean"!=typeof f.modules.infractions.targeting.reqDiscordPermissions&&"object"!=typeof f.modules.infractions.targeting.reqDiscordPermissions||f.modules.infractions.targeting.reqDiscordPermissions,l="boolean"!=typeof f.modules.infractions.targeting.allowSelf||f.modules.infractions.targeting.allowSelf;if(!(a!==Bi.CLEAN||n.canMember(e,1024)&&n.canMember(e,2048)))return U.modules.admin.actor_cant_view_channel;if(!0===r){if((a===Bi.ROLE||a===Bi.TEMPROLE)&&!e.can(268435456))return U.modules.admin.actor_cant_manage_roles;if(a===Bi.NICKNAME&&!e.can(134217728))return U.modules.admin.actor_cant_manage_nicknames;if(a===Bi.CLEAN&&!n.canMember(e,8192))return U.modules.admin.actor_cant_manage_messages}else if("object"==typeof r){if(r.MANAGE_ROLES&&(a===Bi.ROLE||a===Bi.TEMPROLE)&&!e.can(268435456))return U.modules.admin.actor_cant_manage_roles;if(r.MANAGE_NICKNAMES&&a===Bi.NICKNAME&&!e.can(134217728))return U.modules.admin.actor_cant_manage_nicknames;if(r.MANAGE_MESSAGES&&a===Bi.CLEAN&&!n.canMember(e,8192))return U.modules.admin.actor_cant_manage_messages}if(e.user.id===s)return!!l||U.modules.admin.actor_cant_target_self;if(!0===i&&t instanceof discord.GuildMember){const n=pn(e),i=pn(t);if(n<=i)return B(U.modules.admin.actor_cant_target_level,["level",i.toString()])}if(!0===o){const t=await Z(e);if(g instanceof discord.Role&&t.position<=g.position)return U.modules.admin.actor_cant_target_roles}}return!(!0===r&&!o&&e.user.id!==s&&!u)||U.modules.admin.actor_cant_target_globaladmin}async function Qi(e,t,n,i,a=""){const s=await t.getGuild();if(null===s)return!1;const o=await s.getMember(discord.getBotId());if(null===o)return;if(!t.canMember(o,16))return U.modules.admin.cant_manage_channel;if("string"!=typeof a&&(a=""),a.length>101&&(a=a.substr(0,100)),!(t instanceof discord.GuildTextChannel))return U.modules.admin.invalid_channel;if(t.rateLimitPerUser===n)return U.modules.admin.adm_slowmode.channel_already_slowmode;const r=t.rateLimitPerUser;await t.edit({rateLimitPerUser:n});const l=i>0?z(Date.now()+i):void 0;n>0&&i>0&&await Wi(t,e,Bi.SLOWMODE,l,r,void 0,a);const u=new Map([["ACTORTAG",U.ranks.system],["SECONDS",n.toString()],["CHANNEL_ID",t.id],["DURATION",i>0?` for ${Vn(i,2,!1,U.time_units.ti_full.singular.second)}`:""],["REASON",""]]);if(null!==e&&(u.set("ACTORTAG",me(e)),u.set("ACTOR_ID",e.user.id)),a.length>0&&u.set("REASON",B(U.modules.admin.reason,["reason",Qn(a,!0)])),gn("ADMIN","SLOWMODE",u),t.canMember(o,2048)){const e=`${B(n>0?U.modules.admin.adm_slowmode.slowmode_enabled:U.modules.admin.adm_slowmode.slowmode_disabled,["seconds",n.toString(),"actor_tag",u.get("ACTORTAG")])}${i>0?B(U.modules.admin.for_time,["time",Vn(i,2,!1,U.time_units.ti_full.singular.second)]):""}${a.length>0?B(U.modules.admin.reason,["reason",Qn(a,!0)]):""}`;zi(await t.sendMessage({allowedMentions:{},content:e}))}return!0}async function Zi(e,t,n,i,a=""){const s=await t.getGuild();if(null===s)return!1;const o=await s.getMember(discord.getBotId());if(null===o)return;if(!t.canMember(o,268435456)||!t.canMember(o,16))return U.modules.admin.cant_manage_channel;if("string"!=typeof a&&(a=""),a.length>101&&(a=a.substr(0,100)),!(t instanceof discord.GuildTextChannel||t instanceof discord.GuildNewsChannel))return U.modules.admin.invalid_channel;const r=t.permissionOverwrites.find((e=>e.id===s.id));if(!r)return!1;const l=new ee(r.deny);if(l.has("SEND_MESSAGES",!1)&&!0===n)return U.modules.admin.adm_lock_channel.already_locked;if(!l.has("SEND_MESSAGES",!1)&&!n)return U.modules.admin.adm_lock_channel.not_locked;const u=t.permissionOverwrites.map((e=>(e.id===s.id&&(e.deny=Number(!0===n?new ee(e.deny).add("SEND_MESSAGES").bitfield:new ee(e.deny).remove("SEND_MESSAGES").bitfield)),e))),d=i>0?z(Date.now()+i):void 0;!0===n&&i>0&&await Wi(t,e,Bi.LOCK_CHANNEL,d,void 0,void 0,a),await t.edit({permissionOverwrites:u});const c=new Map([["ACTORTAG",U.ranks.system],["DURATION",i>0?` for ${Vn(i,2,!1,U.time_units.ti_full.singular.second)}`:""],["CHANNEL_ID",t.id],["REASON",""]]);let m="LOCKED_CHANNEL";if(!1===n&&(m="UNLOCKED_CHANNEL"),null!==e&&(c.set("ACTORTAG",me(e)),c.set("ACTOR_ID",e.user.id)),a.length>0&&c.set("REASON",B(U.modules.admin.reason,["reason",Qn(a,!0)])),gn("ADMIN",m,c),t.canMember(o,2048)){const e=`${B(!0===n?U.modules.admin.adm_lock_channel.locked:U.modules.admin.adm_lock_channel.unlocked,["actor_tag",c.get("ACTORTAG")])}${i>0?B(U.modules.admin.for_time,["time",Vn(i,2,!1,U.time_units.ti_full.singular.second)]):""}${a.length>0?B(U.modules.admin.reason,["reason",Qn(a,!0)]):""}`;zi(await t.sendMessage({allowedMentions:{},content:e}))}return!0}async function Xi(e,t,n,i=""){const a=await discord.getGuild(p);if(null===a)return!1;const s=await a.getMember(discord.getBotId());if(null===s)return;if(!s.can(268435456))return U.modules.admin.bot_cant_manage_roles;"string"!=typeof i&&(i=""),i.length>101&&(i=i.substr(0,100));const o="string"==typeof f.modules.admin.defaultRole&&f.modules.admin.defaultRole.length>6?f.modules.admin.defaultRole:a.id,r=await a.getRole(o);if(!r)return!1;if(r.id!==a.id){if((await Z(s)).position<=r.position)return B(U.modules.admin.adm_lock_guild.cant_edit_role,["role_mention",r.toMention()])}const l=new ee(r.permissions);if(!l.has("SEND_MESSAGES",!1)&&!0===t)return U.modules.admin.adm_lock_guild.already_locked;if(l.has("SEND_MESSAGES",!1)&&!t)return U.modules.admin.adm_lock_guild.not_locked;!0===t?l.remove("SEND_MESSAGES"):l.add("SEND_MESSAGES");const u=n>0?z(Date.now()+n):void 0;!0===t&&n>0&&await Wi(a,e,Bi.LOCK_GUILD,u,void 0,void 0,i),await r.edit({permissions:Number(l.bitfield)});const d=new Map([["ACTORTAG",U.ranks.system],["DURATION",n>0?` for ${Vn(n,2,!1,U.time_units.ti_full.singular.second)}`:""],["REASON",""]]);let c="LOCKED_GUILD";return!1===t&&(c="UNLOCKED_GUILD"),null!==e&&(d.set("ACTORTAG",me(e)),d.set("ACTOR_ID",e.user.id)),i.length>0&&d.set("REASON",B(U.modules.admin.reason,["reason",Qn(i,!0)])),gn("ADMIN",c,d),!0}async function ea(e,t,n,i,a=""){const s=await discord.getGuild(p);if(null===s)return!1;if(0===i)return U.modules.admin.invalid_duration;if(null===await s.getMember(discord.getBotId()))return;if(!(n instanceof discord.Role)){const e=await qi(n);if(null===e)return U.modules.admin.unknown_role;if(!((n=await s.getRole(e))instanceof discord.Role))return B(U.modules.admin.role_inexistent,["role_id",e])}const o=await Ji(e,t,void 0,n,Bi.TEMPROLE);if(!0!==o)return o;if(t.roles.includes(n.id))return U.modules.admin.already_has_role;"string"!=typeof a&&(a=""),a.length>101&&(a=a.substr(0,100));const r=i>0?z(Date.now()+i):void 0;await Wi(t,e,Bi.TEMPROLE,r,void 0,n.id,a),await t.addRole(n.id);const l=new Map([["ROLE_MENTION",n.toMention()],["USERTAG",ue(t)],["ACTORTAG",U.ranks.system],["DURATION",i>0?`${Vn(i,2,!1,U.time_units.ti_full.singular.second)}`:""],["REASON",""]]);return null!==e&&(l.set("ACTORTAG",me(e)),l.set("ACTOR_ID",e.user.id)),a.length>0&&l.set("REASON",B(U.modules.admin.reason,["reason",Qn(a,!0)])),gn("ADMIN","TEMPROLE",l),!0}async function ta(e,t,n,i,a=""){const s=await discord.getGuild(p);if(null===s)return!1;if(null===await s.getMember(discord.getBotId()))return;if(!(n instanceof discord.Role)){const e=await qi(n);if(null===e)return U.modules.admin.unknown_role;if(!((n=await s.getRole(e))instanceof discord.Role))return B(U.modules.admin.role_inexistent,["role_id",e])}const o=await Ji(e,t,void 0,n,Bi.ROLE);if(!0!==o)return o;if(t.roles.includes(n.id)&&!0===i)return U.modules.admin.already_has_role;if(!t.roles.includes(n.id)&&!i)return U.modules.admin.already_doesnt_have_role;"string"!=typeof a&&(a=""),a.length>101&&(a=a.substr(0,100)),!0===i?await t.addRole(n.id):await t.removeRole(n.id);const r=new Map([["ROLE_MENTION",n.toMention()],["USERTAG",ue(t)],["ACTORTAG",U.ranks.system],["REASON",""]]);null!==e&&(r.set("ACTORTAG",me(e)),r.set("ACTOR_ID",e.user.id)),a.length>0&&r.set("REASON",B(U.modules.admin.reason,["reason",Qn(a,!0)]));return gn("ADMIN",!0===i?"ROLE_ADDED":"ROLE_REMOVED",r),!0}async function na(e,t,n,i=""){const a=await discord.getGuild(p);if(null===a)return!1;if(null===await a.getMember(discord.getBotId()))return;const s=await Ji(e,t,void 0,void 0,Bi.NICKNAME);if(!0!==s)return s;if(t.nick===n)return U.modules.admin.adm_nick.already_has_nick;"string"!=typeof i&&(i=""),i.length>101&&(i=i.substr(0,100)),await t.edit({nick:n});const o=new Map([["NEW_NICK",null===n?"None":Qn(n)],["USERTAG",ue(t)],["ACTORTAG",U.ranks.system],["REASON",""]]);return null!==e&&(o.set("ACTORTAG",me(e)),o.set("ACTOR_ID",e.user.id)),i.length>0&&o.set("REASON",B(U.modules.admin.reason,["reason",Qn(i,!0)])),gn("ADMIN","NICKNAME",o),!0}let ia=!1;async function aa(e,t,n,i,a,s,o="",r=!1){let l;t instanceof discord.User?l=t.id:t instanceof discord.GuildMember&&(l=t.user.id);const u=await i.getGuild();if(null===u)return!1;if("string"!=typeof o&&(o=""),o.length>101&&(o=o.substr(0,100)),0===a)return!1;if(a>Ni)return U.modules.admin.adm_clean.too_many_msgs;const d=await Ji(n,t,i,void 0,Bi.CLEAN);if(!0!==d)return d;if(!0===ia&&!r)return U.modules.admin.adm_clean.already_cleaning;const c=e-500;let m={authorId:l,channelId:s};"string"!=typeof l&&(m={...t,channelId:s});for(const e in m)void 0===m[e]&&delete m[e];let g=(await Gi.getByQuery(m)).filter((e=>("number"==typeof e.ts?e.ts:q(e.id).timestamp)<c));if(0===g.length)return 0;if(g=g.slice(0,Math.min(g.length,a)),0===g.length)return 0;ia=!0;const f=[],p={};"string"==typeof s?p[s]=[].concat(g).map((e=>e.id)):g.forEach((e=>{Array.isArray(p[e.channelId])||(p[e.channelId]=[]),p[e.channelId].push(e.id)}));const h=await u.getMember(discord.getBotId());if(null===h)return;const w=[];for(const e in p)w.push(new Promise((async(t,n)=>{const a=p[e];let s;if(i.id===e)s=i;else{const t=await discord.getChannel(e);t instanceof discord.GuildChannel&&(s=t)}if(!(s&&(s instanceof discord.GuildTextChannel||s instanceof discord.GuildNewsChannel)))return void t(null);const o=s;if(o.canMember(h,8192)){if(1===a.length)try{const e=await o.getMessage(a[0]);await e.delete(),f.push(a[0])}catch(e){}else if(a.length>100){const e=ti(a,99);await Promise.all(e.map((async e=>{await o.bulkDeleteMessages(e),f.push(...e)})))}else await o.bulkDeleteMessages(a),f.push(...a);t(null)}else t(null)})));if(await Promise.all(w),ia=!1,f.length>0){const e=new Map([["MESSAGES",f.length.toString()],["ACTORTAG",U.ranks.system],["CHANNEL",""],["USERTAG",""]]);null!==n&&(e.set("ACTORTAG",me(n)),e.set("ACTOR_ID",n.user.id)),"string"==typeof s&&e.set("CHANNEL",B(U.modules.admin.adm_clean.in_channel,["channel_mention",`<#${s}>`])),"string"==typeof l&&(e.set("USERTAG",B(U.modules.admin.adm_clean.from_user,["user_tag",de(t)])),e.set("USER_ID",l)),gn("ADMIN","CLEAN",e)}return f.length}const sa=new pylon.KVNamespace("roleLock");async function oa(){if(!(Array.isArray(f.modules.admin.lockedRoles)&&f.modules.admin.lockedRoles.length>0)){return void((await sa.list()).length>0&&await sa.clear())}const e=await discord.getGuild(),t=(await e.getRoles()).filter((e=>f.modules.admin.lockedRoles.includes(e.id)));if(t.length<1)return;const n=t.map((e=>e.id));await sa.transactMultiWithResult(n,(e=>{let i=!1;const a=[];for(const s in n){const o=n[s],r=t.find((e=>e.id===o)),l=e[s];if(l){l.locked&&l.unlocked_until?l.unlocked_until=null:!l.locked&&l.unlocked_until&&Date.now()>l.unlocked_until&&(l.unlocked_until=null,l.locked=!0),a.push(l);continue}const u={locked:!0,role_data:{color:r.color,hoist:r.hoist,mentionable:r.mentionable,name:r.name,permissions:r.permissions}};a.push(u),i=!0}return{next:a,result:i}}))}function ra(){const e=f.modules.admin.voiceLink;return!!e&&(!(!e.global&&!e.channels)&&(!!(e.global&&"string"==typeof e.global&&e.global.length>3)||!!(e.channels&&"object"==typeof e.channels&&!Array.isArray(e.channels)&&Object.keys(e.channels).length>0)))}function la(e,t){e instanceof discord.GuildMember&&(e=e.user.id);return!!t.permissionOverwrites.find((t=>{if(t.id===e&&1024===t.allow)return t}))}class ua{constructor(e,t,n,i,a){return this.ts=Date.now(),this.memberId=e,this.roles=t,"string"==typeof n&&n.length>0&&(this.nick=n),"number"==typeof i&&i>0&&(this.level=i),a.length>0&&(this.channels=a),this}}async function da(e){const t=await $i.get("channels"),n=[];if(t&&null!==t&&"object"==typeof t)for(const i in t){const a=t[i].filter((t=>t.id===e)).map((e=>(e.channelId=i,e)));a.length>0&&n.push(...a)}return n}let ca,ma=Date.now();function ga(){(!ca||Date.now()-ma>6e4)&&(ca=setTimeout((async()=>{await fa()}),3e3),ma=Date.now())}async function fa(){ma=Date.now();const e=await discord.getGuild(),t=await e.getChannels(),n={};await Promise.all(t.map((async e=>{const t=[];let i=!1;if(e.parentId&&null!==e.parentId){let t;try{t=await discord.getGuildCategory(e.parentId)}catch(e){}if(t&&null!==t){let n=!1;const a=t.permissionOverwrites;e.permissionOverwrites.forEach((e=>{a.find((t=>t.id===e.id&&t.type===e.type&&t.allow===e.allow&&t.deny===e.deny))||(n=!0)})),n||(i=!0)}}if(i)return;const a=e.permissionOverwrites.filter((e=>1==e.type));a.length>0&&a.forEach((e=>{const n={id:e.id};0!=e.allow&&(n.allow=e.allow),0!=e.deny&&(n.deny=e.deny),t.push(n)})),t.length>0&&(n[e.id]=t)}))),Object.keys(n).length>0&&await $i.put("channels",n),ca=null}async function pa(e){if(!f.modules.admin.persist||!0!==f.modules.admin.persist.enabled)return!1;let t=e.roles.filter((e=>!0));"object"==typeof f.modules.admin.autoroles&&(!0===e.user.bot&&Array.isArray(f.modules.admin.autoroles.bot)?t=t.filter((e=>!f.modules.admin.autoroles.bot.includes(e))):!1===e.user.bot&&Array.isArray(f.modules.admin.autoroles.human)&&(t=t.filter((e=>!f.modules.admin.autoroles.human.includes(e)))));const n=await da(e.user.id);if(0===t.length&&null===e.nick&&0===n.length)return!1;const i=new ua(e.user.id,e.roles,e.nick,pn(e),n);return await ki.saveToPool(i),gn("PERSIST","SAVED",new Map([["USERTAG",ue(e)],["USER_ID",e.user.id],["USER",e.user]])),!0}async function ha(e){if(!f.modules.admin.persist||!0!==f.modules.admin.persist.enabled)return!1;const t=await ki.getById(e.user.id);if(!t)return!1;const n=function(e,t){let n=pn(e);void 0!==t&&(n=t);let i=1e3;for(const e in f.modules.admin.persist.levels){const t=parseInt(e,10);t>=n&&t<i&&(i=t)}const a=f.modules.admin.persist.levels[i.toString()];return void 0===a?void 0!==f.modules.admin.persist.levels[i]?f.modules.admin.persist.levels[i]:null:a}(e,"number"==typeof t.level?t.level:0);if(null===n)return!1;const i=await e.getGuild(),a=await i.getMember(discord.getBotId()),s=await Z(a),o=await Z(e),r=(await i.getRoles()).filter((e=>t.roles.includes(e.id)&&e.position<s.position&&!e.managed&&e.id!==e.guildId)).map((e=>e.id)).filter((e=>!(Array.isArray(n.roleIncludes)&&n.roleIncludes.length>0&&!n.roleIncludes.includes(e))&&(!Array.isArray(n.roleExcludes)||!n.roleExcludes.includes(e))));e.roles.forEach((e=>{r.includes(e)||e===i.id||r.push(e)}));const l={};!0===n.roles&&r.length>0&&(l.roles=r),!0===n.nick&&(null===o||s.position>o.position)&&(l.nick=t.nick),await e.edit(l);const u=t.channels,d=await i.getChannels();return u&&Array.isArray(u)&&!0===n.channels&&await Promise.all(u.map((async e=>{const t=d.find((t=>t.id===e.channelId));if(!t||null===t)return;if(t.permissionOverwrites.find((t=>t.id===e.id)))return;const n={id:e.id,allow:e.allow??0,deny:e.deny??0,type:1},i=[].concat(t.permissionOverwrites).concat(n);if(4===t.type){const e=d.filter((e=>{if(e.parentId!==t.id)return!1;let n=!1;for(let i=0;i<e.permissionOverwrites.length;i++){const a=e.permissionOverwrites[i];if(!t.permissionOverwrites.find((e=>e.id===a.id&&e.allow===a.allow&&e.deny===a.deny&&e.type===a.type))){n=!0;break}}return!n}));await Promise.all(e.map((async e=>{await e.edit({permissionOverwrites:i})})))}await t.edit({permissionOverwrites:i})}))),await ki.editPool(e.user.id,void 0),gn("PERSIST","RESTORED",new Map([["USERTAG",ue(e)],["USER_ID",e.user.id],["USER",e.user]])),!0}const wa={};async function ya(e,t,n){if(!t.guildId||!t.member||"object"!=typeof f.modules||"object"!=typeof f.modules.admin||"object"!=typeof f.modules.admin.reactroles||!0!==f.modules.admin.reactroles.enabled||!Array.isArray(f.modules.admin.reactroles.definitions))return;const i=f.modules.admin.reactroles.definitions,{member:a}=t;if(!0===a.user.bot)return;const s=t.messageId,{emoji:o}=t,r=i.find((e=>{if("string"!=typeof e.message||"string"!=typeof e.role||"string"!=typeof e.emoji||"string"!=typeof e.type)return!1;const t=e.type.toLowerCase();return("once"===t||"toggle"===t||"remove"===t)&&(e.message===s&&(Yn(e.emoji)?"string"==typeof o.id&&e.emoji===o.id:"string"==typeof o.name&&o.name===e.emoji))}));if(!r)return;const l=r.type.toLowerCase();if("remove"===l&&!1===n)return;if("once"===l&&!1===n)return;const u=await discord.getChannel(t.channelId);if(!(u instanceof discord.GuildTextChannel||u instanceof discord.GuildNewsChannel))return;let d;try{d=await u.getMessage(t.messageId)}catch(e){return}if(null===d)return;const c=d.reactions.find((e=>!1!==e.me&&("GUILD"===o.type?o.id===e.emoji.id:o.name===e.emoji.name)));if(void 0!==c&&!0===n&&("once"===l||"remove"===l))try{d.deleteReaction("GUILD"===o.type?`${o.name}:${o.id}`:`${o.name}`,t.userId)}catch(e){}if("number"==typeof wa[t.userId]){if(Date.now()-wa[t.userId]<500)return}if(wa[t.userId]=Date.now(),!c)return void await d.addReaction("GUILD"===o.type?`${o.name}:${o.id}`:`${o.name}`);const m=await discord.getGuild(),g=await m.getMember(t.userId);if(null===g)return;let p;if("once"!==l||g.roles.includes(r.role)?"remove"===l&&g.roles.includes(r.role)?(await g.removeRole(r.role),p=!1):"toggle"===l&&(g.roles.includes(r.role)&&!1===n?(await g.removeRole(r.role),p=!1):g.roles.includes(r.role)||!0!==n||(await g.addRole(r.role),p=!0)):(await g.addRole(r.role),p=!0),"boolean"==typeof p){let n="ROLE_ADDED";!1===p&&(n="ROLE_REMOVED");gn("REACTROLES",n,new Map([["USERTAG",ue(g)],["USER_ID",t.userId],["CHANNEL_ID",t.channelId],["MESSAGE_ID",t.messageId],["EMOJI",t.emoji.toMention()],["ROLE_ID",r.role]]),e)}}function Ea(e){Ai(e,"user",(e=>({user:e.string({name:"user",description:"UserResolvable"}),count:e.integerOptional({maxValue:Ni,minValue:1,default:Li})})),(async(e,{user:t,count:n})=>{let i=await Ti(e,"user","string",Mi.UserResolvable,t);const a=await e.getChannel(),s=await e.getGuild(),o=await s.getMember(i.id);o&&(i=o);const r=await aa(q(e.id).timestamp,i,e.member,a,n,e.channelId);"number"!=typeof r?!1===r?await Po(void 0,e,!1,U.modules.admin.adm_clean.failed_clean):"string"==typeof r&&await Po(void 0,e,!1,r):r>0?await Po(void 0,e,!0,B(U.modules.admin.adm_clean.cleaned_messages_user,["count",r.toString(),"user_mention",t.getTag()])):await Po(void 0,e,!1,U.modules.admin.adm_clean.no_messages_cleaned)}),{permissions:{overrideableInfo:"admin.clean.user",level:w.Moderator}}),Ai(e,"channel",(e=>({channel:e.guildTextChannel(),count:e.integerOptional({maxValue:Ni,minValue:1,default:Li})})),(async(e,{channel:t,count:n})=>{const i=await aa(q(e.id).timestamp,{},e.member,t,n,t.id);"number"!=typeof i?!1===i?await Po(void 0,e,!1,U.modules.admin.adm_clean.failed_clean):"string"==typeof i&&await Po(void 0,e,!1,i):i>0?await Po(void 0,e,!0,B(U.modules.admin.adm_clean.cleaned_messages_channel,["count",i.toString(),"channel_mention",t.toMention()])):await Po(void 0,e,!1,U.modules.admin.adm_clean.no_messages_cleaned)}),{permissions:{overrideableInfo:"admin.clean.channel",level:w.Moderator}}),Ai(e,"here",(e=>({count:e.integerOptional({maxValue:Ni,minValue:1,default:Li})})),(async(e,{count:t})=>{const n=await e.getChannel(),i=await aa(q(e.id).timestamp,{},e.member,n,t,e.channelId);"number"!=typeof i?!1===i?await Po(void 0,e,!1,U.modules.admin.adm_clean.failed_clean):"string"==typeof i&&await Po(void 0,e,!1,i):i>0?await Po(void 0,e,!0,B(U.modules.admin.adm_clean.cleaned_messages_channel,["count",i.toString(),"channel_mention",`<#${e.channelId}>`])):await Po(void 0,e,!1,U.modules.admin.adm_clean.no_messages_cleaned)}),{permissions:{overrideableInfo:"admin.clean.here",level:w.Moderator}}),Ai(e,"all",(e=>({count:e.integerOptional({maxValue:Ni,minValue:1,default:Li})})),(async(e,{count:t})=>{const n=await e.getChannel(),i=await aa(q(e.id).timestamp,{},e.member,n,t);"number"!=typeof i?!1===i?await Po(void 0,e,!1,U.modules.admin.adm_clean.failed_clean):"string"==typeof i&&await Po(void 0,e,!1,i):i>0?await Po(void 0,e,!0,B(U.modules.admin.adm_clean.cleaned_messages_all,["count",i.toString()])):await Po(void 0,e,!1,U.modules.admin.adm_clean.no_messages_cleaned)}),{permissions:{overrideableInfo:"admin.clean.all",level:w.Administrator}}),Ai(e,"bots",(e=>({count:e.integerOptional({maxValue:Ni,minValue:1,default:Li})})),(async(e,{count:t})=>{const n=await e.getChannel(),i=await aa(q(e.id).timestamp,{bot:!0},e.member,n,t,e.channelId);"number"!=typeof i?!1===i?await Po(void 0,e,!1,U.modules.admin.adm_clean.failed_clean):"string"==typeof i&&await Po(void 0,e,!1,i):i>0?await Po(void 0,e,!0,B(U.modules.admin.adm_clean.cleaned_messages_bots,["count",i.toString()])):await Po(void 0,e,!1,U.modules.admin.adm_clean.no_messages_cleaned)}),{permissions:{overrideableInfo:"admin.clean.bots",level:w.Moderator}})}const Da=Ei({name:"clean",description:"Commands to clear messages in the server"},{module:"admin"});Da&&(Di(Da,{name:"user",description:"Clear messages by a specific user",options:e=>({user:e.guildMember({required:!0,description:"The user to clear messages from"}),count:e.integer({required:!1,description:"How many messages to clear (most recent to older). If not defined, clears 50 messages"})})},(async(e,{user:t,count:n})=>{n||(n=Li);const i=await e.getChannel();let a=!1;const s=setTimeout((async()=>{await e.acknowledge({ephemeral:!1}),a=!0}),1500),o=await aa(q(e.id).timestamp,t,e.member,i,n,e.channelId);return a||clearTimeout(s),"number"!=typeof o?(a||await e.acknowledge({ephemeral:!0}),!1===o?await jo(void 0,e,!1,U.modules.admin.adm_clean.failed_clean):"string"==typeof o&&await jo(void 0,e,!1,o),!1):o>0?(a||await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.admin.adm_clean.cleaned_messages_user,["count",o.toString(),"user_mention",t.user.toMention()]))):(a||await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_clean.no_messages_cleaned),!1)}),{module:"admin",parent:"clean",permissions:{overrideableInfo:"admin.clean.user",level:w.Moderator}}),Di(Da,{name:"channel",description:"Clear any kind of messages in a specific channel",options:e=>({channel:e.guildChannel({required:!0,description:"The channel to clear messages from"}),count:e.integer({required:!1,description:"How many messages to clear (most recent to older). If not defined, clears 50 messages"})})},(async(e,{channel:t,count:n})=>{n||(n=Li);let i=!1;const a=setTimeout((async()=>{await e.acknowledge({ephemeral:!1}),i=!0}),1500),s=await aa(q(e.id).timestamp,{},e.member,t,n,t.id);return i||clearTimeout(a),"number"!=typeof s?(i||await e.acknowledge({ephemeral:!0}),!1===s?await jo(void 0,e,!1,U.modules.admin.adm_clean.failed_clean):"string"==typeof s&&await jo(void 0,e,!1,s),!1):s>0?(i||await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.admin.adm_clean.cleaned_messages_channel,["count",s.toString(),"channel_mention",t.toMention()]))):(i||await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_clean.no_messages_cleaned),!1)}),{module:"admin",parent:"clean",permissions:{overrideableInfo:"admin.clean.channel",level:w.Moderator}}),Di(Da,{name:"here",description:"Clear any kind of messages in the current channel",options:e=>({count:e.integer({required:!1,description:"How many messages to clear (most recent to older). If not defined, clears 50 messages"})})},(async(e,{count:t})=>{t||(t=Li);const n=await e.getChannel();let i=!1;const a=setTimeout((async()=>{await e.acknowledge({ephemeral:!1}),i=!0}),1500),s=await aa(q(e.id).timestamp,{},e.member,n,t,n.id);return i||clearTimeout(a),"number"!=typeof s?(i||await e.acknowledge({ephemeral:!0}),!1===s?await jo(void 0,e,!1,U.modules.admin.adm_clean.failed_clean):"string"==typeof s&&await jo(void 0,e,!1,s),!1):s>0?(i||await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.admin.adm_clean.cleaned_messages_channel,["count",s.toString(),"channel_mention",n.toMention()]))):(i||await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_clean.no_messages_cleaned),!1)}),{module:"admin",parent:"clean",permissions:{overrideableInfo:"admin.clean.here",level:w.Moderator}}),Di(Da,{name:"all",description:"Clear latest X messages in the entire server",options:e=>({count:e.integer({required:!1,description:"How many messages to clear (most recent to older). If not defined, clears 50 messages"})})},(async(e,{count:t})=>{t||(t=Li);const n=await e.getChannel();let i=!1;const a=setTimeout((async()=>{await e.acknowledge({ephemeral:!1}),i=!0}),1500),s=await aa(q(e.id).timestamp,{},e.member,n,t);return i||clearTimeout(a),"number"!=typeof s?(i||await e.acknowledge({ephemeral:!0}),!1===s?await jo(void 0,e,!1,U.modules.admin.adm_clean.failed_clean):"string"==typeof s&&await jo(void 0,e,!1,s),!1):s>0?(i||await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.admin.adm_clean.cleaned_messages_all,["count",s.toString()]))):(i||await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_clean.no_messages_cleaned),!1)}),{module:"admin",parent:"clean",permissions:{overrideableInfo:"admin.clean.all",level:w.Administrator}}),Di(Da,{name:"bots",description:"Clear latest X messages in the current channel by bots",options:e=>({count:e.integer({required:!1,description:"How many messages to clear (most recent to older). If not defined, clears 50 messages"})})},(async(e,{count:t})=>{t||(t=Li);const n=await e.getChannel();let i=!1;const a=setTimeout((async()=>{await e.acknowledge({ephemeral:!1}),i=!0}),1500),s=await aa(q(e.id).timestamp,{bot:!0},e.member,n,t,e.channelId);return i||clearTimeout(a),"number"!=typeof s?(i||await e.acknowledge({ephemeral:!0}),!1===s?await jo(void 0,e,!1,U.modules.admin.adm_clean.failed_clean):"string"==typeof s&&await jo(void 0,e,!1,s),!1):s>0?(i||await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.admin.adm_clean.cleaned_messages_bots,["count",s.toString()]))):(i||await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_clean.no_messages_cleaned),!1)}),{module:"admin",parent:"clean",permissions:{overrideableInfo:"admin.clean.bots",level:w.Moderator}}));const _a=Ei({name:"invites",description:"Invite-related commands"},{module:"admin"});_a&&Di(_a,{name:"prune",description:"Prune invites with X or less uses on the server",options:e=>({uses:e.integer({required:!1,description:"The uses or less that an invite has to have to be cleared"})})},(async(e,{uses:t})=>{t||(t=0);const n=await e.getGuild(),i=await n.getInvites();let a=0;return await Promise.all(i.map((async e=>{e.uses<=t&&(await e.delete(),a+=1)}))),0===a?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_inv_prune.no_invites),!1):(await e.acknowledge({ephemeral:!1}),await jo(void 0,e,!0,B(U.modules.admin.adm_inv_prune.pruned,["count",a.toString()])),!0)}),{module:"admin",parent:"invites",permissions:{overrideableInfo:"admin.invites.prune",level:w.Administrator}});const ba=Ei({name:"role",description:"Role management commands"},{module:"admin"});ba&&(Di(ba,{name:"unlock",description:"Unlocks a locked role",options:e=>({role:e.guildRole({required:!0,description:"The role to unlock"})})},(async(e,{role:t})=>{if(!Array.isArray(f.modules.admin.lockedRoles)||0===f.modules.admin.lockedRoles.length)return await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.no_locked_roles),!1;if(!f.modules.admin.lockedRoles.includes(t.id))return await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_role_unlock.not_locked),!1;const{result:n}=await sa.transactWithResult(t.id,(e=>{if(e&&!1===e.locked)return{result:!1,next:e};const t=e;return t.locked=!1,t.unlocked_until=Date.now()+3e5,{result:!0,next:t}}));if(!n)return await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_role_unlock.already_unlocked),!1;await e.acknowledge({ephemeral:!1}),await jo(void 0,e,!0,U.modules.admin.adm_role_unlock.unlocked)}),{module:"admin",parent:"role",permissions:{overrideableInfo:"admin.role.unlock",level:w.Administrator}}),Di(ba,{name:"add",description:"Add a role to a member",options:e=>({member:e.guildMember({required:!0,description:"The member to give the role to"}),role:e.guildRole({required:!0,description:"The role to add"})})},(async(e,{member:t,role:n})=>{const i=await ta(e.member,t,n,!0);return"string"==typeof i?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,i),!1):!0===i?(await e.acknowledge({ephemeral:!1}),await jo(void 0,e,!0,B(U.modules.admin.adm_role_add.added_role,["role_mention",n.toMention(),"user_mention",t.user.toMention()])),!0):(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_role_add.failed_add),!1)}),{module:"admin",parent:"role",permissions:{overrideableInfo:"admin.role.add",level:w.Administrator}}),Di(ba,{name:"remove",description:"Remove a role from a member",options:e=>({member:e.guildMember({required:!0,description:"The member to remove the role from"}),role:e.guildRole({required:!0,description:"The role to remove"})})},(async(e,{member:t,role:n})=>{const i=await ta(e.member,t,n,!1);return"string"==typeof i?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,i),!1):!0===i?(await e.acknowledge({ephemeral:!1}),await jo(void 0,e,!0,B(U.modules.admin.adm_role_remove.removed_role,["role_mention",n.toMention(),"user_mention",t.user.toMention()])),!0):(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_role_remove.failed_remove),!1)}),{module:"admin",parent:"role",permissions:{overrideableInfo:"admin.role.remove",level:w.Administrator}}),Di(ba,{name:"join",description:"Join a user-joinable role",options:e=>({role:e.guildRole({required:!0,description:"The role to join"})})},(async(e,{role:t})=>{if("object"!=typeof f.modules.admin.groupRoles||0===Object.keys(f.modules.admin.groupRoles).length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.group_roles_disabled),!1;const n=f.modules.admin.groupRoles[t.id];if("string"!=typeof n||n.length<5)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.role_incorrectly_configured),!1;if(e.member.roles.includes(t.id))return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.group_already_has_role),!1;let i=new ee(t.permissions).serialize(!0);for(const e in i)!1===i[e]&&delete i[e];i=Object.keys(i);const a=["ADMINISTRATOR","KICK_MEMBERS","BAN_MEMBERS","MANAGE_CHANNELS","MANAGE_GUILD","MANAGE_MESSAGES","MENTION_EVERYONE","MUTE_MEMBERS","DEAFEN_MEMBERS","MANAGE_NICKNAMES","MANAGE_ROLES","MANAGE_EMOJIS_AND_STICKERS","MANAGE_WEBHOOKS","MOVE_MEMBERS","MANAGE_THREADS"];if(!i.every((e=>!a.includes(e))))return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.group_has_staff_perms),!1;await e.acknowledge({ephemeral:!1}),await e.member.addRole(t.id),await _i(e,{content:B(U.modules.admin.group_joined,["role_mention",t.toMention()]),allowedMentions:{}})}),{module:"admin",parent:"role",permissions:{overrideableInfo:"admin.role.join",level:w.Guest}}),Di(ba,{name:"leave",description:"Leave a user-joinable role",options:e=>({role:e.guildRole({required:!0,description:"The role to leave"})})},(async(e,{role:t})=>{if("object"!=typeof f.modules.admin.groupRoles||0===Object.keys(f.modules.admin.groupRoles).length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.group_roles_disabled),!1;const n=f.modules.admin.groupRoles[t.id];return"string"!=typeof n||n.length<5?(await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.role_incorrectly_configured),!1):e.member.roles.includes(t.id)?(await e.acknowledge({ephemeral:!1}),await e.member.removeRole(t.id),void await _i(e,{content:B(U.modules.admin.group_left,["role_mention",t.toMention()]),allowedMentions:{}})):(await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.group_doesnt_have_role),!1)}),{module:"admin",parent:"role",permissions:{overrideableInfo:"admin.role.leave",level:w.Guest}})),yi({name:"nickname",description:"Changes another user's nickname",options:e=>({member:e.guildMember({required:!0,description:"The member to target"}),nickname:e.string({required:!1,description:"The new nickname. Keep this blank to clear their nickname"})})},(async(e,{member:t,nickname:n})=>{n?"invisible"===n&&(n=" ឵឵ "):n=null;const i=await na(e.member,t,n);return"string"==typeof i?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,i),!1):!0===i?(await e.acknowledge({ephemeral:!1}),await jo(void 0,e,!0,B(U.modules.admin.set_nickname,["user_mention",t.user.getTag(),"new_nick",null===n?U.modules.admin.adm_backup.none:Qn(n,!0)])),!0):(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.failed_nickname),!1)}),{module:"admin",permissions:{level:w.Moderator,overrideableInfo:"admin.nickname"}}),yi({name:"temprole",description:"Give a role to a member temporarily",options:e=>({member:e.guildMember({required:!0,description:"The member to give the role to"}),role:e.guildRole({required:!0,description:"The role to give"}),duration:e.string({required:!0,description:"The duration for the role to be given for (in 1h30m format)"})})},(async(e,{member:t,role:n,duration:i})=>{const a=Kn(i);if(0===a)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.duration_malformed),!1;if(a<1e3||a>26784e5)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.exceeds_duration),!1;const s=await ea(e.member,t,n,a);return"string"==typeof s?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,s),!1):!0!==s?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_role_add.failed_add),!1):(await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.admin.temprole_added,["role_mention",n.toMention(),"user_mention",t.toMention(),"duration",Vn(a,2,!1,U.time_units.ti_full.singular.second)])))}),{module:"admin",permissions:{level:w.Administrator,overrideableInfo:"admin.temprole"}}),yi({name:"cease",description:"Locks a channel",options:e=>({duration:e.string({required:!1,description:"The duration for the lock. Blank will lock it permanently"}),channel:e.guildChannel({required:!1,description:"The channel to target. Blank will target the channel you run the command on"})})},(async(e,{channel:t,duration:n})=>{t||(t=await e.getChannel());let i=0;if(n){if(i=Kn(n),0===i)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.duration_malformed),!1;if(i<1e3||i>26784e5)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.exceeds_duration),!1}const a=await Zi(e.member,t,!0,i);return"string"==typeof a?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,a),!1):!0!==a?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_lock_channel.locked_fail),!1):(await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,`${U.modules.admin.adm_lock_channel.locked_cmd}${i>0?B(U.modules.admin.for_time,["time",Vn(i,2,!1,U.time_units.ti_full.singular.second)]):""}`))}),{module:"admin",permissions:{level:w.Moderator,overrideableInfo:"admin.cease"}}),yi({name:"uncease",description:"Unlocks a channel",options:e=>({channel:e.guildChannel({required:!1,description:"The channel to target. Blank will target the channel you run the command on"})})},(async(e,{channel:t})=>{t||(t=await e.getChannel());const n=await Zi(e.member,t,!1,0);return"string"==typeof n?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,n),!1):!0!==n?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_lock_channel.unlocked_fail),!1):(await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,U.modules.admin.adm_lock_channel.unlocked_cmd))}),{module:"admin",permissions:{level:w.Moderator,overrideableInfo:"admin.uncease"}}),yi({name:"slowmode",description:"Sets slowmode on a channel",options:e=>({seconds:e.integer({required:!1,description:"The value for the slowmode in seconds. 0 or blank to disable slowmode"}),duration:e.string({required:!1,description:"How long to apply this slowmode for. Blank will apply it permanently"}),channel:e.guildChannel({required:!1,description:"The channel to target. Blank will target the channel you run the command on"})})},(async(e,{channel:t,seconds:n,duration:i})=>{n||(n=0),t||(t=await e.getChannel());let a=0;if(i){if(a=Kn(i),0===a)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.duration_malformed),!1;if(a<1e3||a>26784e5)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.exceeds_duration),!1}const s=await Qi(e.member,t,n,a);if("string"==typeof s)return await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,s),!1;if(!0!==s)return await e.acknowledge({ephemeral:!1}),await jo(void 0,e,!1,U.modules.admin.adm_slowmode.slowmode_failed),!1;{const i=a>0?Vn(a,2,!1,U.time_units.ti_full.singular.second):"";await e.acknowledge({ephemeral:!1}),await jo(void 0,e,!0,`${B(U.modules.admin.adm_slowmode.slowmode_cmd,["channel_mention",t.toMention(),"seconds",n.toString()])}${""!==i?B(U.modules.admin.for_time,["time",i]):""}`)}}),{module:"admin",permissions:{level:w.Moderator,overrideableInfo:"admin.slowmode"}}),yi({name:"lockdown",description:"Locks the server down, preventing members from sending messages",options:e=>({duration:e.string({required:!1,description:"How long to apply this lockdown for. Blank will apply it permanently"})})},(async(e,{duration:t})=>{let n=0;if(t){if(n=Kn(t),0===n)return await e.acknowledge({ephemeral:!0}),void await e.respondEphemeral(U.modules.admin.duration_malformed);if(n<1e3||n>26784e5)return await e.acknowledge({ephemeral:!0}),void await e.respondEphemeral(U.modules.admin.exceeds_duration)}const i=await Xi(e.member,!0,n);if("string"==typeof i)return await e.acknowledge({ephemeral:!0}),void await jo(void 0,e,!1,i);!0===i?(await e.acknowledge({ephemeral:!1}),await jo(void 0,e,!0,`${U.modules.admin.adm_lock_guild.locked_cmd}${n>0?B(U.modules.admin.for_time,["time",Vn(n,2,!1,U.time_units.ti_full.singular.second)]):""}`)):(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_lock_guild.failed_lock))}),{module:"admin",permissions:{level:w.Moderator,overrideableInfo:"admin.lockdown"}}),yi({name:"unlockdown",description:"Removes a active lockdown"},(async e=>{const t=await Xi(e.member,!1,0);if("string"==typeof t)return await e.acknowledge({ephemeral:!0}),void await jo(void 0,e,!1,t);!0===t?(await e.acknowledge({ephemeral:!1}),await jo(void 0,e,!0,U.modules.admin.adm_lock_guild.unlocked_cmd)):(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.admin.adm_lock_guild.failed_unlock))}),{module:"admin",permissions:{level:w.Moderator,overrideableInfo:"admin.unlockdown"}}),yi({name:"roles",description:"Query roles on your server, returning a list of roles",options:e=>({query:e.string({required:!1,description:"The query to search for. If this is not defined, returns a list of all roles"})})},(async(e,{query:t})=>{t||(t=""),t=t.toLowerCase();const n=await e.getGuild();let i=(await n.getRoles()).reverse();if(t.length>0&&(i=i.filter((e=>e.name.toLowerCase().includes(t)||e.id.includes(t)||e.name.toLowerCase()===t))),i=i.filter((e=>e.id!==n.id)),0===i.length)return await e.acknowledge({ephemeral:!0}),void await e.respondEphemeral(U.modules.admin.adm_roles_list.no_roles);await e.acknowledge({ephemeral:!1});const a=[];let s=0;i.forEach((e=>{let t=Array.isArray(a[s])?a[s].reduce(((e,t)=>e+t.length),0):0;Array.isArray(a[s])&&(t+=10+2*a[s].length);const n=[];"object"==typeof f.levels&&"object"==typeof f.levels.roles&&"number"==typeof f.levels.roles[e.id]&&f.levels.roles[e.id]>0&&n.push(`${U.modules.admin.adm_roles_list.level_short} ${f.levels.roles[e.id]}`),!0===e.mentionable&&n.push(U.modules.admin.adm_roles_list.mentionable_short),!0===e.hoist&&n.push(U.modules.admin.adm_roles_list.hoisted_short);const i=n.length>0?n.join(", "):"",o=`[${e.id}]${""!==i?` | <${i}>`:""} | ${Qn(e.name)}`;t+o.length>1950&&(s+=1),Array.isArray(a[s])||(a[s]=[U.modules.admin.adm_roles_list.properties,""]),a[s].push(o)}));for(let t=0;t<a.length;t+=1){const n=a[t];await _i(e,{allowedMentions:{},content:`\`\`\`\n${n.join("\n")}\n\`\`\``})}}),{module:"admin",permissions:{overrideableInfo:"admin.roles",level:w.Moderator}});var Aa=Object.freeze({__proto__:null,adminPool:Gi,Action:Fi,TrackedMessage:Pi,checkRoleAll:Ki,every5Min:Yi,addAction:Wi,saveMessage:zi,getRoleIdByText:qi,canTarget:Ji,SlowmodeChannel:Qi,LockChannel:Zi,LockGuild:Xi,TempRole:ea,Role:ta,Nick:na,Clean:aa,OnMessageCreate:async function(e,t,n){n.member instanceof discord.GuildMember&&Gi.saveToPool(new Pi(n))},OnMessageDelete:async function(e,t,n){Gi.editPool(n.id,null)},OnMessageDeleteBulk:async function(e,t,n){Gi.editPools(n.ids,(e=>null===e||n.ids.includes(e.id)?null:e))},InitRoleLocks:oa,AL_OnGuildRoleUpdate:async function(e,t,n,i,a){if(null!==a&&Array.isArray(f.modules.admin.lockedRoles)&&f.modules.admin.lockedRoles.includes(i.id)&&!(n instanceof discord.AuditLogEntry&&n.userId===discord.getBotId())){if(void 0===i.guildId){const e=JSON.parse(JSON.stringify(i));e.guildId=p,i=ei(e,discord.Role)}if(await oa(),i.name!==a.name||i.permissions!==a.permissions||i.hoist!==a.hoist||i.color!==a.color||i.mentionable!==a.mentionable){const e=await sa.get(i.id);let t=!1;if(e&&e.locked)t=!0;else if(e&&!e.locked&&e.unlocked_until){Date.now()>e.unlocked_until&&(t=!0)}t?await i.edit({permissions:e.role_data.permissions,hoist:e.role_data.hoist,color:e.role_data.color,name:e.role_data.name,mentionable:e.role_data.mentionable}):e&&!t&&await sa.transact(i.id,(e=>{const t=e;return e.role_data.color=i.color,e.role_data.permissions=i.permissions,e.role_data.hoist=i.hoist,e.role_data.name=i.name,e.role_data.mentionable=i.mentionable,t}))}}},OnVoiceStateUpdate:async function(e,t,n,i){ra()&&n.channelId!==i.channelId&&await async function(e,t,n){if(!ra())return;const i=await discord.getGuild();let a=await i.getChannels();const s=a.find((e=>e.id===t)),o=a.find((e=>e.id===n)),r=f.modules.admin.voiceLink;if(r.global&&"string"==typeof r.global&&r.global.length>3){const t=a.find((e=>e.id===r.global));if(t&&(t instanceof discord.GuildTextChannel||t instanceof discord.GuildNewsChannel))if(!s||t.canMember(e,1024)||la(e,t)){if(o&&!s&&la(e,t)){const n=t.permissionOverwrites;n.splice(n.findIndex((t=>t.id===e.user.id)),1),await t.edit({permissionOverwrites:n})}}else await t.edit({permissionOverwrites:[...t.permissionOverwrites,{allow:1024,deny:0,id:e.user.id,type:1}]})}if(a=await i.getChannels(),r.channels&&"object"==typeof r.channels&&!Array.isArray(r.channels)&&Object.keys(r.channels).length>0){let t=!1;if(s&&s.parentId)for(const n in r.channels){const i=r.channels[n];if(s.parentId===n){const n=a.find((e=>e.id===i));n&&(n instanceof discord.GuildTextChannel||n instanceof discord.GuildNewsChannel)&&(n.canMember(e,1024)||la(e,n)||(await n.edit({permissionOverwrites:[...n.permissionOverwrites,{allow:1024,deny:0,id:e.user.id,type:1}]}),t=!0));break}}if(s&&!t)for(const t in r.channels){const n=r.channels[t];if(s.id===t){const t=a.find((e=>e.id===n));t&&(t instanceof discord.GuildTextChannel||t instanceof discord.GuildNewsChannel)&&(t.canMember(e,1024)||la(e,t)||await t.edit({permissionOverwrites:[...t.permissionOverwrites,{allow:1024,deny:0,id:e.user.id,type:1}]}));break}}if(o)for(const t in r.channels){const n=r.channels[t];if(o.parentId===t||o.id===t){const t=a.find((e=>e.id===n));if(t&&(t instanceof discord.GuildTextChannel||t instanceof discord.GuildNewsChannel)&&la(e,t)){const n=t.permissionOverwrites;n.splice(n.findIndex((t=>t.id===e.user.id)),1),await t.edit({permissionOverwrites:n})}}}}}(n.member,n.channelId,i.channelId)},getStoredUserOverwrites:da,storeChannelData:fa,OnChannelCreate:async function(e,t,n){f.modules.admin.persist&&"object"==typeof f.modules.admin.persist&&!0===f.modules.admin.persist.enabled&&ga()},OnChannelDelete:async function(e,t,n){f.modules.admin.persist&&"object"==typeof f.modules.admin.persist&&!0===f.modules.admin.persist.enabled&&ga()},OnChannelUpdate:async function(e,t,n,i){if(!f.modules.admin.persist||"object"!=typeof f.modules.admin.persist||!0!==f.modules.admin.persist.enabled)return;let a=n.permissionOverwrites.every((e=>{const t=i.permissionOverwrites.find((t=>t.id===e.id));return!!t&&(t.allow===e.allow&&t.deny===e.deny)}));a?(a=i.permissionOverwrites.every((e=>{const t=n.permissionOverwrites.find((t=>t.id===e.id));return!!t&&(t.allow===e.allow&&t.deny===e.deny)})),a||ga()):ga()},OnGuildBanAdd:async function(e,t,n){if(f.modules.admin.persist&&"object"==typeof f.modules.admin.persist&&!0===f.modules.admin.persist.enabled)try{!0!==f.modules.admin.persist.saveOnBan&&ki.editPool(n.user.id,void 0)}catch(e){}},AL_OnGuildMemberRemove:async function(e,t,n,i,a){hn(i.user)||f.modules.admin.persist&&"object"==typeof f.modules.admin.persist&&!0===f.modules.admin.persist.enabled&&(!0!==f.modules.admin.persist.saveOnBan&&n instanceof discord.AuditLogEntry&&22===n.actionType||pa(a))},OnGuildMemberAdd:async function(e,t,n){if(!hn(n)&&(f.modules.admin.persist&&"object"==typeof f.modules.admin.persist&&!0===f.modules.admin.persist.enabled&&await ha(n),f.modules.admin.autoroles&&"object"==typeof f.modules.admin.autoroles&&!0===f.modules.admin.autoroles.enabled)){const e=await n.getGuild(),t=await e.getMember(n.user.id);if(null!==t)if(Array.isArray(f.modules.admin.autoroles.human)&&!1===n.user.bot){const e=[...new Set(t.roles.concat(f.modules.admin.autoroles.human))];e.length!==t.roles.length&&await t.edit({roles:e})}else if(Array.isArray(f.modules.admin.autoroles.bot)&&!0===n.user.bot){const e=[...new Set(t.roles.concat(f.modules.admin.autoroles.bot))];e.length!==t.roles.length&&await t.edit({roles:e})}}},handleReactRoles:ya,OnGuildMemberUpdate:async function(e,t,n,i){Ki()},OnMessageReactionAdd:async function(e,t,n){await ya(e,n,!0)},OnMessageReactionRemove:async function(e,t,n){await ya(e,n,!1)},cleanCommands:Ea,InitializeCommands:function(){const e=Oo({description:"Admin Commands"}),t=new discord.command.CommandGroup(e);return vi(t,"clean",Ea),vi(t,"clear",Ea),vi(t,"invites",(e=>{Ai(e,"prune",(e=>({uses:e.integerOptional({minValue:0})})),(async(e,{uses:t})=>{null===t&&(t=0);const n=await e.getGuild(),i=await n.getInvites();let a=0;await Promise.all(i.map((async e=>{e.uses<=t&&(await e.delete(),a+=1)}))),0===a?await Po(void 0,e,!1,U.modules.admin.adm_inv_prune.no_invites):await Po(void 0,e,!0,B(U.modules.admin.adm_inv_prune.pruned,["count",a.toString()]))}),{permissions:{overrideableInfo:"admin.invites.prune",level:w.Administrator}})})),vi(t,"role",(e=>{Ai(e,"unlock",(e=>({roleText:e.text()})),(async(e,{roleText:t})=>{if(!Array.isArray(f.modules.admin.lockedRoles)||0===f.modules.admin.lockedRoles.length)return await Po(void 0,e,!1,U.modules.admin.no_locked_roles),!1;const n=await qi(t),i=await(await e.getGuild()).getRole(n);if(null===i)return await Po(void 0,e,!1,U.modules.admin.could_not_find_role),!1;if(!f.modules.admin.lockedRoles.includes(i.id))return await Po(void 0,e,!1,U.modules.admin.adm_role_unlock.not_locked),!1;const{result:a}=await sa.transactWithResult(i.id,(e=>{if(e&&!1===e.locked)return{result:!1,next:e};const t=e;return t.locked=!1,t.unlocked_until=Date.now()+3e5,{result:!0,next:t}}));if(!a)return await Po(void 0,e,!1,U.modules.admin.adm_role_unlock.already_unlocked),!1;await Po(void 0,e,!0,U.modules.admin.adm_role_unlock.unlocked)}),{permissions:{overrideableInfo:"admin.role.unlock",level:w.Administrator}}),Ai(e,{name:"add",aliases:["give","grant"]},(e=>({member:e.guildMember(),roleText:e.text()})),(async(e,{member:t,roleText:n})=>{const i=await ta(e.member,t,n,!0);if("string"==typeof i)return await Po(void 0,e,!1,i),!1;if(!0!==i)return await Po(void 0,e,!1,U.modules.admin.adm_role_add.failed_add),!1;{const i=await qi(n);await Po(void 0,e,!0,B(U.modules.admin.adm_role_add.added_role,["role_mention",`<@&${i}>`,"user_mention",t.user.toMention()]))}}),{permissions:{overrideableInfo:"admin.role.add",level:w.Administrator}}),Ai(e,{name:"remove",aliases:["rm","take"]},(e=>({member:e.guildMember(),roleText:e.text()})),(async(e,{member:t,roleText:n})=>{const i=await ta(e.member,t,n,!1);if("string"==typeof i)return await Po(void 0,e,!1,i),!1;if(!0!==i)return await Po(void 0,e,!1,U.modules.admin.adm_role_remove.failed_remove),!1;{const i=await qi(n);await Po(void 0,e,!0,B(U.modules.admin.adm_role_remove.removed_role,["role_mention",`<@&${i}>`,"user_mention",t.user.toMention()]))}}),{permissions:{overrideableInfo:"admin.role.remove",level:w.Administrator}}),Ai(e,{name:"all",aliases:["spray"]},(e=>({role:e.text()})),(async(e,{role:t})=>{const n=await qi(t);if(null===n){return zi(await e.inlineReply(U.modules.admin.role_inexistent)),!1}const i=await e.getGuild(),a=await i.getRoles(),s=await i.getMember(discord.getBotId());if(null===s)return!1;const o=a.find((e=>e.id===n));if(!o){return zi(await e.inlineReply(U.modules.admin.role_inexistent)),!1}if((await Z(s)).position<=o.position||!s.can(268435456)){return zi(await e.inlineReply(U.modules.admin.bot_cant_manage_role)),!1}const r=await ji.items(),l=await xi.items();if(r.length>0||l.length>0){return zi(await e.inlineReply(U.modules.admin.role_spread_in_progress)),!1}await ji.put(z(),o.id),Ki();zi(await e.inlineReply({content:B(U.modules.admin.adm_role_all,["role_mention",o.toMention()]),allowedMentions:{}}))}),{permissions:{overrideableInfo:"admin.role.all",level:w.Administrator}}),Ai(e,{name:"nuke",aliases:["removeall"]},(e=>({role:e.text()})),(async(e,{role:t})=>{const n=await qi(t);if(null===n){return zi(await e.inlineReply(U.modules.admin.role_inexistent)),!1}const i=await e.getGuild(),a=await i.getRoles(),s=await i.getMember(discord.getBotId());if(null===s)return!1;const o=a.find((e=>e.id===n));if(!o){return zi(await e.inlineReply(U.modules.admin.role_inexistent)),!1}if((await Z(s)).position<=o.position||!s.can(268435456)){return zi(await e.inlineReply(U.modules.admin.bot_cant_manage_role)),!1}const r=await ji.items(),l=await xi.items();if(r.length>0||l.length>0){return zi(await e.inlineReply(U.modules.admin.role_spread_in_progress)),!1}await xi.put(z(),o.id),Ki();zi(await e.inlineReply({content:B(U.modules.admin.adm_nuke_all,["role_mention",o.toMention()]),allowedMentions:{}}))}),{permissions:{overrideableInfo:"admin.role.nuke",level:w.Administrator}}),Ai(e,"join",(e=>({roleName:e.text()})),(async(e,{roleName:t})=>{zi(await e.inlineReply((async()=>{if("object"!=typeof f.modules.admin.groupRoles||0===Object.keys(f.modules.admin.groupRoles).length)return{content:U.modules.admin.group_roles_disabled};const n=Bn(f.modules.admin.groupRoles)[t.toLowerCase()];if(!n)return{content:U.modules.admin.role_inexistent};if("string"!=typeof n||n.length<5)return{content:U.modules.admin.role_incorrectly_configured};const i=await(await e.getGuild()).getRole(n);if(null===i)return{content:U.modules.admin.role_inexistent};if(e.member.roles.includes(i.id))return{content:U.modules.admin.group_already_has_role};let a=new ee(i.permissions).serialize(!0);for(const e in a)!1===a[e]&&delete a[e];a=Object.keys(a);const s=["ADMINISTRATOR","KICK_MEMBERS","BAN_MEMBERS","MANAGE_CHANNELS","MANAGE_GUILD","MANAGE_MESSAGES","MENTION_EVERYONE","MUTE_MEMBERS","DEAFEN_MEMBERS","MANAGE_NICKNAMES","MANAGE_ROLES","MANAGE_EMOJIS_AND_STICKERS","MANAGE_WEBHOOKS","MOVE_MEMBERS","MANAGE_THREADS"];return a.every((e=>!s.includes(e)))?(await e.member.addRole(i.id),{allowedMentions:{},content:B(U.modules.admin.group_joined,["role_mention",i.toMention()])}):{content:U.modules.admin.group_has_staff_perms}})))}),{permissions:{overrideableInfo:"admin.role.join",level:w.Guest}}),Ai(e,"leave",(e=>({roleName:e.text()})),(async(e,{roleName:t})=>{zi(await e.inlineReply((async()=>{if("object"!=typeof f.modules.admin.groupRoles||0===Object.keys(f.modules.admin.groupRoles).length)return{content:U.modules.admin.group_roles_disabled};const n=Bn(f.modules.admin.groupRoles)[t.toLowerCase()];if(!n)return{content:U.modules.admin.role_inexistent};if("string"!=typeof n||n.length<5)return{content:U.modules.admin.role_incorrectly_configured};const i=await(await e.getGuild()).getRole(n);return null===i?{content:U.modules.admin.role_inexistent}:e.member.roles.includes(i.id)?(await e.member.removeRole(i.id),{allowedMentions:{},content:B(U.modules.admin.group_left,["role_mention",i.toMention()])}):{content:U.modules.admin.group_doesnt_have_role}})))}),{permissions:{overrideableInfo:"admin.role.leave",level:w.Guest}})})),Ai(t,{name:"nickname",aliases:["nick"]},(e=>({member:e.guildMember(),nickname:e.textOptional()})),(async(e,{member:t,nickname:n})=>{n?"invisible"===n&&(n=" ឵឵ "):n=null;const i=await na(e.member,t,n);if("string"==typeof i)return await Po(void 0,e,!1,i),!1;!0===i?await Po(void 0,e,!0,B(U.modules.admin.set_nickname,["user_mention",t.user.getTag(),"new_nick",null===n?U.modules.admin.adm_backup.none:Qn(n,!0)])):await Po(void 0,e,!1,U.modules.admin.failed_nickname)}),{permissions:{overrideableInfo:"admin.nickname",level:w.Moderator}}),Ai(t,"temprole",(e=>({member:e.guildMember(),duration:e.string(),roleText:e.text()})),(async(e,{member:t,duration:n,roleText:i})=>{const a=Kn(n);if(0===a){return zi(await e.inlineReply(U.modules.admin.duration_malformed)),!1}if(a<1e3||a>26784e5){return zi(await e.inlineReply(U.modules.admin.exceeds_duration)),!1}const s=await ea(e.member,t,i,a);if("string"==typeof s)return await Po(void 0,e,!1,s),!1;if(!0!==s)return await Po(void 0,e,!1,U.modules.admin.adm_role_add.failed_add),!1;{const n=await qi(i);await Po(void 0,e,!0,B(U.modules.admin.temprole_added,["role_mention",`<@&${n}>`,"user_mention",t.toMention(),"duration",Vn(a,2,!1,U.time_units.ti_full.singular.second)]))}}),{permissions:{overrideableInfo:"admin.temprole",level:w.Administrator}}),Ai(t,"cease",(e=>({duration:e.stringOptional(),channel:e.guildChannelOptional()})),(async(e,{channel:t,duration:n})=>{t||(t=await e.getChannel());let i=0;if(null!==n){if(i=Kn(n),0===i){return zi(await e.inlineReply(U.modules.admin.duration_malformed)),!1}if(i<1e3||i>26784e5){return zi(await e.inlineReply(U.modules.admin.exceeds_duration)),!1}}const a=await Zi(e.member,t,!0,i);return"string"==typeof a?(await Po(void 0,e,!1,a),!1):!0!==a?(await Po(void 0,e,!1,U.modules.admin.adm_lock_channel.locked_fail),!1):void await Po(void 0,e,!0,`${U.modules.admin.adm_lock_channel.locked_cmd}${i>0?B(U.modules.admin.for_time,["time",Vn(i,2,!1,U.time_units.ti_full.singular.second)]):""}`)}),{permissions:{overrideableInfo:"admin.cease",level:w.Moderator}}),Ai(t,"uncease",(e=>({channel:e.guildChannelOptional()})),(async(e,{channel:t})=>{null===t&&(t=await e.getChannel());const n=await Zi(e.member,t,!1,0);return"string"==typeof n?(await Po(void 0,e,!1,n),!1):!0!==n?(await Po(void 0,e,!1,U.modules.admin.adm_lock_channel.unlocked_fail),!1):void await Po(void 0,e,!0,U.modules.admin.adm_lock_channel.unlocked_cmd)}),{permissions:{overrideableInfo:"admin.uncease",level:w.Moderator}}),Ai(t,"slowmode",(e=>({seconds:e.integerOptional({default:0,minValue:0,maxValue:21600}),duration:e.stringOptional(),channel:e.guildChannelOptional()})),(async(e,{seconds:t,duration:n,channel:i})=>{let a=0;if(null!==n){if(a=Kn(n),0===a){return zi(await e.inlineReply(U.modules.admin.duration_malformed)),!1}if(a<1e3||a>26784e5){return zi(await e.inlineReply(U.modules.admin.exceeds_duration)),!1}}null===i&&(i=await e.getChannel());const s=await Qi(e.member,i,t,a);if("string"==typeof s)return await Po(void 0,e,!1,s),!1;if(!0!==s)return await Po(void 0,e,!1,U.modules.admin.adm_slowmode.slowmode_failed),!1;{const n=a>0?Vn(a,2,!1,U.time_units.ti_full.singular.second):"";await Po(void 0,e,!0,`${B(U.modules.admin.adm_slowmode.slowmode_cmd,["channel_mention",i.toMention(),"seconds",t.toString()])}${""!==n?B(U.modules.admin.for_time,["time",n]):""}`)}}),{permissions:{overrideableInfo:"admin.slowmode",level:w.Moderator}}),Ai(t,"lockdown",(e=>({duration:e.stringOptional()})),(async(e,{duration:t})=>{let n=0;if(null!==t){if(n=Kn(t),0===n){return zi(await e.inlineReply(U.modules.admin.duration_malformed)),!1}if(n<1e3||n>26784e5){return zi(await e.inlineReply(U.modules.admin.exceeds_duration)),!1}}const i=await Xi(e.member,!0,n);return"string"==typeof i?(await Po(void 0,e,!1,i),!1):!0!==i?(await Po(void 0,e,!1,U.modules.admin.adm_lock_guild.failed_lock),!1):void await Po(void 0,e,!0,`${U.modules.admin.adm_lock_guild.locked_cmd}${n>0?B(U.modules.admin.for_time,["time",Vn(n,2,!1,U.time_units.ti_full.singular.second)]):""}`)}),{permissions:{overrideableInfo:"admin.lockdown",level:w.Moderator}}),Ii(t,"unlockdown",(async e=>{const t=await Xi(e.member,!1,0);return"string"==typeof t?(await Po(void 0,e,!1,t),!1):!0!==t?(await Po(void 0,e,!1,U.modules.admin.adm_lock_guild.failed_unlock),!1):void await Po(void 0,e,!0,U.modules.admin.adm_lock_guild.unlocked_cmd)}),{permissions:{overrideableInfo:"admin.unlockdown",level:w.Moderator}}),Ai(t,"roles",(e=>({query:e.textOptional()})),(async(e,{query:t})=>{null===t&&(t=""),t=t.toLowerCase();const n=await e.getGuild();let i=(await n.getRoles()).reverse();if(t.length>0&&(i=i.filter((e=>e.name.toLowerCase().includes(t)||e.id.includes(t)||e.name.toLowerCase()===t))),i=i.filter((e=>e.id!==n.id)),0===i.length){return zi(await e.inlineReply({content:U.modules.admin.adm_roles_list.no_roles})),!1}const a=[];let s=0;i.forEach((e=>{let t=Array.isArray(a[s])?a[s].reduce(((e,t)=>e+t.length),0):0;Array.isArray(a[s])&&(t+=10+2*a[s].length);const n=[];"object"==typeof f.levels&&"object"==typeof f.levels.roles&&"number"==typeof f.levels.roles[e.id]&&f.levels.roles[e.id]>0&&n.push(`${U.modules.admin.adm_roles_list.level_short} ${f.levels.roles[e.id]}`),!0===e.mentionable&&n.push(U.modules.admin.adm_roles_list.mentionable_short),!0===e.hoist&&n.push(U.modules.admin.adm_roles_list.hoisted_short);const i=n.length>0?n.join(", "):"",o=`[${e.id}]${""!==i?` | <${i}>`:""} | ${Qn(e.name)}`;t+o.length>1950&&(s+=1),Array.isArray(a[s])||(a[s]=[U.modules.admin.adm_roles_list.properties,""]),a[s].push(o)}));for(let t=0;t<a.length;t+=1){const n=a[t];zi(await e.inlineReply({allowedMentions:{},content:`\`\`\`\n${n.join("\n")}\n\`\`\``}))}}),{permissions:{overrideableInfo:"admin.roles",level:w.Moderator}}),Ai(t,"actions",(e=>({id:e.stringOptional()})),(async(e,{id:t})=>{zi(await e.inlineReply((async()=>{if(null===t){const e=await Ui.getByQuery({active:!0});if(0===e.length)return{content:U.modules.admin.adm_actions.no_active};const t=e.slice(0,Math.max(e.length,10));let n=B(U.modules.admin.adm_actions.title,["count",Math.min(t.length,10).toString()]);t.map((e=>{n+=`\n**[**||\`${e.id}\`||**]** - ${null===e.actorId||"SYSTEM"===e.actorId||e.actorId===discord.getBotId()?U.ranks.system:`<@!${e.actorId}>`} **>** ${e.targetId} - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const i=e.length-t.length;i>0&&(n+=B(U.modules.admin.adm_actions.more_actions,["remaining",i.toString()]));const a=new discord.Embed;return a.setDescription(n),a.setTimestamp((new Date).toISOString()),{embed:a,allowedMentions:{},content:""}}})))}),{permissions:{overrideableInfo:"admin.actions",level:w.Moderator}}),!0===f.modules.admin.persist.enabled&&vi(t,"backup",(e=>{Ai(e,"restore",(e=>({member:e.guildMember()})),(async(e,{member:t})=>{zi(await e.inlineReply((async()=>!0===await ha(t)?{allowedMentions:{},content:B(U.modules.admin.adm_backup.restored,["user_mention",t.toMention()])}:{allowedMentions:{},content:B(U.modules.admin.adm_backup.failed_restore,["user_mention",t.toMention()])})))}),{permissions:{overrideableInfo:"admin.backup.restore",level:w.Moderator}}),Ai(e,"save",(e=>({member:e.guildMember()})),(async(e,{member:t})=>{zi(await e.inlineReply((async()=>!0===await pa(t)?{allowedMentions:{},content:B(U.modules.admin.adm_backup.saved,["user_mention",t.toMention()])}:{allowedMentions:{},content:B(U.modules.admin.adm_backup.failed_save,["user_mention",t.toMention()])})))}),{permissions:{overrideableInfo:"admin.backup.save",level:w.Administrator}}),Ai(e,"show",(e=>({user:e.string({name:"user",description:"UserResolvable"})})),(async(e,{user:t})=>{zi(await e.inlineReply((async()=>{const n=await Ti(e,"user","string",Mi.UserResolvable,t),i=await ki.getById(n.id);if(!i)return{content:U.modules.admin.adm_backup.no_data};let a=U.modules.admin.adm_backup.none;if(i.roles.length>0){a=i.roles.map((e=>`<@&${e}>`)).join(", ")}return{content:B(U.modules.admin.adm_backup.data_display,["user_mention",n.toMention(),"roles",0===i.roles.length?U.modules.admin.adm_backup.none:a,"nickname",null===i.nick||"string"!=typeof i.nick?U.modules.admin.adm_backup.none:`\`${Qn(i.nick)}\``,"channel_overwrite_count",Array.isArray(i.channels)?i.channels.length.toString():"0"]),allowedMentions:{}}})))}),{permissions:{overrideableInfo:"admin.backup.show",level:w.Moderator}}),Ai(e,"delete",(e=>({user:e.string({name:"user",description:"UserResolvable"})})),(async(e,{user:t})=>{const n=await Ti(e,"user","string",Mi.UserResolvable,t);zi(await e.inlineReply((async()=>await ki.getById(n.id)?(await ki.editPool(n.id,void 0),B(U.modules.admin.adm_backup.deleted,["user_mention",n.toMention()])):U.modules.admin.adm_backup.no_data)))}),{permissions:{overrideableInfo:"admin.backup.delete",level:w.Administrator}})})),t}});const Ia=336,va=[],Ca=["png","jpg","jpeg"],Sa=new pylon.KVNamespace("starboard"),Ma=new li({name:"starboardMessages",idProperty:"id",local:!1}),Ta=new li({name:"starboardStats",idProperty:"id",local:!1});class Oa{constructor(e){return this.given=0,this.received=0,this.posts=0,this.id=e,this}async update(){await Ta.editPool(this.id,{id:this.id,given:this.received,received:this.received,posts:this.posts})}}class Ra{constructor(e,t,n){return this.channelId=e,this.messageId=t,this.lastUpdate=n,this}}class Na{constructor(e,t,n,i,a,s){return this.reactors=[],this.id=n,this.author=e,this.channelId=t,this.reactors=a,this.publishData=new Ra,this.emojiMention=s,!1!==i&&(this.publishData.channelId=i),this}getReactorCount(){return this.reactors.length}async updateStorage(){await Ma.saveToPool(this)}async publish(){if(!this.publishData.channelId)return;const e=Ua(this.publishData.channelId),t=await discord.getChannel(this.publishData.channelId),n=await discord.getChannel(this.channelId);if(!(null===t||null===n||0!==t.type&&5!==t.type||0!==n.type&&5!==n.type))try{const i=await n.getMessage(this.id);if(!i)return;const a=new discord.Embed;a.setAuthor({iconUrl:i.author.getAvatarUrl(),name:i.author.getTag()}),a.setTimestamp((new Date).toISOString()),a.setFooter({text:`${U.modules.starboard.s_terms.user}: ${i.author.id} | ${U.modules.starboard.s_terms.message}: ${i.id}`});const s=[],o=[];if(i.attachments.length>0&&i.attachments.forEach((e=>{if(e.filename.includes(".")){const t=e.filename.split("."),n=t[t.length-1];Ca.includes(n)&&0===s.length?s.push(e.url):o.push(e.url)}})),"number"==typeof e.maxReacts&&a.setColor(La(e.maxReacts,this.getReactorCount())),1===s.length&&a.setImage({url:s[0]}),a.setFields([{inline:!0,name:"​​​",value:`→ [${U.modules.starboard.s_terms.jump_msg}](https://discord.com/channels/${p}/${i.channelId}/${i.id})`}]),i.content.length>0){let e=i.content;e.length>1605&&(e=`${e.substr(0,1600)} ...`),o.length>0&&(e=`${e}\n${o.join("\n")}`),a.setDescription(e)}const r=await t.sendMessage({embed:a,allowedMentions:{},content:`${this.emojiMention} ${this.getReactorCount()} - <#${i.channelId}>`});zi(r),this.publishData.messageId=r.id,this.publishData.lastUpdate=Date.now(),await this.updateStorage()}catch(e){}}async unpublish(){if(!this.publishData.channelId)return;const e=await discord.getChannel(this.publishData.channelId);if(e&&(0===e.type||5===e.type)){try{const t=await e.getMessage(this.publishData.messageId);t&&await t.delete()}catch(e){}delete this.publishData.messageId,delete this.publishData.lastUpdate,await this.updateStorage()}}async awardStats(){const e=await Ta.getAll(),t=this.reactors.filter((e=>e!==this.author)).length;if(0===t)return;let n=e.find((e=>e.id===this.author));n?(n=ei(n,Oa),n.received+=t,n.posts+=1,await n.update()):(n=new Oa(this.author),n.received+=t,n.posts+=1,await Ta.saveToPool(n));const i=this.reactors.filter((t=>void 0===e.find((e=>e.id===t))&&t!==this.author));async function a(e){if(i.length>0&&await Promise.all(i.map((async e=>{const t=new Oa(e);t.given=1,await Ta.saveToPool(t)}))),i.length!==e.reactors.length){const t=e.reactors.filter((t=>!i.includes(t)&&t!==e.author));t.length>0&&await Ta.editPools(t,(e=>(e.given+=1,e)))}}this.reactors.length>10?await pylon.requestCpuBurst((async()=>{await a(this)})):await a(this)}async needsUpdate(){const e=await discord.getChannel(this.publishData.channelId);if(!e||0!==e.type&&5!==e.type)return;const t=await e.getMessage(this.publishData.messageId);if(!t)return!1;const n=t.content.split("-")[0].split(" ").join("").slice(-1);if(Yn(n)&&Fn(n,!0)){return+n!==this.getReactorCount()}return!1}async update(e=!1){const t=Ua(this.publishData.channelId);try{const n=await discord.getChannel(this.publishData.channelId);if(!n||0!==n.type&&5!==n.type)return;const i=await n.getMessage(this.publishData.messageId);if(!i)return;const a=i.embeds[0];"number"==typeof t.maxReacts&&a.setColor(La(t.maxReacts,this.getReactorCount())),!0===e&&a.footer&&!a.footer.text.toLowerCase().includes(U.modules.starboard.s_terms.message_deleted.toLowerCase())&&a.setFooter({text:`${U.modules.starboard.s_terms.message_deleted} | ${a.footer.text}`});const s="string"==typeof t.maxEmoji&&"number"==typeof t.maxReacts&&this.getReactorCount()>=t.maxReacts?t.maxEmoji:this.emojiMention;"number"==typeof t.minReactsPin&&(!0===i.pinned&&this.getReactorCount()<t.minReactsPin?await i.setPinned(!1):!1===i.pinned&&this.getReactorCount()>=t.minReactsPin&&await i.setPinned(!0)),await i.edit({embed:a,content:`${s} ${this.getReactorCount()} - <#${this.channelId}>`}),this.publishData.lastUpdate=Date.now(),await this.updateStorage()}catch(e){}}async deleted(e=!1){if(await this.finalize(),this.publishData.messageId){const t=Ua(this.publishData.channelId);"boolean"==typeof t.clearOnDelete&&!0===t.clearOnDelete||!0===e&&"boolean"==typeof t.clearOnModDelete&&!0===t.clearOnModDelete?await this.unpublish():await this.update(!0)}}async finalize(){!0!==Ua(this.publishData.channelId).noStats&&await this.awardStats()}async check(){const e=Ua(this.publishData.channelId);if(this.getReactorCount()>=e.minReacts){if(!this.publishData.messageId)return await this.publish(),!0}else if(this.publishData.messageId)return await this.unpublish(),!0;if(this.publishData.messageId&&this.publishData.lastUpdate){const e=Date.now()-this.publishData.lastUpdate;if(e>=1500){if(!0===await this.needsUpdate()){return await this.update()}}else await sleep(100+Math.min(200,2e3-e)),await async function(e){const t=await Ma.getById(e);t&&t instanceof Na&&await t.check()}(this.id)}return!1}}function La(e,t){const n=Math.min(t/e,1);return(255<<16)+(Math.floor(194*n+253*(1-n))<<8)+Math.floor(12*n+247*(1-n))}function ka(e,t){if("object"==typeof f.modules.starboard.channels)for(const n in f.modules.starboard.channels){const i=f.modules.starboard.channels[n];if(void 0!==t)if(Yn(i.emoji)){if("string"==typeof t.id&&i.emoji!==t.id)continue}else if("string"==typeof t.name&&i.emoji!==t.name)continue;if(!Array.isArray(i.excludes)||!i.excludes.includes(e)){if(!Array.isArray(i.includes)||0===i.includes.length)return n;if(i.includes.includes(e))return n}}return!1}async function Ga(){if(!0===await Sa.get("lock"))return;const e=await Ma.getAll();await Promise.all(e.map((async e=>{const t=Ua(e.publishData.channelId),n="number"==typeof t.messageLifetime?Math.min(Ia,Math.max(1,t.messageLifetime)):Ia;if("object"==typeof t){const t=q(e.id).timestamp,i=Date.now()-t;if(i>36e5){Math.floor(i/36e5)>=n&&(await Ma.delete(e.id),await e.finalize())}}})))}async function $a(){await Ma.clear()}function Ua(e){return"object"==typeof f.modules.starboard.channels&&"object"==typeof f.modules.starboard.channels[e]&&f.modules.starboard.channels[e]}async function Ba(e){const t=await Sa.get("blocks");return!!Array.isArray(t)&&t.includes(e)}const Fa=Ei({name:"stars",description:"Starboard commands"},{module:"starboard"});Fa&&(Di(Fa,{name:"stats",description:"Get starboard statistics for a user",options:e=>({user:e.guildMember({required:!1,description:"The user to get data on"})})},(async(e,{user:t})=>{const n=new discord.Embed;if(t){t=t.user;const i=await Ta.getById(t.id);if(void 0===i)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(B(U.modules.starboard.stars_stats.no_stats,["user_mention",t.toMention()])),!1;n.setAuthor({name:t.getTag(),iconUrl:t.getAvatarUrl()}),n.setColor(14805812),n.setDescription(`⭐ **${U.modules.starboard.s_terms.received}** - **${i.received}**\n⭐ **${U.modules.starboard.s_terms.given}** - **${i.given}**\n⭐ **${U.modules.starboard.s_terms.starred_posts}** - **${i.posts}**`)}else{let t=await Ta.getAll();t=t.sort(((e,t)=>t.received-e.received));const i=t.slice(0,Math.min(t.length,10)),a=[],s=[];await Promise.all(i.map((async e=>{const t=await H(e.id);null!==t&&s.push(t)})));for(let t=0;t<i.length;t++){const n=i[t],o=n.id===e.member.user.id;let r="",l=n.id;const u=s.find((e=>e.id===n.id));u&&(l=Qn(u.getTag())),!0===o&&(l=`**${l}**`),r=0===t?"🥇":1===t?"🥈":2===t?"🥉":`\` ${t.toString()} \``,a.push(`${r} ${l} - ${n.received} ${U.modules.starboard.s_terms.stars.toLowerCase()}`)}if(!i.find((t=>t.id===e.member.user.id))){const n=t.findIndex((t=>t.id===e.member.user.id));n>-1&&a.push("...",`\`${n+1}\` - ${Qn(e.member.user.getTag())}`)}const o=t.reduce(((e,t)=>e+t.received),0);n.setDescription(`🏆 **${U.modules.starboard.s_terms.leaderboard}**\n\n⭐ **${o}**\n👱 **${t.length}**\n\n📈 **${U.modules.starboard.s_terms.ranks}**\n${a.join("\n")}`)}await e.acknowledge({ephemeral:!1}),await _i(e,{content:"",allowedMentions:{},embed:n})}),{parent:"stars",module:"starboard",permissions:{overrideableInfo:"starboard.stars.stats",level:w.Authorized}}),Di(Fa,{name:"block",description:"Blocks a user from starboard",options:e=>({user:e.guildMember({required:!0,description:"The user to block"})})},(async(e,{user:t})=>{t=t.user;if(!0===await Ba(t.id))return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(B(U.modules.starboard.stars_block.already_blocked,["user_mention",t.toMention()])),!1;let n=await Sa.get("blocks");Array.isArray(n)||(n=[]),await e.acknowledge({ephemeral:!1}),n.push(t.id),await Sa.put("blocks",n),await _i(e,B(U.modules.starboard.stars_block.blocked,["user_mention",t.toMention()]))}),{parent:"stars",module:"starboard",permissions:{overrideableInfo:"starboard.stars.block",level:w.Moderator}}),Di(Fa,{name:"unblock",description:"Unblocks a user from starboard",options:e=>({user:e.guildMember({required:!0,description:"The user to unblock"})})},(async(e,{user:t})=>{t=t.user;if(!1===await Ba(t.id))return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(B(U.modules.starboard.stars_unblock.not_blocked,["user_mention",t.toMention()])),!1;let n=await Sa.get("blocks");Array.isArray(n)||(n=[]),await e.acknowledge({ephemeral:!1}),n.splice(n.indexOf(t.id),1),await Sa.put("blocks",n),await _i(e,B(U.modules.starboard.stars_unblock.unblocked,["user_mention",t.toMention()]))}),{parent:"stars",module:"starboard",permissions:{overrideableInfo:"starboard.stars.unblock",level:w.Moderator}}),Di(Fa,{name:"lock",description:"Locks the starboard"},(async e=>{if(!0===await Sa.get("lock"))return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.starboard.stars_lock.already_locked),!1;await Sa.put("lock",!0),await _i(e,U.modules.starboard.stars_lock.locked)}),{parent:"stars",module:"starboard",permissions:{overrideableInfo:"starboard.stars.lock",level:w.Administrator}}),Di(Fa,{name:"unlock",description:"Unlocks the starboard"},(async e=>{const t=await Sa.get("lock");if(void 0===t||"boolean"==typeof t&&!1===t)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.starboard.stars_unlock.not_locked),!1;await Sa.put("lock",!1),await _i(e,U.modules.starboard.stars_unlock.unlocked)}),{parent:"stars",module:"starboard",permissions:{overrideableInfo:"starboard.stars.unlock",level:w.Administrator}}));var Pa=Object.freeze({__proto__:null,messagesKv:Ma,statsKv:Ta,StarStats:Oa,PublishData:Ra,StarredMessage:Na,periodicClear:Ga,clearData:$a,isBlocked:Ba,AL_OnMessageDelete:async function(e,t,n,i){if(!0===await Sa.get("lock"))return;let a=await Ma.getById(i.id);a&&(await Ma.delete(a.id),a=ei(a,Na),await a.deleted(n instanceof discord.AuditLogEntry))},AL_OnMessageDeleteBulk:async function(e,t,n,i){if(!0===await Sa.get("lock"))return;let a=await Ma.getAll();a=a.filter((e=>i.ids.includes(e.id))),a.length>0&&(await Ma.editPools(a.map((e=>e.id)),(()=>null)),await Promise.all(a.map((async e=>{e=ei(e,Na),await e.deleted(n instanceof discord.AuditLogEntry)}))))},OnMessageReactionAdd:async function(e,t,n){if(!(n.member instanceof discord.GuildMember))return;const{emoji:i}=n;let a=!1,s=n.messageId;Object.keys(f.modules.starboard.channels).includes(n.channelId)&&(a=!0);let o,r=!1;if(a||(r=ka(n.channelId,i)),!a&&!1===r)return;if(a||"string"!=typeof r||(o=Ua(r)),!a&&!1===o)return;if(!0===await Sa.get("lock"))return;let l=n.channelId;const u=await discord.getChannel(n.channelId);if(null===u||0!==u.type&&5!==u.type)return;const d=await u.getMessage(s);if(!d)return;let c;if(a){if(r=n.channelId,o=f.modules.starboard.channels[n.channelId],1===d.embeds.length&&"object"==typeof d.embeds[0].footer&&null!==d.embeds[0].footer&&"string"==typeof d.embeds[0].footer.text&&d.embeds[0].footer.text.length>0){const e=d.embeds[0].footer.text;if(!e.toLowerCase().includes(U.modules.starboard.s_terms.message_deleted.toLowerCase())&&e.toLowerCase().includes(`${U.modules.starboard.s_terms.user.toLowerCase()}:`)&&e.toLowerCase().includes(`${U.modules.starboard.s_terms.message.toLowerCase()}:`)){const t=e.toLowerCase().split(" ").join("").split("|")[1].split(`${U.modules.starboard.s_terms.message.toLowerCase()}:`)[1];s=t;const n=d.content.split("-")[1].split(" ").join("").substring(2).split(">").join("");l=n;const i=await discord.getChannel(n);if(null===i||0!==i.type&&5!==i.type)return;try{c=await i.getMessage(t)}catch(e){return}if(null===c)return}}}else c=d;if(void 0===c)return;if(0!==c.type||c.content.length<1&&0===c.attachments.length)return;if(Yn(o.emoji)){if(i.id!==o.emoji)return}else if(i.name!==o.emoji)return;const m="number"==typeof o.messageLifetime?Math.min(Ia,o.messageLifetime):Ia;if("number"==typeof o.messageLifetime){const e=Date.now()-q(s).timestamp;if(e>36e5){if(Math.floor(e/36e5)>=m)return}}const g=await(await u.getGuild()).getMember(discord.getBotId());if(!g)return;if(hn(n.member.user.id)||!0===n.member.user.bot||"boolean"==typeof o.preventSelf&&!0===o.preventSelf&&n.member.user.id===c.author.id)return void(u.canMember(g,8192)&&await d.deleteReaction(`${"UNICODE"===i.type?i.name:`${i.name}:${i.id}`}`,n.member.user));if("number"==typeof o.level&&o.level>0){if(!await wn(o.level,n.member))return void(u.canMember(g,8192)&&await d.deleteReaction(`${"UNICODE"===i.type?i.name:`${i.name}:${i.id}`}`,n.member.user))}else{if(!0===await Ba(c.author.id))return void(u.canMember(g,8192)&&await d.deleteAllReactionsForEmoji(`${"UNICODE"===i.type?i.name:`${i.name}:${i.id}`}`));if(!0===await Ba(n.userId))return void(u.canMember(g,8192)&&await d.deleteReaction(`${"UNICODE"===i.type?i.name:`${i.name}:${i.id}`}`,n.member.user))}for(;va.includes(s);)await sleep(200);let p;va.includes(s)||va.push(s);const h=await Ma.getById(s);p=void 0!==h?ei(h,Na):new Na(c.author.id,l,s,r,[],i.toMention()),p.reactors.includes(n.userId)||(p.reactors.push(n.userId),await p.check()),va.includes(s)&&va.splice(va.indexOf(s),1)},OnMessageReactionRemove:async function(e,t,n){if(!(n.member instanceof discord.GuildMember))return;const{emoji:i}=n;let a,s,o=!1,r=n.messageId;if(Object.keys(f.modules.starboard.channels).includes(n.channelId)&&(o=!0),o||(a=ka(n.channelId,i)),!o&&!1===a)return;if(o||"string"!=typeof a||(s=Ua(a)),!o&&!1===s)return;if(!0===await Sa.get("lock"))return;n.channelId;const l=await discord.getChannel(n.channelId);if(null===l||0!==l.type&&5!==l.type)return;let u,d;try{u=await l.getMessage(r)}catch(e){return}if(!u)return;if(o){if(a=n.channelId,s=f.modules.starboard.channels[n.channelId],1===u.embeds.length&&"object"==typeof u.embeds[0].footer&&null!==u.embeds[0].footer&&"string"==typeof u.embeds[0].footer.text&&u.embeds[0].footer.text.length>0){const e=u.embeds[0].footer.text;if(!e.toLowerCase().includes(U.modules.starboard.s_terms.message_deleted.toLowerCase())&&e.toLowerCase().includes(`${U.modules.starboard.s_terms.user.toLowerCase()}:`)&&e.toLowerCase().includes(`${U.modules.starboard.s_terms.message.toLowerCase()}:`)){const t=e.toLowerCase().split(" ").join("").split("|")[1].split(`${U.modules.starboard.s_terms.message.toLowerCase()}:`)[1];r=t;const n=u.content.split("-")[1].split(" ").join("").substring(2).split(">").join(""),i=await discord.getChannel(n);if(null===i||0!==i.type&&5!==i.type)return;try{d=await i.getMessage(t)}catch(e){return}if(null===d)return}}}else d=u;if(void 0===d)return;if(0!==d.type||d.content.length<1&&0===d.attachments.length)return;if(Yn(s.emoji)){if(i.id!==s.emoji)return}else if(i.name!==s.emoji)return;const c="number"==typeof s.messageLifetime?Math.min(Ia,s.messageLifetime):Ia,m=Date.now()-q(r).timestamp;if(m>36e5){if(Math.floor(m/36e5)>=c)return}if(hn(n.member.user.id)||!0===n.member.user.bot||"boolean"==typeof s.preventSelf&&!0===s.preventSelf&&n.member.user.id===d.author.id)return;if("number"==typeof s.level&&s.level>0){if(!await wn(s.level,n.member))return}else{if(!0===await Ba(d.author.id))return;if(!0===await Ba(n.userId))return}for(;va.includes(r);)await sleep(200);let g;va.includes(r)||va.push(r);const p=await Ma.getById(r);void 0!==p&&(g=ei(p,Na),g.reactors.includes(n.userId)?(g.reactors.splice(g.reactors.indexOf(n.userId),1),await g.check(),va.includes(r)&&va.splice(va.indexOf(r),1)):va.includes(r)&&va.splice(va.indexOf(r),1))},OnMessageReactionRemoveAll:async function(e,t,n){if(!n.guildId)return;const i=ka(n.channelId,void 0);if(!1===i)return;const a=Ua(i);if(!1===a)return;const s="number"==typeof a.messageLifetime?Math.min(Ia,a.messageLifetime):Ia,o=Date.now()-q(n.messageId).timestamp;if(o>36e5){if(Math.floor(o/36e5)>=s)return}if(!0===await Sa.get("lock"))return;for(;va.includes(n.messageId);)await sleep(200);let r;va.includes(n.messageId)||va.push(n.messageId);const l=await Ma.getById(n.messageId);void 0!==l&&(r=ei(l,Na),r.reactors.length>0?(r.reactors=[],await r.check(),va.includes(n.messageId)&&va.splice(va.indexOf(n.messageId),1)):va.includes(n.messageId)&&va.splice(va.indexOf(n.messageId),1))},InitializeCommands:function(){const e=Oo({description:"Starboard Commands"}),t=new discord.command.CommandGroup(e);return vi(t,"stars",(e=>{Ai(e,"stats",(e=>({user:e.userOptional()})),(async(e,{user:t})=>{zi(await e.inlineReply((async()=>{const n=new discord.Embed;if(null===t){let t=await Ta.getAll();t=t.sort(((e,t)=>t.received-e.received));const i=t.slice(0,Math.min(t.length,10)),a=[],s=[];await Promise.all(i.map((async e=>{const t=await H(e.id);null!==t&&s.push(t)})));for(let t=0;t<i.length;t++){const n=i[t],o=n.id===e.author.id;let r="",l=n.id;const u=s.find((e=>e.id===n.id));u&&(l=Qn(u.getTag())),!0===o&&(l=`**${l}**`),r=0===t?"🥇":1===t?"🥈":2===t?"🥉":`\` ${t.toString()} \``,a.push(`${r} ${l} - ${n.received} ${U.modules.starboard.s_terms.stars.toLowerCase()}`)}if(!i.find((t=>t.id===e.author.id))){const n=t.findIndex((t=>t.id===e.author.id));n>-1&&a.push("...",`\`${n+1}\` - ${Qn(e.author.getTag())}`)}const o=t.reduce(((e,t)=>e+t.received),0);n.setDescription(`🏆 **${U.modules.starboard.s_terms.leaderboard}**\n\n⭐ **${o}**\n👱 **${t.length}**\n\n📈 **${U.modules.starboard.s_terms.ranks}**\n${a.join("\n")}`)}else{const i=await Ta.getById(t.id);if(void 0===i)return{content:B(U.modules.starboard.stars_stats.no_stats,["user_mention",e.author.toMention()])};n.setAuthor({name:t.getTag(),iconUrl:t.getAvatarUrl()}),n.setColor(14805812),n.setDescription(`⭐ **${U.modules.starboard.s_terms.received}** - **${i.received}**\n⭐ **${U.modules.starboard.s_terms.given}** - **${i.given}**\n⭐ **${U.modules.starboard.s_terms.starred_posts}** - **${i.posts}**`)}return{content:"",allowedMentions:{},embed:n}})))}),{permissions:{overrideableInfo:"starboards.stars.stats",level:w.Authorized}}),Ai(e,"block",(e=>({user:e.user()})),(async(e,{user:t})=>{zi(await e.inlineReply((async()=>{if(!0===await Ba(t.id))return B(U.modules.starboard.stars_block.already_blocked,["user_mention",t.toMention()]);let e=await Sa.get("blocks");return Array.isArray(e)||(e=[]),e.push(t.id),await Sa.put("blocks",e),B(U.modules.starboard.stars_block.blocked,["user_mention",t.toMention()])})))}),{permissions:{overrideableInfo:"starboards.stars.block",level:w.Moderator}}),Ai(e,"unblock",(e=>({user:e.user()})),(async(e,{user:t})=>{zi(await e.inlineReply((async()=>{if(!1===await Ba(t.id))return B(U.modules.starboard.stars_unblock.not_blocked,["user_mention",t.toMention()]);let e=await Sa.get("blocks");return Array.isArray(e)||(e=[]),e.splice(e.indexOf(t.id),1),await Sa.put("blocks",e),B(U.modules.starboard.stars_unblock.unblocked,["user_mention",t.toMention()])})))}),{permissions:{overrideableInfo:"starboards.stars.unblock",level:w.Moderator}}),Ii(e,"lock",(async e=>{zi(await e.inlineReply((async()=>!0===await Sa.get("lock")?U.modules.starboard.stars_lock.already_locked:(await Sa.put("lock",!0),U.modules.starboard.stars_lock.locked))))}),{permissions:{overrideableInfo:"starboards.stars.lock",level:w.Administrator}}),Ii(e,"unlock",(async e=>{zi(await e.inlineReply((async()=>{const e=await Sa.get("lock");return void 0===e||"boolean"==typeof e&&!1===e?U.modules.starboard.stars_unlock.not_locked:(await Sa.put("lock",!1),U.modules.starboard.stars_unlock.unlocked)})))}),{permissions:{overrideableInfo:"starboards.stars.unlock",level:w.Administrator}})})),t}});const ja=["\n","\r","\t"," "],xa=["KICK","SOFTBAN","BAN","MUTE","TEMPMUTE","TEMPBAN"],Ha=["LOCK_GUILD"],Va=12e4,Ka=new li({name:"antiSpam",itemDuration:Va,idProperty:"id",timestampProperty:"ts",local:!0});class Ya{constructor(e){this.deleted=!1,this.characters=void 0,this.attachments=void 0,this.newlines=void 0,this.mentions=void 0,this.links=void 0,this.emoji=void 0,this.attachments=e.attachments.length>0?e.attachments.length:void 0,this.authorId=e.author.id,this.channelId=e.channelId,this.id=e.id,this.ts=q(this.id).timestamp,this.content=za(e.content),this.characters=e.content.length,this.mentions=e.mentions.length>0?e.mentions.length:void 0,e.content.includes("\n")&&(this.newlines=e.content.split("\n").length-1);const t=e.content.match(a);Array.isArray(t)&&t.length>0&&(this.links=t.length);let i=0,o=e.content.match(new RegExp(s,"g"));Array.isArray(o)&&(o=o.filter((e=>!Fn(e))),i+=o.length);const r=e.content.match(new RegExp(n,"gi"));return Array.isArray(r)&&(i+=r.length),i>0&&(this.emoji=i),this}}function Wa(e,t){const n=[],i=f.modules.antiSpam,a=pn(e);return"object"==typeof i.antiRaid&&Object.keys(i.antiRaid).map((e=>Yn(e)&&Fn(e)?parseInt(e,10):-1)).sort().reverse().map((e=>{"number"==typeof e&&e>=a&&e>=0&&n.push({_key:`antiRaid_${e}`,...i.antiRaid[e]})})),void 0!==t&&"object"==typeof i.channels&&Object.keys(i.channels).includes(t.id)&&n.push({_key:`channel_${t.id}`,...i.channels[t.id]}),void 0!==t&&"string"==typeof t.parentId&&""!==t.parentId&&4!==t.type&&"object"==typeof i.categories&&Object.keys(i.categories).includes(t.parentId)&&n.push({_key:`category_${t.parentId}`,...i.categories[t.parentId]}),"object"==typeof i.levels&&Object.keys(i.levels).map((e=>Yn(e)&&Fn(e)?parseInt(e,10):-1)).sort().reverse().map((e=>{"number"==typeof e&&e>=a&&e>=0&&n.push({_key:`level_${e}`,...i.levels[e]})})),n}function za(e){let t=`${e}`;return t=t.toLowerCase().replace(r,""),ja.forEach((e=>{t.includes(e)&&(t=t.split(e).join(""))})),t}function qa(e,t,n,i,a){"number"!=typeof a&&(a=0);let s=0,o=[];return e.every((e=>(o.includes(e.authorId)||o.push(e.authorId),e.ts<i||("number"==typeof e[t]&&(s+=e[t]),!(s>=n&&o.length>=a))))),o=[...new Set(o)],s>=n&&o.length>=a}async function Ja(e){let t=!1,n=!1;const i=q(e.id).timestamp,a=await e.getChannel(),s=await e.getGuild(),{member:o}=e;if(null===a||null===s)return;const r=await Ka.getByQuery({authorId:e.author.id});let l=r.find((t=>t.id===e.id));if(0===r.length)return;l||(r.push(new Ya(e)),l=r.find((t=>t.id===e.id)));const u=Wa(o,a);if(0===u.length)return;const d=["newlines","attachments","emoji","mentions","links","characters"];let c=[],m=0;for(let a=0;a<u.length;a+=1){const g=u[a];let p,w,y=r;if((g._key.includes("channel_")||g._key.includes("category_"))&&(y=r.filter((t=>t.channelId===e.channelId))),g._key.includes("antiRaid_")&&(y=await Ka.getAll()),n=g._key.includes("antiRaid"),c=d.filter((e=>{if("string"!=typeof g[e])return!1;if("number"!=typeof l[e]||l[e]<1)return!1;const t=g[e];if(!t.includes("/"))return!1;if(!Fn(t.split("/")[0])||!Fn(t.split("/")[1]))return!1;if("0"===t.split("/")[0]||"0"===t.split("/")[1])return!1;const n=Math.min(Va,+t.split("/")[0]),a=Math.floor(1e3*+t.split("/")[1]);return qa(y,e,n,i-a,g._key.includes("antiRaid_")?Math.min(10,Math.max(2,Math.floor(n/3))):void 0)})),"string"==typeof g.messages){const e=g.messages;if(e.includes("/")&&"0"!==e.split("/")[0]&&"0"!==e.split("/")[1]){const t=Math.min(Va,+e.split("/")[0]),n=Math.floor(1e3*+e.split("/")[1]),a=i-n;let s=[];const o=Math.max(2,Math.floor(t/3));w=y.filter((e=>(s.includes(e.authorId)||s.push(e.authorId),e.ts>=a))),s=[...new Set(s)],w.length>=t&&(!g._key.includes("antiRaid_")||s.length>=o)&&c.push("messages")}}if(c.length>0){t=!0;const n="number"==typeof g.cleanDuration&&g.cleanDuration>0?Math.min(Va,g.cleanDuration):void 0;if("string"==typeof g.action&&(xa.includes(g.action.toUpperCase())||g._key.includes("antiRaid_")&&Ha.includes(g.action))){const e=g.action.toUpperCase(),t="string"==typeof g.actionDuration?g.actionDuration:void 0;if(("TEMPMUTE"===e||"TEMPBAN"===e)&&void 0===t)throw new h(`config.modules.AntiSpam.${g._key}.actionDuration`,"actionDuration malformed");let n=!1,i=!1;if("LOCK_GUILD"===e){!0===await Xi(null,!0,Kn(t),U.modules.antispam.action_reason)&&(i=!0),n=!0}if(!0===i&&Ha.includes(e)&&(gn("ANTISPAM","ANTIRAID",new Map([["ACTION",e],["FLAGS",c.join(", ")]])),"string"==typeof f.modules.antiSpam.antiRaidPingRole&&f.modules.antiSpam.antiRaidPingRole.length>6&&"string"==typeof f.modules.antiSpam.antiRaidPingChannel&&f.modules.antiSpam.antiRaidPingChannel.length>6)){const t=f.modules.antiSpam.antiRaidPingRole,n=f.modules.antiSpam.antiRaidPingChannel,i=await s.getRole(t),a=await s.getChannel(n);i instanceof discord.Role&&(a instanceof discord.GuildTextChannel||a instanceof discord.GuildNewsChannel)&&await a.sendMessage({content:B(U.modules.antispam.raid_channel_msg,["role_mention",i.toMention(),"action",e]),allowedMentions:{roles:[i.id]}})}if(!n)switch(e){case"KICK":await Yo(o,null,U.modules.antispam.action_reason);break;case"SOFTBAN":await Jo(o,null,"number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,U.modules.antispam.action_reason);break;case"MUTE":await Vo(o,null,U.modules.antispam.action_reason);break;case"BAN":await Wo(o,null,"number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,U.modules.antispam.action_reason);break;case"TEMPMUTE":await Ho(o,null,t,U.modules.antispam.action_reason);break;case"TEMPBAN":await qo(o,null,"number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,t,U.modules.antispam.action_reason)}}if(!0===g.clean){let t=y.filter((e=>{if(!0===e.deleted)return!1;for(const t in c){const a=c[t];if("number"==typeof e[a]&&e[a]>0){let t=void 0!==n?n:void 0;if(void 0!==t)return e.ts>=i-Math.floor(1e3*t);const s=g[a];if("string"!=typeof s)continue;return t=Math.floor(1e3*+s.split("/")[1]),e.ts>i-t}if("duplicateMessages"===a)return void 0!==p.find((t=>t.id===e.id));if("messages"===a)return void 0!==w.find((t=>t.id===e.id))}return!1}));const a=await Ka.editTransactMultiWithResult(t.map((e=>e.id)),(e=>!0===e.deleted?{next:e,result:!1}:(e.deleted=!0,{next:e,result:!0})));if(t=t.filter((e=>!a.has(e.id)||a.get(e.id))),t.length>0){m=t.length;const n={};if(t.forEach((e=>{Array.isArray(n[e.channelId])||(n[e.channelId]=[]),n[e.channelId].push(e.id)})),c.includes("mentions")){const i=er,a=await i.get(tr);if("object"==typeof a){const s=[];for(const i in a)if("antiRaid"===g._key||i===e.author.id)for(const e in a[i]){if("object"==typeof a[i][e]){const o=a[i][e].BotReplyMsg,r=a[i][e].OriginalMsg;if(!t.find((e=>e.id===r.id)))continue;s.push(e),Array.isArray(n[o.channelId])||(n[o.channelId]=[]),n[o.channelId].includes(o.id)||n[o.channelId].push(o.id)}}if(s.length>0)try{await i.transact(tr,(t=>{const n=JSON.parse(JSON.stringify(t));for(const t in n)if("antiRaid"===g._key||t===e.author.id){for(const e in n[t])s.includes(e)&&delete n[t][e];0===Object.keys(n[t]).length&&delete n[t]}return n}))}catch(e){}}}const i=await s.getMember(discord.getBotId());if(null!==i){const t=[];for(const a in n)t.push(new Promise((async(t,s)=>{const o=await discord.getChannel(a);if(0!==o.type&&5!==o.type)return void t(null);if(!o.canMember(i,8192))return void t(null);const r=n[a];if(r.length>=2)if(r.length>100){const e=ti(r,99);await Promise.all(e.map((async e=>{await o.bulkDeleteMessages(e)})))}else await o.bulkDeleteMessages(r);else try{const t=r[0];let n=e;t!==e.id&&(n=await o.getMessage(r[0])),null!==n&&await n.delete()}catch(e){}t(null)})));await Promise.all(t)}}}}if(t)break;if("boolean"==typeof g.stop&&!0===g.stop)break}return t&&(n?gn("ANTISPAM","ANTIRAID_VIOLATION",new Map([["FLAGS",c.join(", ")],["DELETED_MESSAGES",m.toString()]])):gn("ANTISPAM","VIOLATION",new Map([["USERTAG",de(e.author)],["USER_ID",e.author.id],["FLAGS",c.join(", ")],["DELETED_MESSAGES",m.toString()]]))),!t}var Qa=Object.freeze({__proto__:null,pools:Ka,getApplicableConfigs:Wa,cleanString:za,checkDuplicateContent:function(e,t){let n=[];const i=za(e.content);return n=t.filter((t=>{if(e.id===t.id)return!1;const n=t.content,a=n.length;if(0===a&&t.attachments>0)return!1;if(a<4)return n===i;return 100*ni(i,n)>90})),n},exceedsThreshold:qa,doChecks:Ja,OnMessageCreate:async function(e,t,n){if(!(n instanceof discord.GuildMemberMessage&&!0!==n.author.bot&&null===n.webhookId&&"string"!=typeof n.webhookId&&0===n.flags&&n.member instanceof discord.GuildMember&&0===n.type))return;if(yn(n.author.id)&&"307927177154789386"!==p)return;return await Ka.saveToPool(new Ya(n)),await Ja(n)},OnMessageUpdate:async function(e,t,n,i){if(!(n instanceof discord.GuildMemberMessage&&!0!==n.author.bot&&null===n.webhookId&&0===n.flags&&n.member instanceof discord.GuildMember&&0===n.type&&null!==i&&n.content!==i.content))return;if(yn(n.author.id)&&"307927177154789386"!==p)return;if(Date.now()-q(n.id).timestamp>Va)return;return await Ka.editPool(n.id,new Ya(n)),await Ja(n)},OnMessageDelete:async function(e,t,n){Ka.editTransact(n.id,(e=>(e.deleted=!0,e)))},OnMessageDeleteBulk:async function(e,t,n){Ka.editPools(n.ids,(e=>e?(n.ids.includes(e.id)&&!e.deleted&&(e.deleted=!0),e):e))}});new pylon.KVNamespace("eventHandlerRatelimit");let Za=new Array;const Xa={global:["20/5000","60/20000","200/40000"],event:["9/6000","15/15000","40/30000"],auditlog:["10/4000","30/40000","100/120000"],auditlog_MESSAGE_DELETE:["3/7500"]};async function es(e,t,n=Date.now()){n instanceof Date&&(n=n.getTime()),Za.push({id:n,event:e,type:t})}async function ts(e,t,n=Date.now()){"auditlog"!==(t=t.toLowerCase())&&"global"!==t&&"all"!==t&&"event"!==t&&(t=t.toUpperCase()),n instanceof Date&&(n=n.getTime());const i=await async function(){return Za}();return function(){let a;"all"===t&&(a=["global","auditlog","event",e,`auditlog_${e}`]),"global"===t&&(a=["global"]),"event"===t&&(a=["event",e]),"auditlog"===t&&(a=["auditlog",`auditlog_${e}`]),void 0===a&&(a=[e]);for(const s in Xa){if(-1===a.indexOf(s))continue;if(void 0!==Xa[s].find((a=>{const o=+a.split("/")[1],r=+a.split("/")[0];return i.filter((i=>{if(n-i.id<=o){if("auditlog"===t&&"auditlog"!==i.type)return!1;if("global"===t&&"global"!==i.type)return!1;if("global"===s||"auditlog"===s)return!0;if(i.event===e)return!0}return!1})).length>r})))return!0}return!1}()}class ns{constructor(e,...t){return this.guildId=void 0,this.processed=!1,this.verified=!1,this.auditLogEntry=null,this.id=z(),this.eventName=e,this.payload=t,this.guildId=p,this}}const is=5e3;let as,ss,os=new Array;function rs(){if(void 0!==ss&&"number"==typeof ss){const e=(new Date).getTime()-ss;if(e<is)return is-e}return!0}async function ls(){if(as=void 0,!0!==rs())return!1;ss=(new Date).getTime(),os=us(os);let e=(new Array).concat(os);e=e.filter((e=>!e.processed));const t=e.length;if(t<1)return ss=void 0,!1;let n=35;"function"==typeof pylon.getCpuTime&&(n=Math.floor(await pylon.getCpuTime()));const i=n+Math.floor(23*t);try{if(i>=3e3){const t=Math.min(e.length-1,Math.floor((3e3-n)/23)-1);if(t>0){const n=e.slice(0,t);try{await pylon.requestCpuBurst((async()=>{await Rl(n),n.map((t=>{const n=os.findIndex((e=>t.id===e.id)),i=e.findIndex((e=>t.id===e.id));return-1!==n&&(os[n]=t),-1!==i&&(e[i]=t),t}))}),3e3)}catch(e){Zn(e)}}}else if(i>=100)try{await pylon.requestCpuBurst((async()=>{await Rl(e)}),Math.max(200,i))}catch(t){if(Zn(t),!(t instanceof pylon.CpuBurstRequestError)&&"number"!=typeof t.bucketRemainingMs){const t=Math.min(e.length-1,Math.floor((100-n)/23)-1);if(t>0){const n=e.slice(0,t);await Rl(n),n.map((t=>{const n=os.findIndex((e=>t.id===e.id)),i=e.findIndex((e=>t.id===e.id));return-1!==n&&(os[n]=t),-1!==i&&(e[i]=t),t}))}}}else await Rl(os)}catch(e){if(e.messageExtended&&"string"==typeof e.messageExtended)try{const t=JSON.parse(e.messageExtended).message;t&&"missing permissions"!==t.toLowerCase()&&fn("BOT_ERROR",new Map([["ERROR",`Error while executing event queue': \n${e.stack}`]]))}catch(e){}}return e.map((e=>{const t=os.findIndex((t=>e.id===t.id));return-1===t||(os[t]=e),e})),ss=(new Date).getTime(),!0}function us(e){return void 0===e&&(e=os),e=e.filter((e=>{if(e.processed){const t=new Date(q(e.id).timestamp).getTime(),n=(new Date).getTime()-t;if(e.verified&&n>=Math.floor(15e3))return!1;if(!e.verified&&n>=Math.floor(15e4))return!1}return!0}))}async function ds(e,t,...n){const i=new ns(e,...n);return i.id=t,os.push(i),await async function(e=!0){if(as)return;!0===rs()&&(as=setTimeout(ls,Math.ceil(2500)))}(),i}class cs{constructor(e,t){return this.shortcode=e,this.name=t,this}}class ms{constructor(e,t,n,i){return this.shortcode=e,this.name=t,this.flag=n,this.mainLanguage=i,this}}let gs=new Array(new ms("AD","Andorra","🇦🇩",""),new ms("AE","United Arab Emirates","🇦🇪",""),new ms("AF","Afghanistan","🇦🇫",""),new ms("AG","Antigua and Barbuda","🇦🇬",""),new ms("AI","Anguilla","🇦🇮",""),new ms("AL","Albania","🇦🇱",""),new ms("AM","Armenia","🇦🇲",""),new ms("AO","Angola","🇦🇴",""),new ms("AQ","Antarctica","🇦🇶",""),new ms("AR","Argentina","🇦🇷",""),new ms("AS","American Samoa","🇦🇸",""),new ms("AT","Austria","🇦🇹",""),new ms("AU","Australia","🇦🇺",""),new ms("AW","Aruba","🇦🇼",""),new ms("AX","Åland Islands","🇦🇽",""),new ms("AZ","Azerbaijan","🇦🇿",""),new ms("BA","Bosnia and Herzegovina","🇧🇦",""),new ms("BB","Barbados","🇧🇧",""),new ms("BD","Bangladesh","🇧🇩",""),new ms("BE","Belgium","🇧🇪",""),new ms("BF","Burkina Faso","🇧🇫",""),new ms("BG","Bulgaria","🇧🇬",""),new ms("BH","Bahrain","🇧🇭",""),new ms("BI","Burundi","🇧🇮",""),new ms("BJ","Benin","🇧🇯",""),new ms("BL","Saint Barthélemy","🇧🇱",""),new ms("BM","Bermuda","🇧🇲",""),new ms("BN","Brunei Darussalam","🇧🇳",""),new ms("BO","Bolivia","🇧🇴",""),new ms("BQ","Bonaire, Sint Eustatius and Saba","🇧🇶",""),new ms("BR","Brazil","🇧🇷","pt"),new ms("BS","Bahamas","🇧🇸",""),new ms("BT","Bhutan","🇧🇹",""),new ms("BV","Bouvet Island","🇧🇻",""),new ms("BW","Botswana","🇧🇼",""),new ms("BY","Belarus","🇧🇾",""),new ms("BZ","Belize","🇧🇿",""),new ms("CA","Canada","🇨🇦",""),new ms("CC","Cocos (Keeling) Islands","🇨🇨",""),new ms("CD","Congo","🇨🇩",""),new ms("CF","Central African Republic","🇨🇫",""),new ms("CG","Congo","🇨🇬",""),new ms("CH","Switzerland","🇨🇭",""),new ms("CI","Côte D´Ivoire","🇨🇮",""),new ms("CK","Cook Islands","🇨🇰",""),new ms("CL","Chile","🇨🇱",""),new ms("CM","Cameroon","🇨🇲",""),new ms("CN","China","🇨🇳",""),new ms("CO","Colombia","🇨🇴",""),new ms("CR","Costa Rica","🇨🇷",""),new ms("CU","Cuba","🇨🇺",""),new ms("CV","Cape Verde","🇨🇻",""),new ms("CW","Curaçao","🇨🇼",""),new ms("CX","Christmas Island","🇨🇽",""),new ms("CY","Cyprus","🇨🇾",""),new ms("CZ","Czech Republic","🇨🇿",""),new ms("DE","Germany","🇩🇪",""),new ms("DJ","Djibouti","🇩🇯",""),new ms("DK","Denmark","🇩🇰",""),new ms("DM","Dominica","🇩🇲",""),new ms("DO","Dominican Republic","🇩🇴",""),new ms("DZ","Algeria","🇩🇿",""),new ms("EC","Ecuador","🇪🇨",""),new ms("EE","Estonia","🇪🇪",""),new ms("EG","Egypt","🇪🇬",""),new ms("EH","Western Sahara","🇪🇭",""),new ms("ER","Eritrea","🇪🇷",""),new ms("ES","Spain","🇪🇸",""),new ms("ET","Ethiopia","🇪🇹",""),new ms("FI","Finland","🇫🇮",""),new ms("FJ","Fiji","🇫🇯",""),new ms("FK","Falkland Islands (Malvinas)","🇫🇰",""),new ms("FM","Micronesia","🇫🇲",""),new ms("FO","Faroe Islands","🇫🇴",""),new ms("FR","France","🇫🇷",""),new ms("GA","Gabon","🇬🇦",""),new ms("GB","United Kingdom",["🇬🇧","🏴󠁧󠁢󠁥󠁮󠁧󠁿"],""),new ms("GD","Grenada","🇬🇩",""),new ms("GE","Georgia","🇬🇪",""),new ms("GF","French Guiana","🇬🇫",""),new ms("GG","Guernsey","🇬🇬",""),new ms("GH","Ghana","🇬🇭",""),new ms("GI","Gibraltar","🇬🇮",""),new ms("GL","Greenland","🇬🇱",""),new ms("GM","Gambia","🇬🇲",""),new ms("GN","Guinea","🇬🇳",""),new ms("GP","Guadeloupe","🇬🇵",""),new ms("GQ","Equatorial Guinea","🇬🇶",""),new ms("GR","Greece","🇬🇷",""),new ms("GS","South Georgia","🇬🇸",""),new ms("GT","Guatemala","🇬🇹",""),new ms("GU","Guam","🇬🇺",""),new ms("GW","Guinea-Bissau","🇬🇼",""),new ms("GY","Guyana","🇬🇾",""),new ms("HK","Hong Kong","🇭🇰",""),new ms("HM","Heard Island and Mcdonald Islands","🇭🇲",""),new ms("HN","Honduras","🇭🇳",""),new ms("HR","Croatia","🇭🇷",""),new ms("HT","Haiti","🇭🇹",""),new ms("HU","Hungary","🇭🇺",""),new ms("ID","Indonesia","🇮🇩",""),new ms("IE","Ireland","🇮🇪",""),new ms("IL","Israel","🇮🇱",""),new ms("IM","Isle of Man","🇮🇲",""),new ms("IN","India","🇮🇳",""),new ms("IO","British Indian Ocean Territory","🇮🇴",""),new ms("IQ","Iraq","🇮🇶",""),new ms("IR","Iran","🇮🇷",""),new ms("IS","Iceland","🇮🇸",""),new ms("IT","Italy","🇮🇹",""),new ms("JE","Jersey","🇯🇪",""),new ms("JM","Jamaica","🇯🇲",""),new ms("JO","Jordan","🇯🇴",""),new ms("JP","Japan","🇯🇵",""),new ms("KE","Kenya","🇰🇪",""),new ms("KG","Kyrgyzstan","🇰🇬",""),new ms("KH","Cambodia","🇰🇭",""),new ms("KI","Kiribati","🇰🇮",""),new ms("KM","Comoros","🇰🇲",""),new ms("KN","Saint Kitts and Nevis","🇰🇳",""),new ms("KP","North Korea","🇰🇵",""),new ms("KR","South Korea","🇰🇷",""),new ms("KW","Kuwait","🇰🇼",""),new ms("KY","Cayman Islands","🇰🇾",""),new ms("KZ","Kazakhstan","🇰🇿",""),new ms("LA","Lao People´s Democratic Republic","🇱🇦",""),new ms("LB","Lebanon","🇱🇧",""),new ms("LC","Saint Lucia","🇱🇨",""),new ms("LI","Liechtenstein","🇱🇮",""),new ms("LK","Sri Lanka","🇱🇰",""),new ms("LR","Liberia","🇱🇷",""),new ms("LS","Lesotho","🇱🇸",""),new ms("LT","Lithuania","🇱🇹",""),new ms("LU","Luxembourg","🇱🇺",""),new ms("LV","Latvia","🇱🇻",""),new ms("LY","Libya","🇱🇾",""),new ms("MA","Morocco","🇲🇦",""),new ms("MC","Monaco","🇲🇨",""),new ms("MD","Moldova","🇲🇩",""),new ms("ME","Montenegro","🇲🇪",""),new ms("MF","Saint Martin (French Part)","🇲🇫",""),new ms("MG","Madagascar","🇲🇬",""),new ms("MH","Marshall Islands","🇲🇭",""),new ms("MK","Macedonia","🇲🇰",""),new ms("ML","Mali","🇲🇱",""),new ms("MM","Myanmar","🇲🇲",""),new ms("MN","Mongolia","🇲🇳",""),new ms("MO","Macao","🇲🇴",""),new ms("MP","Northern Mariana Islands","🇲🇵",""),new ms("MQ","Martinique","🇲🇶",""),new ms("MR","Mauritania","🇲🇷",""),new ms("MS","Montserrat","🇲🇸",""),new ms("MT","Malta","🇲🇹",""),new ms("MU","Mauritius","🇲🇺",""),new ms("MV","Maldives","🇲🇻",""),new ms("MW","Malawi","🇲🇼",""),new ms("MX","Mexico","🇲🇽",""),new ms("MY","Malaysia","🇲🇾",""),new ms("MZ","Mozambique","🇲🇿",""),new ms("NA","Namibia","🇳🇦",""),new ms("NC","New Caledonia","🇳🇨",""),new ms("NE","Niger","🇳🇪",""),new ms("NF","Norfolk Island","🇳🇫",""),new ms("NG","Nigeria","🇳🇬",""),new ms("NI","Nicaragua","🇳🇮",""),new ms("NL","Netherlands","🇳🇱",""),new ms("NO","Norway","🇳🇴",""),new ms("NP","Nepal","🇳🇵",""),new ms("NR","Nauru","🇳🇷",""),new ms("NU","Niue","🇳🇺",""),new ms("NZ","New Zealand","🇳🇿",""),new ms("OM","Oman","🇴🇲",""),new ms("PA","Panama","🇵🇦",""),new ms("PE","Peru","🇵🇪",""),new ms("PF","French Polynesia","🇵🇫",""),new ms("PG","Papua New Guinea","🇵🇬",""),new ms("PH","Philippines","🇵🇭",""),new ms("PK","Pakistan","🇵🇰",""),new ms("PL","Poland","🇵🇱",""),new ms("PM","Saint Pierre and Miquelon","🇵🇲",""),new ms("PN","Pitcairn","🇵🇳",""),new ms("PR","Puerto Rico","🇵🇷",""),new ms("PS","Palestinian Territory","🇵🇸",""),new ms("PT","Portugal","🇵🇹","pt"),new ms("PW","Palau","🇵🇼",""),new ms("PY","Paraguay","🇵🇾",""),new ms("QA","Qatar","🇶🇦",""),new ms("RE","Réunion","🇷🇪",""),new ms("RO","Romania","🇷🇴",""),new ms("RS","Serbia","🇷🇸",""),new ms("RU","Russia","🇷🇺",""),new ms("RW","Rwanda","🇷🇼",""),new ms("SA","Saudi Arabia","🇸🇦",""),new ms("SB","Solomon Islands","🇸🇧",""),new ms("SC","Seychelles","🇸🇨",""),new ms("SD","Sudan","🇸🇩",""),new ms("SE","Sweden","🇸🇪",""),new ms("SG","Singapore","🇸🇬",""),new ms("SH","Saint Helena, Ascension and Tristan Da Cunha","🇸🇭",""),new ms("SI","Slovenia","🇸🇮",""),new ms("SJ","Svalbard and Jan Mayen","🇸🇯",""),new ms("SK","Slovakia","🇸🇰",""),new ms("SL","Sierra Leone","🇸🇱",""),new ms("SM","San Marino","🇸🇲",""),new ms("SN","Senegal","🇸🇳",""),new ms("SO","Somalia","🇸🇴",""),new ms("SR","Suriname","🇸🇷",""),new ms("SS","South Sudan","🇸🇸",""),new ms("ST","Sao Tome and Principe","🇸🇹",""),new ms("SV","El Salvador","🇸🇻",""),new ms("SX","Sint Maarten (Dutch Part)","🇸🇽",""),new ms("SY","Syrian Arab Republic","🇸🇾",""),new ms("SZ","Swaziland","🇸🇿",""),new ms("TC","Turks and Caicos Islands","🇹🇨",""),new ms("TD","Chad","🇹🇩",""),new ms("TF","French Southern Territories","🇹🇫",""),new ms("TG","Togo","🇹🇬",""),new ms("TH","Thailand","🇹🇭",""),new ms("TJ","Tajikistan","🇹🇯",""),new ms("TK","Tokelau","🇹🇰",""),new ms("TL","Timor-Leste","🇹🇱",""),new ms("TM","Turkmenistan","🇹🇲",""),new ms("TN","Tunisia","🇹🇳",""),new ms("TO","Tonga","🇹🇴",""),new ms("TR","Turkey","🇹🇷",""),new ms("TT","Trinidad and Tobago","🇹🇹",""),new ms("TV","Tuvalu","🇹🇻",""),new ms("TW","Taiwan","🇹🇼",""),new ms("TZ","Tanzania","🇹🇿",""),new ms("UA","Ukraine","🇺🇦",""),new ms("UG","Uganda","🇺🇬",""),new ms("UM","United States Minor Outlying Islands","🇺🇲",""),new ms("US","United States","🇺🇸",""),new ms("UY","Uruguay","🇺🇾",""),new ms("UZ","Uzbekistan","🇺🇿",""),new ms("VA","Vatican City","🇻🇦",""),new ms("VC","Saint Vincent and The Grenadines","🇻🇨",""),new ms("VE","Venezuela","🇻🇪",""),new ms("VG","Virgin Islands, British","🇻🇬",""),new ms("VI","Virgin Islands, U.S.","🇻🇮",""),new ms("VN","Viet Nam","🇻🇳",""),new ms("VU","Vanuatu","🇻🇺",""),new ms("WF","Wallis and Futuna","🇼🇫",""),new ms("WS","Samoa","🇼🇸",""),new ms("YE","Yemen","🇾🇪",""),new ms("YT","Mayotte","🇾🇹",""),new ms("ZA","South Africa","🇿🇦",""),new ms("ZM","Zambia","🇿🇲",""),new ms("ZW","Zimbabwe","🇿🇼",""));const fs=JSON.parse('[{"English": "Afar", "alpha2": "aa"},{"English": "Abkhazian", "alpha2": "ab"},{"English": "Avestan", "alpha2": "ae"},{"English": "Afrikaans", "alpha2": "af"},{"English": "Akan", "alpha2": "ak"},{"English": "Amharic", "alpha2": "am"},{"English": "Aragonese", "alpha2": "an"},{"English": "Arabic", "alpha2": "ar"},{"English": "Assamese", "alpha2": "as"},{"English": "Avaric", "alpha2": "av"},{"English": "Aymara", "alpha2": "ay"},{"English": "Azerbaijani", "alpha2": "az"},{"English": "Bashkir", "alpha2": "ba"},{"English": "Belarusian", "alpha2": "be"},{"English": "Bulgarian", "alpha2": "bg"},{"English": "Bihari languages", "alpha2": "bh"},{"English": "Bislama", "alpha2": "bi"},{"English": "Bambara", "alpha2": "bm"},{"English": "Bengali", "alpha2": "bn"},{"English": "Tibetan", "alpha2": "bo"},{"English": "Breton", "alpha2": "br"},{"English": "Bosnian", "alpha2": "bs"},{"English": "Catalan; Valencian", "alpha2": "ca"},{"English": "Chechen", "alpha2": "ce"},{"English": "Chamorro", "alpha2": "ch"},{"English": "Corsican", "alpha2": "co"},{"English": "Cree", "alpha2": "cr"},{"English": "Czech", "alpha2": "cs"},{"English": "Church Slavic; Old Slavonic; Church Slavonic; Old Bulgarian; Old Church Slavonic", "alpha2": "cu"},{"English": "Chuvash", "alpha2": "cv"},{"English": "Welsh", "alpha2": "cy"},{"English": "Danish", "alpha2": "da"},{"English": "German", "alpha2": "de"},{"English": "Divehi; Dhivehi; Maldivian", "alpha2": "dv"},{"English": "Dzongkha", "alpha2": "dz"},{"English": "Ewe", "alpha2": "ee"},{"English": "Greek, Modern (1453-)", "alpha2": "el"},{"English": "English", "alpha2": "en"},{"English": "Esperanto", "alpha2": "eo"},{"English": "Spanish; Castilian", "alpha2": "es"},{"English": "Estonian", "alpha2": "et"},{"English": "Basque", "alpha2": "eu"},{"English": "Persian", "alpha2": "fa"},{"English": "Fulah", "alpha2": "ff"},{"English": "Finnish", "alpha2": "fi"},{"English": "Fijian", "alpha2": "fj"},{"English": "Faroese", "alpha2": "fo"},{"English": "French", "alpha2": "fr"},{"English": "Western Frisian", "alpha2": "fy"},{"English": "Irish", "alpha2": "ga"},{"English": "Gaelic; Scottish Gaelic", "alpha2": "gd"},{"English": "Galician", "alpha2": "gl"},{"English": "Guarani", "alpha2": "gn"},{"English": "Gujarati", "alpha2": "gu"},{"English": "Manx", "alpha2": "gv"},{"English": "Hausa", "alpha2": "ha"},{"English": "Hebrew", "alpha2": "he"},{"English": "Hindi", "alpha2": "hi"},{"English": "Hiri Motu", "alpha2": "ho"},{"English": "Croatian", "alpha2": "hr"},{"English": "Haitian; Haitian Creole", "alpha2": "ht"},{"English": "Hungarian", "alpha2": "hu"},{"English": "Armenian", "alpha2": "hy"},{"English": "Herero", "alpha2": "hz"},{"English": "Interlingua (International Auxiliary Language Association)", "alpha2": "ia"},{"English": "Indonesian", "alpha2": "id"},{"English": "Interlingue; Occidental", "alpha2": "ie"},{"English": "Igbo", "alpha2": "ig"},{"English": "Sichuan Yi; Nuosu", "alpha2": "ii"},{"English": "Inupiaq", "alpha2": "ik"},{"English": "Ido", "alpha2": "io"},{"English": "Icelandic", "alpha2": "is"},{"English": "Italian", "alpha2": "it"},{"English": "Inuktitut", "alpha2": "iu"},{"English": "Japanese", "alpha2": "ja"},{"English": "Javanese", "alpha2": "jv"},{"English": "Georgian", "alpha2": "ka"},{"English": "Kongo", "alpha2": "kg"},{"English": "Kikuyu; Gikuyu", "alpha2": "ki"},{"English": "Kuanyama; Kwanyama", "alpha2": "kj"},{"English": "Kazakh", "alpha2": "kk"},{"English": "Kalaallisut; Greenlandic", "alpha2": "kl"},{"English": "Central Khmer", "alpha2": "km"},{"English": "Kannada", "alpha2": "kn"},{"English": "Korean", "alpha2": "ko"},{"English": "Kanuri", "alpha2": "kr"},{"English": "Kashmiri", "alpha2": "ks"},{"English": "Kurdish", "alpha2": "ku"},{"English": "Komi", "alpha2": "kv"},{"English": "Cornish", "alpha2": "kw"},{"English": "Kirghiz; Kyrgyz", "alpha2": "ky"},{"English": "Latin", "alpha2": "la"},{"English": "Luxembourgish; Letzeburgesch", "alpha2": "lb"},{"English": "Ganda", "alpha2": "lg"},{"English": "Limburgan; Limburger; Limburgish", "alpha2": "li"},{"English": "Lingala", "alpha2": "ln"},{"English": "Lao", "alpha2": "lo"},{"English": "Lithuanian", "alpha2": "lt"},{"English": "Luba-Katanga", "alpha2": "lu"},{"English": "Latvian", "alpha2": "lv"},{"English": "Malagasy", "alpha2": "mg"},{"English": "Marshallese", "alpha2": "mh"},{"English": "Maori", "alpha2": "mi"},{"English": "Macedonian", "alpha2": "mk"},{"English": "Malayalam", "alpha2": "ml"},{"English": "Mongolian", "alpha2": "mn"},{"English": "Marathi", "alpha2": "mr"},{"English": "Malay", "alpha2": "ms"},{"English": "Maltese", "alpha2": "mt"},{"English": "Burmese", "alpha2": "my"},{"English": "Nauru", "alpha2": "na"},{"English": "Bokmål, Norwegian; Norwegian Bokmål", "alpha2": "nb"},{"English": "Ndebele, North; North Ndebele", "alpha2": "nd"},{"English": "Nepali", "alpha2": "ne"},{"English": "Ndonga", "alpha2": "ng"},{"English": "Dutch; Flemish", "alpha2": "nl"},{"English": "Norwegian Nynorsk; Nynorsk, Norwegian", "alpha2": "nn"},{"English": "Norwegian", "alpha2": "no"},{"English": "Ndebele, South; South Ndebele", "alpha2": "nr"},{"English": "Navajo; Navaho", "alpha2": "nv"},{"English": "Chichewa; Chewa; Nyanja", "alpha2": "ny"},{"English": "Occitan (post 1500)", "alpha2": "oc"},{"English": "Ojibwa", "alpha2": "oj"},{"English": "Oromo", "alpha2": "om"},{"English": "Oriya", "alpha2": "or"},{"English": "Ossetian; Ossetic", "alpha2": "os"},{"English": "Panjabi; Punjabi", "alpha2": "pa"},{"English": "Pali", "alpha2": "pi"},{"English": "Polish", "alpha2": "pl"},{"English": "Pushto; Pashto", "alpha2": "ps"},{"English": "Portuguese", "alpha2": "pt"},{"English": "Quechua", "alpha2": "qu"},{"English": "Romansh", "alpha2": "rm"},{"English": "Rundi", "alpha2": "rn"},{"English": "Romanian; Moldavian; Moldovan", "alpha2": "ro"},{"English": "Russian", "alpha2": "ru"},{"English": "Kinyarwanda", "alpha2": "rw"},{"English": "Sanskrit", "alpha2": "sa"},{"English": "Sardinian", "alpha2": "sc"},{"English": "Sindhi", "alpha2": "sd"},{"English": "Northern Sami", "alpha2": "se"},{"English": "Sango", "alpha2": "sg"},{"English": "Sinhala; Sinhalese", "alpha2": "si"},{"English": "Slovak", "alpha2": "sk"},{"English": "Slovenian", "alpha2": "sl"},{"English": "Samoan", "alpha2": "sm"},{"English": "Shona", "alpha2": "sn"},{"English": "Somali", "alpha2": "so"},{"English": "Albanian", "alpha2": "sq"},{"English": "Serbian", "alpha2": "sr"},{"English": "Swati", "alpha2": "ss"},{"English": "Sotho, Southern", "alpha2": "st"},{"English": "Sundanese", "alpha2": "su"},{"English": "Swedish", "alpha2": "sv"},{"English": "Swahili", "alpha2": "sw"},{"English": "Tamil", "alpha2": "ta"},{"English": "Telugu", "alpha2": "te"},{"English": "Tajik", "alpha2": "tg"},{"English": "Thai", "alpha2": "th"},{"English": "Tigrinya", "alpha2": "ti"},{"English": "Turkmen", "alpha2": "tk"},{"English": "Tagalog", "alpha2": "tl"},{"English": "Tswana", "alpha2": "tn"},{"English": "Tonga (Tonga Islands)", "alpha2": "to"},{"English": "Turkish", "alpha2": "tr"},{"English": "Tsonga", "alpha2": "ts"},{"English": "Tatar", "alpha2": "tt"},{"English": "Twi", "alpha2": "tw"},{"English": "Tahitian", "alpha2": "ty"},{"English": "Uighur; Uyghur", "alpha2": "ug"},{"English": "Ukrainian", "alpha2": "uk"},{"English": "Urdu", "alpha2": "ur"},{"English": "Uzbek", "alpha2": "uz"},{"English": "Venda", "alpha2": "ve"},{"English": "Vietnamese", "alpha2": "vi"},{"English": "Volapük", "alpha2": "vo"},{"English": "Walloon", "alpha2": "wa"},{"English": "Wolof", "alpha2": "wo"},{"English": "Xhosa", "alpha2": "xh"},{"English": "Yiddish", "alpha2": "yi"},{"English": "Yoruba", "alpha2": "yo"},{"English": "Zhuang; Chuang", "alpha2": "za"},{"English": "Chinese", "alpha2": "zh-TW"},{"English": "Chinese (Simplified)", "alpha2": "zh-CN"},{"English": "Zulu", "alpha2": "zu"}]');let ps=new Array;fs.forEach((function(e){let t=e.English;t.indexOf(";")>-1&&(t=t.split(";")[0]);const n=new cs(e.alpha2,t);ps.push(n)}));JSON.parse('[{"ISO3166-1-Alpha-2":"TW","Languages":"zh-TW,zh,nan,hak"},{"ISO3166-1-Alpha-2":"AF","Languages":"fa-AF,ps,uz-AF,tk"},{"ISO3166-1-Alpha-2":"AL","Languages":"sq,el"},{"ISO3166-1-Alpha-2":"DZ","Languages":"ar-DZ"},{"ISO3166-1-Alpha-2":"AS","Languages":"en-AS,sm,to"},{"ISO3166-1-Alpha-2":"AD","Languages":"ca"},{"ISO3166-1-Alpha-2":"AO","Languages":"pt-AO"},{"ISO3166-1-Alpha-2":"AI","Languages":"en-AI"},{"ISO3166-1-Alpha-2":"AQ","Languages":null},{"ISO3166-1-Alpha-2":"AG","Languages":"en-AG"},{"ISO3166-1-Alpha-2":"AR","Languages":"es-AR,en,it,de,fr,gn"},{"ISO3166-1-Alpha-2":"AM","Languages":"hy"},{"ISO3166-1-Alpha-2":"AW","Languages":"nl-AW,es,en"},{"ISO3166-1-Alpha-2":"AU","Languages":"en-AU"},{"ISO3166-1-Alpha-2":"AT","Languages":"de-AT,hr,hu,sl"},{"ISO3166-1-Alpha-2":"AZ","Languages":"az,ru,hy"},{"ISO3166-1-Alpha-2":"BS","Languages":"en-BS"},{"ISO3166-1-Alpha-2":"BH","Languages":"ar-BH,en,fa,ur"},{"ISO3166-1-Alpha-2":"BD","Languages":"bn-BD,en"},{"ISO3166-1-Alpha-2":"BB","Languages":"en-BB"},{"ISO3166-1-Alpha-2":"BY","Languages":"be,ru"},{"ISO3166-1-Alpha-2":"BE","Languages":"nl-BE,fr-BE,de-BE"},{"ISO3166-1-Alpha-2":"BZ","Languages":"en-BZ,es"},{"ISO3166-1-Alpha-2":"BJ","Languages":"fr-BJ"},{"ISO3166-1-Alpha-2":"BM","Languages":"en-BM,pt"},{"ISO3166-1-Alpha-2":"BT","Languages":"dz"},{"ISO3166-1-Alpha-2":"BO","Languages":"es-BO,qu,ay"},{"ISO3166-1-Alpha-2":"BQ","Languages":"nl,pap,en"},{"ISO3166-1-Alpha-2":"BA","Languages":"bs,hr-BA,sr-BA"},{"ISO3166-1-Alpha-2":"BW","Languages":"en-BW,tn-BW"},{"ISO3166-1-Alpha-2":"BV","Languages":null},{"ISO3166-1-Alpha-2":"BR","Languages":"pt-BR,es,en,fr"},{"ISO3166-1-Alpha-2":"IO","Languages":"en-IO"},{"ISO3166-1-Alpha-2":"VG","Languages":"en-VG"},{"ISO3166-1-Alpha-2":"BN","Languages":"ms-BN,en-BN"},{"ISO3166-1-Alpha-2":"BG","Languages":"bg,tr-BG,rom"},{"ISO3166-1-Alpha-2":"BF","Languages":"fr-BF"},{"ISO3166-1-Alpha-2":"BI","Languages":"fr-BI,rn"},{"ISO3166-1-Alpha-2":"CV","Languages":"pt-CV"},{"ISO3166-1-Alpha-2":"KH","Languages":"km,fr,en"},{"ISO3166-1-Alpha-2":"CM","Languages":"en-CM,fr-CM"},{"ISO3166-1-Alpha-2":"CA","Languages":"en-CA,fr-CA,iu"},{"ISO3166-1-Alpha-2":"KY","Languages":"en-KY"},{"ISO3166-1-Alpha-2":"CF","Languages":"fr-CF,sg,ln,kg"},{"ISO3166-1-Alpha-2":"TD","Languages":"fr-TD,ar-TD,sre"},{"ISO3166-1-Alpha-2":"CL","Languages":"es-CL"},{"ISO3166-1-Alpha-2":"CN","Languages":"zh-CN,yue,wuu,dta,ug,za"},{"ISO3166-1-Alpha-2":"HK","Languages":"zh-HK,yue,zh,en"},{"ISO3166-1-Alpha-2":"MO","Languages":"zh,zh-MO,pt"},{"ISO3166-1-Alpha-2":"CX","Languages":"en,zh,ms-CC"},{"ISO3166-1-Alpha-2":"CC","Languages":"ms-CC,en"},{"ISO3166-1-Alpha-2":"CO","Languages":"es-CO"},{"ISO3166-1-Alpha-2":"KM","Languages":"ar,fr-KM"},{"ISO3166-1-Alpha-2":"CG","Languages":"fr-CG,kg,ln-CG"},{"ISO3166-1-Alpha-2":"CK","Languages":"en-CK,mi"},{"ISO3166-1-Alpha-2":"CR","Languages":"es-CR,en"},{"ISO3166-1-Alpha-2":"HR","Languages":"hr-HR,sr"},{"ISO3166-1-Alpha-2":"CU","Languages":"es-CU"},{"ISO3166-1-Alpha-2":"CW","Languages":"nl,pap"},{"ISO3166-1-Alpha-2":"CY","Languages":"el-CY,tr-CY,en"},{"ISO3166-1-Alpha-2":"CZ","Languages":"cs,sk"},{"ISO3166-1-Alpha-2":"CI","Languages":"fr-CI"},{"ISO3166-1-Alpha-2":"KP","Languages":"ko-KP"},{"ISO3166-1-Alpha-2":"CD","Languages":"fr-CD,ln,kg"},{"ISO3166-1-Alpha-2":"DK","Languages":"da-DK,en,fo,de-DK"},{"ISO3166-1-Alpha-2":"DJ","Languages":"fr-DJ,ar,so-DJ,aa"},{"ISO3166-1-Alpha-2":"DM","Languages":"en-DM"},{"ISO3166-1-Alpha-2":"DO","Languages":"es-DO"},{"ISO3166-1-Alpha-2":"EC","Languages":"es-EC"},{"ISO3166-1-Alpha-2":"EG","Languages":"ar-EG,en,fr"},{"ISO3166-1-Alpha-2":"SV","Languages":"es-SV"},{"ISO3166-1-Alpha-2":"GQ","Languages":"es-GQ,fr"},{"ISO3166-1-Alpha-2":"ER","Languages":"aa-ER,ar,tig,kun,ti-ER"},{"ISO3166-1-Alpha-2":"EE","Languages":"et,ru"},{"ISO3166-1-Alpha-2":"ET","Languages":"am,en-ET,om-ET,ti-ET,so-ET,sid"},{"ISO3166-1-Alpha-2":"FK","Languages":"en-FK"},{"ISO3166-1-Alpha-2":"FO","Languages":"fo,da-FO"},{"ISO3166-1-Alpha-2":"FJ","Languages":"en-FJ,fj"},{"ISO3166-1-Alpha-2":"FI","Languages":"fi-FI,sv-FI,smn"},{"ISO3166-1-Alpha-2":"FR","Languages":"fr-FR,frp,br,co,ca,eu,oc"},{"ISO3166-1-Alpha-2":"GF","Languages":"fr-GF"},{"ISO3166-1-Alpha-2":"PF","Languages":"fr-PF,ty"},{"ISO3166-1-Alpha-2":"TF","Languages":"fr"},{"ISO3166-1-Alpha-2":"GA","Languages":"fr-GA"},{"ISO3166-1-Alpha-2":"GM","Languages":"en-GM,mnk,wof,wo,ff"},{"ISO3166-1-Alpha-2":"GE","Languages":"ka,ru,hy,az"},{"ISO3166-1-Alpha-2":"DE","Languages":"de"},{"ISO3166-1-Alpha-2":"GH","Languages":"en-GH,ak,ee,tw"},{"ISO3166-1-Alpha-2":"GI","Languages":"en-GI,es,it,pt"},{"ISO3166-1-Alpha-2":"GR","Languages":"el-GR,en,fr"},{"ISO3166-1-Alpha-2":"GL","Languages":"kl,da-GL,en"},{"ISO3166-1-Alpha-2":"GD","Languages":"en-GD"},{"ISO3166-1-Alpha-2":"GP","Languages":"fr-GP"},{"ISO3166-1-Alpha-2":"GU","Languages":"en-GU,ch-GU"},{"ISO3166-1-Alpha-2":"GT","Languages":"es-GT"},{"ISO3166-1-Alpha-2":"GG","Languages":"en,fr"},{"ISO3166-1-Alpha-2":"GN","Languages":"fr-GN"},{"ISO3166-1-Alpha-2":"GW","Languages":"pt-GW,pov"},{"ISO3166-1-Alpha-2":"GY","Languages":"en-GY"},{"ISO3166-1-Alpha-2":"HT","Languages":"ht,fr-HT"},{"ISO3166-1-Alpha-2":"HM","Languages":null},{"ISO3166-1-Alpha-2":"VA","Languages":"la,it,fr"},{"ISO3166-1-Alpha-2":"HN","Languages":"es-HN"},{"ISO3166-1-Alpha-2":"HU","Languages":"hu-HU"},{"ISO3166-1-Alpha-2":"IS","Languages":"is,en,de,da,sv,no"},{"ISO3166-1-Alpha-2":"IN","Languages":"en-IN,hi,bn,te,mr,ta,ur,gu,kn,ml,or,pa,as,bh,sat,ks,ne,sd,kok,doi,mni,sit,sa,fr,lus,inc"},{"ISO3166-1-Alpha-2":"ID","Languages":"id,en,nl,jv"},{"ISO3166-1-Alpha-2":"IR","Languages":"fa-IR,ku"},{"ISO3166-1-Alpha-2":"IQ","Languages":"ar-IQ,ku,hy"},{"ISO3166-1-Alpha-2":"IE","Languages":"en-IE,ga-IE"},{"ISO3166-1-Alpha-2":"IM","Languages":"en,gv"},{"ISO3166-1-Alpha-2":"IL","Languages":"he,ar-IL,en-IL,"},{"ISO3166-1-Alpha-2":"IT","Languages":"it-IT,de-IT,fr-IT,sc,ca,co,sl"},{"ISO3166-1-Alpha-2":"JM","Languages":"en-JM"},{"ISO3166-1-Alpha-2":"JP","Languages":"ja"},{"ISO3166-1-Alpha-2":"JE","Languages":"en,pt"},{"ISO3166-1-Alpha-2":"JO","Languages":"ar-JO,en"},{"ISO3166-1-Alpha-2":"KZ","Languages":"kk,ru"},{"ISO3166-1-Alpha-2":"KE","Languages":"en-KE,sw-KE"},{"ISO3166-1-Alpha-2":"KI","Languages":"en-KI,gil"},{"ISO3166-1-Alpha-2":"KW","Languages":"ar-KW,en"},{"ISO3166-1-Alpha-2":"KG","Languages":"ky,uz,ru"},{"ISO3166-1-Alpha-2":"LA","Languages":"lo,fr,en"},{"ISO3166-1-Alpha-2":"LV","Languages":"lv,ru,lt"},{"ISO3166-1-Alpha-2":"LB","Languages":"ar-LB,fr-LB,en,hy"},{"ISO3166-1-Alpha-2":"LS","Languages":"en-LS,st,zu,xh"},{"ISO3166-1-Alpha-2":"LR","Languages":"en-LR"},{"ISO3166-1-Alpha-2":"LY","Languages":"ar-LY,it,en"},{"ISO3166-1-Alpha-2":"LI","Languages":"de-LI"},{"ISO3166-1-Alpha-2":"LT","Languages":"lt,ru,pl"},{"ISO3166-1-Alpha-2":"LU","Languages":"lb,de-LU,fr-LU"},{"ISO3166-1-Alpha-2":"MG","Languages":"fr-MG,mg"},{"ISO3166-1-Alpha-2":"MW","Languages":"ny,yao,tum,swk"},{"ISO3166-1-Alpha-2":"MY","Languages":"ms-MY,en,zh,ta,te,ml,pa,th"},{"ISO3166-1-Alpha-2":"MV","Languages":"dv,en"},{"ISO3166-1-Alpha-2":"ML","Languages":"fr-ML,bm"},{"ISO3166-1-Alpha-2":"MT","Languages":"mt,en-MT"},{"ISO3166-1-Alpha-2":"MH","Languages":"mh,en-MH"},{"ISO3166-1-Alpha-2":"MQ","Languages":"fr-MQ"},{"ISO3166-1-Alpha-2":"MR","Languages":"ar-MR,fuc,snk,fr,mey,wo"},{"ISO3166-1-Alpha-2":"MU","Languages":"en-MU,bho,fr"},{"ISO3166-1-Alpha-2":"YT","Languages":"fr-YT"},{"ISO3166-1-Alpha-2":"MX","Languages":"es-MX"},{"ISO3166-1-Alpha-2":"FM","Languages":"en-FM,chk,pon,yap,kos,uli,woe,nkr,kpg"},{"ISO3166-1-Alpha-2":"MC","Languages":"fr-MC,en,it"},{"ISO3166-1-Alpha-2":"MN","Languages":"mn,ru"},{"ISO3166-1-Alpha-2":"ME","Languages":"sr,hu,bs,sq,hr,rom"},{"ISO3166-1-Alpha-2":"MS","Languages":"en-MS"},{"ISO3166-1-Alpha-2":"MA","Languages":"ar-MA,ber,fr"},{"ISO3166-1-Alpha-2":"MZ","Languages":"pt-MZ,vmw"},{"ISO3166-1-Alpha-2":"MM","Languages":"my"},{"ISO3166-1-Alpha-2":"NA","Languages":"en-NA,af,de,hz,naq"},{"ISO3166-1-Alpha-2":"NR","Languages":"na,en-NR"},{"ISO3166-1-Alpha-2":"NP","Languages":"ne,en"},{"ISO3166-1-Alpha-2":"NL","Languages":"nl-NL,fy-NL"},{"ISO3166-1-Alpha-2":"NC","Languages":"fr-NC"},{"ISO3166-1-Alpha-2":"NZ","Languages":"en-NZ,mi"},{"ISO3166-1-Alpha-2":"NI","Languages":"es-NI,en"},{"ISO3166-1-Alpha-2":"NE","Languages":"fr-NE,ha,kr,dje"},{"ISO3166-1-Alpha-2":"NG","Languages":"en-NG,ha,yo,ig,ff"},{"ISO3166-1-Alpha-2":"NU","Languages":"niu,en-NU"},{"ISO3166-1-Alpha-2":"NF","Languages":"en-NF"},{"ISO3166-1-Alpha-2":"MP","Languages":"fil,tl,zh,ch-MP,en-MP"},{"ISO3166-1-Alpha-2":"NO","Languages":"no,nb,nn,se,fi"},{"ISO3166-1-Alpha-2":"OM","Languages":"ar-OM,en,bal,ur"},{"ISO3166-1-Alpha-2":"PK","Languages":"ur-PK,en-PK,pa,sd,ps,brh"},{"ISO3166-1-Alpha-2":"PW","Languages":"pau,sov,en-PW,tox,ja,fil,zh"},{"ISO3166-1-Alpha-2":"PA","Languages":"es-PA,en"},{"ISO3166-1-Alpha-2":"PG","Languages":"en-PG,ho,meu,tpi"},{"ISO3166-1-Alpha-2":"PY","Languages":"es-PY,gn"},{"ISO3166-1-Alpha-2":"PE","Languages":"es-PE,qu,ay"},{"ISO3166-1-Alpha-2":"PH","Languages":"tl,en-PH,fil"},{"ISO3166-1-Alpha-2":"PN","Languages":"en-PN"},{"ISO3166-1-Alpha-2":"PL","Languages":"pl"},{"ISO3166-1-Alpha-2":"PT","Languages":"pt-PT,mwl"},{"ISO3166-1-Alpha-2":"PR","Languages":"en-PR,es-PR"},{"ISO3166-1-Alpha-2":"QA","Languages":"ar-QA,es"},{"ISO3166-1-Alpha-2":"KR","Languages":"ko-KR,en"},{"ISO3166-1-Alpha-2":"MD","Languages":"ro,ru,gag,tr"},{"ISO3166-1-Alpha-2":"RO","Languages":"ro,hu,rom"},{"ISO3166-1-Alpha-2":"RU","Languages":"ru,tt,xal,cau,ady,kv,ce,tyv,cv,udm,tut,mns,bua,myv,mdf,chm,ba,inh,tut,kbd,krc,av,sah,nog"},{"ISO3166-1-Alpha-2":"RW","Languages":"rw,en-RW,fr-RW,sw"},{"ISO3166-1-Alpha-2":"RE","Languages":"fr-RE"},{"ISO3166-1-Alpha-2":"BL","Languages":"fr"},{"ISO3166-1-Alpha-2":"SH","Languages":"en-SH"},{"ISO3166-1-Alpha-2":"KN","Languages":"en-KN"},{"ISO3166-1-Alpha-2":"LC","Languages":"en-LC"},{"ISO3166-1-Alpha-2":"MF","Languages":"fr"},{"ISO3166-1-Alpha-2":"PM","Languages":"fr-PM"},{"ISO3166-1-Alpha-2":"VC","Languages":"en-VC,fr"},{"ISO3166-1-Alpha-2":"WS","Languages":"sm,en-WS"},{"ISO3166-1-Alpha-2":"SM","Languages":"it-SM"},{"ISO3166-1-Alpha-2":"ST","Languages":"pt-ST"},{"ISO3166-1-Alpha-2":null,"Languages":null},{"ISO3166-1-Alpha-2":"SA","Languages":"ar-SA"},{"ISO3166-1-Alpha-2":"SN","Languages":"fr-SN,wo,fuc,mnk"},{"ISO3166-1-Alpha-2":"RS","Languages":"sr,hu,bs,rom"},{"ISO3166-1-Alpha-2":"SC","Languages":"en-SC,fr-SC"},{"ISO3166-1-Alpha-2":"SL","Languages":"en-SL,men,tem"},{"ISO3166-1-Alpha-2":"SG","Languages":"cmn,en-SG,ms-SG,ta-SG,zh-SG"},{"ISO3166-1-Alpha-2":"SX","Languages":"nl,en"},{"ISO3166-1-Alpha-2":"SK","Languages":"sk,hu"},{"ISO3166-1-Alpha-2":"SI","Languages":"sl,sh"},{"ISO3166-1-Alpha-2":"SB","Languages":"en-SB,tpi"},{"ISO3166-1-Alpha-2":"SO","Languages":"so-SO,ar-SO,it,en-SO"},{"ISO3166-1-Alpha-2":"ZA","Languages":"zu,xh,af,nso,en-ZA,tn,st,ts,ss,ve,nr"},{"ISO3166-1-Alpha-2":"GS","Languages":"en"},{"ISO3166-1-Alpha-2":"SS","Languages":"en"},{"ISO3166-1-Alpha-2":"ES","Languages":"es-ES,ca,gl,eu,oc"},{"ISO3166-1-Alpha-2":"LK","Languages":"si,ta,en"},{"ISO3166-1-Alpha-2":"PS","Languages":"ar-PS"},{"ISO3166-1-Alpha-2":"SD","Languages":"ar-SD,en,fia"},{"ISO3166-1-Alpha-2":"SR","Languages":"nl-SR,en,srn,hns,jv"},{"ISO3166-1-Alpha-2":"SJ","Languages":"no,ru"},{"ISO3166-1-Alpha-2":"SZ","Languages":"en-SZ,ss-SZ"},{"ISO3166-1-Alpha-2":"SE","Languages":"sv-SE,se,sma,fi-SE"},{"ISO3166-1-Alpha-2":"CH","Languages":"de-CH,fr-CH,it-CH,rm"},{"ISO3166-1-Alpha-2":"SY","Languages":"ar-SY,ku,hy,arc,fr,en"},{"ISO3166-1-Alpha-2":"TJ","Languages":"tg,ru"},{"ISO3166-1-Alpha-2":"TH","Languages":"th,en"},{"ISO3166-1-Alpha-2":"MK","Languages":"mk,sq,tr,rmm,sr"},{"ISO3166-1-Alpha-2":"TL","Languages":"tet,pt-TL,id,en"},{"ISO3166-1-Alpha-2":"TG","Languages":"fr-TG,ee,hna,kbp,dag,ha"},{"ISO3166-1-Alpha-2":"TK","Languages":"tkl,en-TK"},{"ISO3166-1-Alpha-2":"TO","Languages":"to,en-TO"},{"ISO3166-1-Alpha-2":"TT","Languages":"en-TT,hns,fr,es,zh"},{"ISO3166-1-Alpha-2":"TN","Languages":"ar-TN,fr"},{"ISO3166-1-Alpha-2":"TR","Languages":"tr-TR,ku,diq,az,av"},{"ISO3166-1-Alpha-2":"TM","Languages":"tk,ru,uz"},{"ISO3166-1-Alpha-2":"TC","Languages":"en-TC"},{"ISO3166-1-Alpha-2":"TV","Languages":"tvl,en,sm,gil"},{"ISO3166-1-Alpha-2":"UG","Languages":"en-UG,lg,sw,ar"},{"ISO3166-1-Alpha-2":"UA","Languages":"uk,ru-UA,rom,pl,hu"},{"ISO3166-1-Alpha-2":"AE","Languages":"ar-AE,fa,en,hi,ur"},{"ISO3166-1-Alpha-2":"GB","Languages":"en-GB,cy-GB,gd"},{"ISO3166-1-Alpha-2":"TZ","Languages":"sw-TZ,en,ar"},{"ISO3166-1-Alpha-2":"UM","Languages":"en-UM"},{"ISO3166-1-Alpha-2":"VI","Languages":"en-VI"},{"ISO3166-1-Alpha-2":"US","Languages":"en-US,es-US,haw,fr"},{"ISO3166-1-Alpha-2":"UY","Languages":"es-UY"},{"ISO3166-1-Alpha-2":"UZ","Languages":"uz,ru,tg"},{"ISO3166-1-Alpha-2":"VU","Languages":"bi,en-VU,fr-VU"},{"ISO3166-1-Alpha-2":"VE","Languages":"es-VE"},{"ISO3166-1-Alpha-2":"VN","Languages":"vi,en,fr,zh,km"},{"ISO3166-1-Alpha-2":"WF","Languages":"wls,fud,fr-WF"},{"ISO3166-1-Alpha-2":"EH","Languages":"ar,mey"},{"ISO3166-1-Alpha-2":"YE","Languages":"ar-YE"},{"ISO3166-1-Alpha-2":"ZM","Languages":"en-ZM,bem,loz,lun,lue,ny,toi"},{"ISO3166-1-Alpha-2":"ZW","Languages":"en-ZW,sn,nr,nd"},{"ISO3166-1-Alpha-2":"AX","Languages":"sv-AX"}]').forEach((function(e){if(null===e["ISO3166-1-Alpha-2"]||2!==e["ISO3166-1-Alpha-2"].length||null===e.Languages)return;const t=gs.findIndex((t=>t.shortcode.toUpperCase()===e["ISO3166-1-Alpha-2"].toUpperCase()));if(-1===t)return;const n=e.Languages.split(",")[0].split("-")[0];2===n.length&&(gs[t].mainLanguage=n)}));const hs=new pylon.KVNamespace("translation");class ws{constructor(e){return this.id=e,this.translations=new Array,this}}async function ys(){const e=await hs.get("translatedMessages");if(!Array.isArray(e))return;const t=e.filter((function(e){const t=new Date(q(e.id).timestamp).getTime();return!((new Date).getTime()-t>36e6)}));si(t,e)||await hs.put("translatedMessages",t)}async function Es(e,t,n){Array.isArray(e)||(e=[]);const i=e.findIndex((e=>e.id===t)),a=new ws(t);if(a.translations.push(n),!Array.isArray(e)||null===e){const e=[];return e.push(a),void await hs.put("translatedMessages",e)}i>-1?e[i].translations.push(n):e.push(a),await hs.put("translatedMessages",e)}async function Ds(e,t,n,i,a,s){const o=new discord.Embed;o.setAuthor({name:t.author.getTag(),iconUrl:t.author.getAvatarUrl(),url:`https://discord.com/channels/${e.guildId}/${e.id}/${t.id}`}),o.setThumbnail({url:"https://icons-for-free.com/iconfiles/png/512/language+text+translate+translation+icon-1320183416086707155.png",height:128,width:128}),o.setTitle(`${i} ➡️ ${a}`).setColor(65280),o.setDescription(s),o.setFooter({iconUrl:n.getAvatarUrl(),text:B(U.modules.translation.tr_terms.requested_by,["user_tag",n.getTag(),"user_id",n.id])}),o.setTimestamp((new Date).toISOString()),await e.sendMessage({embed:o})}var _s=Object.freeze({__proto__:null,cleanPool:ys,translationEmbed:Ds,OnMessageReactionAdd:async function(e,t,n){if(!(n.member instanceof discord.GuildMember))return;if(!n.emoji)return;if("UNICODE"!==n.emoji.type||!0===n.emoji.animated||"string"!=typeof n.emoji.name||null!==n.emoji.id)return;if(null===n.member)return;if(!0===n.member.user.bot)return;if(hn(n.member)){const e=`<>[→ ${U.modules.translation.tr_terms.jump_message}](https://discord.com/channels/{GUILD_ID}/{CHANNEL_ID}/{MESSAGE_ID})`.split("CHANNEL_ID").join(n.channelId).split("GUILD_ID").join(t).split("MESSAGE_ID").join(n.messageId);return void await In(n.member,`translation reaction attempt on <#${n.channelId}> on a message by <@!${n.userId}> ${e}`)}const i=n.emoji;if(!i)return;const a=function(e){if("🏳️‍🌈"===e)return"pride";if("🏴‍☠️"===e)return"piratespeak";const t=gs.find((t=>"string"==typeof t.flag?t.flag===e:t.flag.indexOf(e)>-1));if(void 0===t)return null;const n=ps.find((e=>e.shortcode.split("-")[0].split(",")[0]===t.mainLanguage));return void 0===n?null:n}(i.name);if(null===a)return;const s=await discord.getChannel(n.channelId);if(!(s instanceof discord.GuildTextChannel))return;if(!s.canMember(n.member,2048))return;const o=await s.getMessage(n.messageId);if(null===o)return;if(o.content.length<2||null!==o.webhookId||null===o.author||!0===o.author.bot)return;if("object"!=typeof f.modules.translation||"object"!=typeof f.modules.translation.googleApi||"string"!=typeof f.modules.translation.googleApi.key||f.modules.translation.googleApi.key.length<5)return;if("number"==typeof f.modules.translation.level){if(!await wn(f.modules.translation.level,n.member))return}const r=await hs.get("translatedMessages"),l=await s.getGuild(),u=await l.getMember(discord.getBotId());let d=a;if("object"==typeof a&&(d=a.shortcode),Array.isArray(r)){if(void 0!==r.find((e=>e.id===o.id&&e.translations.indexOf(d)>-1)))return null!==u&&s.canMember(u,8192)&&await o.deleteReaction(n.emoji.name,n.userId),!1}if("pride"===a)return!1;if("piratespeak"===a){await Es(r,o.id,a);if(void 0===(await async function(e){const t=`?${vn({q:e,key:f.modules.translation.googleApi.key})}`,n=new Request(`https://translation.googleapis.com/language/translate/v2/detect${t}`,{method:"POST"}),i=await(await fetch(n)).json();if("object"==typeof i.error)throw Zn(i),new Error(i.error.message);if(!Array.isArray(i.data.detections)||i.data.detections<1)throw Zn(i),new Error(i);return i.data.detections[0]}(o.content)).find((e=>"en"===e.language&&e.confidence>=.9))){return zi(await s.sendMessage(B(U.modules.translation.tr_terms.pirate_api.only_english,["user_mention",n.member.toMention()]))),!1}const e=await async function(e){const t=new Request("https://api.funtranslations.com/translate/pirate.json",{method:"POST",body:JSON.stringify({text:e}),headers:{"Content-Type":"application/json",Accept:"application/json"}}),n=await(await fetch(t)).json();return"object"!=typeof n.contents?n:n.contents.translated}(o.content);if("string"!=typeof e){return zi(await s.sendMessage(B(U.modules.translation.tr_terms.pirate_api.random_fail,["user_mention",n.member.toMention()]))),!1}if(e.toLowerCase()===o.content.toLowerCase()){return zi(await s.sendMessage(B(U.modules.translation.tr_terms.pirate_api.lol_shit_api,["user_mention",n.member.toMention()]))),!1}return await Ds(s,o,n.member.user,"English","🏴‍☠️<:pirate:713103123912065024>🏴‍☠️",e),!1}if(!(a instanceof cs))return;const c=await Cn(o.content,a.shortcode),m=ps.find((e=>e.shortcode===c.detectedSourceLanguage)),g=m?m.name:c.detectedSourceLanguage;if(await Es(r,o.id,a.shortcode),g===a.name||o.content.toLowerCase()===c.translatedText.toLowerCase()){return zi(await s.sendMessage(B(U.modules.translation.tr_terms.cant_translate,["user_mention",n.member.toMention()]))),null!==u&&s.canMember(u,8192)&&await o.deleteReaction(n.emoji.name,n.userId),!1}return await Ds(s,o,n.member.user,g,a.name,c.translatedText),!1}});class bs{constructor(e,t){return this.memberId=e,this.roleId=t,this}}const As=new li({name:"customUserRoles",idProperty:"memberId",local:!1});class Is{constructor(e,t,n,i,a){return this.expires=t,this.id=e,this.authorId=n,this.channelId=i,this.content=a,this}}const vs=new li({name:"reminders",idProperty:"id",local:!1});async function Cs(){const e=await vs.getAll();0!==e.length&&await Promise.all(e.map((async e=>{if(Date.now()-e.expires>=0){const t=await discord.getGuild();if(null===t)return;const n=await t.getMember(e.authorId);if(null===n)return;const i=await discord.getChannel(e.channelId);if(!(i&&null!==i&&(i instanceof discord.GuildTextChannel||i instanceof discord.GuildNewsChannel)))return;const a=q(e.id).timestamp;U.time_units.months.mo_short.january,U.time_units.months.mo_short.february,U.time_units.months.mo_short.march,U.time_units.months.mo_short.april,U.time_units.months.mo_short.may,U.time_units.months.mo_short.june,U.time_units.months.mo_short.july,U.time_units.months.mo_short.august,U.time_units.months.mo_short.september,U.time_units.months.mo_short.october,U.time_units.months.mo_short.november,U.time_units.months.mo_short.december,Y(a);let s=!1;try{const t=await i.getMessage(e.id);t&&t instanceof discord.Message&&(s=!0)}catch(e){}const o=await K(e.content);await i.sendMessage({reply:!0===s?e.id:null,allowedMentions:{users:[e.authorId]},content:B(U.modules.utilities.reminders.remind_message,["user_mention",n.toMention(),"time_ago",Y(a,"R"),"reminder_text",o])}),await vs.editPool(e.id,null)}})))}async function Ss(e,t,n){const i=Kn(t);if(0===i)return void await e.respondEphemeral(U.modules.utilities.time_improper);if(i<12e4||i>27648e5)return void await e.respondEphemeral(U.modules.utilities.reminders.reminder_time_limit);const a=Vn(i,2,!1,U.time_units.ti_full.singular.second);(await vs.getByQuery({authorId:e.member.user.id})).length>=10?await e.respondEphemeral(U.modules.utilities.reminders.reminder_count_limit):(n=(n=Qn(n)).split("\n").join(" ").split("\t").join(" ")).length>1e3?await e.respondEphemeral(U.modules.utilities.reminders.reminder_content_limit):(await vs.saveToPool(new Is(z(),Date.now()+i,e.member.user.id,e.channelId,n)),await e.respondEphemeral(B(U.modules.utilities.reminders.will_remind_in,["duration",a,"time",Y(Date.now()+i)])))}async function Ms(e,t,n){zi(await e.inlineReply((async()=>{const i=Kn(t);if(0===i)return U.modules.utilities.time_improper;if(i<12e4||i>27648e5)return U.modules.utilities.reminders.reminder_time_limit;const a=Vn(i,2,!1,U.time_units.ti_full.singular.second);return(await vs.getByQuery({authorId:e.author.id})).length>=10?U.modules.utilities.reminders.reminder_count_limit:(n=(n=Qn(n)).split("\n").join(" ").split("\t").join(" ")).length>1e3?U.modules.utilities.reminders.reminder_content_limit:(await vs.saveToPool(new Is(e.id,Date.now()+i,e.author.id,e.channelId,n)),B(U.modules.utilities.reminders.will_remind_in,["duration",a,"time",Y(Date.now()+i)]))})))}async function Ts(e){const t=await vs.getByQuery({authorId:e.member.user.id});if(0===t.length)return void await e.respondEphemeral(U.modules.utilities.reminders.no_reminders);const n=t.map((e=>e.id));await vs.editPools(n,(()=>null)),await e.respondEphemeral(B(U.modules.utilities.reminders.cleared_reminders,["count",n.length.toString()]))}async function Os(e){zi(await e.inlineReply((async()=>{const t=await vs.getByQuery({authorId:e.author.id});if(0===t.length)return U.modules.utilities.reminders.no_reminders;const n=t.map((e=>e.id));return await vs.editPools(n,(()=>null)),B(U.modules.utilities.reminders.cleared_reminders,["count",n.length.toString()])})))}const Rs=new pylon.KVNamespace("snipe");function Ns(){return"object"==typeof f.modules.utilities.customUserRoles&&!0===f.modules.utilities.customUserRoles.enabled}async function Ls(){if("object"!=typeof f.modules.utilities.customUserRoles||"boolean"!=typeof f.modules.utilities.customUserRoles.enabled||!0!==f.modules.utilities.customUserRoles.enabled)return;const e=await As.getAll(),t=await discord.getGuild(),n=(await t.getRoles()).filter((t=>void 0!==e.find((e=>e.roleId===t.id))));n.length>0&&await Promise.all(n.map((async e=>{!0!==e.mentionable&&!0!==e.hoist&&new ee(e.permissions).bitfield===BigInt(0)||await e.edit({mentionable:!1,hoist:!1,permissions:0})})))}async function ks(e){if("object"!=typeof f.modules.utilities.customUserRoles||"boolean"!=typeof f.modules.utilities.customUserRoles.enabled||!0!==f.modules.utilities.customUserRoles.enabled)return;const t=await As.getById(e);if(t){const e=await discord.getGuild(),n=await e.getRole(t.roleId);null!==n&&await n.delete()}}async function Gs(){if("object"!=typeof f.modules.utilities.customUserRoles||"boolean"!=typeof f.modules.utilities.customUserRoles.enabled||!0!==f.modules.utilities.customUserRoles.enabled)return;const e=await As.getAll(),t=await discord.getGuild(),n=await t.getRoles(),i=e.filter((e=>void 0===n.find((t=>t.id===e.roleId))));i.length>0&&await As.editPools(i.map((e=>e.memberId)),(()=>null))}async function $s(e,t){if("object"!=typeof f.modules.utilities.customUserRoles||"boolean"!=typeof f.modules.utilities.customUserRoles.enabled||!0!==f.modules.utilities.customUserRoles.enabled)return;const n=new bs(e,t);await As.saveToPool(n)}async function Us(e){if("object"!=typeof f.modules.utilities.customUserRoles||"boolean"!=typeof f.modules.utilities.customUserRoles.enabled||!0!==f.modules.utilities.customUserRoles.enabled)return;const t=await As.getById(e.user.id);if(void 0===t)return;const n=await discord.getGuild(),i=await n.getRole(t.roleId);if(null!==i&&!e.roles.includes(i.id)){await Ls();try{await e.addRole(i.id)}catch(e){}}}const Bs=Ei({name:"cur",description:"Custom user roles"},{module:"utilities"});Bs&&(Di(Bs,{name:"check",description:"Checks what your current custom role is"},(async e=>{if(!Ns())return await e.respondEphemeral(U.modules.utilities.curs.not_enabled),!1;const t=await As.getById(e.member.user.id);if(!t)return await e.respondEphemeral(U.modules.utilities.curs.dont_have_role),!1;await e.respondEphemeral(B(U.modules.utilities.curs.check_role_slash,["user_mention",e.member.user.toMention(),"role_mention",`<@&${t.roleId}>`]))}),{parent:"cur",staticAck:!1,module:"utilities",permissions:{overrideableInfo:"utilities.cur",level:w.Guest}}),Di(Bs,{name:"name",description:"Changes the name of your custom role",options:e=>({name:e.string({required:!0,description:"New name of the role"})})},(async(e,{name:t})=>{if(!Ns())return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.not_enabled),!1;const n=await As.getById(e.member.user.id);if(!n)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.dont_have_role),!1;if(t.length<2||t.length>32)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.character_limit),!1;const i=await e.getGuild(),a=await i.getRole(n.roleId);if(!a)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.role_not_found),!1;await a.edit({name:t}),await e.acknowledge({ephemeral:!1}),await _i(e,{allowedMentions:{users:[e.member.user.id]},content:B(U.modules.utilities.curs.changed_role_name,["role_name",Qn(t,!0)])})}),{parent:"cur",module:"utilities",permissions:{overrideableInfo:"utilities.cur.name",level:w.Guest}}),Di(Bs,{name:"color",description:"Changes the color of your custom role",options:e=>({color:e.string({required:!1,description:"New color of the role (#ffffff format) -- Not passing this argument removes the color of your role"})})},(async(e,{color:t})=>{if(!Ns())return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.not_enabled),!1;const n=await As.getById(e.member.user.id);if(!n)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.dont_have_role),!1;if("string"==typeof t&&t.includes("#")&&(t=t.split("#").join("")),"string"==typeof t&&6!==t.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.color_wrong_format),!1;const i=await e.getGuild(),a=await i.getRole(n.roleId);if(!a)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.role_not_found),!1;await e.acknowledge({ephemeral:!1}),await a.edit({color:"string"==typeof t?parseInt(t,16):0}),await _i(e,{allowedMentions:{users:[e.member.user.id]},content:B(U.modules.utilities.curs.changed_role_color,["color","string"==typeof t?`#${t}`:"None"])})}),{parent:"cur",module:"utilities",permissions:{overrideableInfo:"utilities.cur.color",level:w.Guest}}),Di(Bs,{name:"set",description:"Sets a user's custom role",options:e=>({target:e.guildMember({required:!0,description:"User to set the role"}),role:e.guildRole({required:!0,description:"The role to set to this user"})})},(async(e,{target:t,role:n})=>{if(!Ns())return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.not_enabled),!1;if(!(n&&n instanceof discord.Role))return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.role_not_found),!1;if(await As.exists(t.user.id))return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.already_has_role),!1;const i=await As.getByQuery({roleId:n.id});if(Array.isArray(i)&&i.length>0)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(B(U.modules.utilities.curs.already_assigned_to,["user_mention",`<@!${i[0].memberId}>`])),!1;await e.acknowledge({ephemeral:!1}),await $s(t.user.id,n.id),await Ls(),t.roles.includes(n.id)||await t.addRole(n.id),await _i(e,{allowedMentions:{users:[e.member.user.id]},content:B(U.modules.utilities.curs.set_role,["user_mention",t.toMention(),"role_mention",n.toMention()])})}),{parent:"cur",module:"utilities",permissions:{overrideableInfo:"utilities.cur.set",level:w.Administrator}}),Di(Bs,{name:"clear",description:"Clear a user's assigned custom role",options:e=>({target:e.guildMember({required:!0,description:"User to clear role from"})})},(async(e,{target:t})=>{if(!Ns())return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.not_enabled),!1;const n=await As.getById(t.user.id);if(!n)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.has_no_role),!1;await e.acknowledge({ephemeral:!1});const i=n.roleId,a=await e.getGuild(),s=await a.getRole(i);await As.editPool(t.user.id,null),s instanceof discord.Role&&t.roles.includes(s.id)&&await t.removeRole(s.id),await _i(e,{allowedMentions:{users:[e.member.user.id]},content:B(U.modules.utilities.curs.cleared_role,["user_mention",t.user.toMention()])})}),{parent:"cur",module:"utilities",permissions:{overrideableInfo:"utilities.cur.clear",level:w.Administrator}}),Di(Bs,{name:"delete",description:"Delete a user's assigned custom role (from the server)",options:e=>({target:e.guildMember({required:!0,description:"User to delete role from"})})},(async(e,{target:t})=>{if(!Ns())return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.not_enabled),!1;const n=await As.getById(t.user.id);if(!n)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.has_no_role),!1;const i=n.roleId,a=await e.getGuild();if(!(await a.getRole(i)instanceof discord.Role))return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.curs.role_not_found),!1;await e.acknowledge({ephemeral:!1}),await ks(t.user.id),await _i(e,{allowedMentions:{users:[e.member.user.id]},content:B(U.modules.utilities.curs.deleted_role,["user_mention",t.user.toMention()])})}),{parent:"cur",module:"utilities",permissions:{overrideableInfo:"utilities.cur.delete",level:w.Administrator}})),yi({name:"snipe",description:"Snipes the latest user-deleted message"},(async e=>{let t=await Rs.get(e.channelId);if("string"==typeof t&&(t=JSON.parse(t)),void 0===t||"object"!=typeof t.author||"string"!=typeof t.id)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.snipe.no_message),!1;if(t.author.id===e.member.user.id&&!e.member.can(8))return await e.acknowledge({ephemeral:!0}),void await e.respondEphemeral(U.modules.utilities.snipe.no_message);const n=new discord.Embed,i=await H(t.author.id);if(!i)return await e.acknowledge({ephemeral:!0}),void await e.respondEphemeral(U.modules.utilities.snipe.user_not_found);await e.acknowledge({ephemeral:!1}),n.setAuthor({name:i.getTag(),iconUrl:i.getAvatarUrl()}),n.setTimestamp(new Date(q(t.id).timestamp).toISOString()),n.setFooter({iconUrl:e.member.user.getAvatarUrl(),text:B(U.modules.utilities.snipe.requested_by,["user_tag",e.member.user.getTag()])}),n.setDescription(t.content),n.setColor(261202),await Rs.delete(e.channelId),await _i(e,{embed:n,content:B(U.modules.utilities.snipe.said,["user_mention",i.toMention()]),allowedMentions:{}})}),{module:"utilities",permissions:{overrideableInfo:"utilities.snipe",level:w.Authorized}}),yi({name:"avatar",description:"Gets a user's avatar",options:e=>({user:e.guildMember({description:"User",required:!1})})},(async(e,{user:t})=>{t=t?t.user:e.member.user;const n=new discord.Embed;n.setAuthor({iconUrl:t.getAvatarUrl(),name:t.getTag()}),n.setDescription(B(U.modules.utilities.avatar.avatar_of,["user_tag",t.getTag(),"avatar_url",`<${t.getAvatarUrl()}>`])),n.setFooter({text:B(U.modules.utilities.avatar.requested_by,["user_tag",e.member.user.getTag(),"user_id",e.member.user.id])}),n.setTimestamp((new Date).toISOString()),n.setImage({url:t.getAvatarUrl()}),await _i(e,{embed:n})}),{module:"utilities",permissions:{overrideableInfo:"utilities.avatar",level:w.Guest},staticAck:!0});const Fs=Ei({name:"remind",description:"Reminders"},{module:"utilities"});Fs&&(Di(Fs,{name:"add",description:"Adds a reminder",options:e=>({when:e.string({description:"When to remind you (1h30m format)"}),text:e.string({description:"The reminder"})})},(async(e,{when:t,text:n})=>(await Ss(e,t,n),!1)),{parent:"remind",staticAck:!1,permissions:{overrideableInfo:"utilities.remind.add",level:w.Guest},module:"utilities"}),Di(Fs,{name:"clear",description:"Clears all your reminders"},(async e=>(await Ts(e),!1)),{parent:"remind",staticAck:!1,permissions:{overrideableInfo:"utilities.remind.clear",level:w.Guest},module:"utilities"}));const Ps=Ei({name:"random",description:"RNG Commands"},{module:"utilities"});Ps&&(Di(Ps,{name:"coin",description:"Flips a coin"},(async e=>{const t=Xn(1,2);await _i(e,B(U.modules.utilities.random.coin,["result",1===t?U.modules.utilities.random.coin_heads:U.modules.utilities.random.coin_tails]))}),{parent:"random",staticAck:!0,permissions:{overrideableInfo:"utilities.random.coin",level:w.Guest},module:"utilities"}),Di(Ps,{name:"number",description:"Gets a random number between 2 values",options:e=>({minimum:e.integer({required:!0,description:"The minimum value"}),maximum:e.integer({required:!0,description:"The maximum value"})})},(async(e,{minimum:t,maximum:n})=>{if(t>=n)return void await e.respondEphemeral(U.modules.utilities.random.number_minimum_wrong);const i=Xn(t,n);await _i(e,B(U.modules.utilities.random.number,["minimum",t.toString(),"maximum",n.toString(),"result",i.toString()]))}),{parent:"random",staticAck:!0,permissions:{overrideableInfo:"utilities.random.number",level:w.Guest},module:"utilities"}),Di(Ps,{name:"cat",description:"Gets a random cat image"},(async e=>{await e.acknowledge({ephemeral:!1});const t=await(await fetch("http://aws.random.cat/meow")).json(),n=new discord.Embed;n.setImage({url:t.file}),await _i(e,{embed:n})}),{parent:"random",module:"utilities",permissions:{overrideableInfo:"utilities.random.cat",level:w.Guest}}),Di(Ps,{name:"dog",description:"Gets a random dog image"},(async e=>{await e.acknowledge({ephemeral:!1});const t=await(await fetch("https://random.dog/woof.json")).json(),n=new discord.Embed;n.setImage({url:t.url}),await _i(e,{embed:n})}),{parent:"random",module:"utilities",permissions:{overrideableInfo:"utilities.random.dog",level:w.Guest}}),Di(Ps,{name:"doge",description:"Gets a random shiba inu image"},(async e=>{await e.acknowledge({ephemeral:!1});const t=await(await fetch("https://dog.ceo/api/breed/shiba/images/random")).json(),n=new discord.Embed;n.setImage({url:t.message}),await _i(e,{embed:n})}),{parent:"random",module:"utilities",permissions:{overrideableInfo:"utilities.random.doge",level:w.Guest}}),Di(Ps,{name:"fox",description:"Gets a random fox image"},(async e=>{await e.acknowledge({ephemeral:!1});const t=await(await fetch("https://randomfox.ca/floof/")).json(),n=new discord.Embed;n.setImage({url:t.image}),await _i(e,{embed:n})}),{parent:"random",module:"utilities",permissions:{overrideableInfo:"utilities.random.fox",level:w.Guest}}),Di(Ps,{name:"pikachu",description:"Gets a random pikachu image"},(async e=>{await e.acknowledge({ephemeral:!1});const t=await(await fetch("https://some-random-api.ml/img/pikachu")).json(),n=new discord.Embed;n.setImage({url:t.link}),await _i(e,{embed:n})}),{parent:"random",module:"utilities",permissions:{overrideableInfo:"utilities.random.pikachu",level:w.Guest}}),Di(Ps,{name:"koala",description:"Gets a random koala image"},(async e=>{await e.acknowledge({ephemeral:!1});const t=await(await fetch("https://some-random-api.ml/img/koala")).json(),n=new discord.Embed;n.setImage({url:t.link}),await _i(e,{embed:n})}),{parent:"random",module:"utilities",permissions:{overrideableInfo:"utilities.random.koala",level:w.Guest}}),Di(Ps,{name:"birb",description:"Gets a random birb image"},(async e=>{await e.acknowledge({ephemeral:!1});const t=await(await fetch("https://some-random-api.ml/img/birb")).json(),n=new discord.Embed;n.setImage({url:t.link}),await _i(e,{embed:n})}),{parent:"random",module:"utilities",permissions:{overrideableInfo:"utilities.random.birb",level:w.Guest}}),Di(Ps,{name:"panda",description:"Gets a random panda image"},(async e=>{await e.acknowledge({ephemeral:!1});const t=await(await fetch("https://some-random-api.ml/img/panda")).json(),n=new discord.Embed;n.setImage({url:t.link}),await _i(e,{embed:n})}),{parent:"random",module:"utilities",permissions:{overrideableInfo:"utilities.random.panda",level:w.Guest}})),yi({name:"pat",description:"Gets a random anime patting gif"},(async e=>{await e.acknowledge({ephemeral:!1});const t=await(await fetch("https://some-random-api.ml/animu/pat")).json(),n=new discord.Embed;n.setImage({url:t.link}),await _i(e,{embed:n})}),{module:"utilities",permissions:{overrideableInfo:"utilities.pat",level:w.Guest}}),yi({name:"hug",description:"Gets a random anime hugging gif"},(async e=>{await e.acknowledge({ephemeral:!1});const t=await(await fetch("https://some-random-api.ml/animu/hug")).json(),n=new discord.Embed;n.setImage({url:t.link}),await _i(e,{embed:n})}),{module:"utilities",permissions:{overrideableInfo:"utilities.hug",level:w.Guest}}),yi({name:"server",description:"Shows server info"},(async e=>{const t=new discord.Embed,n=await e.getGuild(),i=await n.getMember(discord.getBotId());let a=n.getIconUrl();null===a&&(a=""),t.setAuthor({name:n.name,iconUrl:n.getIconUrl()??void 0});const s=new Date(q(n.id).timestamp),o=Y(s,"R");null!==a&&t.setThumbnail({url:a});let r="";Y(s.getTime(),"D");const l="string"==typeof n.preferredLocale&&n.features.includes("DISCOVERABLE")?`\n  󠇰**${U.modules.utilities.server.preferred_locale}**: \`${n.preferredLocale}\``:"",u="number"==typeof n.premiumSubscriptionCount&&n.premiumSubscriptionCount>0?`\n<:booster3:735780703773655102>**${U.modules.utilities.server.boosts}**: ${n.premiumSubscriptionCount}`:"",d=null!==n.premiumTier&&void 0!==n.premiumTier?`\n  󠇰**${U.modules.utilities.server.boost_tier}**: ${n.premiumTier}`:"",c="string"==typeof n.systemChannelId?`\n  󠇰**${U.modules.utilities.server.system_channel}**: <#${n.systemChannelId}>`:"",m="string"==typeof n.vanityUrlCode?`\n  󠇰**${U.modules.utilities.server.vanity_url}**: \`${n.vanityUrlCode}\``:"",g="string"==typeof n.description?`\n  󠇰**${U.modules.utilities.server.description}**: \`${n.description}\``:"",f="string"==typeof n.widgetChannelId?`<#${n.widgetChannelId}>`:U.modules.utilities.server.widget_no_channel,p=!0===n.widgetEnabled?`\n  󠇰**${U.modules.utilities.server.widget}**: ✅ ( ${f} )`:"",h=n.features.length>0?n.features.map((e=>e.split("_").map((e=>`${e.substr(0,1).toUpperCase()}${e.substr(1).toLowerCase()}`)).join(" "))).join(", "):U.modules.utilities.server.none;r+=`  **❯ **${U.modules.utilities.server.information}\n<:rich_presence:735781410509684786>**${U.modules.utilities.server.id}**: \`${n.id}\`\n  󠇰󠇰${B(U.modules.utilities.server.created,["time",o])}\n<:owner:735780703903547443>**${U.modules.utilities.server.owner}**: <@!${n.ownerId}>\n<:voice:735780703928844319>**${U.modules.utilities.server.vc_region}**: \`${n.region.split(" ").map((e=>`${e.substr(0,1).toUpperCase()}${e.substr(1).toLowerCase()}`)).join(" ")}\`\n  󠇰**${U.modules.utilities.server.features}**: \`${h}\`${u}${d}${p}${g}${l}${m}${c}`;const w=[],y={text:0,category:0,voice:0,stage:0,news:0,store:0},E=await n.getChannels();E.forEach((e=>{0===e.type&&(y.text+=1),2===e.type&&(y.voice+=1),13===e.type&&(y.stage+=1),6===e.type&&(y.store+=1),4===e.type&&(y.category+=1),5===e.type&&(y.news+=1)}));for(const e in y){const t=y[e];let n="";"text"===e&&(n="<:channel:735780703983239218>"),"voice"===e&&(n="<:voice:735780703928844319>"),"store"===e&&(n="<:store:735780704130170880>"),"news"===e&&(n="<:news:735780703530385470>"),"category"===e&&(n="<:category:754241739258069043>"),"stage"===e&&(n="<:stage:870236745072009236>"),t>0&&w.push(`${n}: **${t}**`)}r+=`\n\n**❯ **${U.modules.utilities.server.channels} ⎯ ${E.length}\n${w.join(" | ")}`;const D=await n.getRoles(),_=await n.getEmojis();let b=0,A=0;i.can(4)&&(b=(await n.getBans()).length),i.can(32)&&(A=(await n.getInvites()).length),(D.length>0||_.length>0||b>0||A>0)&&(r+="\n\n\n**❯ **Other Counts",D.length>0&&(r+=`\n <:settings:735782884836638732> **${U.modules.utilities.server.roles}**: ${D.length}`),_.length>0&&(r+=`\n <:emoji_ghost:735782884862066789> **${U.modules.utilities.server.emojis}**: ${_.length}`),b>0&&(r+=`\n 🔨 **${U.modules.utilities.server.bans}**: ${b}`),A>0&&(r+=`\n <:memberjoin:754249269665333268> **${U.modules.utilities.server.invites}**: ${A}`));const I={human:0,bot:0,presences:{streaming:0,game:0,listening:0,watching:0,online:0,dnd:0,idle:0,offline:0}};if(n.memberCount<60){await async function(){for await(const e of n.iterMembers()){const t=e;if(t.user.bot){I.bot+=1;continue}I.human+=1;const n=await t.getPresence();n.activities.find((e=>1===e.type))&&(I.presences.streaming+=1),n.activities.find((e=>2===e.type))&&(I.presences.listening+=1),n.activities.find((e=>0===e.type))&&(I.presences.game+=1),n.activities.find((e=>3===e.type))&&(I.presences.watching+=1),I.presences[n.status]+=1}}();let e="",t=!1;for(const n in I.presences){const i=I.presences[n];let a="";"streaming"===n&&(a="<:streaming:735793095597228034>"),"game"===n&&(a="🎮"),"watching"===n&&(a="<:watching:735793898051469354>"),"listening"===n&&(a="<:spotify:735788337897406535>"),"online"===n&&(a="<:status_online:735780704167919636>"),"dnd"===n&&(a="<:status_busy:735780703983239168>"),"idle"===n&&(a="<:status_away:735780703710478407>"),"offline"===n&&(a="<:status_offline:735780703802753076>"),i>0&&("streaming"===n||"listening"===n||"watching"===n||"game"===n||e.includes("  󠇰")||t||(0===e.length?t=!0:e+="\n  󠇰"),e+=`\n ${a} **-** ${i}`)}let i=`\n <:bot:735780703945490542> **-** ${I.bot}\n  󠇰`;I.bot<=0&&(i=""),r+=`\n\n\n**❯ **${U.modules.utilities.server.members} ⎯ ${n.memberCount}${i}${e}`}else r+=`\n\n\n**❯ **${U.modules.utilities.server.members} ⎯ ${n.memberCount}`;t.setDescription(r),await _i(e,{embed:t,allowedMentions:{},content:""})}),{permissions:{overrideableInfo:"commands.server",level:w.Guest},module:"utilities",staticAck:!0}),yi({name:"info",description:"Shows user info",options:e=>({user:e.guildMember({description:"User to get info on",required:!1})})},(async(e,{user:t})=>{let n=void 0!==t?t.user:e.member.user;if(yn(e.member.user.id)&&(n=await H(n.id,!0)),!n)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.utilities.info.user_not_found),!1;const i=new discord.Embed;i.setAuthor({name:n.getTag(),iconUrl:n.getAvatarUrl()}),"string"==typeof n.avatar&&i.setThumbnail({url:n.getAvatarUrl()});let a=`**❯ ${n.bot?U.modules.utilities.info.bot:U.modules.utilities.info.user} ${U.modules.utilities.server.information}**\n        <:rich_presence:735781410509684786> 󠇰**${U.modules.utilities.server.id}**: \`${n.id}\`\n        🔗 **${U.modules.utilities.info.profile}**: ${n.toMention()}${n.avatar?` - [${U.modules.utilities.info.avatar}](${n.getAvatarUrl()})`:""}`;const s=Y(new Date(q(n.id).timestamp),"R");a+=`\n 🗓️ ${B(U.modules.utilities.server.created,["time",s])}`;const o=await e.getGuild(),r=await o.getMember(n.id);if(null!==r){const e=await r.getPresence(),t=e.activities.map((e=>{let t="";if(1===e.type&&(t="<:streaming:735793095597228034>"),0===e.type&&(t="🎮"),3===e.type&&(t="<:watching:735793898051469354>"),2===e.type&&(t="<:spotify:735788337897406535>"),4===e.type){let t="";return t=null!==e.emoji?null===e.emoji.id?e.emoji.name:`<${!0===e.emoji.animated?"a":""}:${e.emoji.name}:${e.emoji.id}>`:"🗒️",`${t}${null!==e.state?` \`${Qn(e.state,!0)}\``:""} (Custom Status)`}return`${t}${e.name.length>0?` \`${e.name}\``:""}`}));let n,s,o="";"online"===e.status&&(o="<:status_online:735780704167919636>",n=2474073,s=U.modules.utilities.info.online),"dnd"===e.status&&(o="<:status_busy:735780703983239168>",n=11749204,s=U.modules.utilities.info.busy),"idle"===e.status&&(o="<:status_away:735780703710478407>",n=14991165,s=U.modules.utilities.info.idle),"offline"===e.status&&(o="<:status_offline:735780703802753076>",n=3553599,s=U.modules.utilities.info.offline),a+=`\n ${o} **${U.modules.utilities.info.status}**: ${s}`,t.length>0&&(a+=`\n  ${t.join("\n  ")}󠇰`),n&&i.setColor(n)}if(null===i.color){const e=(16777215*Math.random()<<0).toString(16);i.setColor(parseInt(e,16))}try{if("object"==typeof n&&n instanceof F&&"number"==typeof n.public_flags){let e=[];const t=new te(n.public_flags).serialize();for(const n in t)!0===t[n]&&e.push(n);e.length>0&&(a+=`\n\n**❯ ${U.modules.utilities.info.discord_badges}**`,e=e.map((e=>{switch(e){case"STAFF":return`<:discordstaff:751155123648069743> ${U.modules.utilities.info.discord_staff}`;case"PARTNER":return`<:partner:735780703941165057> ${U.modules.utilities.info.discord_partner}`;case"HYPESQUAD_EVENTS":return`<:hypesquad_events:735780703958204446> ${U.modules.utilities.info.hypesquad}`;case"BUG_HUNTER":return`<:bughunter:735780703920324762> ${U.modules.utilities.info.bug_hunter}`;case"HYPESQUAD_BRAVERY":return`<:bravery:735780704100679720> ${U.modules.utilities.info.hs_bravery}`;case"HYPESQUAD_BRILLIANCE":return`<:brilliance:735780703878512711> ${U.modules.utilities.info.hs_brilliance}`;case"HYPESQUAD_BALANCE":return`<:balance:735780704159531089> ${U.modules.utilities.info.hs_balance}`;case"EARLY_SUPPORTER":return`<:earlysupporter:735780703631048786> ${U.modules.utilities.info.early_supporter}`;case"TEAM_USER":return`<:members:735780703559745558> ${U.modules.utilities.info.team_user}`;case"SYSTEM":return`<:discordstaff:751155123648069743> ${U.modules.utilities.info.system}`;case"BUG_HUNTER_GOLDEN":return`<:goldenbughunter:751153800693284924> ${U.modules.utilities.info.golden_bug_hunter}`;case"VERIFIED_BOT":return`<:verified:735780703874318417> ${U.modules.utilities.info.verified_bot}`;case"VERIFIED_BOT_DEVELOPER":return`<:botdev:751154656679559259> ${U.modules.utilities.info.early_bot_dev}`;case"CERTIFIED_MODERATOR":return`🛡️ ${U.modules.utilities.info.certified_moderator}`;default:return e}})).filter((e=>""!==e)).map((e=>`**${e}**`)),a+=`\n ${e.join("\n ")}`)}}catch(e){Zn(e)}const l=yn(n.id);if("object"==typeof E.badges&&(l||"object"==typeof E.userBadges&&Array.isArray(E.userBadges[n.id]))&&(a+=`\n\n**❯ ${U.modules.utilities.info.pyboat_badges}**`,l&&"string"==typeof E.badges.globaladmin&&(a+=`\n${E.badges.globaladmin}`),"object"==typeof E.userBadges&&Array.isArray(E.userBadges[n.id])&&(a+=`\n${E.userBadges[n.id].map((e=>"string"==typeof E.badges[e]?E.badges[e]:"Unknown")).join("\n")}`)),null!==r){const e=r.roles.map((e=>`<@&${e}>`)).join(" ");a+=`\n\n**❯ ${U.modules.utilities.info.member_info}**`;const t=new Date(r.joinedAt),i=Y(t,"R");if(Y(t.getTime(),"D"),a+=`\n 📥${B(U.modules.utilities.info.joined,["time",i])}`,r.nick&&null!==r.nick&&r.nick.length>0&&(a+=`\n 🗒️ 󠇰**${U.modules.utilities.info.nickname}**: \`${Qn(r.nick,!0)}\``),null!==r.premiumSince){const e=new Date(r.premiumSince),t=Y(e,"R");Y(e.getTime(),"D"),a+=`\n <:booster:735780703912067160> ${B(U.modules.utilities.info.boosting_since,["time",t])}`}const s=["CREATE_INSTANT_INVITE","ADD_REACTIONS","STREAM","VIEW_CHANNEL","SEND_MESSAGES","SEND_TTS_MESSAGES","EMBED_LINKS","ATTACH_FILES","READ_MESSAGE_HISTORY","USE_EXTERNAL_EMOJIS","CONNECT","SPEAK","USE_VOICE_ACTIVITY","CHANGE_NICKNAME","VIEW_GUILD_INSIGHTS","VIEW_AUDIT_LOG","PRIORITY_SPEAKER","USE_SLASH_COMMANDS","REQUEST_TO_SPEAK","USE_PUBLIC_THREADS","USE_PRIVATE_THREADS"];if(r.roles.length>0)if(r.roles.length<20)a+=`\n 🛡️ **Roles** (${r.roles.length}): ${e}`;else{const e=(await o.getRoles()).filter((e=>r.roles.includes(e.id))).filter((e=>{const t=new ee(e.permissions).serialize();for(const e in t)(!1===t[e]||s.includes(e))&&delete t[e];return Object.keys(t).length>0})).map((e=>e.id));e.length<20?a+=`\n 🛡️ **${U.modules.utilities.info.roles}** (${r.roles.length})\n 🛡️ **${U.modules.utilities.info.key_roles}** (${e.length}): ${e.map((e=>`<@&${e}>`)).join(" ")}`:a+=`\n 🛡️ **${U.modules.utilities.info.roles}** (${r.roles.length})`}const l=await No.getByQuery({actorId:n.id}),u=await No.getByQuery({memberId:n.id});(l.length>0||u.length>0)&&(a+=`\n\n**❯ ${U.modules.utilities.info.infractions}`),l.length>0&&(a+=`\n 🔨 **${U.modules.utilities.info.infractions_applied}**: **${l.length}**`),u.length>0&&(a+=`\n ⛔ **${U.modules.utilities.info.infractions_received}**: **${u.length}**`);const d=new ee(r.permissions);let c=d.serialize();for(const e in c)(!1===c[e]||s.includes(e))&&delete c[e];!0===c.ADMINISTRATOR&&(c={ADMINISTRATOR:!0}),o.ownerId===n.id&&(c={SERVER_OWNER:!0}),c=Object.keys(c).map((e=>e.split("_").map((e=>`${e.substr(0,1).toUpperCase()}${e.substr(1).toLowerCase()}`)).join(" ")));const m=pn(r);(Number(d.bitfield)>0&&c.length>0||m>0)&&(a+=`\n\n**❯ ${U.modules.utilities.info.permissions}**`),Number(d.bitfield)>0&&c.length>0&&(a+=`\n <:settings:735782884836638732> **${U.modules.utilities.info.staff}**: \`${c.join(", ")}\``),m>0&&!n.bot&&(a+=`\n 🌀 **${U.modules.utilities.info.bot_level}**: **${m}**`)}i.setDescription(a),await _i(e,{content:"",allowedMentions:{},embed:i})}),{module:"utilities",permissions:{overrideableInfo:"utilities.info",level:w.Guest}});var js,xs=Object.freeze({__proto__:null,checkReminders:Cs,addReminderSlash:Ss,addReminder:Ms,clearRemindersSlash:Ts,clearReminders:Os,AL_OnMessageDelete:async function(e,t,n,i,a){if(!f.modules.utilities||"object"!=typeof f.modules.utilities||!0!==f.modules.utilities.enabled)return;if(!a||n instanceof discord.AuditLogEntry||!a.author||null!==a.webhookId||!0===a.author.bot||!a.member)return;if(!f.modules.utilities||!f.modules.utilities.snipe||!0!==f.modules.utilities.snipe.enabled||"number"!=typeof f.modules.utilities.snipe.delay)return;if(hn(a.member))return;const s=q(a.id).timestamp;(new Date).getTime()-s>=1e3*f.modules.utilities.snipe.delay||await Rs.put(a.channelId,JSON.stringify(a),{ttl:1e3*f.modules.utilities.snipe.delay})},checkAllCustomRoles:Gs,OnGuildMemberAdd:async function(e,t,n){await Us(n)},AL_OnGuildMemberRemove:async function(e,t,n,i){"object"==typeof f.modules.utilities.customUserRoles&&"boolean"==typeof f.modules.utilities.customUserRoles.enabled&&!0===f.modules.utilities.customUserRoles.enabled&&(n instanceof discord.AuditLogEntry?(20===n.actionType&&!0===f.modules.utilities.customUserRoles.clearOnKick||22===n.actionType&&!0===f.modules.utilities.customUserRoles.clearOnBan)&&await ks(i.user.id):!0===f.modules.utilities.customUserRoles.clearOnLeave&&await ks(i.user.id))},OnGuildMemberUpdate:async function(e,t,n,i){await Us(n)},OnGuildRoleUpdate:async function(e,t,n,i){await Ls(),await Gs()},OnGuildRoleDelete:async function(e,t,n){const i=await As.getByQuery({roleId:n.id});i&&1===i.length&&await As.editPool(i[0].memberId,null),await Gs()},InitializeCommands:function(){const e=Oo({description:"Utility Commands"}),t=new discord.command.CommandGroup(e);return"object"==typeof f.modules.utilities.customUserRoles&&!0===f.modules.utilities.customUserRoles.enabled&&vi(t,"cur",(e=>{e.defaultRaw((async e=>{await bi(0,{permissions:{level:w.Guest,overrideableInfo:"utilities.cur"}},(async e=>{zi(await e.inlineReply((async()=>{const t=await As.getById(e.author.id);if(!t)return{content:U.modules.utilities.curs.dont_have_role};const n="string"==typeof f.modules.commands.prefix?f.modules.commands.prefix:f.modules.commands.prefix[0];return{allowedMentions:{users:[e.author.id]},content:B(U.modules.utilities.curs.check_role,["user_mention",e.author.toMention(),"role_mention",`<@&${t.roleId}>`,"prefix",n])}})))}),e)})),Ai(e,"name",(e=>({name:e.text()})),(async(e,{name:t})=>{zi(await e.inlineReply((async()=>{const n=await As.getById(e.author.id);if(!n)return{allowedMentions:{users:[e.author.id]},content:U.modules.utilities.curs.dont_have_role};if(t.length<2||t.length>32)return{allowedMentions:{users:[e.author.id]},content:U.modules.utilities.curs.character_limit};const i=await e.getGuild(),a=await i.getRole(n.roleId);return a?(await a.edit({name:t}),{allowedMentions:{users:[e.author.id]},content:B(U.modules.utilities.curs.changed_role_name,["role_name",Qn(t,!0)])}):{content:U.modules.utilities.curs.role_not_found}})))}),{permissions:{overrideableInfo:"utilities.cur.name",level:w.Guest}}),Ai(e,"color",(e=>({color:e.textOptional()})),(async(e,{color:t})=>{zi(await e.inlineReply((async()=>{const n=await As.getById(e.author.id);if(!n)return{allowedMentions:{users:[e.author.id]},content:U.modules.utilities.curs.dont_have_role};if("string"==typeof t&&t.includes("#")&&(t=t.split("#").join("")),"string"==typeof t&&6!==t.length)return{allowedMentions:{users:[e.author.id]},content:U.modules.utilities.curs.color_wrong_format};const i=await e.getGuild(),a=await i.getRole(n.roleId);return a?(await a.edit({color:"string"==typeof t?parseInt(t,16):0}),{allowedMentions:{users:[e.author.id]},content:B(U.modules.utilities.curs.changed_role_color,["color","string"==typeof t?`#${t}`:"None"])}):{content:U.modules.utilities.curs.role_not_found}})))}),{permissions:{overrideableInfo:"utilities.cur.color",level:w.Guest}}),Ai(e,"set",(e=>({target:e.guildMember(),roleText:e.text()})),(async(e,{target:t,roleText:n})=>{zi(await e.inlineReply((async()=>{const i=await qi(n);if(!i)return{allowedMentions:{users:[e.author.id]},content:U.modules.utilities.curs.role_not_found};const a=await e.getGuild(),s=await a.getRole(i);if(!(s instanceof discord.Role))return{allowedMentions:{users:[e.author.id]},content:U.modules.utilities.curs.role_not_found};if(await As.exists(t.user.id))return{allowedMentions:{users:[e.author.id]},content:U.modules.utilities.curs.already_has_role};const o=await As.getByQuery({roleId:s.id});return Array.isArray(o)&&o.length>0?{allowedMentions:{users:[e.author.id]},content:B(U.modules.utilities.curs.already_assigned_to,["user_mention",`<@!${o[0].memberId}>`])}:(await $s(t.user.id,s.id),await Ls(),t.roles.includes(s.id)||await t.addRole(s.id),{allowedMentions:{users:[e.author.id]},content:B(U.modules.utilities.curs.set_role,["user_mention",t.toMention(),"role_mention",s.toMention()])})})))}),{permissions:{overrideableInfo:"utilities.cur.set",level:w.Administrator}}),Ai(e,"clear",(e=>({target:e.guildMember()})),(async(e,{target:t})=>{zi(await e.inlineReply((async()=>{const n=await As.getById(t.user.id);if(!n)return{allowedMentions:{users:[e.author.id]},content:U.modules.utilities.curs.has_no_role};const i=n.roleId,a=await e.getGuild(),s=await a.getRole(i);return await As.editPool(t.user.id,null),s instanceof discord.Role&&t.roles.includes(s.id)&&await t.removeRole(s.id),{allowedMentions:{users:[e.author.id]},content:B(U.modules.utilities.curs.cleared_role,["user_mention",t.user.toMention()])}})))}),{permissions:{overrideableInfo:"utilities.cur.clear",level:w.Administrator}}),Ai(e,"delete",(e=>({target:e.guildMember()})),(async(e,{target:t})=>{zi(await e.inlineReply((async()=>{const n=await As.getById(t.user.id);if(!n)return{allowedMentions:{users:[e.author.id]},content:U.modules.utilities.curs.has_no_role};const i=n.roleId,a=await e.getGuild();return await a.getRole(i)instanceof discord.Role?(await ks(t.user.id),{allowedMentions:{users:[e.author.id]},content:B(U.modules.utilities.curs.deleted_role,["user_mention",t.user.toMention()])}):{allowedMentions:{users:[e.author.id]},content:U.modules.utilities.curs.role_not_found}})))}),{permissions:{overrideableInfo:"utilities.cur.delete",level:w.Administrator}})}),!1),"object"==typeof f.modules.utilities.snipe&&!0===f.modules.utilities.snipe.enabled&&Ii(t,"snipe",(async e=>{zi(await e.inlineReply((async()=>{let t=await Rs.get(e.channelId);if("string"==typeof t&&(t=JSON.parse(t)),void 0===t||"object"!=typeof t.author||"string"!=typeof t.id)return{content:U.modules.utilities.snipe.no_message};if(t.author.id===e.author.id&&!e.member.can(8))return{content:U.modules.utilities.snipe.no_message};const n=new discord.Embed,i=await H(t.author.id);return i?(n.setAuthor({name:i.getTag(),iconUrl:i.getAvatarUrl()}),n.setTimestamp(new Date(q(t.id).timestamp).toISOString()),n.setFooter({iconUrl:e.author.getAvatarUrl(),text:B(U.modules.utilities.snipe.requested_by,["user_tag",e.author.getTag()])}),n.setDescription(t.content),n.setColor(261202),await Rs.delete(e.channelId),{embed:n,content:B(U.modules.utilities.snipe.said,["user_mention",i.toMention()]),allowedMentions:{}}):{content:U.modules.utilities.snipe.user_not_found}})))}),{permissions:{overrideableInfo:"utilities.snipe",level:w.Authorized}}),vi(t,"random",(e=>{Ii(e,"coin",(async e=>{await e.inlineReply((async()=>{const e=Xn(1,2);return B(U.modules.utilities.random.coin,["result",1===e?U.modules.utilities.random.coin_heads:U.modules.utilities.random.coin_tails])}))}),{permissions:{overrideableInfo:"utilities.random.coin",level:w.Guest}}),Ai(e,"number",(e=>({minimum:e.integer({maxValue:1e9,minValue:0}),maximum:e.integer({maxValue:1e9,minValue:1})})),(async(e,{minimum:t,maximum:n})=>{await e.inlineReply((async()=>{if(t>=n)return U.modules.utilities.random.number_minimum_wrong;const e=Xn(t,n);return B(U.modules.utilities.random.number,["minimum",t.toString(),"maximum",n.toString(),"result",e.toString()])}))}),{permissions:{overrideableInfo:"utilities.random.number",level:w.Guest}}),Ii(e,{name:"cat",aliases:["pussy","fatbitch"]},(async e=>{zi(await e.inlineReply((async()=>{const e=await(await fetch("http://aws.random.cat/meow")).json(),t=await(await fetch(e.file)).arrayBuffer();return{content:"",attachments:[{name:`cat.${e.file.split(".")[e.file.split(".").length-1]}`,data:t}]}})))}),{permissions:{overrideableInfo:"utilities.random.cat",level:w.Guest}}),Ii(e,{name:"dog",aliases:["doggo"]},(async e=>{zi(await e.inlineReply((async()=>{const e=await(await fetch("https://random.dog/woof.json")).json(),t=await(await fetch(e.url)).arrayBuffer();return{content:"",allowedMentions:{},attachments:[{name:`dog.${e.url.split(".")[e.url.split(".").length-1]}`,data:t}]}})))}),{permissions:{overrideableInfo:"utilities.random.dog",level:w.Guest}}),Ii(e,{name:"doge",aliases:["shibe"]},(async e=>{zi(await e.inlineReply((async()=>{const e=await(await fetch("https://dog.ceo/api/breed/shiba/images/random")).json(),t=await(await fetch(e.message)).arrayBuffer();return{content:"",allowedMentions:{},attachments:[{name:`dog.${e.message.split(".")[e.message.split(".").length-1]}`,data:t}]}})))}),{permissions:{overrideableInfo:"utilities.random.doge",level:w.Guest}}),Ii(e,"fox",(async e=>{zi(await e.inlineReply((async()=>{const e=await(await fetch("https://randomfox.ca/floof/")).json(),t=await(await fetch(e.image)).arrayBuffer();return{content:"",allowedMentions:{},attachments:[{name:`fox.${e.image.split(".")[e.image.split(".").length-1]}`,data:t}]}})))}),{permissions:{overrideableInfo:"utilities.random.fox",level:w.Guest}}),Ii(e,"koala",(async e=>{zi(await e.inlineReply((async()=>{const e=await(await fetch("https://some-random-api.ml/img/koala")).json(),t=await(await fetch(e.link)).arrayBuffer();return{content:"",allowedMentions:{},attachments:[{name:`koala.${e.link.split(".")[e.link.split(".").length-1]}`,data:t}]}})))}),{permissions:{overrideableInfo:"utilities.random.koala",level:w.Guest}}),Ii(e,{name:"birb",aliases:["bird"]},(async e=>{zi(await e.inlineReply((async()=>{const e=await(await fetch("https://some-random-api.ml/img/birb")).json(),t=await(await fetch(e.link)).arrayBuffer();return{content:"",allowedMentions:{},attachments:[{name:`birb.${e.link.split(".")[e.link.split(".").length-1]}`,data:t}]}})))}),{permissions:{overrideableInfo:"utilities.random.birb",level:w.Guest}}),Ii(e,{name:"panda",aliases:["ponda","pwnda"]},(async e=>{zi(await e.inlineReply((async()=>{const e=await(await fetch("https://some-random-api.ml/img/panda")).json(),t=await(await fetch(e.link)).arrayBuffer();return{content:"",allowedMentions:{},attachments:[{name:`panda.${e.link.split(".")[e.link.split(".").length-1]}`,data:t}]}})))}),{permissions:{overrideableInfo:"utilities.random.panda",level:w.Guest}})})),Ai(t,"snowflake",(e=>({snowflake:e.string()})),(async(e,{snowflake:t})=>{zi(await e.inlineReply((async()=>{if(t.length>25||t.length<15||!/^\d+$/.test(t))return U.modules.utilities.snowflake_wrong;const e=function(e){return q(e).timestamp}(t);return B(U.modules.utilities.snowflake,["snowflake",t,"date",new Date(e)])})))}),{permissions:{overrideableInfo:"utilities.snowflake",level:w.Guest}}),Ai(t,"avatar",(e=>({user:e.stringOptional({name:"user",description:"UserResolvable"})})),(async(e,{user:t})=>{zi(await e.inlineReply((async()=>{const n=await Ti(e,"user","stringOptional",Mi.UserResolvable,t??e.author),i=new discord.Embed;return i.setAuthor({iconUrl:n.getAvatarUrl(),name:n.getTag()}),i.setDescription(B(U.modules.utilities.avatar.avatar_of,["user_tag",n.getTag(),"avatar_url",`<${n.getAvatarUrl()}>`])),i.setFooter({text:B(U.modules.utilities.avatar.requested_by,["user_tag",e.author.getTag(),"user_id",e.author.id])}),i.setTimestamp((new Date).toISOString()),i.setImage({url:n.getAvatarUrl()}),{embed:i}})))}),{permissions:{overrideableInfo:"utilities.avatar",level:w.Guest}}),vi(t,"remind",(e=>{e.default((e=>({when:e.string(),text:e.text()})),(async(...e)=>{await bi("remind",{permissions:{level:w.Guest,overrideableInfo:"utilities.remind.add"}},(async(e,{when:t,text:n})=>{await Ms(e,t,n)}),...e)})),Ai(e,"add",(e=>({when:e.string(),text:e.text()})),(async(e,{when:t,text:n})=>{await Ms(e,t,n)}),{permissions:{overrideableInfo:"utilities.remind.add",level:w.Guest}}),Ii(e,"clear",(async e=>{await Os(e)}),{permissions:{overrideableInfo:"utilities.remind.clear",level:w.Guest}})}),!1),Ii(t,"pikachu",(async e=>{zi(await e.inlineReply((async()=>{const e=await(await fetch("https://some-random-api.ml/img/pikachu")).json(),t=await(await fetch(e.link)).arrayBuffer();return{content:"",allowedMentions:{},attachments:[{name:`pika.${e.link.split(".")[e.link.split(".").length-1]}`,data:t}]}})))}),{permissions:{overrideableInfo:"utilities.pikachu",level:w.Guest}}),Ii(t,"pat",(async e=>{zi(await e.inlineReply((async()=>{const e=await(await fetch("https://some-random-api.ml/animu/pat")).json(),t=await(await fetch(e.link)).arrayBuffer();return{content:"",allowedMentions:{},attachments:[{name:`pat.${e.link.split(".")[e.link.split(".").length-1]}`,data:t}]}})))}),{permissions:{overrideableInfo:"utilities.pat",level:w.Guest}}),Ii(t,"hug",(async e=>{zi(await e.inlineReply((async()=>{const e=await(await fetch("https://some-random-api.ml/animu/hug")).json(),t=await(await fetch(e.link)).arrayBuffer();return{content:"",allowedMentions:{},attachments:[{name:`hug.${e.link.split(".")[e.link.split(".").length-1]}`,data:t}]}})))}),{permissions:{overrideableInfo:"utilities.hug",level:w.Guest}}),Ai(t,"server",(e=>({gid:e.stringOptional()})),(async(e,{gid:t})=>{zi(await e.inlineReply((async()=>{const n=new discord.Embed;null===t&&(t=p);const i=await e.getGuild(),a=await async function(e,t=!1){let n;try{t||e!==f.guildId||(n=await discord.getGuild())}catch(e){}if(void 0!==n)return n;const i=await P(`guilds/${e}?with_counts=true`,{},"GET",null,!0);try{const e=await i.json();if("string"==typeof e.id){for(const t in e)if("roles"===t||"emojis"===t)e[t]=e[t].map((e=>e.id));else if("approximate_member_count"===t)e.memberCount=e[t],delete e[t];else if("max_presences"===t&&null===e[t])delete e[t];else if("premium_tier"===t&&0===e[t])e[t]=null;else if(t.includes("_")){const n=t.split("_");for(let e=1;e<n.length;e++)n[e]=`${n[e].substr(0,1).toUpperCase()}${n[e].substr(1).toLowerCase()}`;e[n.join("")]=e[t],delete e[t]}return ei(e,discord.Guild)}}catch(e){Zn(e)}return null}(t),s=await i.getMember(discord.getBotId());if(null===a||!(a instanceof discord.Guild))return{content:U.modules.utilities.server.guild_not_found};if(null===s)throw new Error(U.modules.utilities.server.bot_user_not_found);let o=a.getIconUrl();null===o&&(o=""),n.setAuthor({name:a.name,iconUrl:a.getIconUrl()??void 0});const r=new Date(q(a.id).timestamp),l=Y(r,"R");null!==o&&n.setThumbnail({url:o});let u="";Y(r.getTime(),"D");const d="string"==typeof a.preferredLocale&&a.features.includes("DISCOVERABLE")?`\n  󠇰**${U.modules.utilities.server.preferred_locale}**: \`${a.preferredLocale}\``:"",c="number"==typeof a.premiumSubscriptionCount&&a.premiumSubscriptionCount>0?`\n<:booster3:735780703773655102>**${U.modules.utilities.server.boosts}**: ${a.premiumSubscriptionCount}`:"",m=null!==a.premiumTier&&void 0!==a.premiumTier?`\n  󠇰**${U.modules.utilities.server.boost_tier}**: ${a.premiumTier}`:"",g="string"==typeof a.systemChannelId?`\n  󠇰**${U.modules.utilities.server.system_channel}**: <#${a.systemChannelId}>`:"",h="string"==typeof a.vanityUrlCode?`\n  󠇰**${U.modules.utilities.server.vanity_url}**: \`${a.vanityUrlCode}\``:"",w="string"==typeof a.description?`\n  󠇰**${U.modules.utilities.server.description}**: \`${a.description}\``:"",y="string"==typeof a.widgetChannelId?`<#${a.widgetChannelId}>`:U.modules.utilities.server.widget_no_channel,E=!0===a.widgetEnabled?`\n  󠇰**${U.modules.utilities.server.widget}**: ✅ ( ${y} )`:"",D=a.features.length>0?a.features.map((e=>e.split("_").map((e=>`${e.substr(0,1).toUpperCase()}${e.substr(1).toLowerCase()}`)).join(" "))).join(", "):U.modules.utilities.server.none;u+=`  **❯ **${U.modules.utilities.server.information}\n<:rich_presence:735781410509684786>**${U.modules.utilities.server.id}**: \`${a.id}\`\n  󠇰${B(U.modules.utilities.server.created,["time",l])}\n<:owner:735780703903547443>**${U.modules.utilities.server.owner}**: <@!${a.ownerId}>\n<:voice:735780703928844319>**${U.modules.utilities.server.vc_region}**: \`${a.region.split(" ").map((e=>`${e.substr(0,1).toUpperCase()}${e.substr(1).toLowerCase()}`)).join(" ")}\`\n  󠇰**${U.modules.utilities.server.features}**: \`${D}\`${c}${m}${E}${w}${d}${h}${g}`;const _=[],b={text:0,category:0,voice:0,stage:0,news:0,store:0},A=await a.getChannels();A.forEach((e=>{0===e.type&&(b.text+=1),2===e.type&&(b.voice+=1),13===e.type&&(b.stage+=1),6===e.type&&(b.store+=1),4===e.type&&(b.category+=1),5===e.type&&(b.news+=1)}));for(const e in b){const t=b[e];let n="";"text"===e&&(n="<:channel:735780703983239218>"),"voice"===e&&(n="<:voice:735780703928844319>"),"store"===e&&(n="<:store:735780704130170880>"),"news"===e&&(n="<:news:735780703530385470>"),"category"===e&&(n="<:category:754241739258069043>"),"stage"===e&&(n="<:stage:870236745072009236>"),t>0&&_.push(`${n}: **${t}**`)}a.id===i.id&&(u+=`\n\n**❯ **${U.modules.utilities.server.channels} ⎯ ${A.length}\n${_.join(" | ")}`);const I=a,v=a.id!==i.id?I.roles:await a.getRoles(),C=a.id!==i.id?I.emojis:await a.getEmojis();let S=0,M=0;i.id===a.id&&s.can(4)&&(S=(await a.getBans()).length),i.id===a.id&&s.can(32)&&(M=(await a.getInvites()).length),(v.length>0||C.length>0||S>0||M>0)&&(u+=`\n\n\n**❯ **${U.modules.utilities.server.other_counts}`,v.length>0&&(u+=`\n <:settings:735782884836638732> **${U.modules.utilities.server.roles}**: ${v.length}`),C.length>0&&(u+=`\n <:emoji_ghost:735782884862066789> **${U.modules.utilities.server.emojis}**: ${C.length}`),S>0&&(u+=`\n 🔨 **${U.modules.utilities.server.bans}**: ${S}`),M>0&&(u+=`\n <:memberjoin:754249269665333268> **${U.modules.utilities.server.invites}**: ${M}`));const T={human:0,bot:0,presences:{streaming:0,game:0,listening:0,watching:0,online:0,dnd:0,idle:0,offline:0}};if(a.memberCount<60&&i.id===a.id){await async function(){for await(const e of a.iterMembers()){const t=e;if(t.user.bot){T.bot+=1;continue}T.human+=1;const n=await t.getPresence();n.activities.find((e=>1===e.type))&&(T.presences.streaming+=1),n.activities.find((e=>2===e.type))&&(T.presences.listening+=1),n.activities.find((e=>0===e.type))&&(T.presences.game+=1),n.activities.find((e=>3===e.type))&&(T.presences.watching+=1),T.presences[n.status]+=1}}();let e="",t=!1;for(const n in T.presences){const i=T.presences[n];let a="";"streaming"===n&&(a="<:streaming:735793095597228034>"),"game"===n&&(a="🎮"),"watching"===n&&(a="<:watching:735793898051469354>"),"listening"===n&&(a="<:spotify:735788337897406535>"),"online"===n&&(a="<:status_online:735780704167919636>"),"dnd"===n&&(a="<:status_busy:735780703983239168>"),"idle"===n&&(a="<:status_away:735780703710478407>"),"offline"===n&&(a="<:status_offline:735780703802753076>"),i>0&&("streaming"===n||"listening"===n||"watching"===n||"game"===n||e.includes("  󠇰")||t||(0===e.length?t=!0:e+="\n  󠇰"),e+=`\n ${a} **-** ${i}`)}let n=`\n <:bot:735780703945490542> **-** ${T.bot}\n    󠇰`;T.bot<=0&&(n=""),u+=`\n\n\n**❯ **${U.modules.utilities.server.members} ⎯ ${a.memberCount}${n}${e}`}else u+=`\n\n\n**❯ **${U.modules.utilities.server.members} ⎯ ${a.memberCount}`;return n.setDescription(u),{content:"",embed:n,allowedMentions:{}}})))}),{permissions:{overrideableInfo:"utilities.server",level:w.Guest}}),Ai(t,"info",(e=>({user:e.stringOptional({name:"user",description:"UserResolvable"})})),(async(e,{user:t},n)=>{zi(await e.inlineReply((async()=>{const n=await Ti(e,"user","stringOptional",Mi.UserResolvable,t??e.author.id),i=new discord.Embed;i.setAuthor({name:n.getTag(),iconUrl:n.getAvatarUrl()}),"string"==typeof n.avatar&&i.setThumbnail({url:n.getAvatarUrl()});let a=`**❯ ${n.bot?U.modules.utilities.info.bot:U.modules.utilities.info.user} ${U.modules.utilities.server.information}**\n        <:rich_presence:735781410509684786> 󠇰**${U.modules.utilities.server.id}**: \`${n.id}\`\n        🔗 **${U.modules.utilities.info.profile}**: ${n.toMention()}${n.avatar?` - [${U.modules.utilities.info.avatar}](${n.getAvatarUrl()})`:""}`;const s=Y(new Date(q(n.id).timestamp),"R");a+=`\n 🗓️ ${B(U.modules.utilities.server.created,["time",s])}`;const o=await e.getGuild(),r=await o.getMember(n.id);if(null!==r){const e=await r.getPresence(),t=e.activities.map((e=>{let t="";if(1===e.type&&(t="<:streaming:735793095597228034>"),0===e.type&&(t="🎮"),3===e.type&&(t="<:watching:735793898051469354>"),2===e.type&&(t="<:spotify:735788337897406535>"),4===e.type){let t="";return t=null!==e.emoji?null===e.emoji.id?e.emoji.name:`<${!0===e.emoji.animated?"a":""}:${e.emoji.name}:${e.emoji.id}>`:"🗒️",`${t}${null!==e.state?` \`${Qn(e.state,!0)}\``:""} (${U.modules.utilities.info.custom_status})`}return`${t}${e.name.length>0?` \`${e.name}\``:""}`}));let n,s,o="";"online"===e.status&&(o="<:status_online:735780704167919636>",n=2474073,s=U.modules.utilities.info.online),"dnd"===e.status&&(o="<:status_busy:735780703983239168>",n=11749204,s=U.modules.utilities.info.busy),"idle"===e.status&&(o="<:status_away:735780703710478407>",n=14991165,s=U.modules.utilities.info.idle),"offline"===e.status&&(o="<:status_offline:735780703802753076>",n=3553599,s=U.modules.utilities.info.offline),a+=`\n ${o} **${U.modules.utilities.info.status}**: ${s}`,t.length>0&&(a+=`\n  ${t.join("\n  ")}󠇰`),n&&i.setColor(n)}if(null===i.color){const e=(16777215*Math.random()<<0).toString(16);i.setColor(parseInt(e,16))}try{if("object"==typeof n&&n instanceof F&&"number"==typeof n.public_flags){let e=[];const t=new te(n.public_flags).serialize();for(const n in t)!0===t[n]&&e.push(n);e.length>0&&(a+=`\n\n**❯ ${U.modules.utilities.info.discord_badges}**`,e=e.map((e=>{switch(e){case"STAFF":return`<:discordstaff:751155123648069743> ${U.modules.utilities.info.discord_staff}`;case"PARTNER":return`<:partner:735780703941165057> ${U.modules.utilities.info.discord_partner}`;case"HYPESQUAD_EVENTS":return`<:hypesquad_events:735780703958204446> ${U.modules.utilities.info.hypesquad}`;case"BUG_HUNTER":return`<:bughunter:735780703920324762> ${U.modules.utilities.info.bug_hunter}`;case"HYPESQUAD_BRAVERY":return`<:bravery:735780704100679720> ${U.modules.utilities.info.hs_bravery}`;case"HYPESQUAD_BRILLIANCE":return`<:brilliance:735780703878512711> ${U.modules.utilities.info.hs_brilliance}`;case"HYPESQUAD_BALANCE":return`<:balance:735780704159531089> ${U.modules.utilities.info.hs_balance}`;case"EARLY_SUPPORTER":return`<:earlysupporter:735780703631048786> ${U.modules.utilities.info.early_supporter}`;case"TEAM_USER":return`<:members:735780703559745558> ${U.modules.utilities.info.team_user}`;case"SYSTEM":return`<:discordstaff:751155123648069743> ${U.modules.utilities.info.system}`;case"BUG_HUNTER_GOLDEN":return`<:goldenbughunter:751153800693284924> ${U.modules.utilities.info.golden_bug_hunter}`;case"VERIFIED_BOT":return`<:verified:735780703874318417> ${U.modules.utilities.info.verified_bot}`;case"VERIFIED_BOT_DEVELOPER":return`<:botdev:751154656679559259> ${U.modules.utilities.info.early_bot_dev}`;case"CERTIFIED_MODERATOR":return`🛡️ ${U.modules.utilities.info.certified_moderator}`;default:return e}})).filter((e=>""!==e)).map((e=>`**${e}**`)),a+=`\n ${e.join("\n ")}`)}}catch(e){Zn(e)}const l=yn(n.id);if("object"==typeof E.badges&&(l||"object"==typeof E.userBadges&&Array.isArray(E.userBadges[n.id]))&&(a+=`\n\n**❯ ${U.modules.utilities.info.pyboat_badges}**`,l&&"string"==typeof E.badges.globaladmin&&(a+=`\n${E.badges.globaladmin}`),"object"==typeof E.userBadges&&Array.isArray(E.userBadges[n.id])&&(a+=`\n${E.userBadges[n.id].map((e=>"string"==typeof E.badges[e]?E.badges[e]:"Unknown")).join("\n")}`)),null!==r){const e=r.roles.map((e=>`<@&${e}>`)).join(" ");a+=`\n\n**❯ ${U.modules.utilities.info.member_info}**`;const t=new Date(r.joinedAt),i=Y(t,"R");if(Y(t.getTime(),"D"),a+=`\n 📥 ${B(U.modules.utilities.info.joined,["time",i])}`,r.nick&&null!==r.nick&&r.nick.length>0&&(a+=`\n 🗒️ 󠇰**${U.modules.utilities.info.nickname}**: \`${Qn(r.nick,!0)}\``),null!==r.premiumSince){const e=new Date(r.premiumSince),t=Y(e,"R");Y(e.getTime(),"D"),a+=`\n <:booster:735780703912067160> ${B(U.modules.utilities.info.boosting_since,["time",t])}`}const s=["CREATE_INSTANT_INVITE","ADD_REACTIONS","STREAM","VIEW_CHANNEL","SEND_MESSAGES","SEND_TTS_MESSAGES","EMBED_LINKS","ATTACH_FILES","READ_MESSAGE_HISTORY","USE_EXTERNAL_EMOJIS","CONNECT","SPEAK","USE_VOICE_ACTIVITY","CHANGE_NICKNAME","VIEW_GUILD_INSIGHTS","VIEW_AUDIT_LOG","PRIORITY_SPEAKER","USE_SLASH_COMMANDS","REQUEST_TO_SPEAK","USE_PUBLIC_THREADS","USE_PRIVATE_THREADS"];if(r.roles.length>0)if(r.roles.length<20)a+=`\n 🛡️ **${U.modules.utilities.info.roles}** (${r.roles.length}): ${e}`;else{const e=(await o.getRoles()).filter((e=>r.roles.includes(e.id))).filter((e=>{const t=new ee(e.permissions).serialize();for(const e in t)(!1===t[e]||s.includes(e))&&delete t[e];return Object.keys(t).length>0})).map((e=>e.id));e.length<20?a+=`\n 🛡️ **${U.modules.utilities.info.roles}** (${r.roles.length})\n 🛡️ **${U.modules.utilities.info.key_roles}** (${e.length}): ${e.map((e=>`<@&${e}>`)).join(" ")}`:a+=`\n 🛡️ **${U.modules.utilities.info.roles}** (${r.roles.length})`}const l=await No.getByQuery({actorId:n.id}),u=await No.getByQuery({memberId:n.id});(l.length>0||u.length>0)&&(a+=`\n\n**❯ ${U.modules.utilities.info.infractions}`),l.length>0&&(a+=`\n 🔨 **${U.modules.utilities.info.infractions_applied}**: **${l.length}**`),u.length>0&&(a+=`\n ⛔ **${U.modules.utilities.info.infractions_received}**: **${u.length}**`);const d=new ee(r.permissions);let c=d.serialize();for(const e in c)(!1===c[e]||s.includes(e))&&delete c[e];!0===c.ADMINISTRATOR&&(c={ADMINISTRATOR:!0}),o.ownerId===n.id&&(c={SERVER_OWNER:!0}),c=Object.keys(c).map((e=>e.split("_").map((e=>`${e.substr(0,1).toUpperCase()}${e.substr(1).toLowerCase()}`)).join(" ")));const m=pn(r);(Number(d.bitfield)>0&&c.length>0||m>0)&&(a+=`\n\n**❯ ${U.modules.utilities.info.permissions}**`),Number(d.bitfield)>0&&c.length>0&&(a+=`\n <:settings:735782884836638732> **${U.modules.utilities.info.staff}**: \`${c.join(", ")}\``),m>0&&!n.bot&&(a+=`\n 🌀 **${U.modules.utilities.info.bot_level}**: **${m}**`)}return i.setDescription(a),{content:"",embed:i,allowedMentions:{}}})))}),{permissions:{overrideableInfo:"utilities.info",level:w.Guest}}),t}});!function(e){e.PLAIN="PLAIN",e.PRETTY="PRETTY"}(js||(js={}));class Hs{constructor(e,t,n,i,a){return this.channel=void 0,this.name=e,this.channelId=t,this.mode=n,this.stats=i,this.role=a,this}}const Vs=new pylon.KVNamespace("reddit");async function Ks(){if(!Nl("reddit"))return;const e=f.modules.reddit;if(!e||!e.subs||!Array.isArray(e.subs))return;let t=e.subs.map((e=>{if("string"==typeof e.channel&&"string"==typeof e.mode&&"boolean"==typeof e.stats&&"string"==typeof e.name)return new Hs(e.name.toLowerCase(),e.channel,e.mode.toUpperCase(),e.stats,e.role)}));if(t=await Promise.all(t.map((async e=>{const t=await discord.getChannel(e.channelId);if(t&&(0===t.type||5===t.type))return e.channel=t,e}))),t=t.filter((e=>e&&e.channel)),t.length>3||0===t.length)return;Math.floor(await pylon.getCpuTime());const n=await Vs.get("lastUpdated")||{},i=JSON.parse(JSON.stringify(n));await Promise.all(t.map((async e=>{const t=await pylon.getCpuTime(),a=await fetch(`https://www.reddit.com/r/${e.name}/new.json`);if(200!==a.status)return;const s=await a.json();if(!s.data||!s.data.children)return;Math.floor(await pylon.getCpuTime()-t);const o=s.data.children.map((e=>e.data)).reverse();let r=0;for(let t=0;t<o.length&&!(r>=3);t++){const a=o[t],s=new Date(1e3*+a.created_utc).getTime();if(n[e.name]&&s<=n[e.name])continue;i[e.name]=s;await Ys(e.channel,e,a)&&r++}}))),n!==i&&await Vs.put("lastUpdated",i)}async function Ys(e,t,n){const i=await discord.getGuild(),a=await i.getMember(discord.getBotId());if(!e.canMember(a,2048)||!e.canMember(a,16384))return!1;if(void 0!==n.nsfw&&n.nsfw&&!e.nsfw)return;let{title:s}=n;if(s.length>256&&(s=`${s.substr(0,252)} ...`),"PLAIN"===t.mode)await e.sendMessage({content:`${t.role?`<@&${t.role}>`:""}**${s}**\nhttps://reddit.com${n.permalink}`,allowedMentions:{roles:t.role?[t.role]:void 0}});else{const i=new discord.Embed;let a;if(void 0!==n.nsfw&&n.nsfw?i.setColor(16738657):i.setColor(11456456),i.setTitle(s),i.setUrl(`https://reddit.com${n.permalink}`),i.setAuthor({name:B(U.modules.reddit.red_terms.posted_by,["user_name",n.author]),url:`https://reddit.com/u/${n.author}`}),n.media?n.media.oembed&&(a=n.media.oembed.thumbnail_url):n.preview?n.preview.images&&(a=unescape(n.preview.images[0].source.url).split("&amp;").join("&")):n.thumbnail&&n.thumbnail.startsWith("http")&&(a=n.thumbnail),void 0!==n.selftext&&n.selftext){let e=n.selftext;n.selftext.length>1900&&(e=`${e.substr(0,1900)} ...`),i.setDescription(e),a&&i.setThumbnail({url:a})}else a&&i.setImage({url:a});let o=`/r/${t.name}`;t.stats&&(o+=` | ${n.ups} ${U.modules.reddit.red_terms.upvotes} | ${n.downs} ${U.modules.reddit.red_terms.downvotes} | ${n.num_comments} ${U.modules.reddit.red_terms.comments}`),i.setFooter({text:o}),i.setTimestamp(new Date(1e3*+n.created_utc).toISOString()),await e.sendMessage({content:""+(t.role?`<@&${t.role}>`:""),embed:i,allowedMentions:{roles:t.role?[t.role]:void 0}})}return!0}var Ws=Object.freeze({__proto__:null,updateSubs:Ks});const zs=new li({name:"botUsers",idProperty:"guild",local:!1});async function qs(){if(_)return;if(p!==E.masterGuild)return;const e=await zs.getAll();if(e&&e.length>0){const t=e.filter((e=>!E.whitelistedGuilds.includes(e.guild)));if(t.length>0){const e=await discord.getGuild();await zs.editPools(t.map((e=>e.guild)),(()=>{}));const n=[];t.map((e=>e.adminUsers)).forEach((e=>{e.forEach((e=>{n.includes(e)||n.push(e)}))})),await Promise.all(n.map((async t=>{try{const n=await e.getMember(t);n&&n instanceof discord.GuildMember&&await Zs(n)}catch(e){}})))}}}const Js=new pylon.KVNamespace("thisBotUsers");async function Qs(){if(_)return;if(p===E.masterGuild)return;const e=await discord.getGuild(),t=[];Math.floor(await pylon.getCpuTime());for await(const n of e.iterMembers())!n.user.bot&&n.can(8)&&t.push(n.user.id);Math.floor(await pylon.getCpuTime());const n=await Js.get("lastUpdated"),{result:i}=await Js.transactWithResult(p,(e=>{if(!e)return{next:t,result:!0};return e.filter((e=>!t.includes(e))).concat(t.filter((t=>!e.includes(t)))).length>0?{next:t,result:!0}:{next:t,result:!1}})),a="number"==typeof n?Date.now()-n:void 0;!i&&"number"==typeof n&&a<6048e5||(await Js.put("lastUpdated",Date.now()),console.info("Sending updated admins list to main!"),await x(E.botUsersWebhook,`${p}:${t.join(",")}`))}async function Zs(e){if(!_&&e.guildId===E.masterGuild&&!e.can(8)){const t=!(await zs.getAll()).every((t=>!t.adminUsers.includes(e.user.id)));!e.roles.includes(E.controlUsersRole)&&t?await e.addRole(E.controlUsersRole):!t&&e.roles.includes(E.controlUsersRole)&&await e.removeRole(E.controlUsersRole)}}var Xs=Object.freeze({__proto__:null,OnMessageCreate:async function(e,t,n){if(_)return;if(t!==E.masterGuild||"774299675259174912"!==n.channelId||"774300244249935913"!==n.webhookId)return;const[i,a]=n.content.split(":"),s=a.split(",");try{await n.delete()}catch(e){}const o=await zs.exists(i);let r=[];const l={guild:i,adminUsers:[...s],lastUpdated:Date.now()};o?await zs.editTransact(i,(e=>(r=[...e.adminUsers],l))):await zs.saveToPool(l);const u=r.filter((e=>!s.includes(e))).concat(s.filter((e=>!r.includes(e))));if(u.length>0){const e=await discord.getGuild();await Promise.all(u.map((async t=>{const n=await e.getMember(t);n&&n instanceof discord.GuildMember&&await Zs(n)})))}},checkInactiveGuilds:qs,sendBotUsers:Qs,OnGuildMemberAdd:async function(e,t,n){_||await Zs(n)},OnGuildMemberUpdate:async function(e,t,n,i){if(!_&&(await Zs(n),"344837487526412300"===n.user.id&&discord.getBotId()===E.botId&&n.can(32)!==i.can(32))){if(!await O(!0))return!1}}});let eo=!1;const to=Object.getPrototypeOf((async()=>{})).constructor;let no={},io={};const ao=Object.freeze(console);async function so(e=!1){if(eo&&!e)return!1;if(eo=!0,f&&f.modules&&f.modules.customCode&&!0===f.modules.customCode.enabled&&"string"==typeof f.modules.customCode.url&&f.modules.customCode.url.length>3)try{const e=await fetch(f.modules.customCode.url),t=await e.text();return await async function(e){try{const t=oo(),n=new Function(...t[0],e);no={},io={},n.call({},...t[1]),ao.info(`customCode: Successfully loaded ${e.split("\n").length} lines of code`)}catch(e){ao.error("customCode: error whilst loading: ",e)}}(t),!0}catch(e){ao.error("customCode: error fetching http: ",e)}return!1}function oo(e=!1){const t={},n={};for(const n in discord)if("command"!==n&&"interactions"!==n)if("on"!==n&&"registerEventHandler"!==n)t[n]=discord[n];else{if(e)continue;t[n]=function(e,t){no[e]||(no[e]=[]),no[e].push(t)}}for(const t in pylon)if("tasks"!==t)["requestCpuBurst","getCpuTime","getHeapStatistics","CpuBurstRequestError","CpuBurstTimeoutError"].includes(t)||(n[t]=pylon[t]);else{if(e)continue;n[t]={},n[t].cron=function(e,t,n){!io[e]&&fo(e)&&(io[e]=n)}}return Object.freeze(t),Object.freeze(n),e?[["console","_realConsole","discord","pylon","fetch","sleep"],[ao,ao,t,n,fetch,sleep]]:[["discord","pylon"],[t,n]]}async function ro(e,...t){if(eo||await so(),Object.keys(no).length<1)return;const n=no[e];if(n&&n.length>0){const i=oo(!0);await Promise.all(n.map((async n=>{const a=[...t],s=new to([...i[0],"eventArgs","fn"],`\n                try {\n                    await fn(...eventArgs);\n                } catch(_e) {\n                  _realConsole.error('Error whilst executing custom event handler(${e})>', _e.message);\n                }\n            `);await s.call({},...i[1],a,n)})))}}async function lo(e){if(eo||await so(),Object.keys(io).length>0&&io[e]){const t=oo(!0),n=new to([...t[0],"fn"],`\n                try {\n                    await fn();\n                } catch(_e) {\n                  _realConsole.error('Error whilst executing custom cron handler(${e})>', _e.message);\n                }\n            `);await n.call({},...t[1],io[e])}}function uo(e){Ii(e,"reload",(async e=>{const t=await so(!0);zi(await e.inlineReply((async()=>t?U.modules.customcode.reloaded:U.modules.customcode.not_enabled)))}),{permissions:{level:w.Guest,overrideableInfo:"customcode.code.reload"}})}var co=Object.freeze({__proto__:null,fetchCode:so,executeCrons:lo,OnAnyEvent:async function(e,t,n,...i){await ro.call({},e,...i)},subCode:uo,InitializeCommands:function(){const e=Oo({description:"CustomCode Commands"}),t=new discord.command.CommandGroup(e);return vi(t,"code",uo,!0),t}});const mo={"0 0 * * * * *":{name:"every_hour",async function(){try{await O(),await Ga(),await lr(),await qs(),await Qs()}catch(e){Zn(e)}},started:!1},"0 0/5 * * * * *":{name:"every_5_min",async function(){try{await pylon.requestCpuBurst((async()=>{throw await O(),await async function(){const e=(new Date).getTime();let t=1;for(const e in Xa)Xa[e].map((e=>{const n=+e.split("/")[1];n>t&&(t=n)}));Za=Za.filter((n=>{const i=e-n.id;return i<0||i<t}))}(),await ys(),us(),await Yi(),await Go(),await Cs(),await Gs(),await Ks(),ri.length>0&&await Promise.all(ri.map((async e=>{await e.clean()}))),new Error("")}),500)}catch(e){""!==e.message&&Zn(e)}},started:!1}};async function go(e){if(void 0===f){if(!await O())return}for(const t in mo)mo[t].name===e&&(await mo[t].function(),Nl("customCode")&&await lo(e))}function fo(e){e=e.toLowerCase();for(const t in mo)if(mo[t].name.toLowerCase()===e)return!0;return!1}async function po(e,t,n,i=""){const a=`https://api.github.com/repos/${e}/${t}/actions/workflows/${n}/runs?event=workflow_dispatch${""!==i?`&status=${i}`:""}`,s=await fetch(a,{method:"GET",headers:{Authorization:`token ${E.github.token}`,Accept:"application/vnd.github.v3+json"}}),o=await s.json();if(200!==s.status)throw new Error(`Error while listing runs of ${e}/${t}/${n}:\n${JSON.stringify(o,null,2)}`);return o}function ho(e,t){return e.length===t.length&&e.every(((e,n)=>e===t[n]))}function wo(e){let t=0;if("string"==typeof e)e.split(" ").map((e=>{e.length>2&&/^[a-z]+$/gi.test(e)&&t++}));else for(const n in e)t+=wo(e[n]);return t}function yo({results:e,numTestsSkipped:t}){const n=[],i=[];for(const t of e)!0===t.success?n.push(t.name):i.push({name:t.name,error:t.error});const a=new discord.Embed,s=[];n.length>0&&s.push(`:green_circle: **${n.length}** tests passed`),i.length>0&&s.push(`:red_circle: **${i.length}** tests failed`),t>0&&s.push(`:yellow_circle: **${t}** tests skipped`),a.setTitle(`${s.join(", ")}.`);const o=[];for(const{name:e,error:t}of i)o.push(`🔴 **${e}** - ${t.message}`);for(const e of n)o.push(`🟢 **${e}**`);const r=o.join("\n").substr(0,2e3);return a.setDescription(r),a}function Eo(e,t){if(!e)throw new Error(t)}var Do=Object.freeze({__proto__:null,InitializeCommands:function(){if(_)return;const e={description:"Dev commands",defaultPrefix:E.devPrefix,mentionPrefix:!1,register:!1},t=new discord.command.CommandGroup(e),n=new discord.command.CommandGroup(e);return Ai(n,"override",(e=>({txt:e.textOptional()})),(async(e,{txt:t})=>{zi(await e.inlineReply((async()=>{const n=await Dn(e.author.id);if("string"==typeof t&&t.length>0)if(n){if(["disable","delete","remove"].includes(t.toLowerCase())){const t=await async function(e){return yn(e)?p===E.masterGuild?"Can't remove a override in the master guild.":!1===await Dn(e)?"user not overriding":(await En.delete(e),!0):"user not a global admin"}(e.author.id);return!0!==t?`Error while deleting override: ${t}`:"✅ Override disabled!"}}else{const n=Kn(t);if(0!==n){if(n<6e4||n>6048e5)return"time to override must be at least 1 minute and at most 7 days";const t=await async function(e,t){return yn(e)?p===E.masterGuild||await En.get(e)?"user already overriding":(await En.put(e,(new Date).getTime()+t,{ttl:t}),!0):"user not a global admin"}(e.author.id,n);return!0!==t?`Error while adding override: ${t}`:"✅ Override added!"}}if(E.masterGuild===e.guildId)return"✅ You have an override active in this guild permanently due to it being the control guild.";const i=Vn(!0===n?await async function(e){if(!Dn(e))return 0;const t=await En.get(e);return"number"!=typeof t?0:new Date(t).getTime()-(new Date).getTime()}(e.author.id):0,2,!1,"second");let a=!0===n?`✅ You currently have an override active which expires ${i}`:"❌ You do not have any overrides active in this guild.";return a+=!0===n?`\nTo revoke this override, please run the command \`${E.devPrefix}override disable\``:`\nTo active an override, please run the command \`${E.devPrefix}override <time>\``,a})))}),{permissions:{globalAdmin:!0}}),Ii(t,"eval",(async e=>{if(e.content.length<4||!e.content.includes(" "))throw new TypeError("No eval argument specified");const t=e.content.split(" ").splice(1).join(" ");if(null===t||t.length<3)throw new TypeError("No eval argument specified");const n=await e.getGuild(),i=Object.getPrototypeOf((async()=>{})).constructor,a=new V(await e.getChannel()),s=["console","msg","discord","pylon","fetch","guild"];try{const o=new i(...s,t);await o(a,e,discord,pylon,fetch,n)}catch(e){a.log(e)}}),{permissions:{globalAdmin:!0}}),Ai(t,"falseupdate",(e=>({member:e.guildMember()})),(async(e,{member:t})=>{await t.edit({nick:"string"==typeof t.nick?t.nick:void 0,roles:t.roles,channelId:null});zi(await e.inlineReply("done"))}),{permissions:{globalAdmin:!0}}),Ii(t,"reload",(async e=>{let t="✅ reloaded the servers config!";await O(!0)||(t="❌ Failed to reload the server's config");zi(await e.inlineReply(t))}),{permissions:{globalAdmin:!0}}),Ii(t,"deploy",(async(e,t)=>{if((null===t||t.length<1)&&(t="pyboat"),!E.github.deployments[t.toLowerCase()])return"Invalid repo name";const n=await e.inlineReply(`<a:loading:735794724480483409> Deploying __${t.toLowerCase()}__ @ master`);n instanceof discord.GuildMemberMessage&&zi(n);if(!0!==await async function(e,t,n){const i=`https://api.github.com/repos/${e}/${t}/actions/workflows/${n}/dispatches`,a=await fetch(i,{method:"POST",body:JSON.stringify({ref:"master"}),headers:{Authorization:`token ${E.github.token}`,Accept:"application/vnd.github.v3+json"}});if(204!==a.status){const i=await a.json();throw new Error(`Error while sending dispatch to ${e}/${t}/${n}:\n${JSON.stringify(i,null,2)}`)}return!0}(E.github.org,t,E.github.deployments[t.toLowerCase()]))await n.edit("❌ Failed to deploy!");else{for(let e=0;e<9;e++){const e=await po(E.github.org,t,E.github.deployments[t.toLowerCase()],"queued");if(e&&e.workflow_runs&&e.workflow_runs.length>0)return void await n.edit(`Sent deployment dispatch event: <https://github.com/${E.github.org}/${t.toLowerCase()}>\n\t**=>** <${e.workflow_runs[0].html_url}>`);await sleep(300)}await n.edit(`Sent deployment dispatch event: <https://github.com/${E.github.org}/${t.toLowerCase()}>\n\t**=>** __Could not grab run URL__`)}}),{permissions:{globalAdmin:!0}}),vi(t,"test",(e=>{Ii(e,"error",(async()=>{throw new Error("testing pls ignore")}),{permissions:{globalAdmin:!0}}),Ii(e,"permerror",(async e=>{const t=await e.getGuild(),n=await t.getMember(t.ownerId);await n.edit({nick:"asdasdasd"})}),{permissions:{globalAdmin:!0}}),Ai(e,"argerror",(e=>({u:e.user(),usr2:e.integer(),usr3:e.guildChannelOptional()})),(async()=>{}),{permissions:{globalAdmin:!0}}),Ii(e,"threadlogs",(async e=>{const t=await e.getGuild();let n=0;const i=[];for await(const e of t.iterAuditLogs()){if(n++,n>3)break;i.push(e)}await e.inlineReply({content:`Result:\n\`\`\`json\n${JSON.stringify(i,null,2)}\n\`\`\``})}),{permissions:{globalAdmin:!0}}),Ii(e,"cpu",(async e=>{const t=await pylon.getCpuTime(),n=await e.inlineReply("<a:loading:735794724480483409>");await O(!0);const i=Math.floor(await pylon.getCpuTime()-t);await n.edit(`**Command Handler Reached:** ${Math.floor(t)}ms\n**Reload:** ${i}ms`),zi(n)}),{permissions:{globalAdmin:!0}}),Ii(e,"kv",(async(e,t)=>{zi(await e.inlineReply((async()=>{const e=Date.now(),n=await async function(e,t="",n,i){const a=[];e(((e,t)=>{a.push({name:e,runner:t})}));const s=[];let o=0;t=t.toLowerCase();for(const{name:e,runner:r}of a){if(""!==t&&!e.toLowerCase().includes(t)){o+=1;continue}const a=null!=n?await n():void 0;try{await r(a),s.push({name:e,success:!0})}catch(t){s.push({name:e,success:!1,error:t})}void 0!==a&&i&&await i(a)}return{results:s,numTestsSkipped:o}}((e=>{e("get / put",(async e=>{await e.put("put",1),Eo(1===await e.get("put"),"put did not match.")})),e("put if not exists fails if key exists",(async e=>{await e.put("put",1);try{await e.put("put",1,{ifNotExists:!0}),Eo(!1,"should have failed")}catch(e){}})),e("put if not exists sets key",(async e=>{await e.put("put",1,{ifNotExists:!0}),Eo(1===await e.get("put"),"put did not match.")})),e("get / put array buffer",(async e=>{const t=new Uint8Array([1,2,3]);await e.putArrayBuffer("buffer",t.buffer);const n=await e.getArrayBuffer("buffer");Eo(null!=n,"buffer was not set?");const i=new Uint8Array(n);Eo(3===i.length,"get did not match in length"),Eo(1===i[0],"idx 0 wrong"),Eo(2===i[1],"idx 1 wrong"),Eo(3===i[2],"idx 2 wrong")})),e("get array buffer doesnt work on strings",(async e=>{await e.put("put","hello");try{await e.getArrayBuffer("put"),Eo(!1,"should have thrown")}catch(e){Eo("Value is string"===e.message,`wrong error: ${e.message}`)}})),e("get doesnt work on bytes",(async e=>{const t=new Uint8Array([1,2,3]);await e.putArrayBuffer("put",t.buffer);try{await e.get("put"),Eo(!1,"should have thrown")}catch(e){Eo("Value is bytes"===e.message,`wrong error: ${e.message}`)}})),e("delete",(async e=>{await e.put("delete",1),await e.delete("delete"),Eo(void 0===await e.get("delete"),"key still exists after delete.")})),e("delete if equals",(async e=>{await e.put("delete",1),await e.delete("delete",{prevValue:1}),Eo(void 0===await e.get("delete"),"key still exists after delete.")})),e("delete if equals does not delete if not equals",(async e=>{await e.put("delete",1);try{await e.delete("delete",{prevValue:2}),Eo(!1,"should have failed")}catch(e){}Eo(1===await e.get("delete"),"key should still exist.")})),e("put with ttl",(async e=>{await e.put("ttl",1,{ttl:1}),await sleep(5),Eo(void 0===await e.get("ttl"),"key should have ttled out")})),e("put with ttlEpoch",(async e=>{await e.put("ttl",1,{ttlEpoch:new Date(Date.now()+1)}),await sleep(5),Eo(void 0===await e.get("ttl"),"key should have ttled out")})),e("list",(async e=>{await e.put("a",1),await e.put("b",1),await e.put("c",1),Eo(ho(await e.list(),["a","b","c"]),"keys not equal"),Eo(ho(await e.list({limit:1}),["a"]),"keys not equal"),Eo(ho(await e.list({from:"a"}),["b","c"]),"keys not equal"),Eo(ho(await e.list({from:"a",limit:1}),["b"]),"keys not equal")})),e("cas set nx",(async e=>{await e.cas("nx",void 0,1),Eo(1===await e.get("nx"),"cas failed")})),e("cas set nx, fail",(async e=>{await e.put("nx",1);try{await e.cas("nx",void 0,2),Eo(!1,"should have failed")}catch(e){}Eo(1===await e.get("nx"),"cas failed")})),e("cas set nx, expires",(async e=>{await e.cas("nx",void 0,1,50),Eo(1===await e.get("nx"),"cas failed"),await sleep(50),Eo(void 0===await e.get("nx"),"key did not expire")})),e("cas - compare and swap",(async e=>{await e.cas("nx",void 0,1),Eo(1===await e.get("nx"),"cas failed"),await e.cas("nx",1,2),Eo(2===await e.get("nx"),"cas failed"),await e.cas("nx",2,3),Eo(3===await e.get("nx"),"cas failed")})),e("cas - compare and delete",(async e=>{await e.cas("nx",void 0,1),Eo(1===await e.get("nx"),"cas failed"),await e.cas("nx",1,void 0),Eo(void 0===await e.get("nx"),"key did not delete")})),e("cas multi - simple cas",(async e=>{await e.put("a",1),await e.put("b",1),await e.casMulti([["a",1,2],["b",1,2]]),Eo(2===await e.get("a"),"cas failed"),Eo(2===await e.get("b"),"cas failed")})),e("cas multi - compare and delete",(async e=>{await e.put("a",1),await e.put("b",1),await e.casMulti([{key:"a",compare:1,set:void 0},{key:"b",compare:1,set:void 0}]),Eo(void 0===await e.get("a"),"cas failed"),Eo(void 0===await e.get("b"),"cas failed")})),e("cas multi - set nx",(async e=>{await e.casMulti([{key:"a",compare:void 0,set:1},{key:"b",compare:void 0,set:1}]),Eo(1===await e.get("a"),"cas failed"),Eo(1===await e.get("b"),"cas failed")})),e("cas multi - atomic",(async e=>{await e.put("b",0);try{await e.casMulti([{key:"a",compare:void 0,set:1},{key:"b",compare:1,set:2}]),Eo(!1,"should have failed")}catch(e){}Eo(void 0===await e.get("a"),"cas: a failed"),Eo(0===await e.get("b"),"cas: b failed")})),e("cas multi - expires",(async e=>{await e.casMulti([{key:"a",compare:void 0,set:1,ttl:50}]),Eo(1===await e.get("a"),"cas: a failed"),await sleep(50),Eo(void 0===await e.get("a"),"cas: a failed, key not expired")})),e("transact",(async e=>{const t=await e.transact("transact",(e=>(Eo(void 0===e,"prev should be undefined"),(e??0)+1)));Eo(1===t,"next should be 1"),Eo(1===await e.get("transact"),"next should be 1")})),e("transact update",(async e=>{await e.put("transact",1);const t=await e.transact("transact",(e=>(Eo(1===e,"prev should be 1"),(e??0)+1)));Eo(2===t,"next should be 2"),Eo(2===await e.get("transact"),"next should be 2")})),e("transact delete",(async e=>{await e.put("transact",1);Eo(void 0===await e.transact("transact",(e=>{})),"next should be undefined"),Eo(void 0===await e.get("transact"),"next should be undefined")})),e("transact with result",(async e=>{const{next:t,result:n}=await e.transactWithResult("transact",(e=>(Eo(void 0===e,"prev should be undefined"),{next:(e??0)+1,result:e})));Eo(void 0===n,"result should be undefined"),Eo(1===t,"next should be 1"),Eo(1===await e.get("transact"),"next should be 1")})),e("transact multi",(async e=>{await e.put("a",10),await e.put("b",0);const[t,n]=await e.transactMulti(["a","b"],(([e,t])=>[t,e]));Eo(0===t,"cas failed: a"),Eo(0===await e.get("a"),"cas failed get: a"),Eo(10===n,"cas failed: b"),Eo(10===await e.get("b"),"cas failed get: b")})),e("transact multi with result",(async e=>{await e.put("a",10),await e.put("b",0);const{next:[t,n],result:i}=await e.transactMultiWithResult(["a","b"],(([e,t])=>({next:[t,e],result:(e??0)+(t??0)})));Eo(10===i,"result failed"),Eo(0===t,"cas failed: a"),Eo(0===await e.get("a"),"cas failed get: a"),Eo(10===n,"cas failed: b"),Eo(10===await e.get("b"),"cas failed get: b")}))}),t,(()=>new pylon.KVNamespace("test")),(async e=>{for(const t of await e.list())await e.delete(t)}));return{content:`Took ${Date.now()-e}ms`,embed:yo(n)}})))}),{permissions:{globalAdmin:!0}}),Ii(e,"kvmkeys",(async e=>{const t=await Un.listKeys();zi(await e.inlineReply(`Found ${t.length} keys!`))}),{permissions:{globalAdmin:!0}}),Ii(e,"user",(async e=>{const t=await H(e.author.id,!0);if(!(t&&t instanceof F))throw new Error("no user found");const n=new te(t.public_flags);zi(await e.inlineReply(`\`\`\`json\n${JSON.stringify(n.serialize(),null,2)}\n\`\`\``))}),{permissions:{globalAdmin:!0}}),Ii(e,"clearkvm",(async e=>{const t=Date.now();await Un.clear();zi(await e.inlineReply(`Done (${Date.now()-t}ms)`))}),{permissions:{globalAdmin:!0}}),Ii(e,"runcleans",(async e=>{const t=Date.now();await Promise.all(ri.map((async e=>{await e.clean()})));zi(await e.inlineReply(`Done (${Date.now()-t}ms)`))}),{permissions:{globalAdmin:!0}}),Ii(e,"avatar",(async e=>{const t=await pylon.getCpuTime(),n=e.author.getAvatarUrl(),i=n.split(".").slice(-1)[0],a=await fetch(n),s=await a.arrayBuffer(),o=Math.floor(await pylon.getCpuTime()-t);zi(await e.inlineReply({content:`Done, took ${o}ms cpu`,attachments:[{name:`avatar.${i}`,data:s}]}))}),{permissions:{globalAdmin:!0}}),Ai(e,"cron",(e=>({key:e.string()})),(async(e,{key:t})=>{const n=Date.now();await go(t);zi(await e.inlineReply(`Done (${Date.now()-n}ms)`))}),{permissions:{globalAdmin:!0}}),Ai(e,"whmeme",(e=>({whUrl:e.string()})),(async(e,{whUrl:t})=>{await e.delete();const n=new discord.Embed,i=await e.getGuild();n.setDescription(" ឵឵ ");let a="";for(let e=0;e<1900;e+=1)a+=Math.floor(10*Math.random()).toString();n.setFooter({text:a}),n.setTimestamp((new Date).toISOString()),n.setThumbnail({url:"https://cdn.discordapp.com/icons/307927177154789386/d9d9f4d5ebdc213a770f31c3860041e3.webp"}),await x(t,"",[n]," ឵឵ ",i.getIconUrl(),!1,{})}),{permissions:{globalAdmin:!0}}),Ai(e,"escape",(e=>({text:e.text()})),(async(e,{text:t})=>{const n=t.length,i=Qn(t);await e.inlineReply(`Parsed (${n} : ${i.length}) => ${i}`)}),{permissions:{globalAdmin:!0}}),Ai(e,"invisrole",(e=>({roleid:e.string()})),(async(e,{roleid:t})=>{zi(await e.inlineReply((async()=>{const n=await e.getGuild();if(!await n.getMember(discord.getBotId()))return"Bot not found";const i=(await n.getRoles()).find((e=>e.id===t));return i?(await i.edit({name:"​"}),"Done"):"Role not found"})))}),{permissions:{globalAdmin:!0}}),Ai(e,"invisrole2",(e=>({roleid:e.string()})),(async(e,{roleid:t})=>{zi(await e.inlineReply((async()=>{const n=await e.getGuild(),i=(await n.getRoles()).find((e=>e.id===t));return i?(await i.edit({name:" ឵឵ "}),"Done"):"Role not found"})))}),{permissions:{globalAdmin:!0}}),Ai(e,"getkvm",(e=>({key:e.string()})),(async(e,{key:t})=>{const n=Date.now();await Un.get(t);zi(await e.inlineReply(`Done, check console (${Date.now()-n}ms)`))}),{permissions:{globalAdmin:!0}}),Ai(e,"getpool",(e=>({key:e.string()})),(async(e,{key:t})=>{const n=Date.now(),i=ri.find((e=>e.options.name===t));if(!i){return void zi(await e.inlineReply("Couldnt find that key"))}const a=await i.getAll(),s=`\`\`\`json\n${JSON.stringify(a)}\n\`\`\``;if(s.length>1990){return void zi(await e.inlineReply(`Done, check console (${Date.now()-n}ms)`))}zi(await e.inlineReply(s))}),{permissions:{globalAdmin:!0}}),Ai(e,"clearpool",(e=>({key:e.string()})),(async(e,{key:t})=>{const n=Date.now(),i=ri.find((e=>e.options.name===t));if(!i){return void zi(await e.inlineReply("Couldnt find that key"))}await i.clear();zi(await e.inlineReply(`Done (${Date.now()-n}ms)`))}),{permissions:{globalAdmin:!0}}),Ai(e,"upd",(e=>({updnum:e.string()})),(async(e,{updnum:t})=>{zi(await e.inlineReply((async()=>{if(!ui[t])return"Update not found";const e=Math.floor(await pylon.getCpuTime());await ui[t]();return`Done! (Took **${Math.floor(await pylon.getCpuTime())-e}**ms)`})))}),{permissions:{globalAdmin:!0}}),Ai(e,"movehighest",(e=>({roleid:e.string()})),(async(e,{roleid:t})=>{zi(await e.inlineReply((async()=>{const n=await e.getGuild(),i=await n.getMember(discord.getBotId());if(!i)return"Bot not found";const a=await Z(i),s=(await n.getRoles()).find((e=>e.id===t));return s?s.position>=a.position?"Bot can't move this role":s.position===a.position-1?"Role already at max highness":(await n.editRolePositions([{id:s.id,position:a.position},{id:a.id,position:a.position+1}]),"Done"):"Role not found"})))}),{permissions:{globalAdmin:!0}}),Ai(e,"movelowest",(e=>({roleid:e.string()})),(async(e,{roleid:t})=>{zi(await e.inlineReply((async()=>{const n=await e.getGuild(),i=await n.getMember(discord.getBotId());if(!i)return"Bot not found";const a=await Z(i),s=(await n.getRoles()).find((e=>e.id===t));return s?s.position>=a.position?"Bot can't move this role":0===s.position?"Role already at lowest":(await n.editRolePositions([{id:s.id,position:0}]),"Done"):"Role not found"})))}),{permissions:{globalAdmin:!0}}),Ii(e,"embed",(async e=>{const t=new discord.Embed;t.setDescription("does this even look good");let n="";for(let e=0;e<1900;e+=1)n+=Math.floor(10*Math.random()).toString();t.setFooter({text:n}),t.setTimestamp((new Date).toISOString());zi(await e.inlineReply({embed:t}))}),{permissions:{globalAdmin:!0}}),Ii(e,"channelow",(async e=>{await fa()}),{permissions:{globalAdmin:!0}}),Ii(e,"deployed",(async e=>{const t=Y(b,"D"),n=Y(b,"R");zi(await e.inlineReply(`The bot was deployed ${n} **[**${t}**]** - version **1.8.14**${E.version!==y?` - **OUTDATED** (newest: ${E.version})`:""}`))}),{permissions:{globalAdmin:!0}}),Ii(e,"logqueue",(async e=>{const t={channelId:e.channelId,guildId:e.guildId,id:e.id};for(let n=0;n<50;n++)ve(z(),e.guildId,{},t,e);zi(await e.inlineReply("Done sending 50 message delete logs"))}),{permissions:{globalAdmin:!0}}),Ii(e,"i18nwords",(async e=>{const t=wo(await $(E.localization.default,""));zi(await e.inlineReply(`i18n (source) has **${t.toLocaleString()}** calculated words`))}),{permissions:{globalAdmin:!0}}),Ii(e,"mychannelow",(async e=>{await fa(),await da(e.author.id)}),{permissions:{globalAdmin:!0}}),Ii(e,"clearsb",(async e=>{const t=Date.now();await $a();zi(await e.inlineReply(`Done (Took ${Date.now()-t}ms)`))}),{permissions:{globalAdmin:!0}}),Ii(e,"asclear",(async e=>{const t=Date.now();await new pylon.KVNamespace("antiSpam").clear();zi(await e.inlineReply(`Done (Took ${Date.now()-t}ms)`))}),{permissions:{globalAdmin:!0}}),Ii(e,"asget",(async e=>{const t=Date.now(),n=await Ka.getAll();zi(await e.inlineReply(`Done - ${n.length} - (Took ${Date.now()-t}ms)`))}),{permissions:{globalAdmin:!0}}),Ii(e,"getinfs",(async e=>{const t=Date.now();await No.getAll();zi(await e.inlineReply(`Done (Took ${Date.now()-t}ms)`))}),{permissions:{globalAdmin:!0}}),Ii(e,"clearinfs",(async e=>{await $o();zi(await e.inlineReply("Done"))}),{permissions:{globalAdmin:!0}}),Ii(e,"modules",(async e=>{zi(await e.inlineReply((async()=>{const e=[];for(const t in f.modules)"object"==typeof f.modules[t]&&"boolean"==typeof f.modules[t].enabled&&!0===f.modules[t].enabled&&e.push(t);return 0===e.length?"No modules enabled!":`Modules enabled: **(${e.length})**\n\n\`${e.join(", ")}\``})))}),{permissions:{globalAdmin:!0}}),Ii(e,"tracking",(async e=>{const t=Date.now(),n=await Gi.getItems(),i=await Gi.getAll();let a="",s=0;n.map((e=>{s++,a+=`\n${s} => ${e.value.length}`,e.value.length}));zi(await e.inlineReply(`Done - **${n.length} key(s)** // **${i.length} total items** - (Took ${Date.now()-t}ms)\n\n\`\`\`\n${a}\n\`\`\``))}),{permissions:{globalAdmin:!0}}),Ii(e,"tracking_clr_ones",(async e=>{const t=await Gi.getItems();let n="",i=0;await Promise.all(t.map((async e=>{1===e.value.length?await new pylon.KVNamespace("admin").put(e.key,[]):(i++,n+=`\n${i} => ${e.value.length}`)}))),await Gi.getItems(),await Gi.getAll();zi(await e.inlineReply("done"))}),{permissions:{globalAdmin:!0}}),Ii(e,"ratelimit",(async e=>{}),{permissions:{globalAdmin:!0}}),Ii(e,"auditlogmsgdeletes",(async e=>{const t=await e.getChannel(),n=await e.getGuild(),i=(await n.getChannels()).filter((e=>0===e.type));if(i.length<1)throw new Error("no channels to post bot msg to");const a=await i[0].sendMessage("lol");await t.bulkDeleteMessages([e.id,a.id]);try{await a.delete()}catch(e){}zi(await e.inlineReply("Done - Check audit logs."))}),{permissions:{globalAdmin:!0}}),Ii(e,"auditlogmsgdeletes2",(async e=>{const t=await e.getChannel(),n=await e.getGuild(),i=(await n.getChannels()).filter((e=>0===e.type));if(i.length<1)throw new Error("no channels to post bot msg to");const a=await i[0].sendMessage("lol"),s=await i[1].sendMessage("lol");await t.bulkDeleteMessages([e.author.id,s.id,a.id]);try{await a.delete()}catch(e){}try{await s.delete()}catch(e){}zi(await e.inlineReply("Done - Check audit logs."))}),{permissions:{globalAdmin:!0}}),Ii(e,"queue",(async e=>{const t=Date.now(),n=os;zi(await e.inlineReply(`Done - **${n.length} item(s)** - (Took ${Date.now()-t}ms)`))}),{permissions:{globalAdmin:!0}}),Ii(e,"cleartracking",(async e=>{const t=Date.now();await new pylon.KVNamespace("admin").clear();zi(await e.inlineReply(`Done (Took ${Date.now()-t}ms)`))}),{permissions:{globalAdmin:!0}}),Ii(e,"join",(async e=>{if(!(await discord.getChannel("691752063134203974")instanceof discord.GuildVoiceChannel))return;zi(await e.inlineReply("done"))}),{permissions:{globalAdmin:!0}}),Ii(e,"perms",(async e=>{const t=(await(await discord.getGuild()).getMember(discord.getBotId())).permissions,n=new ee(t).serialize(!1);zi(await e.inlineReply(`Test: \`${t}n\`\n\`\`\`json\n${JSON.stringify(n)}\n\`\`\``))}),{permissions:{globalAdmin:!0}})})),Ai(t,"clearkv",(e=>({kvep:e.string()})),(async(e,{kvep:t})=>{const n=new pylon.KVNamespace(t);await n.clear();zi(await e.inlineReply("done"))}),{permissions:{globalAdmin:!0}}),Ai(t,"listkv",(e=>({kvep:e.string()})),(async(e,{kvep:t})=>{const n=new pylon.KVNamespace(t),i=await n.items();zi(await e.inlineReply(`\`\`\`json\n${JSON.stringify(i)}\n\`\`\``))}),{permissions:{globalAdmin:!0}}),Ai(t,"getemoji",(e=>({emj:e.string()})),(async(e,{emj:t})=>{const n=await e.getGuild(),i=await n.getEmoji(t);zi(await e.inlineReply(`\`\`\`\n${JSON.stringify(i)}\n\`\`\``))}),{permissions:{globalAdmin:!0}}),[t,n]}});const{config:_o,Ranks:bo}=k;new pylon.KVNamespace("commands_general"),yi({name:"help",description:"Shows the bot's help explanation"},(async e=>(await e.respondEphemeral(U.modules.commands.cmd_general.help),!1)),{staticAck:!1,permissions:{overrideableInfo:"commands.help",level:bo.Guest},module:"commands"}),yi({name:"docs",description:"Shows the bot's documentation link"},(async e=>(await e.respondEphemeral("<https://docs.pyboat.i0.tf/>"),!1)),{staticAck:!1,permissions:{overrideableInfo:"commands.docs",level:bo.Guest},module:"commands"}),yi({name:"mylevel",description:"Shows your bot access level"},(async e=>{const t=yn(e.member.user.id)?U.modules.commands.cmd_general.mylevel_admin:U.modules.commands.cmd_general.mylevel;return await e.respondEphemeral(B(t,["level",pn(e.member).toString()])),!1}),{staticAck:!1,permissions:{overrideableInfo:"commands.mylevel",level:bo.Guest},module:"commands"}),yi({name:"ping",description:"Ping pong"},(async e=>{const t=(new Date).getTime()-q(e.id).timestamp,n=new Date,i=await _i(e,"<a:loading:735794724480483409>");if(!i)return;const a=(new Date).getTime()-n.getTime();await i.edit(B(U.modules.commands.cmd_general.ping,["msg_diff_ms",t.toString(),"sent_msg_ms",a.toString()]))}),{staticAck:!0,permissions:{overrideableInfo:"commands.ping",level:bo.Guest},module:"commands"});var Ao=Object.freeze({__proto__:null,InitializeCommands:function(){const e=new discord.command.CommandGroup(Oo({description:"General commands"}));return Ii(e,"help",(async e=>{const t=new discord.Embed;t.setAuthor({name:"PyBoat"}),t.setDescription(U.modules.commands.cmd_general.help),t.setColor(16711680),t.setThumbnail({url:E.botUser.getAvatarUrl()});zi(await e.inlineReply({allowedMentions:{},content:"",embed:t}))}),{permissions:{overrideableInfo:"commands.help",level:bo.Guest}}),Ii(e,"docs",(async e=>{zi(await e.inlineReply({allowedMentions:{},content:"<https://docs.pyboat.i0.tf/>"}))}),{permissions:{overrideableInfo:"commands.docs",level:bo.Guest}}),Ii(e,"mylevel",(async e=>{const t=yn(e.author.id)?U.modules.commands.cmd_general.mylevel_admin:U.modules.commands.cmd_general.mylevel;zi(await e.inlineReply(B(t,["level",pn(e.member).toString()])))}),{permissions:{overrideableInfo:"commands.mylevel",level:bo.Guest}}),Ii(e,"ping",(async e=>{const t=(new Date).getTime()-q(e.id).timestamp,n=new Date,i=await e.inlineReply("<a:loading:735794724480483409>"),a=(new Date).getTime()-n.getTime();await i.edit(B(U.modules.commands.cmd_general.ping,["msg_diff_ms",t.toString(),"sent_msg_ms",a.toString()])),zi(i)}),{permissions:{overrideableInfo:"commands.ping",level:bo.Guest}}),Ii(e,"version",(async e=>{const t=Y(b,"D");Y(b,"R");zi(await e.inlineReply(`This version is from **[**${t}**]** - version **1.8.14**${E.version!==y?` - **OUTDATED** (newest: ${E.version})`:""}`))}),{permissions:{overrideableInfo:"commands.version",level:bo.Administrator}}),Ai(e,"nickme",(e=>({nick:e.textOptional()})),(async(e,{nick:t})=>{zi(await e.inlineReply((async()=>{const n=await e.getGuild(),i=await n.getMember(discord.getBotId());return i.can(67108864)?t===i.nick?U.modules.commands.cmd_general.cmd_nickme.already_nickname:("invisible"===t&&(t=" ឵឵ "),await i.edit({nick:t}),U.modules.commands.cmd_general.cmd_nickme.done):U.modules.commands.cmd_general.cmd_nickme.no_permission})))}),{permissions:{overrideableInfo:"commands.nickme",level:bo.Owner}}),e}});discord.command.filters,new pylon.KVNamespace("commands_fun");const Io={dev:Do,general:Ao,fun:Object.freeze({__proto__:null,InitializeCommands:function(){const e=Oo({additionalPrefixes:[],description:"Fun commands"});return new discord.command.CommandGroup(e)}}),admin:Object.freeze({__proto__:null})};let vo=[];function Co(){return void 0===f||void 0===f.modules.counting||void 0===f.modules.counting.channels?["1"]:["1"].concat(f.modules.counting.channels)}class So{constructor(){this.disabled=!1}}function Mo(e){if(e.commandExecutors)for(let[t,n]of e.commandExecutors)n.executor.commandExecutors?n=Mo(n.executor):n.executor.options.onError||(n.executor.options.onError=Ci,e.commandExecutors.set(t,n));return e}async function To(e,t,n,i,a,s=!1,o=!1){const r={access:!1,errors:[]},l=await Dn(e.user.id),u=yn(e.user.id),d=t.ownerId===e.user.id,c=pn(e);if(!0===o)return r.access=u,r;if(!0===s)return r.access=l||d,r.errors.push(U.modules.commands.must_be_server_owner),r;let m;if(i&&i.length>1&&"object"==typeof f.modules.commands.overrides&&a&&(m=function(e,t){const n=new So;let i,a,s,o=!1;if((t=t.toLowerCase()).includes(".")){const e=t.split(".");2===e.length?i=e[1]:3===e.length&&(i=`${e[1]} ${e[2]}`,s=e[1]),a=e[0]}else a=t;const r=[`module.${a}`,`group.${s}`,`command.${i}`];for(let t=0;t<r.length;t++){const i=f.modules.commands.overrides[r[t]];"object"==typeof i&&("boolean"==typeof i.disabled&&(o=i.disabled),"number"==typeof i.level&&(e=i.level),Array.isArray(i.channelsWhitelist)&&(n.channelsWhitelist=i.channelsWhitelist),Array.isArray(i.channelsBlacklist)&&(n.channelsBlacklist=i.channelsBlacklist),Array.isArray(i.rolesWhitelist)&&(n.rolesWhitelist=i.rolesWhitelist),Array.isArray(i.rolesBlacklist)&&(n.rolesBlacklist=i.rolesBlacklist),"number"==typeof i.bypassLevel?n.bypassLevel=i.bypassLevel:delete n.bypassLevel)}return e<0&&(e=0),o&&(n.disabled=!0),n.level=e,n}(a,i),a=m.level),m&&!0===m.disabled)d||l||"number"==typeof m.bypassLevel&&c>=m.bypassLevel?r.access=!0:(r.access=!1,r.errors.push(U.modules.commands.command_disabled));else if("number"!=typeof a)r.access=!1,r.errors.push("Command improperly defined");else{const t=(()=>{const t=c>=a;if(d||l)return!0;if(!m)return!!t||B(U.modules.commands.must_be_level,["level",a.toString()]);if("number"==typeof m.bypassLevel&&c>=m.bypassLevel)return!0;if(Array.isArray(m.channelsBlacklist)&&m.channelsBlacklist.includes(n))return B(U.modules.commands.must_not_be_on_channel,["channels",m.channelsBlacklist.map((e=>`<#${e}>`)).join(", ")]);if(Array.isArray(m.channelsWhitelist)&&m.channelsWhitelist.length>0&&!m.channelsWhitelist.includes(n)){let e=m.channelsWhitelist;return Array.isArray(m.channelsBlacklist)&&(e=e.filter((e=>!m.channelsBlacklist.includes(e)))),B(U.modules.commands.must_be_on_channel,["channels",e.map((e=>`<#${e}>`)).join(", ")])}if(Array.isArray(m.rolesBlacklist)){if(void 0!==e.roles.find((e=>m.rolesBlacklist.includes(e))))return B(U.modules.commands.must_not_have_roles,["roles",m.rolesBlacklist.map((e=>`<@&${e}>`)).join(", ")])}if(Array.isArray(m.rolesWhitelist)&&m.rolesWhitelist.length>0){if(void 0===e.roles.find((e=>m.rolesWhitelist.includes(e)))){let e=m.rolesWhitelist;return Array.isArray(m.rolesBlacklist)&&(e=e.filter((e=>!m.rolesBlacklist.includes(e)))),B(U.modules.commands.must_have_roles,["roles",e.map((e=>`<@&${e}>`)).join(", ")])}}return!!t||B(U.modules.commands.must_be_level,["level",a.toString()])})();!0===t?r.access=!0:(r.access=!1,r.errors.push(t))}return r}function Oo(e){discord.command.filters;let t="!",n=[];void 0!==f.modules.commands.prefix&&("string"==typeof f.modules.commands.prefix?t=f.modules.commands.prefix:Array.isArray(f.modules.commands.prefix)&&f.modules.commands.prefix.length>0&&(t=f.modules.commands.prefix[0],f.modules.commands.prefix.length>1&&(n=f.modules.commands.prefix.slice(1))));const i={label:"default",description:"default",defaultPrefix:t,register:!1,mentionPrefix:"boolean"==typeof f.modules.commands.allowMentionPrefix&&f.modules.commands.allowMentionPrefix,additionalPrefixes:n};if("object"==typeof e)for(const t in e)void 0!==e[t]&&(i[t]=e[t]);i.additionalPrefixes.includes(E.devPrefix)||i.defaultPrefix===E.devPrefix||i.additionalPrefixes.push(E.devPrefix);return i}function Ro(){if(void 0!==f&&!0===f.modules.commands.enabled){0!==vo.length&&(vo=[]);for(const e in Io){const t=Io[e];if("function"==typeof t.InitializeCommands){const e=t.InitializeCommands();Array.isArray(e)?e.map((e=>{e instanceof discord.command.CommandGroup&&vo.push(e)})):e instanceof discord.command.CommandGroup&&vo.push(e)}else{const e={};for(const n in t){const i=t[n];"_"!==n.substr(0,1)&&(i instanceof discord.command.CommandGroup?vo.push(i):e[n]=i)}if(Object.keys(e).length<1)continue;const n=Oo(t._groupOptions),i=new discord.command.CommandGroup(n).attach(e);vo.push(i)}}for(const e in ol){if(!f.modules[e])continue;if(!f.modules[e].enabled||!0!==f.modules[e].enabled)continue;const t=ol[e];if("function"==typeof t.InitializeCommands){const e=t.InitializeCommands();Array.isArray(e)?e.map((e=>{e instanceof discord.command.CommandGroup&&vo.push(e)})):e instanceof discord.command.CommandGroup&&vo.push(e)}else for(const e in t){const n=t[e];n instanceof discord.command.CommandGroup&&vo.push(n)}}vo=vo.map((e=>Mo(e))),function(){const e=mi.filter((e=>!e.extras.parent)).map((e=>e.config.name)),t=gi.filter((e=>!e.extras||!e.extras.parent)).map((e=>e.config.name));!1===f.modules.commands.duplicateRegistry&&(vo=vo.map((n=>{const i={};for(const a in n)if("commandExecutors"!==a)i[a]=n[a];else{const s=new Map;for(const[i,o]of n[a]){const n=o.executor.constructor.name;if("Command"===n){if(e.includes(i.toLowerCase())||o.aliasOf&&e.includes(o.aliasOf.toLowerCase()))continue}else if("CommandGroup"===n&&fi(i.toLowerCase())&&(t.includes(i.toLowerCase())||o.aliasOf&&t.includes(o.aliasOf.toLowerCase())))continue;s.set(i,o)}i[a]=s}return ei(i,discord.command.CommandGroup)})))}()}}const No=new li({name:"infractions",idProperty:"id",local:!1,timestampProperty:"ts"});var Lo;!function(e){e.MUTE="MUTE",e.TEMPMUTE="TEMPMUTE",e.KICK="KICK",e.TEMPBAN="TEMPBAN",e.SOFTBAN="SOFTBAN",e.BAN="BAN"}(Lo||(Lo={}));class ko{constructor(e,t,n,i="",a=""){const s=z();return this.id=s,this.ts=q(s).timestamp,this.type=e,this.actorId=t,this.memberId=n,"string"==typeof a&&a.length>0&&(this.reason=a),"string"==typeof i&&""!==i&&(this.expiresAt=i),this.active=this.expiresAt!==this.id&&"string"==typeof this.expiresAt,this}async updateStorage(){await No.editPool(this.id,this)}async checkActive(){if(!this.active)return!1;const e=await discord.getGuild();if(this.type===Lo.TEMPMUTE){const t=await e.getMember(this.memberId);return t&&(f.modules.infractions&&f.modules.infractions.muteRole&&"string"==typeof f.modules.infractions.muteRole&&!!t.roles.includes(f.modules.infractions.muteRole))||(this.active=!1,await this.updateStorage(),!1)}if(this.type===Lo.TEMPBAN){return!!await e.getBan(this.memberId)||(this.active=!1,await this.updateStorage(),!1)}return this.active}async checkExpired(){if(!this.active||!this.isExpired())return;if(!await this.checkActive())return;const e=await discord.getGuild(p);if(this.type===Lo.TEMPMUTE){const t=await e.getMember(this.memberId);if(!t)return;await t.removeRole(f.modules.infractions.muteRole),await Fo("tempmute_expired",null,t),await this.checkActive()}else if(this.type===Lo.TEMPBAN){const t=await H(this.memberId);await e.deleteBan(this.memberId),await Fo("tempban_expired",null,t),await this.checkActive()}}isExpired(){if("string"!=typeof this.expiresAt||this.id===this.expiresAt)return!1;const e=q(this.expiresAt).timestamp;return Date.now()-e>0}}async function Go(){try{const e=await No.getByQuery({active:!0},!0),t=(await No.getAll(),e.map((e=>ei(e,ko))).filter((e=>!0===e.active&&e.isExpired())));if(t.length>0){const e=[];for(let n=0;n<t.length;n+=1){const i=t[n];i.isExpired()&&(await sleep(200),e.push(i.checkExpired()))}await Promise.all(e)}}catch(e){Zn(e)}}async function $o(){await No.clear()}async function Uo(e,t,n,i="",a=""){let s;if(t||(t=discord.getBotId()),e instanceof discord.GuildMember&&(s=e.user.id),e instanceof discord.User&&(s=e.id),"string"==typeof e&&(s=e),void 0===s)return!1;"string"!=typeof a&&(a="");let o="";"string"==typeof t&&(o=t),t instanceof discord.User&&(o=t.id),t instanceof discord.GuildMember&&(o=t.user.id);const r=new ko(n,o,s,i,a);return await No.saveToPool(r),r}async function Bo(e,t,n){const i=t instanceof discord.GuildMember?t.user.id:t.id,a=yn(i);if(!e&&i===discord.getBotId())return!1;if(!e)return!a;let s=!1;yn(e.user.id)&&(s=await Dn(e.user.id));const o=await e.getGuild(),r=await o.getMember(discord.getBotId());if(!r)return!1;if(n===Lo.KICK&&!r.can(2))return U.modules.infractions.targeting.bot_cant_kick;if((n===Lo.SOFTBAN||n===Lo.TEMPBAN||n===Lo.BAN)&&!r.can(4))return U.modules.infractions.targeting.bot_cant_ban;const l=await Z(r),u=o.ownerId===e.user.id;if(!s&&!u&&i===discord.getBotId())return U.modules.infractions.targeting.cant_target_bot;const d=o.ownerId===r.user.id;if(n===Lo.MUTE||n===Lo.TEMPMUTE){if(!r.can(268435456)&&!d)return U.modules.infractions.targeting.bot_cant_manage_roles;const e=await o.getRole(f.modules.infractions.muteRole);if(!d&&null!==e&&l.position<=e.position)return U.modules.infractions.targeting.bot_cant_manage_mute_role}const c=t instanceof discord.GuildMember?await Z(t):null;if(n===Lo.KICK||n===Lo.BAN||n===Lo.SOFTBAN||n===Lo.TEMPBAN){if(!d&&t instanceof discord.GuildMember&&t.user.id===o.ownerId)return B(U.modules.infractions.targeting.bot_cant_perform_action,["action",n.toLowerCase()]);if(!d&&c instanceof discord.Role&&l.position<=c.position)return B(U.modules.infractions.targeting.bot_cant_perform_action,["action",n.toLowerCase()]);if(i===discord.getBotId())return B(U.modules.infractions.targeting.bot_cant_perform_action,["action",n.toLowerCase()])}if(f.modules.infractions&&f.modules.infractions.targeting&&!s&&!u){const a="boolean"!=typeof f.modules.infractions.targeting.checkLevels||f.modules.infractions.targeting.checkLevels,s="boolean"!=typeof f.modules.infractions.targeting.checkRoles||f.modules.infractions.targeting.checkRoles,o="boolean"!=typeof f.modules.infractions.targeting.reqDiscordPermissions&&"object"!=typeof f.modules.infractions.targeting.reqDiscordPermissions||f.modules.infractions.targeting.reqDiscordPermissions,r="boolean"==typeof f.modules.infractions.targeting.allowSelf&&f.modules.infractions.targeting.allowSelf;if(!0===o){if(n===Lo.KICK&&!e.can(2))return U.modules.infractions.targeting.actor_cant_kick;if((n===Lo.BAN||n===Lo.SOFTBAN||n===Lo.TEMPBAN)&&!e.can(4))return U.modules.infractions.targeting.actor_cant_ban;if((n===Lo.MUTE||n===Lo.TEMPMUTE)&&!e.can(268435456))return U.modules.infractions.targeting.actor_cant_roles}else if("object"==typeof o){if(!0===o.KICK_MEMBERS&&n===Lo.KICK&&!e.can(2))return U.modules.infractions.targeting.actor_cant_kick;if(!0===o.BAN_MEMBERS&&(n===Lo.BAN||n===Lo.SOFTBAN||n===Lo.TEMPBAN)&&!e.can(4))return U.modules.infractions.targeting.actor_cant_ban;if(!0===o.MANAGE_ROLES&&(n===Lo.MUTE||n===Lo.TEMPMUTE)&&!e.can(268435456))return U.modules.infractions.targeting.actor_cant_roles}if(e.user.id===i)return!!r||U.modules.infractions.targeting.cant_self_target;if(!0===a&&t instanceof discord.GuildMember){const n=pn(e),i=pn(t);if(n<=i)return B(U.modules.infractions.targeting.actor_cant_level,["level",i.toString()])}if(!0===s){const t=await Z(e);if(c instanceof discord.Role&&t.position<=c.position)return U.modules.infractions.targeting.actor_cant_hierarchy}}return!(!0===a&&e.user.id!==i&&!u)||U.modules.infractions.targeting.actor_cant_admin}async function Fo(e,t,n,i=new Map,a){n instanceof discord.GuildMember&&(n=n.user),n&&(null!==t&&se(t)||ae(n)||(null!==n&&(i.set("USERTAG",de(n)),i.set("USER_ID",n.id),i.set("USER",n)),null===t?i.set("ACTORTAG",U.ranks.system):(t instanceof discord.GuildMember&&(t=t.user),i.set("ACTORTAG",me(t)),i.set("ACTOR_ID",t.id),i.set("ACTOR",t)),gn("INFRACTIONS",`${e}`,i,a)))}async function Po(e,t,n,i,a=!1){if(e instanceof discord.GuildMember||(e=await(await t.getGuild()).getMember(discord.getBotId())),!e)return;const s=e,o=await t.getChannel();if(f.modules.infractions&&f.modules.infractions.confirmation){const r=!("boolean"!=typeof n||"boolean"!=typeof f.modules.infractions.confirmation.reaction||!o.canMember(e,64))&&f.modules.infractions.confirmation.reaction,l=!!("boolean"==typeof f.modules.infractions.confirmation.message&&o.canMember(e,2048)&&"string"==typeof i&&i.length>0)&&f.modules.infractions.confirmation.message,u="number"==typeof f.modules.infractions.confirmation.expiry?Math.min(12,Math.max(0,f.modules.infractions.confirmation.expiry)):0,d="boolean"==typeof f.modules.infractions.confirmation.deleteOriginal&&!a&&f.modules.infractions.confirmation.deleteOriginal,c=!1;if(!0===r)try{!0===n?await t.addReaction("✅"):!1===n&&await t.addReaction("❌")}catch(e){}let m;if(!0===l)try{const e="";m=await t.inlineReply({content:`${""!==e?`${e} `:""}${i}`,allowedMentions:{}}),0===u&&zi(m)}catch(e){m=void 0}if((!0===r||!0===l)&&u>0){const e=m;setTimeout((async()=>{try{o.canMember(s,8192)&&(!0!==r||d||!0!==n&&!1!==n||await t.deleteAllReactionsForEmoji(!0===n?"✅":"❌"),!0!==d||c||await t.delete()),!0===l&&e instanceof discord.Message&&await e.delete()}catch(e){}}),1e3*u)}}}async function jo(e,t,n,i,a=!1){if(e instanceof discord.GuildMember||(e=await(await t.getGuild()).getMember(discord.getBotId())),!e)return;const s=await t.getChannel();if(f.modules.infractions&&f.modules.infractions.confirmation){"boolean"==typeof n&&"boolean"==typeof f.modules.infractions.confirmation.reaction&&s.canMember(e,64)&&f.modules.infractions.confirmation.reaction;const o=!!("boolean"==typeof f.modules.infractions.confirmation.message&&s.canMember(e,2048)&&"string"==typeof i&&i.length>0)&&f.modules.infractions.confirmation.message,r="number"==typeof f.modules.infractions.confirmation.expiry?Math.min(12,Math.max(0,f.modules.infractions.confirmation.expiry)):0,l="boolean"==typeof f.modules.infractions.confirmation.deleteOriginal&&!a&&f.modules.infractions.confirmation.deleteOriginal;let u;if(!0===o)try{const e="";!1===n?await t.respondEphemeral(`${""!==e?`${e} `:""}${i}`):u=await t.respond({content:`${""!==e?`${e} `:""}${i}`,allowedMentions:{}})}catch(e){}if(!0===o&&r>0&&u instanceof discord.interactions.commands.SlashCommandResponse&&!0===n){const e=u;setTimeout((async()=>{try{await e.delete()}catch(e){}try{l&&await t.deleteOriginal()}catch(e){}}),5e3)}}}function xo(e){const{muteRole:t}=f.modules.infractions;return"string"==typeof t&&""!==t&&e.roles.includes(t)}async function Ho(e,t,n,i){const a=Kn(n);if(0===a)return U.modules.admin.duration_malformed;if(a<1e3||a>31536e6)return U.modules.infractions.inf_terms.exceeds_duration;const{muteRole:s}=f.modules.infractions;if("string"!=typeof s||""===s)return U.modules.infractions.inf_terms.mute_undefined;const o=await e.getGuild();if(null===await o.getRole(s))return U.modules.infractions.inf_terms.unknown_mute_role;if("string"!=typeof i&&(i=""),i.length>101&&(i=i.substr(0,100)),xo(e))return B(U.modules.infractions.inf_terms.already_muted,["user_mention",e.user.toMention()]);const r=await Bo(t,e,Lo.TEMPMUTE);if(!0!==r)return r;const l=z(Date.now()+a),u=Vn(a,2,!1,U.time_units.ti_full.singular.second);return await e.addRole(s),await Uo(e,t,Lo.TEMPMUTE,l,i),await Fo("tempmute",t,e.user,new Map([["EXPIRES",""],["DURATION",u],["REASON","string"==typeof i&&""!==i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):""]])),!0}async function Vo(e,t,n){const{muteRole:i}=f.modules.infractions;if("string"!=typeof i||""===i)return U.modules.infractions.inf_terms.mute_undefined;const a=await e.getGuild();if(null===await a.getRole(i))return U.modules.infractions.inf_terms.unknown_mute_role;if("string"!=typeof n&&(n=""),n.length>101&&(n=n.substr(0,100)),xo(e))return B(U.modules.infractions.inf_terms.already_muted,["user_mention",e.user.toMention()]);const s=await Bo(t,e,Lo.MUTE);return!0!==s?s:(await e.addRole(i),await Uo(e,t,Lo.MUTE,void 0,n),await Fo("mute",t,e.user,new Map([["REASON","string"==typeof n&&""!==n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""]])),!0)}async function Ko(e,t,n){const{muteRole:i}=f.modules.infractions;if("string"!=typeof i||""===i)return U.modules.infractions.inf_terms.mute_undefined;const a=await e.getGuild(),s=await a.getRole(i);if(null===s)return U.modules.infractions.inf_terms.unknown_mute_role;if("string"!=typeof n&&(n=""),n.length>101&&(n=n.substr(0,100)),!e.roles.includes(s.id))return B(U.modules.infractions.inf_terms.not_muted,["user_mention",e.user.toMention()]);const o=await Bo(t,e,Lo.MUTE);return!0!==o?o:(await e.removeRole(i),await Fo("unmute",t,e.user,new Map([["REASON","string"==typeof n&&""!==n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""]])),!0)}async function Yo(e,t,n){"string"!=typeof n&&(n=""),n.length>101&&(n=n.substr(0,100));const i=await Bo(t,e,Lo.KICK);return"string"==typeof i?i:!1!==i&&(await e.kick(),await Uo(e,t,Lo.KICK,void 0,n),await Fo("kick",t,e.user,new Map([["REASON",""!==n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""]])),!0)}async function Wo(e,t,n,i){const a=e instanceof discord.GuildMember?e.user.id:e.id,s=e instanceof discord.GuildMember?e.user:e,o=await discord.getGuild(p);if(!o)return;"string"!=typeof i&&(i=""),i.length>101&&(i=i.substr(0,100));if(await o.getBan(a))return B(U.modules.infractions.inf_terms.already_banned,["user_mention",s.toMention()]);const r=await Bo(t,e,Lo.BAN);return!0!==r?r:("number"!=typeof n&&(n=0),n>7&&(n=7),n<0&&(n=0),await o.createBan(a,{deleteMessageDays:n,reason:`(${t instanceof discord.GuildMember?`${t.user.getTag()}[${t.user.id}]`:U.ranks.system}): ${i}`}),await Uo(e,t,Lo.BAN,void 0,i),await Fo("ban",t,s,new Map([["DELETE_DAYS",n.toString()],["REASON","string"==typeof i&&""!==i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):""]])),!0)}async function zo(e,t,n,i){const a={success:[],fail:[]};"number"!=typeof n&&(n=0),n>7&&(n=7),n<0&&(n=0),"string"!=typeof i&&(i=""),i.length>101&&(i=i.substr(0,100));const s=await discord.getGuild(p);return s?(await pylon.requestCpuBurst((async()=>{for(const o in e){const r=e[o],l=r instanceof discord.GuildMember?r.user.id:r.id;if(null!==await s.getBan(l)){a.fail.push(l);continue}!0===await Bo(t,r,Lo.BAN)?(await s.createBan(l,{deleteMessageDays:n,reason:`(${t instanceof discord.GuildMember?`${t.user.getTag()}[${t.user.id}]`:U.ranks.system}): ${i}`}),await Uo(r,t,Lo.BAN,void 0,i),a.success.push(l)):a.fail.push(l)}})),a.success.length>0&&await Fo("massban",t,null,new Map([["DELETE_DAYS",n.toString()],["REASON","string"==typeof i&&""!==i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):""],["BANNED_USER_COUNT",a.success.length.toString()],["BANNED_USERS",a.success.join(", ")]])),a):a}async function qo(e,t,n,i,a){const s=e instanceof discord.GuildMember?e.user.id:e.id,o=e instanceof discord.GuildMember?e.user:e,r=Kn(i);if(0===r)return U.modules.admin.duration_malformed;if(r<1e3||r>31536e6)return U.modules.infractions.inf_terms.exceeds_duration;const l=await discord.getGuild(p);if(!l)return!1;"string"!=typeof a&&(a=""),a.length>101&&(a=a.substr(0,100));if(null!==await l.getBan(s))return B(U.modules.infractions.inf_terms.already_banned,["user_mention",o.toMention()]);const u=await Bo(t,e,Lo.TEMPBAN);if(!0!==u)return u;"number"!=typeof n&&(n=0),n>7&&(n=7),n<0&&(n=0);const d=z(Date.now()+r),c=Vn(r,2,!1,U.time_units.ti_full.singular.second);return await l.createBan(s,{deleteMessageDays:n,reason:a}),await Uo(e,t,Lo.TEMPBAN,d,a),await Fo("tempban",t,o,new Map([["DELETE_DAYS",n.toString()],["EXPIRES",""],["DURATION",c],["REASON","string"==typeof a&&""!==a?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(a,!0)]):""]])),!0}async function Jo(e,t,n,i){const a=e instanceof discord.GuildMember?e.user.id:e.id,s=e instanceof discord.GuildMember?e.user:e,o=await discord.getGuild(p);if(!o)return!1;"string"!=typeof i&&(i=""),i.length>101&&(i=i.substr(0,100));if(null!==await o.getBan(a))return B(U.modules.infractions.inf_terms.already_banned,["user_mention",s.toMention()]);const r=await Bo(t,e,Lo.BAN);return!0!==r?r:("number"!=typeof n&&(n=0),n>7&&(n=7),n<0&&(n=0),await o.createBan(a,{deleteMessageDays:n,reason:i}),await o.deleteBan(a),await Uo(e,t,Lo.SOFTBAN,void 0,i),await Fo("softban",t,s,new Map([["DELETE_DAYS",n.toString()],["REASON","string"==typeof i&&""!==i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):""]])),!0)}async function Qo(e,t,n){const i=e instanceof discord.GuildMember?e.user.id:e.id,a=e instanceof discord.GuildMember?e.user:e,s=await discord.getGuild(p);if(!s)return!1;"string"!=typeof n&&(n=""),n.length>101&&(n=n.substr(0,100));if(null===await s.getBan(i))return B(U.modules.infractions.inf_terms.not_banned,["user_mention",a.toMention()]);const o=await Bo(t,e,Lo.BAN);return!0!==o?o:(await s.deleteBan(i),await Fo("unban",t,a,new Map([["REASON","string"==typeof n&&""!==n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""]])),!0)}yi({name:"kick",description:"Kicks a member from the server",options:e=>({member:e.guildMember({required:!0,description:"The member to kick"}),reason:e.string({required:!1,description:"The reason"})})},(async(e,{member:t,reason:n})=>{"string"!=typeof n&&(n="");const i=await Yo(t,e.member,n);return!1===i?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.infractions.inf_terms.failed_kick),!1):"string"==typeof i?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,i),!1):(await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.infractions.inf_terms.kicked_member,["user_tag",Qn(t.user.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""])))}),{module:"infractions",permissions:{overrideableInfo:"infractions.kick",level:w.Moderator}}),yi({name:"mute",description:"Mutes a member",options:e=>({member:e.guildMember({required:!0,description:"The member to mute"}),reason:e.string({required:!1,description:"The reason"})})},(async(e,{member:t,reason:n})=>{let i;return"string"!=typeof n&&(n=""),void 0===i&&(i=await Vo(t,e.member,n)),!1===i?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.infractions.inf_terms.failed_mute),!1):"string"==typeof i?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,i),!1):(await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.infractions.inf_terms.muted_member,["user_tag",Qn(t.user.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""])))}),{module:"infractions",permissions:{overrideableInfo:"infractions.mute",level:w.Moderator}}),yi({name:"tempmute",description:"Tempmutes a member",options:e=>({member:e.guildMember({required:!0,description:"The member to tempmute"}),time:e.string({required:!0,description:"Time to mute for (1h30m format)"}),reason:e.string({required:!1,description:"The reason"})})},(async(e,{member:t,time:n,reason:i})=>{"string"!=typeof i&&(i="");const a=await Ho(t,e.member,n,i);if(!1===a)return await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.infractions.inf_terms.failed_tempmute),!1;if("string"==typeof a)return await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,a),!1;await e.acknowledge({ephemeral:!1});const s=Vn(Kn(n),2,!1,U.time_units.ti_full.singular.second);await jo(void 0,e,!0,B(U.modules.infractions.inf_terms.temp_muted_member,["user_tag",Qn(t.user.getTag(),!0),"reason",i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):"","duration",s]))}),{module:"infractions",permissions:{overrideableInfo:"infractions.tempmute",level:w.Moderator}}),yi({name:"unmute",description:"Unmutes a member",options:e=>({member:e.guildMember({required:!0,description:"The member to Unmute"}),reason:e.string({required:!1,description:"The reason"})})},(async(e,{member:t,reason:n})=>{"string"!=typeof n&&(n="");const i=await Ko(t,e.member,n);return!1===i?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.infractions.inf_terms.failed_unmute),!1):"string"==typeof i?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,i),!1):(await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.infractions.inf_terms.unmuted_member,["user_tag",Qn(t.user.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""])))}),{module:"infractions",permissions:{overrideableInfo:"infractions.unmute",level:w.Moderator}}),yi({name:"ban",description:"Ban a member",options:e=>({member:e.guildMember({required:!0,description:"The member to ban"}),reason:e.string({required:!1,description:"The reason"})})},(async(e,{member:t,reason:n})=>{"string"!=typeof n&&(n="");const i="number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,a=await Wo(t,e.member,i,n);return!1===a?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.infractions.inf_terms.failed_ban),!1):"string"==typeof a?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,a),!1):(await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.infractions.inf_terms.banned_user,["user_tag",Qn(t.user.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""])))}),{module:"infractions",permissions:{overrideableInfo:"infractions.ban",level:w.Moderator}}),yi({name:"massban",description:"Massbans a bunch of users by their ids",options:e=>({ids:e.string({required:!0,description:"IDs of users to ban, space seperated"}),delete_days:e.integer({required:!0,description:"Days of messages to delete",choices:[0,1,2,3,4,5,6,7]}),reason:e.string({required:!1,description:"The reason"})})},(async(e,{ids:t,reason:n,delete_days:i})=>{if(t.split(" ").forEach((e=>{const n=e.split("@").join("").split("<").join("").split(">").join("").split("!").join("");Yn(n)&&t.push(n)})),(t=[...new Set(t)]).length<2)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.massban_ids),!1;await e.acknowledge({ephemeral:!1});const a=[],s=[],o=await e.getGuild();await Promise.all([].map((async e=>{const t=await o.getMember(e);if(null!==t)return void a.push(t);const n=await H(e);null===n?s.push(e):a.push(n)})));const r=i,l=await zo(a,e.member,r,n);await jo(void 0,e,null,B(U.modules.infractions.inf_terms.massbanned,["banned_success_count",l.success.length.toString(),"banned_success",l.success.join(", "),"banned_fail_count",l.fail.length.toString(),"banned_fail",l.fail.join(", "),"banned_unknown_count",s.length.toString(),"banned_unknown",s.join(", ")]))}),{module:"infractions",permissions:{overrideableInfo:"infractions.massban",level:w.Administrator}}),yi({name:"cleanban",description:"Ban a member and clean X days of their messages",options:e=>({member:e.guildMember({required:!0,description:"The member to cleanban"}),delete_days:e.integer({required:!0,description:"Days of messages to delete",choices:[0,1,2,3,4,5,6,7]}),reason:e.string({required:!1,description:"The reason"})})},(async(e,{member:t,delete_days:n,reason:i})=>{"string"!=typeof i&&(i="");const a=n,s=await Wo(t,e.member,a,i);return!1===s?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.infractions.inf_terms.failed_cleanban),!1):"string"==typeof s?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,s),!1):(await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.infractions.inf_terms.clean_banned_member,["user_tag",Qn(t.user.getTag(),!0),"reason",i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):""])))}),{module:"infractions",permissions:{overrideableInfo:"infractions.cleanban",level:w.Moderator}}),yi({name:"softban",description:"Ban a member and unban right after, clearing X days of messages",options:e=>({member:e.guildMember({required:!0,description:"The member to softban"}),delete_days:e.integer({required:!0,description:"Days of messages to delete",choices:[0,1,2,3,4,5,6,7]}),reason:e.string({required:!1,description:"The reason"})})},(async(e,{member:t,delete_days:n,reason:i})=>{"string"!=typeof i&&(i="");const a=n,s=await Jo(t,e.member,a,i);return!1===s?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.infractions.inf_terms.failed_softban),!1):"string"==typeof s?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,s),!1):(await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.infractions.inf_terms.softbanned_user,["user_tag",Qn(t.user.getTag(),!0),"reason",i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):""])))}),{module:"infractions",permissions:{overrideableInfo:"infractions.softban",level:w.Moderator}}),yi({name:"tempban",description:"Ban a member for X amount of time",options:e=>({member:e.guildMember({required:!0,description:"The member to tempban"}),time:e.string({required:!0,description:"Time to ban the member for (in 1h30m format)"}),reason:e.string({required:!1,description:"The reason"})})},(async(e,{member:t,time:n,reason:i})=>{"string"!=typeof i&&(i="");const a="number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,s=await qo(t,e.member,a,n,i);if(!1===s)return await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.infractions.inf_terms.failed_tempban),!1;if("string"==typeof s)return await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,s),!1;await e.acknowledge({ephemeral:!1});const o=Vn(Kn(n),2,!1,U.time_units.ti_full.singular.second);await jo(void 0,e,!0,B(U.modules.infractions.inf_terms.tempbanned_user,["user_tag",Qn(t.user.getTag(),!0),"reason",i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):"","duration",o]))}),{module:"infractions",permissions:{overrideableInfo:"infractions.tempban",level:w.Moderator}}),yi({name:"unban",description:"Unban a member",options:e=>({user_id:e.string({required:!0,description:"The user ID to unban"}),reason:e.string({required:!1,description:"The reason"})})},(async(e,{user_id:t,reason:n})=>{const i=await H(t.replace(/\D/g,""));if(!i)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.user_not_found),!1;let a=await(await e.getGuild()).getMember(i.id);a||(a=i),"string"!=typeof n&&(n="");const s=await Qo(a,e.member,n);return!1===s?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,U.modules.infractions.inf_terms.failed_unban),!1):"string"==typeof s?(await e.acknowledge({ephemeral:!0}),await jo(void 0,e,!1,s),!1):(await e.acknowledge({ephemeral:!1}),void await jo(void 0,e,!0,B(U.modules.infractions.inf_terms.unbanned_user,["user_tag",Qn(i.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""])))}),{module:"infractions",permissions:{overrideableInfo:"infractions.unban",level:w.Moderator}});const Zo=Ei({name:"inf",description:"Infractions management and visualization commands"},{module:"infractions"});if(Zo){Di(Zo,{name:"recent",description:"Shows the latest 10 infractions"},(async e=>{const t=await No.getAll(null);if(0===t.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.no_infractions),!1;await e.acknowledge({ephemeral:!1});const n=t.slice(0,Math.min(t.length,10));let i=B(U.modules.infractions.inf_terms.inf_recent,["count",Math.min(n.length,10).toString()]);n.map((e=>{i+=`\n**[**||\`${e.id}\`||**]** - ${null===e.actorId||"SYSTEM"===e.actorId||e.actorId===discord.getBotId()?U.ranks.system:`${null===e.actorId||"SYSTEM"===e.actorId||e.actorId===discord.getBotId()?U.ranks.system:`<@!${e.actorId}>`}`} **>** <@!${e.memberId}> - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const a=t.length-n.length;a>0&&(i+=B(U.modules.infractions.inf_terms.more_infs,["remaining",a.toString()]));const s=new discord.Embed;s.setDescription(i),s.setTimestamp((new Date).toISOString()),await _i(e,{embed:s,allowedMentions:{},content:""})}),{module:"infractions",parent:"inf",permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.recent"}}),Di(Zo,{name:"active",description:"Shows currently active infractions (temporary ones)"},(async e=>{const t=await No.getByQuery({active:!0});if(0===t.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral("There are no active infractions"),!1;await e.acknowledge({ephemeral:!1});const n=t.slice(0,Math.min(t.length,10));let i=B(U.modules.infractions.inf_terms.inf_active,["count",Math.min(n.length,10).toString()]);n.map((e=>{i+=`\n**[**||\`${e.id}\`||**]** - ${null===e.actorId||"SYSTEM"===e.actorId||e.actorId===discord.getBotId()?U.ranks.system:`<@!${e.actorId}>`} **>** <@!${e.memberId}> - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const a=t.length-n.length;a>0&&(i+=B(U.modules.infractions.inf_terms.more_infs,["remaining",a.toString()]));const s=new discord.Embed;s.setDescription(i),s.setTimestamp((new Date).toISOString()),await _i(e,{embed:s,allowedMentions:{},content:""})}),{module:"infractions",parent:"inf",permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.active"}}),Di(Zo,{name:"info",description:"Gets detailed info on a specific infraction",options:e=>({inf_id:e.string({required:!0,description:"The ID of the infraction. You can also use `ml` to see info on your latest applied infraction"})})},(async(e,{inf_id:t})=>{let n;if("ml"===t.toLowerCase()?(n=await No.getByQuery({actorId:e.member.user.id}),n.length>0&&(n=[n[0]])):n=await No.getByQuery({id:t}),1!==n.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.inf_not_found),!1;await e.acknowledge({ephemeral:!1});const i=n[0],a=B(U.modules.infractions.inf_terms.inf_info,["inf_id",i.id,"actor_tag",null===i.actorId||"SYSTEM"===i.actorId||i.actorId===discord.getBotId()?U.ranks.system:`<@!${i.actorId}>`,"actor_id",i.actorId,"target_mention",`<@!${i.memberId}>`,"target_id",i.memberId,"type",i.type.toUpperCase(),"active",i.active,"created_date",new Date(i.ts).toISOString(),"expires",i.expiresAt!==i.id&&"string"==typeof i.expiresAt?new Date(q(i.expiresAt).timestamp):"Never","reason",i.reason]),s=new discord.Embed;s.setDescription(a),s.setTimestamp((new Date).toISOString()),await _i(e,{embed:s,allowedMentions:{},content:""})}),{module:"infractions",parent:"inf",permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.info"}}),Di(Zo,{name:"duration",description:"Edit the duration on a infraction",options:e=>({inf_id:e.string({required:!0,description:"The ID of the infraction. You can also use `ml` to see info on your latest applied infraction"}),duration:e.string({required:!0,description:"The new duration for the infraction (in 1h30m format)"})})},(async(e,{inf_id:t,duration:n})=>{const i=Kn(n);if(0===i)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.admin.duration_malformed),!1;if(i<1e3||i>31536e6)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.exceeds_duration),!1;let a;if("ml"===t.toLowerCase()?(a=await No.getByQuery({actorId:e.member.user.id}),a.length>0&&(a=[a[0]])):a=await No.getByQuery({id:t}),1!==a.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.inf_not_found),!1;const s=ei(a[0],ko);if(!s.active)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.inf_not_active),!1;if(s.actorId!==e.member.user.id&&"number"==typeof f.modules.infractions.targeting.othersEditLevel&&pn(e.member)<f.modules.infractions.targeting.othersEditLevel)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.cannot_edit_inf),!1;await e.acknowledge({ephemeral:!1}),s.expiresAt=z(s.ts+i),await s.updateStorage();const o=new Map;o.set("ACTORTAG",me(e.member.user)),o.set("ACTOR",e.member.user),o.set("ACTOR_ID",e.member.user.id),o.set("INFRACTION_ID",s.id),o.set("TYPE","duration"),o.set("NEW_VALUE",Qn(n,!0)),gn("INFRACTIONS","EDITED",o),await _i(e,U.modules.infractions.inf_terms.inf_duration_updated)}),{module:"infractions",parent:"inf",permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.duration"}}),Di(Zo,{name:"reason",description:"Edit the reason on a infraction",options:e=>({inf_id:e.string({required:!0,description:"The ID of the infraction. You can also use `ml` to see info on your latest applied infraction"}),reason:e.string({required:!0,description:"The new reason for the infraction"})})},(async(e,{inf_id:t,reason:n})=>{let i;if("ml"===t.toLowerCase()?(i=await No.getByQuery({actorId:e.member.user.id}),i.length>0&&(i=[i[0]])):i=await No.getByQuery({id:t}),1!==i.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.inf_not_found),!1;const a=ei(i[0],ko);if(!a.active)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.inf_not_active),!1;if(a.actorId!==e.member.user.id&&"number"==typeof f.modules.infractions.targeting.othersEditLevel&&pn(e.member)<f.modules.infractions.targeting.othersEditLevel)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.cannot_edit_inf),!1;await e.acknowledge({ephemeral:!1}),a.reason=n,await a.updateStorage();const s=new Map;s.set("ACTORTAG",me(e.member.user)),s.set("ACTOR_ID",e.member.user.id),s.set("ACTOR",e.member.user),s.set("USER_ID",e.member.user.id),s.set("INFRACTION_ID",a.id),s.set("TYPE","reason"),s.set("NEW_VALUE",Qn(n,!0)),gn("INFRACTIONS","EDITED",s),await _i(e,U.modules.infractions.inf_terms.inf_reason_updated)}),{module:"infractions",parent:"inf",permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.reason"}}),Di(Zo,{name:"actor",description:"Changes the registered actor on a given infraction",options:e=>({inf_id:e.string({required:!0,description:"The ID of the infraction. You can also use `ml` to see info on your latest applied infraction"}),new_actor:e.guildMember({required:!0,description:"The new actor for this infraction"})})},(async(e,{inf_id:t,new_actor:n})=>{let i;if("ml"===t.toLowerCase()?(i=await No.getByQuery({actorId:e.member.user.id}),i.length>0&&(i=[i[0]])):i=await No.getByQuery({id:t}),1!==i.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.inf_not_found),!1;const a=ei(i[0],ko);if("number"==typeof f.modules.infractions.targeting.othersEditLevel&&pn(e.member)<f.modules.infractions.targeting.othersEditLevel)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.cannot_edit_inf),!1;if(n.user.id===discord.getBotId())return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.cannot_assign_system),!1;await e.acknowledge({ephemeral:!1}),a.actorId=n.user.id,await a.updateStorage();const s=new Map;s.set("ACTORTAG",me(e.member.user)),s.set("ACTOR_ID",e.member.user.id),s.set("ACTOR",e.member.user),s.set("USER_ID",e.member.user.id),s.set("INFRACTION_ID",a.id),s.set("TYPE","actor"),s.set("NEW_VALUE",n.user.toMention()),gn("INFRACTIONS","EDITED",s),await _i(e,U.modules.infractions.inf_terms.inf_actor_updated)}),{module:"infractions",parent:"inf",permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.actor"}}),Di(Zo,{name:"delete",description:"Deletes a infraction",options:e=>({inf_id:e.string({required:!0,description:"The ID of the infraction. You can also use `ml` to see info on your latest applied infraction"})})},(async(e,{inf_id:t})=>{let n;if("ml"===t.toLowerCase()?(n=await No.getByQuery({actorId:e.member.user.id}),n.length>0&&(n=[n[0]])):n=await No.getByQuery({id:t}),1!==n.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.inf_not_found),!1;const i=n[0];if(i.actorId!==e.member.user.id&&"number"==typeof f.modules.infractions.targeting.othersEditLevel&&pn(e.member)<f.modules.infractions.targeting.othersEditLevel)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.cannot_edit_inf),!1;await e.acknowledge({ephemeral:!1}),await No.delete(i.id);const a=new Map;a.set("ACTORTAG",me(e.member.user)),a.set("ACTOR",e.member.user),a.set("ACTOR_ID",e.member.user.id),a.set("USER_ID",e.member.user.id),a.set("INFRACTION_ID",i.id),gn("INFRACTIONS","DELETED",a),await _i(e,U.modules.infractions.inf_terms.inf_deleted)}),{module:"infractions",parent:"inf",permissions:{level:w.Administrator,overrideableInfo:"infractions.inf.delete"}}),Di(Zo,{name:"clearuser",description:"Clear every infraction applied to a specific user",options:e=>({user:e.guildMember({required:!0,description:"The user to clear infractions from"})})},(async(e,{user:t})=>{t=t.id;const n=await No.getByQuery({memberId:t.id});if(!n||0===n.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.cant_find_infractions),!1;await e.acknowledge({ephemeral:!1}),await No.editPools(n.map((e=>e.id)),(()=>null)),await _i(e,B(U.modules.infractions.inf_terms.infs_deleted,["count",n.length.toString()]))}),{module:"infractions",parent:"inf",permissions:{level:w.Administrator,overrideableInfo:"infractions.inf.clearuser"}}),Di(Zo,{name:"clearactor",description:"Clear every infraction applied by a specific actor",options:e=>({actor:e.guildMember({required:!0,description:"The actor to clear infractions by"})})},(async(e,{actor:t})=>{t=t.user;const n=await No.getByQuery({actorId:t.id});if(!n||0===n.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.cant_find_infractions),!1;await e.acknowledge({ephemeral:!1}),await No.editPools(n.map((e=>e.id)),(()=>null)),await _i(e,B(U.modules.infractions.inf_terms.infs_deleted,["count",n.length.toString()]))}),{module:"infractions",parent:"inf",permissions:{level:w.Administrator,overrideableInfo:"infractions.inf.clearactor"}});const e=Ei({name:"search",description:"Infraction search commands"},{module:"infractions",parent:"inf"},Zo);e&&(Di(e,{name:"actor",description:"Search infractions by the given actor",options:e=>({actor:e.guildMember({required:!0,description:"The actor to search infractions by"})})},(async(e,{actor:t})=>{t=t.user;const n=await No.getByQuery({actorId:t.id===discord.getBotId()?discord.getBotId():t.id});if(0===n.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.no_infs_by_actor),!1;await e.acknowledge({ephemeral:!1});const i=n.slice(0,Math.min(n.length,10));let a=B(U.modules.infractions.inf_terms.inf_search_actor,["count",Math.min(i.length,10).toString(),"actor_mention",t.id===discord.getBotId()?U.ranks.system:t.toMention()]);i.map((e=>{a+=`\n**[**||\`${e.id}\`||**]** - <@!${e.memberId}> - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const s=n.length-i.length;s>0&&(a+=B(U.modules.infractions.inf_terms.more_infs,["remaining",s.toString()]));const o=new discord.Embed;o.setDescription(a),o.setAuthor({name:t.getTag(),iconUrl:t.getAvatarUrl()}),o.setTimestamp((new Date).toISOString()),await _i(e,{embed:o,allowedMentions:{},content:""})}),{module:"infractions",parent:"search",permissions:{level:w.Moderator,overrideableInfo:"infractions.inf search.actor"}}),Di(e,{name:"system",description:"Search infractions applied by the bot automatically"},(async e=>{const t=await No.getByQuery({actorId:discord.getBotId()});if(0===t.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.no_infs_by_system),!1;await e.acknowledge({ephemeral:!1});const n=t.slice(0,Math.min(t.length,10));let i=B(U.modules.infractions.inf_terms.inf_search_system,["count",Math.min(n.length,10).toString()]);n.map((e=>{i+=`\n**[**||\`${e.id}\`||**]** - <@!${e.memberId}> - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const a=t.length-n.length;a>0&&(i+=B(U.modules.infractions.inf_terms.more_infs,["remaining",a.toString()]));const s=new discord.Embed;s.setDescription(i),s.setAuthor({name:U.ranks.system}),s.setTimestamp((new Date).toISOString()),await _i(e,{embed:s,allowedMentions:{},content:""})}),{module:"infractions",parent:"search",permissions:{level:w.Moderator,overrideableInfo:"infractions.inf search.system"}}),Di(e,{name:"user",description:"Search infractions for the given user",options:e=>({user:e.guildMember({required:!0,description:"The user to search infractions for"})})},(async(e,{user:t})=>{t=t.user;const n=await No.getByQuery({memberId:t.id});if(0===n.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.no_infs_to_user),!1;await e.acknowledge({ephemeral:!1});const i=n.slice(0,Math.min(n.length,10));let a=B(U.modules.infractions.inf_terms.inf_search_user,["count",Math.min(i.length,10).toString(),"user_mention",t.toMention()]);i.map((e=>{a+=`\n**[**||\`${e.id}\`||**]** - ${null===e.actorId||"SYSTEM"===e.actorId||e.actorId===discord.getBotId()?U.ranks.system:`<@!${e.actorId}>`} - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const s=n.length-i.length;s>0&&(a+=B(U.modules.infractions.inf_terms.more_infs,["remaining",s.toString()]));const o=new discord.Embed;o.setDescription(a),o.setAuthor({name:t.getTag(),iconUrl:t.getAvatarUrl()}),o.setTimestamp((new Date).toISOString()),await _i(e,{embed:o,allowedMentions:{},content:""})}),{module:"infractions",parent:"search",permissions:{level:w.Moderator,overrideableInfo:"infractions.inf search.user"}}),Di(e,{name:"type",description:"Search infractions of a given type",options:e=>({type:e.string({required:!0,description:"The infraction type",choices:Object.keys(Lo).map((e=>`${e.substr(0,1).toUpperCase()}${e.substr(1).toLowerCase()}`))})})},(async(e,{type:t})=>{const n=await No.getByQuery({type:t.toUpperCase()});if(0===n.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.infractions.inf_terms.no_infs_type),!1;await e.acknowledge({ephemeral:!1});const i=n.slice(0,Math.min(n.length,10));let a=B(U.modules.infractions.inf_terms.infs_search_type,["count",Math.min(i.length,10).toString(),"type",t.substr(0,1).toUpperCase()]);i.map((e=>{a+=`\n**[**||\`${e.id}\`||**]** - ${null===e.actorId||"SYSTEM"===e.actorId||e.actorId===discord.getBotId()?U.ranks.system:`<@!${e.actorId}>`} **>** <@!${e.memberId}>${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const s=n.length-i.length;s>0&&(a+=B(U.modules.infractions.inf_terms.more_infs,["remaining",s.toString()]));const o=new discord.Embed;o.setDescription(a),o.setTimestamp((new Date).toISOString()),await _i(e,{embed:o,allowedMentions:{},content:""})}),{module:"infractions",parent:"search",permissions:{level:w.Moderator,overrideableInfo:"infractions.inf search.type"}}))}var Xo=Object.freeze({__proto__:null,infsPool:No,get InfractionType(){return Lo},Infraction:ko,every5Min:Go,clearInfractions:$o,addInfraction:Uo,canTarget:Bo,logAction:Fo,confirmResult:Po,confirmResultInteraction:jo,isMuted:xo,TempMute:Ho,Mute:Vo,UnMute:Ko,Kick:Yo,Ban:Wo,MassBan:zo,TempBan:qo,SoftBan:Jo,UnBan:Qo,InitializeCommands:function(){discord.command.filters;const e=Oo({description:"Infraction Commands"}),t=new discord.command.CommandGroup(e);return Ai(t,"kick",(e=>({member:e.guildMember(),reason:e.textOptional()})),(async(e,{member:t,reason:n})=>{"string"!=typeof n&&(n="");const i=await Yo(t,e.member,n);return!1===i?(await Po(void 0,e,!1,U.modules.infractions.inf_terms.failed_kick),!1):"string"==typeof i?(await Po(void 0,e,!1,i),!1):void await Po(void 0,e,!0,B(U.modules.infractions.inf_terms.kicked_member,["user_tag",Qn(t.user.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""]))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.kick"}}),Ai(t,"mute",(e=>({member:e.guildMember(),reason:e.textOptional()})),(async(e,{member:t,reason:n})=>{let i;"string"!=typeof n&&(n="");let a,s=!1;if(n.length>1&&n.includes(" ")){const o=n.split(" ")[0];if(o.length>1){const r=Kn(o);r>1e3&&r<31536e6&&0!==r&&(s=!0,a=Vn(r,2,!1,U.time_units.ti_full.singular.second),n=n.split(" ").slice(1).join(" "),i=await Ho(t,e.member,o,n))}}return void 0===i&&(i=await Vo(t,e.member,n)),!1===i?(s?await Po(void 0,e,!1,U.modules.infractions.inf_terms.failed_mute):await Po(void 0,e,!1,U.modules.infractions.inf_terms.failed_tempmute),!1):"string"==typeof i?(await Po(void 0,e,!1,i),!1):void(!1===s?await Po(void 0,e,!0,B(U.modules.infractions.inf_terms.muted_member,["user_tag",Qn(t.user.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""])):await Po(void 0,e,!0,B(U.modules.infractions.inf_terms.temp_muted_member,["user_tag",Qn(t.user.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):"","duration",a])))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.mute"}}),Ai(t,"tempmute",(e=>({member:e.guildMember(),time:e.string(),reason:e.textOptional()})),(async(e,{member:t,time:n,reason:i})=>{"string"!=typeof i&&(i="");const a=await Ho(t,e.member,n,i);if(!1===a)return await Po(void 0,e,!1,U.modules.infractions.inf_terms.failed_tempmute),!1;if("string"==typeof a)return await Po(void 0,e,!1,a),!1;const s=Vn(Kn(n),2,!1,U.time_units.ti_full.singular.second);await Po(void 0,e,!0,B(U.modules.infractions.inf_terms.temp_muted_member,["user_tag",Qn(t.user.getTag(),!0),"reason",i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):"","duration",s]))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.tempmute"}}),Ai(t,"unmute",(e=>({member:e.guildMember(),reason:e.textOptional()})),(async(e,{member:t,reason:n})=>{"string"!=typeof n&&(n="");const i=await Ko(t,e.member,n);return!1===i?(await Po(void 0,e,!1,U.modules.infractions.inf_terms.failed_unmute),!1):"string"==typeof i?(await Po(void 0,e,!1,i),!1):void await Po(void 0,e,!0,B(U.modules.infractions.inf_terms.unmuted_member,["user_tag",Qn(t.user.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""]))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.unmute"}}),Ai(t,"ban",(e=>({user:e.string({name:"user",description:"UserResolvable"}),reason:e.textOptional()})),(async(e,{user:t,reason:n})=>{const i=await Ti(e,"user","string",Mi.UserResolvable,t);let a=await(await e.getGuild()).getMember(i.id);a||(a=i),"string"!=typeof n&&(n="");const s="number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,o=await Wo(a,e.member,s,n);return!1===o?(await Po(void 0,e,!1,U.modules.infractions.inf_terms.failed_ban),!1):"string"==typeof o?(await Po(void 0,e,!1,o),!1):void await Po(void 0,e,!0,B(U.modules.infractions.inf_terms.banned_user,["user_tag",Qn(i.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""]))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.ban"}}),Ai(t,"massban",(e=>({deleteDays:e.integer({choices:[0,1,2,3,4,5,6,7]}),args:e.text()})),(async(e,{deleteDays:t,args:n})=>{let i=[];const a=[];n.split(" ").forEach((e=>{const t=e.split("@").join("").split("<").join("").split(">").join("").split("!").join("");Yn(t)?i.push(t):a.push(e)})),i=[...new Set(i)];const s=a.join(" ");if(i.length<2){return zi(await e.inlineReply(U.modules.infractions.inf_terms.massban_ids)),!1}const o=[],r=[],l=await e.getGuild();await Promise.all(i.map((async e=>{const t=await l.getMember(e);if(null!==t)return void o.push(t);const n=await H(e);null===n?r.push(e):o.push(n)})));const u=t,d=await zo(o,e.member,u,s);await Po(void 0,e,null,B(U.modules.infractions.inf_terms.massbanned,["banned_success_count",d.success.length.toString(),"banned_success",d.success.join(", "),"banned_fail_count",d.fail.length.toString(),"banned_fail",d.fail.join(", "),"banned_unknown_count",r.length.toString(),"banned_unknown",r.join(", ")]))}),{permissions:{level:w.Administrator,overrideableInfo:"infractions.massban"}}),Ai(t,{name:"cleanban",aliases:["cban"]},(e=>({user:e.string({name:"user",description:"UserResolvable"}),deleteDays:e.integer({choices:[0,1,2,3,4,5,6,7]}),reason:e.textOptional()})),(async(e,{user:t,deleteDays:n,reason:i})=>{const a=await Ti(e,"user","string",Mi.UserResolvable,t);let s=await(await e.getGuild()).getMember(a.id);null===s&&(s=a),"string"!=typeof i&&(i="");const o=n,r=await Wo(s,e.member,o,i);return!1===r?(await Po(void 0,e,!1,U.modules.infractions.inf_terms.failed_cleanban),!1):"string"==typeof r?(await Po(void 0,e,!1,r),!1):void await Po(void 0,e,!0,B(U.modules.infractions.inf_terms.clean_banned_member,["user_tag",Qn(a.getTag(),!0),"reason",i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):""]))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.cleanban"}}),Ai(t,{name:"softban",aliases:["sban"]},(e=>({user:e.string({name:"user",description:"UserResolvable"}),deleteDays:e.integer({choices:[0,1,2,3,4,5,6,7]}),reason:e.textOptional()})),(async(e,{user:t,deleteDays:n,reason:i})=>{const a=await Ti(e,"user","string",Mi.UserResolvable,t);let s=await(await e.getGuild()).getMember(a.id);null===s&&(s=a),"string"!=typeof i&&(i="");const o=n,r=await Jo(s,e.member,o,i);return!1===r?(await Po(void 0,e,!1,U.modules.infractions.inf_terms.failed_softban),!1):"string"==typeof r?(await Po(void 0,e,!1,r),!1):void await Po(void 0,e,!0,B(U.modules.infractions.inf_terms.softbanned_user,["user_tag",Qn(a.getTag(),!0),"reason",i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):""]))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.softban"}}),Ai(t,"tempban",(e=>({user:e.string({name:"user",description:"UserResolvable"}),time:e.string(),reason:e.textOptional()})),(async(e,{user:t,time:n,reason:i})=>{const a=await Ti(e,"user","string",Mi.UserResolvable,t);let s=await(await e.getGuild()).getMember(a.id);null===s&&(s=a),"string"!=typeof i&&(i="");const o="number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,r=await qo(s,e.member,o,n,i);if(!1===r)return await Po(void 0,e,!1,U.modules.infractions.inf_terms.failed_tempban),!1;if("string"==typeof r)return await Po(void 0,e,!1,r),!1;const l=Vn(Kn(n),2,!1,U.time_units.ti_full.singular.second);await Po(void 0,e,!0,B(U.modules.infractions.inf_terms.tempbanned_user,["user_tag",Qn(a.getTag(),!0),"reason",i?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(i,!0)]):"","duration",l]))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.tempban"}}),Ai(t,"unban",(e=>({user:e.string({name:"user",description:"UserResolvable"}),reason:e.textOptional()})),(async(e,{user:t,reason:n})=>{const i=await Ti(e,"user","string",Mi.UserResolvable,t);let a=await(await e.getGuild()).getMember(i.id);a||(a=i),"string"!=typeof n&&(n="");const s=await Qo(a,e.member,n);return!1===s?(await Po(void 0,e,!1,U.modules.infractions.inf_terms.failed_unban),!1):"string"==typeof s?(await Po(void 0,e,!1,s),!1):void await Po(void 0,e,!0,B(U.modules.infractions.inf_terms.unbanned_user,["user_tag",Qn(i.getTag(),!0),"reason",n?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n,!0)]):""]))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.unban"}}),vi(t,"inf",(e=>{Ii(e,"recent",(async e=>{zi(await e.inlineReply((async()=>{const e=await No.getAll(null);if(0===e.length)return{content:U.modules.infractions.inf_terms.no_infractions};const t=e.slice(0,Math.min(e.length,10));let n=B(U.modules.infractions.inf_terms.inf_recent,["count",Math.min(t.length,10).toString()]);t.map((e=>{n+=`\n**[**||\`${e.id}\`||**]** - ${null===e.actorId||"SYSTEM"===e.actorId?U.ranks.system:`${null===e.actorId||"SYSTEM"===e.actorId||e.actorId===discord.getBotId()?U.ranks.system:`<@!${e.actorId}>`}`} **>** <@!${e.memberId}> - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const i=e.length-t.length;i>0&&(n+=B(U.modules.infractions.inf_terms.more_infs,["remaining",i.toString()]));const a=new discord.Embed;return a.setDescription(n),a.setTimestamp((new Date).toISOString()),{embed:a,allowedMentions:{},content:""}})))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.recent"}}),Ii(e,"active",(async e=>{zi(await e.inlineReply((async()=>{const e=await No.getByQuery({active:!0});if(0===e.length)return{content:U.modules.infractions.inf_terms.cant_find_infractions};const t=e.slice(0,Math.min(e.length,10));let n=B(U.modules.infractions.inf_terms.inf_active,["count",Math.min(t.length,10).toString()]);t.map((e=>{n+=`\n**[**||\`${e.id}\`||**]** - ${null===e.actorId||"SYSTEM"===e.actorId||e.actorId===discord.getBotId()?U.ranks.system:`<@!${e.actorId}>`} **>** <@!${e.memberId}> - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const i=e.length-t.length;i>0&&(n+=B(U.modules.infractions.inf_terms.more_infs,["remaining",i.toString()]));const a=new discord.Embed;return a.setDescription(n),a.setTimestamp((new Date).toISOString()),{embed:a,allowedMentions:{},content:""}})))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.active"}}),Ai(e,"info",(e=>({id:e.string()})),(async(e,{id:t})=>{zi(await e.inlineReply((async()=>{let n;if("ml"===t.toLowerCase()?(n=await No.getByQuery({actorId:e.author.id}),n.length>0&&(n=[n[0]])):n=await No.getByQuery({id:t}),1!==n.length)return{content:U.modules.infractions.inf_terms.inf_not_found};const i=n[0],a=B(U.modules.infractions.inf_terms.inf_info,["inf_id",i.id,"actor_tag",null===i.actorId||"SYSTEM"===i.actorId||i.actorId===discord.getBotId()?U.ranks.system:`<@!${i.actorId}>`,"actor_id",i.actorId,"target_mention",`<@!${i.memberId}>`,"target_id",i.memberId,"type",i.type.toUpperCase(),"active",i.active,"created_date",new Date(i.ts).toISOString(),"expires",i.expiresAt!==i.id&&"string"==typeof i.expiresAt?new Date(q(i.expiresAt).timestamp):"Never","reason",i.reason]),s=new discord.Embed;return s.setDescription(a),s.setTimestamp((new Date).toISOString()),{embed:s,allowedMentions:{},content:""}})))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.info"}}),Ai(e,"duration",(e=>({id:e.string(),duration:e.string()})),(async(e,{id:t,duration:n})=>{zi(await e.inlineReply((async()=>{const i=Kn(n);if(0===i)return U.modules.admin.duration_malformed;if(i<1e3||i>31536e6)return U.modules.infractions.inf_terms.exceeds_duration;let a;if("ml"===t.toLowerCase()?(a=await No.getByQuery({actorId:e.author.id}),a.length>0&&(a=[a[0]])):a=await No.getByQuery({id:t}),1!==a.length)return U.modules.infractions.inf_terms.inf_not_found;const s=ei(a[0],ko);if(!s.active)return U.modules.infractions.inf_terms.inf_not_active;if(s.actorId!==e.author.id&&"number"==typeof f.modules.infractions.targeting.othersEditLevel&&pn(e.member)<f.modules.infractions.targeting.othersEditLevel)return U.modules.infractions.inf_terms.cannot_edit_inf;s.expiresAt=z(s.ts+i),await s.updateStorage();const o=new Map;return o.set("ACTORTAG",me(e.author)),o.set("ACTOR",e.author),o.set("ACTOR_ID",e.author.id),o.set("INFRACTION_ID",s.id),o.set("TYPE","duration"),o.set("NEW_VALUE",Qn(n,!0)),gn("INFRACTIONS","EDITED",o),U.modules.infractions.inf_terms.inf_duration_updated})))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.duration"}}),Ai(e,"reason",(e=>({id:e.string(),reason:e.text()})),(async(e,{id:t,reason:n})=>{zi(await e.inlineReply((async()=>{let i;if("ml"===t.toLowerCase()?(i=await No.getByQuery({actorId:e.author.id}),i.length>0&&(i=[i[0]])):i=await No.getByQuery({id:t}),1!==i.length)return U.modules.infractions.inf_terms.inf_not_found;const a=ei(i[0],ko);if(a.actorId!==e.author.id&&"number"==typeof f.modules.infractions.targeting.othersEditLevel&&pn(e.member)<f.modules.infractions.targeting.othersEditLevel)return U.modules.infractions.inf_terms.cannot_edit_inf;a.reason=n,await a.updateStorage();const s=new Map;return s.set("ACTORTAG",me(e.author)),s.set("ACTOR_ID",e.author.id),s.set("ACTOR",e.author),s.set("USER_ID",e.author.id),s.set("INFRACTION_ID",a.id),s.set("TYPE","reason"),s.set("NEW_VALUE",Qn(n,!0)),gn("INFRACTIONS","EDITED",s),U.modules.infractions.inf_terms.inf_reason_updated})))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.reason"}}),Ai(e,"actor",(e=>({id:e.string(),actor:e.user()})),(async(e,{id:t,actor:n})=>{zi(await e.inlineReply((async()=>{let i;if("ml"===t.toLowerCase()?(i=await No.getByQuery({actorId:e.author.id}),i.length>0&&(i=[i[0]])):i=await No.getByQuery({id:t}),1!==i.length)return U.modules.infractions.inf_terms.inf_not_found;const a=ei(i[0],ko);if("number"==typeof f.modules.infractions.targeting.othersEditLevel&&pn(e.member)<f.modules.infractions.targeting.othersEditLevel)return U.modules.infractions.inf_terms.cannot_edit_inf;if(n.id===discord.getBotId())return U.modules.infractions.inf_terms.cannot_assign_system;a.actorId=n.id,await a.updateStorage();const s=new Map;return s.set("ACTORTAG",me(e.author)),s.set("ACTOR_ID",e.author.id),s.set("ACTOR",e.author),s.set("USER_ID",e.author.id),s.set("INFRACTION_ID",a.id),s.set("TYPE","actor"),s.set("NEW_VALUE",n.toMention()),gn("INFRACTIONS","EDITED",s),U.modules.infractions.inf_terms.inf_actor_updated})))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.inf.actor"}}),Ai(e,"delete",(e=>({id:e.string()})),(async(e,{id:t})=>{zi(await e.inlineReply((async()=>{let n;if("ml"===t.toLowerCase()?(n=await No.getByQuery({actorId:e.author.id}),n.length>0&&(n=[n[0]])):n=await No.getByQuery({id:t}),1!==n.length)return U.modules.infractions.inf_terms.inf_not_found;const i=n[0];if(i.actorId!==e.author.id&&"number"==typeof f.modules.infractions.targeting.othersEditLevel&&pn(e.member)<f.modules.infractions.targeting.othersEditLevel)return U.modules.infractions.inf_terms.cannot_edit_inf;await No.delete(i.id);const a=new Map;return a.set("ACTORTAG",me(e.author)),a.set("ACTOR",e.author),a.set("ACTOR_ID",e.author.id),a.set("USER_ID",e.author.id),a.set("INFRACTION_ID",i.id),gn("INFRACTIONS","DELETED",a),U.modules.infractions.inf_terms.inf_deleted})))}),{permissions:{level:w.Administrator,overrideableInfo:"infractions.inf.delete"}}),Ai(e,"clearuser",(e=>({user:e.user()})),(async(e,{user:t})=>{zi(await e.inlineReply((async()=>{const e=await No.getByQuery({memberId:t.id});return e&&0!==e.length?(await No.editPools(e.map((e=>e.id)),(()=>null)),B(U.modules.infractions.inf_terms.infs_deleted,["count",e.length.toString()])):U.modules.infractions.inf_terms.cant_find_infractions})))}),{permissions:{level:w.Administrator,overrideableInfo:"infractions.inf.clearuser"}}),Ai(e,"clearactor",(e=>({actor:e.user()})),(async(e,{actor:t})=>{zi(await e.inlineReply((async()=>{const e=await No.getByQuery({actorId:t.id});return e&&0!==e.length?(await No.editPools(e.map((e=>e.id)),(()=>null)),B(U.modules.infractions.inf_terms.infs_deleted,["count",e.length.toString()])):U.modules.infractions.inf_terms.cant_find_infractions})))}),{permissions:{level:w.Administrator,overrideableInfo:"infractions.inf.clearactor"}}),Ii(e,"clearall",(async e=>{zi(await e.inlineReply((async()=>{const e=await No.getAll(null);return 0===e.length?U.modules.infractions.inf_terms.cant_find_infractions:(await No.clear(),B(U.modules.infractions.inf_terms.infs_deleted,["count",e.length.toString()]))})))}),{permissions:{level:w.Owner,overrideableInfo:"infractions.inf.clearall"}}),vi(e,"search",(e=>{Ai(e,"actor",(e=>({actor:e.user()})),(async(e,{actor:t})=>{zi(await e.inlineReply((async()=>{const e=await No.getByQuery({actorId:t.id===discord.getBotId()?discord.getBotId():t.id});if(0===e.length)return{content:U.modules.infractions.inf_terms.no_infs_by_actor};const n=e.slice(0,Math.min(e.length,10));let i=B(U.modules.infractions.inf_terms.inf_search_actor,["count",Math.min(n.length,10).toString(),"actor_mention",t.id===discord.getBotId()?U.ranks.system:t.toMention()]);n.map((e=>{i+=`\n**[**||\`${e.id}\`||**]** - <@!${e.memberId}> - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const a=e.length-n.length;a>0&&(i+=B(U.modules.infractions.inf_terms.more_infs,["remaining",a.toString()]));const s=new discord.Embed;return s.setDescription(i),s.setAuthor({name:t.getTag(),iconUrl:t.getAvatarUrl()}),s.setTimestamp((new Date).toISOString()),{embed:s,allowedMentions:{},content:""}})))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.inf search.actor"}}),Ii(e,"system",(async e=>{zi(await e.inlineReply((async()=>{const e=await No.getByQuery({actorId:discord.getBotId()});if(0===e.length)return{content:U.modules.infractions.inf_terms.no_infs_by_system};const t=e.slice(0,Math.min(e.length,10));let n=B(U.modules.infractions.inf_terms.inf_search_system,["count",Math.min(t.length,10).toString()]);t.map((e=>{n+=`\n**[**||\`${e.id}\`||**]** - <@!${e.memberId}> - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const i=e.length-t.length;i>0&&(n+=B(U.modules.infractions.inf_terms.more_infs,["remaining",i.toString()]));const a=new discord.Embed;return a.setDescription(n),a.setAuthor({name:U.ranks.system}),a.setTimestamp((new Date).toISOString()),{embed:a,allowedMentions:{},content:""}})))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.inf search.system"}}),Ai(e,"user",(e=>({user:e.user()})),(async(e,{user:t})=>{zi(await e.inlineReply((async()=>{const e=await No.getByQuery({memberId:t.id});if(0===e.length)return{content:U.modules.infractions.inf_terms.no_infs_to_user};const n=e.slice(0,Math.min(e.length,10));let i=B(U.modules.infractions.inf_terms.inf_search_user,["count",Math.min(n.length,10).toString(),"user_mention",t.toMention()]);n.map((e=>{i+=`\n**[**||\`${e.id}\`||**]** - ${null===e.actorId||"SYSTEM"===e.actorId||e.actorId===discord.getBotId()?U.ranks.system:`<@!${e.actorId}>`} - **${e.type.substr(0,1).toUpperCase()}${e.type.substr(1).toLowerCase()}**${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const a=e.length-n.length;a>0&&(i+=B(U.modules.infractions.inf_terms.more_infs,["remaining",a.toString()]));const s=new discord.Embed;return s.setDescription(i),s.setAuthor({name:t.getTag(),iconUrl:t.getAvatarUrl()}),s.setTimestamp((new Date).toISOString()),{embed:s,allowedMentions:{},content:""}})))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.inf search.user"}}),Ai(e,"type",(e=>({type:e.string()})),(async(e,{type:t})=>{zi(await e.inlineReply((async()=>{const e=await No.getByQuery({type:t.toUpperCase()});if(0===e.length)return{content:U.modules.infractions.inf_terms.no_infs_type};const n=e.slice(0,Math.min(e.length,10));let i=B(U.modules.infractions.inf_terms.infs_search_type,["count",Math.min(n.length,10).toString(),"type",`${t.substr(0,1).toUpperCase()}${t.substr(1).toLowerCase()}`]);n.map((e=>{i+=`\n**[**||\`${e.id}\`||**]** - ${null===e.actorId||"SYSTEM"===e.actorId||e.actorId===discord.getBotId()?U.ranks.system:`<@!${e.actorId}>`} **>** <@!${e.memberId}>${"string"==typeof e.reason&&e.reason.length>0?` - \`${Qn(e.reason,!0)}\``:""}`}));const a=e.length-n.length;a>0&&(i+=B(U.modules.infractions.inf_terms.more_infs,["remaining",a.toString()]));const s=new discord.Embed;return s.setDescription(i),s.setTimestamp((new Date).toISOString()),{embed:s,allowedMentions:{},content:""}})))}),{permissions:{level:w.Moderator,overrideableInfo:"infractions.inf search.type"}})}))})),t},AL_OnGuildMemberUpdate:async function(e,t,n,i,a){if(f.modules.infractions&&f.modules.infractions.muteRole&&"string"==typeof f.modules.infractions.muteRole){if(!i.roles.includes(f.modules.infractions.muteRole)&&a.roles.includes(f.modules.infractions.muteRole)){const t=(await No.getByQuery({memberId:i.user.id,active:!0})).filter((e=>e.type===Lo.TEMPMUTE||e.type===Lo.MUTE));if(t.length>0){const e=[];t.forEach((t=>{t=ei(t,ko),e.push(t.checkActive())})),await Promise.all(e)}if(!f.modules.infractions.checkLogs||!(n instanceof discord.AuditLogEntry)||n.userId===discord.getBotId()||i.user.id===n.userId&&i.user.bot)return;se(n.userId)||ae(i.user)||await Fo("unmute",n.user,i.user,new Map([["REASON",""!==n.reason?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n.reason,!0)]):""]]),e)}else if(i.roles.includes(f.modules.infractions.muteRole)&&!a.roles.includes(f.modules.infractions.muteRole)){if(!f.modules.infractions.checkLogs||!(n instanceof discord.AuditLogEntry)||n.userId===discord.getBotId()||i.user.id===n.userId&&i.user.bot)return;return await Uo(i,n.user,Lo.MUTE,void 0,n.reason),void(se(n.userId)||ae(i.user)||await Fo("mute",n.user,i.user,new Map([["REASON",""!==n.reason?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n.reason,!0)]):""]]),e))}if(!f.modules.infractions.checkLogs||!f.modules.infractions.integrate||!(n instanceof discord.AuditLogEntry)||n.userId===discord.getBotId()||i.nick===a.nick||"string"!=typeof i.nick||i.user.id===n.userId||hn(n.user))return;const t=i.nick.toLowerCase(),s=await(await discord.getGuild(p)).getMember(n.userId);if(!s)return;if("unmute"===t&&i.roles.includes(f.modules.infractions.muteRole)){!0===await Ko(i,s,"")&&await i.edit({nick:a.nick})}else if("mute"!==t||i.roles.includes(f.modules.infractions.muteRole)){if("mute "===t.substr(0,5)&&t.length>=6&&!i.roles.includes(f.modules.infractions.muteRole)){const e=t.substr(5);!0===await Ho(i,s,e,"")&&await i.edit({nick:a.nick})}}else{!0===await Vo(i,s,"")&&await i.edit({nick:a.nick})}}},AL_OnGuildMemberRemove:async function(e,t,n,i,a){f.modules.infractions.checkLogs&&n instanceof discord.AuditLogEntry&&n.userId!==discord.getBotId()&&20===n.actionType&&(await Uo(i.user,n.user,Lo.KICK,void 0,n.reason),se(n.userId)||ae(i.user)||await Fo("kick",n.user,i.user,new Map([["REASON",""!==n.reason?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n.reason,!0)]):""]]),e))},AL_OnGuildBanAdd:async function(e,t,n,i,a){if(!(f.modules.infractions.checkLogs&&n instanceof discord.AuditLogEntry&&n.userId!==discord.getBotId()))return;let{reason:s}=n;if(!0===f.modules.infractions.integrate&&!hn(n.user)&&s.length>0&&s.includes("-")){const t=s.split("-"),a=t[t.length-1].split(" ").join("").toLowerCase(),o=s.split("-");if(o[o.length-1]="",["sb","softban"].includes(a))return s=o.join("-").slice(0,-1)," "===s.substr(s.length-1,1)&&(s=s.slice(0,-1)),await i.delete(),await Uo(i.user,n.user,Lo.SOFTBAN,void 0,s),void await Fo("softban",n.user,i.user,new Map([["DELETE_DAYS","unknown"],["REASON",""!==s?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(s,!0)]):""]]),e);const r=Kn(a);if(r>1e3&&r<31536e6&&0!==r){s=o.join("-").slice(0,-1)," "===s.substr(s.length-1,1)&&(s=s.slice(0,-1));const t=z(Date.now()+r),a=Vn(r,2,!1,U.time_units.ti_full.singular.second);return await Uo(i.user,n.user,Lo.TEMPBAN,t,s),void await Fo("tempban",n.user,i.user,new Map([["DELETE_DAYS","unknown"],["EXPIRES",""],["DURATION",a],["REASON","string"==typeof s&&""!==s?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(s,!0)]):""]]),e)}}await Uo(i.user,n.user,Lo.BAN,void 0,s),se(n.userId)||ae(i.user)||await Fo("ban",n.user,i.user,new Map([["REASON",""!==s?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(s,!0)]):""]]),e)},AL_OnGuildBanRemove:async function(e,t,n,i,a){const s=(await No.getByQuery({memberId:i.user.id,active:!0})).filter((e=>e.type===Lo.BAN||e.type===Lo.TEMPBAN));if(s.length>0){const e=[];s.forEach((t=>{t=ei(t,ko),e.push(t.checkActive())})),await Promise.all(e)}f.modules.infractions.checkLogs&&n instanceof discord.AuditLogEntry&&n.userId!==discord.getBotId()&&!se(n.userId)&&!ae(i.user)&&await Fo("unban",n.user,i.user,new Map([["REASON",""!==n.reason?B(U.modules.infractions.inf_terms.with_reason,["reason",Qn(n.reason,!0)]):""]]),e)}});const er=new pylon.KVNamespace("antiPing"),tr="antiPingData",nr="antiPingIgnores";async function ir(e,t,n){if(!function(e){if("object"!=typeof f.modules.antiPing||"object"!=typeof f.modules.antiPing.targets)return!1;const t=e.id,n={channel:!1,category:!1};"object"==typeof f.modules.antiPing.targets.channels&&Array.isArray(f.modules.antiPing.targets.channels.include)&&f.modules.antiPing.targets.channels.include.indexOf(t)>-1&&(!Array.isArray(f.modules.antiPing.targets.channels.exclude)||-1===f.modules.antiPing.targets.channels.exclude.indexOf(t))&&(n.channel=!0);const i=e.parentId;"string"==typeof i&&"object"==typeof f.modules.antiPing.targets.categories&&Array.isArray(f.modules.antiPing.targets.categories.include)&&f.modules.antiPing.targets.categories.include.indexOf(i)>-1&&(!Array.isArray(f.modules.antiPing.targets.categories.exclude)||-1===f.modules.antiPing.targets.categories.exclude.indexOf(i))&&(n.category=!0);return n.channel||n.category}(n))return!1;if(e.user.bot||t.user.bot)return!1;if(e.user.id===t.user.id)return!1;if(await or(e))return!1;if(xo(e))return!1;const i=await sr(t);if(!i)return!1;const a=await sr(e);return(!i||!a)&&!await ar(e)}async function ar(e){if(e.user.bot)return!1;const t=pn(e);return"number"==typeof f.modules.antiPing.staff&&t>=f.modules.antiPing.staff}async function sr(e){if("object"!=typeof f.modules.antiPing||"object"!=typeof f.modules.antiPing.targets)return!1;const t=e.user.id;if("object"==typeof f.modules.antiPing.targets.users&&Array.isArray(f.modules.antiPing.targets.users.exclude)&&f.modules.antiPing.targets.users.exclude.indexOf(t)>-1)return!1;if("object"==typeof f.modules.antiPing.targets.users&&Array.isArray(f.modules.antiPing.targets.users.include)&&f.modules.antiPing.targets.users.include.indexOf(t)>-1)return!0;const n=await Q(e);let i=!1,a=!1;return n.forEach((e=>{"object"==typeof f.modules.antiPing.targets.roles&&Array.isArray(f.modules.antiPing.targets.roles.include)&&f.modules.antiPing.targets.roles.include.indexOf(e.id)>-1&&(i=!0),"object"==typeof f.modules.antiPing.targets.roles&&Array.isArray(f.modules.antiPing.targets.roles.exclude)&&f.modules.antiPing.targets.roles.exclude.indexOf(e.id)>-1&&(a=!0)})),!(!i||a)}async function or(e){if(e.user.bot)return!0;if(await ar(e))return!0;const t=e.user.id;if("object"==typeof f.modules.antiPing.bypass&&Array.isArray(f.modules.antiPing.bypass.users)&&f.modules.antiPing.bypass.users.indexOf(t)>-1)return!0;const n=pn(e);if("object"==typeof f.modules.antiPing.bypass&&"number"==typeof f.modules.antiPing.bypass.level&&n>=f.modules.antiPing.bypass.level)return!0;if(await async function(e){const t=await er.get(nr);return!!Array.isArray(t)&&t.includes(e)}(t))return!0;const i=await Q(e);let a=!1;return i.forEach((e=>{"object"==typeof f.modules.antiPing.bypass&&Array.isArray(f.modules.antiPing.bypass.roles)&&f.modules.antiPing.bypass.roles.indexOf(e.id)>-1&&(a=!0)})),a}async function rr(e,t,n,i=new Map){t instanceof discord.User&&(i.set("USERTAG",de(t)),i.set("USER_ID",t.id),i.set("USER",t)),n instanceof discord.User&&(i.set("ACTORTAG",me(n)),i.set("ACTOR",n),i.set("ACTOR_ID",n.id)),gn("ANTIPING",`${e}`,i)}async function lr(){const e=await er.get(tr);if(!e)return;const t=[];for(const n in e)for(const i in e[n]){const e=q(i).timestamp;Date.now()-e>=864e5&&t.push(i)}t.length>0&&await er.transact(tr,(e=>{let n;n="object"==typeof e?JSON.parse(JSON.stringify(e)):{};for(const e in n){for(const i in n[e])t.includes(i)&&delete n[e][i];0===Object.keys(n[e]).length&&delete n[e]}return n}))}async function ur(e){let t=await er.get(nr);Array.isArray(t)||(t=[]),t.includes(e)&&(t.splice(t.indexOf(e),1),await er.put(nr,t)),await er.transact(tr,(t=>{let n;return n="object"==typeof t?JSON.parse(JSON.stringify(t)):{},"object"==typeof n[e]&&delete n[e],n}))}async function dr(e,t=!1){const n=await er.get(tr);if(n)for(const i in n[e])for(const a in n[e][i]){const s=n[e][i][a];if("OriginalMsg"!==a||t)try{const e=await discord.getChannel(s.channelId);if("object"!=typeof e||null===e||0!==e.type||!(e instanceof discord.GuildTextChannel))continue;const t=await e.getMessage(s.id);if(null===t)continue;await t.delete()}catch(e){}}}async function cr(e,t,n,i){try{const e=await Vo(t,n,U.modules.antiping.normal_mute_reason);return"boolean"==typeof e&&e}catch(e){}return!1}async function mr(e,t,n,i){let a=await er.get(nr);if(Array.isArray(a)||(a=[]),a.includes(i.authorId)||(a.push(i.authorId),await er.put(nr,a)),xo(t))try{const e=await Ko(t,n,U.modules.antiping.unmute_ignore);return"boolean"==typeof e&&e}catch(e){await rr("FAIL_MARK_UNMUTE",t.user,n.user,new Map([["ACTION","Ignore"],["MESSAGE_ID",i.id],["CHANNEL_ID",i.channelId]]))}return!1}async function gr(e,t,n,i){if(xo(t))try{const e=await Ko(t,n,U.modules.antiping.unmute_ignore_once);return"boolean"==typeof e&&e}catch(e){await rr("FAIL_MARK_UNMUTE",t.user,n.user,new Map([["ACTION","IgnoreOnce"],["MESSAGE_ID",i.id],["CHANNEL_ID",i.channelId]]))}return!1}async function fr(e,t,n,i){try{const e=await Yo(t,n,U.modules.antiping.kick_reason);return"boolean"==typeof e&&e}catch(e){}return!1}async function pr(e,t,n,i){const a=await Jo(t,n,7,U.modules.antiping.softban_reason);return"boolean"==typeof a&&a}async function hr(e,t,n,i){const a=await Wo(t,n,7,U.modules.antiping.ban_reason);return"boolean"==typeof a&&a}var wr=Object.freeze({__proto__:null,kv:er,kvDataKey:tr,periodicDataClear:lr,OnMessageCreate:async function(e,t,n){if(null!==n.webhookId||0!==n.type)return;if(n.mentions.length<=0||n.mentions.length>10)return;if(!(n instanceof discord.GuildMemberMessage))return;const i=await n.getChannel();if(!(i instanceof discord.GuildTextChannel)||0!==i.type)return;const{author:a}=n;if(yn(a.id)&&"307927177154789386"!==t)return;const s=await n.getGuild();if(null===s)return;const o=n.member;if(!(o instanceof discord.GuildMember))return;if(await or(o))return;if(n.mentions.length>6)return;const r=[];if(await Promise.all(n.mentions.map((async e=>{let t;if("object"==typeof e.member){t=e.member;const n=e;delete n.member,t.user=n,t.guildId=s.id}else t=await s.getMember(e.id);await ir(o,t,i)&&r.push(t)}))),r.length<=0)return;const l=f.modules.antiPing.caughtMessages[Math.floor(Math.random()*f.modules.antiPing.caughtMessages.length)],u=await er.get(tr);let d=!1;if("object"==typeof u&&"number"==typeof f.modules.antiPing.pingsForAutoMute&&f.modules.antiPing.pingsForAutoMute>0&&"object"==typeof u[a.id]&&Object.keys(u[a.id]).length>=f.modules.antiPing.pingsForAutoMute-1&&!xo(o)){d=!0;try{await Vo(o,null,U.modules.antiping.repeated_mute_reason)}catch(e){d=!1}}let c="";d&&(c=U.modules.antiping.displayed_mute_reason);const m=`${n.author.toMention()} ${l}\n${c}\n${f.modules.antiPing.actualCaughtMessage}`,g=await n.reply(m);if(zi(g),"boolean"==typeof f.modules.antiPing.instaDeletePings&&!0===f.modules.antiPing.instaDeletePings)try{await n.delete()}catch(e){}const p=[{},{}],h=["member","author","mentionRoles","attachments","mentionChannels","mentionRoles","mentionEveryone","webhookId","editedTimestamp","mentions","reactions","pinned","activity","application","flags","messageReference","type","timestamp","content","embeds","guildId"];for(let e=0;e<2;e+=1){let t=n;0===e&&(t=g);for(const n in t)h.includes(n)||(p[e][n]=t[n]);p[e].authorId=t.author.id}const w=n.mentions.length;let y=`${w} users`;if(w<10){y="";for(const e in n.mentions){""!==y&&(y+=", "),y+=`<@!${n.mentions[e].id}>`}}d?await rr("TRIGGERED_MUTE",a,void 0,new Map([["MESSAGE_ID",n.id],["CHANNEL_ID",n.channelId]])):await rr("TRIGGERED",a,void 0,new Map([["MESSAGE_ID",n.id],["CHANNEL_ID",n.channelId]])),await er.transact(tr,(e=>{let t;return t="object"==typeof e?JSON.parse(JSON.stringify(e)):{},"object"!=typeof t&&(t={}),"object"!=typeof t[a.id]&&(t[a.id]={}),t[a.id][n.id]={BotReplyMsg:p[0],OriginalMsg:p[1]},t}));try{for(const e in f.modules.antiPing.emojiActions)await g.addReaction(e.split(" ").join(""))}catch(e){}return!1},OnMessageDelete:async function(e,t,n,i){await async function(e){await er.transact(tr,(t=>{let n;n="object"==typeof t?JSON.parse(JSON.stringify(t)):{};for(const t in n){for(const i in n[t])if(n[t][i].BotReplyMsg.id===e){delete n[t][i];break}0===Object.keys(n[t]).length&&delete n[t]}return n}))}(n.id)},OnMessageDeleteBulk:async function(e,t,n){await async function(e){await er.transact(tr,(t=>{let n;n="object"==typeof t?JSON.parse(JSON.stringify(t)):{};for(const t in n){for(const i in n[t]){const a=n[t][i].BotReplyMsg;if(e.includes(a.id)){delete n[t][i];break}}0===Object.keys(n[t]).length&&delete n[t]}return n}))}(n.ids)},EmojiActionMute:cr,EmojiActionIgnore:mr,EmojiActionIgnoreOnce:gr,EmojiActionKick:fr,EmojiActionSoftban:pr,EmojiActionBan:hr,OnMessageReactionAdd:async function(e,t,n){const{member:i}=n,{messageId:a}=n,{emoji:s}=n;if(!await ar(i))return;const o=await er.get(tr);if(!o)return;let r;for(const e in o){if("object"==typeof r)break;for(const t in o[e])if(o[e][t].BotReplyMsg.id===a){r=o[e][t];break}}if("object"!=typeof r)return;r.BotReplyMsg;const l=r.OriginalMsg,u=f.modules.antiPing.emojiActions[s.name];if("string"!=typeof u)return;let d;if("ban"===u.toLowerCase()?d=hr:"kick"===u.toLowerCase()?d=fr:"mute"===u.toLowerCase()?d=cr:"ignoreonce"===u.toLowerCase()?d=gr:"ignore"===u.toLowerCase()?d=mr:"softban"===u.toLowerCase()&&(d=pr),"function"!=typeof d)return;const c=await discord.getGuild(t);let m=!0;const g=await H(l.authorId);if(null===g)return;let p=!1,h=!1;const w=await async function(e,t){let n;try{n=e.getMember(t)}catch(e){}return"object"==typeof n&&n}(c,l.authorId);if(!1===w&&"Ban"!==u&&"Softban"!==u&&(h=!0),"IgnoreOnce"!==u&&"Ignore"!==u||(m=!1),!1===h){let e=w;e instanceof discord.GuildMember||(e=g),p=!await d(c,e,i,l)}h?await rr("FAIL_MARK_MEMBER_NOT_FOUND",g,i.user,new Map([["ACTION",u],["MESSAGE_ID",l.id],["CHANNEL_ID",l.channelId]])):p?await rr("FAIL_MARK_ACTION",g,i.user,new Map([["ACTION",u],["MESSAGE_ID",l.id],["CHANNEL_ID",l.channelId]])):await rr("MARK_SUCCESS",g,i.user,new Map([["ACTION",u],["MESSAGE_ID",l.id],["CHANNEL_ID",l.channelId]])),await dr(l.authorId,m),"ignore"!==u.toLowerCase()&&"ignoreonce"!==u.toLowerCase()||await ur(l.authorId)},AL_OnGuildMemberRemove:async function(e,t,n,i){const a=await er.get(tr);if(!a)return;const{user:s}=i,o=await discord.getGuild(i.guildId);if("object"!=typeof a[s.id]||null===o)return;if(n instanceof discord.AuditLogEntry)return void(22===n.actionType&&(dr(s.id,!0),await ur(s.id)));if(await sleep(300),null!==await o.getBan(s))return;("number"==typeof f.modules.antiPing.pingsForAutoMute&&f.modules.antiPing.pingsForAutoMute>0&&Object.keys(a[s.id]).length>=f.modules.antiPing.pingsForAutoMute||"boolean"==typeof f.modules.antiPing.banOnLeave&&f.modules.antiPing.banOnLeave)&&(await Wo(s,null,7,U.modules.antiping.auto_ban_left_reason),dr(s.id,!0),n("LEFT_BANNED",s),await ur(s.id))},OnGuildBanAdd:async function(e,t,n){const{user:i}=n;dr(i.id,!0),await ur(i.id)}});const yr=new pylon.KVNamespace("counting");function Er(e){const t=Math.floor(Number(e));return t!==1/0&&String(t)===e&&t>=0}function Dr(e){if(!(f.modules.counting.autoPins&&f.modules.counting.autoPins.repeating&&f.modules.counting.autoPins.repeatingLast&&f.modules.counting.autoPins.single))return;if(f.modules.counting.autoPins.single.indexOf(e)>-1)return!0;if("number"==typeof f.modules.counting.autoPins.repeating.find((t=>e%t==0)))return!0;return"number"==typeof f.modules.counting.autoPins.repeatingLast.find((t=>e.toString().slice(-t.toString().length)===t.toString()))}async function _r(e){}async function br(e){const t=e.content;let n,i=0;try{const t=await yr.get(`counting_current${e.channelId}`);"number"==typeof t&&(i=t)}catch(e){}try{const t=await yr.get(`counting_lastmid${e.channelId}`);"string"==typeof t&&(n=t)}catch(e){}i<1||t!==i.toString()||"string"==typeof n&&n===e.id&&(await yr.put(`counting_current${e.channelId}`,i-1),await yr.delete(`counting_lastuser${e.channelId}`),await yr.delete(`counting_lastmid${e.channelId}`),_r(e.channelId))}var Ar=Object.freeze({__proto__:null,OnMessageCreate:async function(e,t,n){if(-1===f.modules.counting.channels.indexOf(n.channelId))return;if((0!==n.type||"string"==typeof n.webhookId)&&f.modules.counting.useWebhook)return Dr(+n.content)&&await n.setPinned(!0),!1;if(null===n.author||null===n.member||0!==n.type||"string"==typeof n.webhookId)return;const i=n.content;async function a(e){return await e.delete(),!1}if(!0===n.author.bot)return void await a(n);if("RESET"===i&&n.member.can(8192)){try{await yr.delete(`counting_lastuser${n.channelId}`),await yr.delete(`counting_lastmid${n.channelId}`),await yr.delete(`counting_current${n.channelId}`)}catch(e){}return(await n.getChannel()).sendMessage(B(U.modules.counting.reset,["user_tag",n.author.getTag()])),await _r(n.channelId),void await a(n)}if("SET"===i.split(" ")[0]&&"SET"!==i&&n.member.can(8192)){const e=+i.split(" ")[1];try{await yr.put(`counting_current${n.channelId}`,e),await yr.delete(`counting_lastmid${n.channelId}`),await yr.delete(`counting_lastuser${n.channelId}`)}catch(e){}return(await n.getChannel()).sendMessage(B(U.modules.counting.set,["value",e.toString(),"user_tag",n.author.getTag()])),await _r(n.channelId),void await a(n)}if(!Er(i))return void await a(n);let s,o=0;try{const e=await yr.get(`counting_current${n.channelId}`);"number"==typeof e&&(o=e)}catch(e){}if(i===(o+1).toString()){try{const e=await yr.get(`counting_lastuser${n.channelId}`);"string"==typeof e&&(s=e)}catch(e){}if("string"!=typeof s||s!==n.author.id){if(yr.put(`counting_lastmid${n.channelId}`,n.id),await yr.put(`counting_current${n.channelId}`,o+1),await yr.put(`counting_lastuser${n.channelId}`,n.author.id),_r(n.channelId),!Dr(+n.content)||!_&&f.modules.counting.useWebhook||await n.setPinned(!0),f.modules.counting.useWebhook){if(a(n),_)return;await x(f.modules.counting.webhook,i,void 0,n.author.getTag(),n.author.getAvatarUrl(),!1,{})}return!1}await a(n)}else await a(n)},OnMessageDelete:async function(e,t,n,i){if(-1!==f.modules.counting.channels.indexOf(n.channelId)&&null!==i&&(null!==i.author&&null!==i.member&&"string"!=typeof i.webhookId||f.modules.counting.useWebhook))return"string"!=typeof i.webhookId&&f.modules.counting.useWebhook||await br(i),!1},OnMessageUpdate:async function(e,t,n,i){if(!(i instanceof discord.GuildMemberMessage&&n instanceof discord.GuildMemberMessage))return;if(!i)return;if(!0===n.author.bot||0!==n.type)return;if(-1===f.modules.counting.channels.indexOf(i.channelId)||f.modules.counting.useWebhook)return;if(null===n.author||null===n.member)return;async function a(e){return await br(i),await e.delete(),!1}const s=n.content,o=i.content;!Er(o)||Er(s)?o!==s&&await a(n):await a(n)}});async function Ir(e,t){const n=await discord.getGuild(e);if(null===n)throw new Error("guild not found");const i=await n.getMember(t);if(!(i instanceof discord.GuildMember))throw new Error("member not found");return i}async function vr(e){if(!0===e.user.bot)return;const t=await Q(e);let n=!1;if(t.forEach((e=>{!0===e.hoist&&e.id!==f.modules.roleManagement.lowestHoistRole&&(n=!0)})),!n&&t.length>0)await e.addRole(f.modules.roleManagement.lowestHoistRole);else{t.find((e=>e.id===f.modules.roleManagement.lowestHoistRole))&&await e.removeRole(f.modules.roleManagement.lowestHoistRole)}}async function Cr(e){if(e.user.id===discord.getBotId())return;const t=await Q(e);async function n(e,n,i,a=!1){const s=t.find((e=>e.id===i)),o=t.find((e=>e.id===n));s||o||a?s&&o&&await e.removeRole(i):await e.addRole(i)}!0===e.user.bot?(await n(e,f.modules.roleManagement.botRole,f.modules.roleManagement.botRoleRP,!1),await n(e,f.modules.roleManagement.botRoleRP,f.modules.roleManagement.memberRoleRP,!0)):await n(e,f.modules.roleManagement.memberRole,f.modules.roleManagement.memberRoleRP,!0)}const Sr=["#2f3136","#000000"],Mr={"▬":{amount:5,alphaAllowed:8},"󠇰":{amount:7,alphaAllowed:8}};async function Tr(e){return await(await e.getGuild()).getRole(e.roles[0])}function Or(e){let t=!1;for(const n in Mr){const i=Mr[n];let{amount:a}=i;if("number"!=typeof a&&(a=5),e.name.indexOf(n)>-1){if(e.name.split(n).length-1>=a&&Sr.indexOf(ai(e.color))>-1){if("number"==typeof i.alphaAllowed){if(e.name.replace(/\W/g,"").length>i.alphaAllowed)continue}t=!0;break}}}return t}async function Rr(e){return(await e.getRoles()).filter((e=>!!Or(e)&&(async function(e){if(Or(e)){const t=await discord.getGuild(e.guildId);if(null===t)return;const n=await t.getMember(discord.getBotId());if(null==n)return;const i=await Tr(n);if(null===i)return;e.permissions>0&&i.position>e.position&&e.edit({permissions:0})}}(e),!0))).reverse()}async function Nr(e){let t=!1;const n=await e.getGuild(),i=await n.getMember(discord.getBotId());if(null===i)return;const a=await Rr(n),s=(await n.getRoles()).filter((t=>e.roles.indexOf(t.id)>-1)).reverse();let o=[],r=[];if(a.length<1||s.length<2)return;const l={},u=[];a.forEach((e=>{u.push(e.position)})),u.sort(((e,t)=>e-t)),a.forEach((e=>{let t=0,n=501;const i=e.position;for(let a=0;a<u.length;a+=1){if(u[a]!==i)continue;a>0&&(t=u[a-1]),a<u.length-1&&(n=u[a+1]);const s={upperLimit:n,lowerLimit:t,position:i};l[e.id]=s}}));const d=await Tr(i);if(null!==d){if(a.forEach((t=>{if(!Or(t))return;let{lowerLimit:n}=l[t.id];const{upperLimit:a}=l[t.id];if(n=0,d.position<t.position||!i.can(268435456))return;const u=t.position;let c=!1,m=!1,g=!1,f=!1,p=t,h=t,w=0;s.forEach((i=>{t.id===i.id?g=!0:((p.position===u||i.position<p.position)&&i.position>u&&(p=i),(h.position===u||i.position>h.position)&&i.position<u&&(h=i),i.id===e.guildId||Or(i)||(i.position>u&&0!==i.color&&(f=!0,i.position>w&&(w=i.position)),i.position>n&&i.position<a&&(u<i.position&&(m=!0),u>i.position&&(c=!0))))})),!g||c&&m?g&&!f&&0!==t.color&&r.push(t):r.push(t),!g&&c&&m&&(f||0===t.color)&&o.push(t)})),(o.length>0||r.length>0)&&(t=!0),!0===t){o=o.filter((e=>Or(e))),r=r.filter((e=>Or(e)));const t=s.filter((e=>{if(!Or(e))return!0;return void 0===r.find((t=>t.id===e.id))})).map((e=>e.id));o.map((async e=>{t.push(e.id)})),await e.edit({roles:t})}return t}}var Lr=Object.freeze({__proto__:null,OnGuildMemberUpdate:async function(e,t,n,i){await Cr(await Ir(n.guildId,n.user.id)),await vr(await Ir(n.guildId,n.user.id)),await Nr(await Ir(n.guildId,n.user.id))},OnGuildMemberAdd:async function(e,t,n){await Cr(await Ir(n.guildId,n.user.id)),await vr(await Ir(n.guildId,n.user.id)),await Nr(await Ir(n.guildId,n.user.id))},checkUserRoles:Cr});const kr=["€","£","»","«","´","¨","º","ª","ç"],Gr=["KICK","SOFTBAN","BAN","MUTE","TEMPMUTE","TEMPBAN"],$r=["SLOWMODE","MASSBAN","LOCK_GUILD","LOCK_CHANNEL"],Ur=12e4,Br=new li({name:"censor",itemDuration:Ur,idProperty:"id",timestampProperty:"ts",local:!0});class Fr{constructor(e,t){return this.ts=Date.now(),this.key=e,this.member=t,this}}var Pr;!function(e){e.INVITE="invite",e.URL="url",e.ZALGO="zalgo",e.WORD="word",e.TOKEN="token",e.CAPS="caps",e.CHAR="char",e.REGEX="regex"}(Pr||(Pr={}));class jr{constructor(e,t,n,i,a=!1){return this.stop=!1,this.check=!1,this.check=e,this.type=t,this.message=n,this.target=i,this.stop=a,this}}async function xr(e){return await Br.getByQuery({member:null!==e?e:void 0})}async function Hr(e,t,n,i,a){const s=Date.now(),o=await xr(null),r=o.filter((e=>e.member===i));if("object"==typeof a.globalViolations&&"string"==typeof a.globalViolations.trigger&&"string"==typeof a.globalViolations.action&&a.globalViolations.trigger.includes("/")&&$r.includes(a.globalViolations.action.toUpperCase())&&(!t||"MASSBAN"===a.globalViolations.action.toUpperCase())){const e=a.globalViolations.action.toUpperCase();if(["LOCK_CHANNEL","LOCK_GUILD","SLOWMODE"].includes(e)&&"string"!=typeof a.globalViolations.actionDuration)throw new h(`config.modules.censor.${a._key}.globalViolations.actionDuration`,"Incorrect formatting");if("SLOWMODE"===e&&"number"!=typeof a.globalViolations.actionValue)throw new h(`config.modules.censor.${a._key}.globalViolations.actionValue`,"Incorrect formatting");const t="number"==typeof a.globalViolations.actionValue?Math.min(21600,a.globalViolations.actionValue):void 0,{trigger:n}=a.globalViolations;let i=n.split("/")[0],r=n.split("/")[1];if(!Fn(i,!0)||!Fn(r,!0))throw new h(`config.modules.censor.${a._key}.globalViolations.trigger`,"Incorrect formatting");if("0"===i||"0"===r)return!1;i=parseInt(i,10),r=Math.min(Math.floor(120),parseInt(r,10));const l=[],u=Math.min(10,Math.max(2,Math.floor(i/3))),d=s-Math.floor(1e3*r);if(o.filter((e=>(l.includes(e.member)||l.push(e.member),e.ts>d))).length>=i&&l.length>=u)return{action:e,actionDuration:"string"==typeof a.globalViolations.actionDuration?a.globalViolations.actionDuration:void 0,actionValue:t,individuals:"MASSBAN"===e?l:void 0}}if("object"==typeof a.violations&&"string"==typeof a.violations.trigger&&"string"==typeof a.violations.action&&a.violations.trigger.includes("/")&&Gr.includes(a.violations.action.toUpperCase())){const e=a.violations.action.toUpperCase();if(["TEMPMUTE","TEMPBAN"].includes(e)&&"string"!=typeof a.violations.actionDuration)throw new h(`config.modules.censor.${a._key}.violations.actionDuration`,"Incorrect formatting");const{trigger:t}=a.violations;let n=t.split("/")[0],i=t.split("/")[1];if(!Fn(n,!0)||!Fn(i,!0))throw new h(`config.modules.censor.${a._key}.violations.trigger`,"Incorrect formatting");if("0"===n||"0"===i)return!1;n=parseInt(n,10),i=Math.min(Math.floor(120),parseInt(i,10));const o=s-Math.floor(1e3*i);if(r.filter((e=>e.ts>o)).length>=n)return{action:e,actionDuration:"string"==typeof a.violations.actionDuration?a.violations.actionDuration:void 0}}return!1}async function Vr(e,t,n){const i=new Fr(t,n);i.ts=q(e).timestamp,await Br.saveToPool(i)}function Kr(e,t){const n=[],i=f.modules.censor;if(void 0!==t&&"object"==typeof i.channels&&Object.keys(i.channels).includes(t.id)&&n.push({_key:`channel_${t.id}`,...i.channels[t.id]}),void 0!==t&&"string"==typeof t.parentId&&""!==t.parentId&&4!==t.type&&"object"==typeof i.categories&&Object.keys(i.categories).includes(t.parentId)&&n.push({_key:`category_${t.parentId}`,...i.categories[t.parentId]}),"object"==typeof i.levels){const t=pn(e);Object.keys(i.levels).map((e=>Yn(e)&&Fn(e)?parseInt(e,10):-1)).sort().reverse().map((e=>{"number"==typeof e&&e>=t&&e>=0&&n.push({_key:`level_${e.toString()}`,...i.levels[e]})}))}return n}async function Yr(e,t=!1,n=!1,s=!1){const r={invites:!0===t?[]:void 0,urls:!0===n?[]:void 0,zalgo:!0===s?[]:void 0};if(!0===t&&Array.isArray(r.invites)){const t=e.match(i);if(Array.isArray(t)&&t.length>0){let e=[...new Set(t)].map((e=>{let t="";if(e.includes("/")&&(t=e.split("/"),t=t[t.length-1]),""!==t&&t.length>1)return t})).filter((e=>"string"==typeof e));e.length>=10||(await Promise.all(e.map((async e=>{const t=await discord.getInvite(e);t instanceof discord.Invite&&r.invites.push(t)}))),e=e.filter((e=>!r.invites.find((t=>t instanceof discord.Invite&&t.code===e))))),r.invites=r.invites.concat(e)}}if(!0===n){const t=e.match(a);Array.isArray(t)&&t.length>0&&(r.urls=[...new Set(t)].map((e=>new URL(e))))}if(!0===s){const t=e.match(o);Array.isArray(t)&&t.length>0&&(r.zalgo=[...new Set(t)])}return r}async function Wr(e,t,n=!1,i=!1,a=!1,o=!1,l=!1){const u={words:!0===n?[]:void 0,tokens:!0===i?[]:void 0,caps:!0===a?[]:void 0,chars:!0===o?[]:void 0,regex:!0===l?[]:void 0};if(!0===n){const n=t.words.filter((e=>"string"==typeof e&&e.length>0));let i=[],a=e.includes(" ")?e.toLowerCase().split(" "):[e.toLowerCase()];if(e.includes("\n")){const e=[],t=a.filter((t=>!t.includes("\n")||(e.push(...t.split("\n")),!1)));t.push(...e),a=t}i=a.filter((e=>n.includes(e))),Array.isArray(i)&&i.length>0&&(u.words=[...new Set(i)])}if(!0===i){const n=t.tokens.filter((e=>"string"==typeof e&&e.length>0));if(n.length>0){const t=e.toLowerCase().match(new RegExp(n.join("|"),"gi"));Array.isArray(t)&&t.length>0&&(u.tokens=t)}}if(!0===a){const n="number"==typeof t.caps.minLength?t.caps.minLength:5;if(e.length>=n&&n>0){const n=e.match(/[A-z]/gi);if(Array.isArray(n)&&n.length>0){if("number"==typeof t.caps.percentage&&t.caps.percentage>1){const e=n.filter((e=>e.toUpperCase()===e)).length,i=Math.floor(e/n.length*100);i>t.caps.percentage&&u.caps.push(`${i}% / ${t.caps.percentage}%`)}if("number"==typeof t.caps.followed&&t.caps.followed>1){let e=0;for(let i=0;i<n.length;i+=1){if(n[i].toUpperCase()===n[i]?e+=1:e=0,e>=t.caps.followed){u.caps.push(B(U.modules.censor.capitals_followed,["capitals",e.toString()]));break}}}}}}if(!0===o){const n=t.chars;if("number"==typeof n.limit&&n.limit>0&&e.length>n.limit&&u.chars.push(`${e.length}/${n.limit} characters`),"number"==typeof n.newLines&&n.newLines>0&&e.includes("\n")){const t=e.split("\n").length-1;t>n.newLines&&u.chars.push(B(U.modules.censor.capitals_followed,["found",t.toString(),"max",n.newlines.toString()]))}if("boolean"==typeof n.nonAscii&&!0===n.nonAscii){let t=e.match(r);const n=e.match(s);Array.isArray(t)&&(t=t.filter((e=>!kr.includes(e))),Array.isArray(n)&&(t=t.filter((e=>!n.includes(e))))),Array.isArray(t)&&t.length>0&&u.chars.push(B(U.modules.censor.illegal_ascii,["ascii",t.join(", ")]))}}return l&&t.regex.forEach((t=>{const n=e.match(new RegExp(t,"gm"));Array.isArray(n)&&u.regex.push(...n)})),u}function zr(e,t){const n="boolean"==typeof t.stop&&t.stop,{invites:i}=e,{urls:a}=e,{zalgo:s}=e,{words:o}=e,{tokens:r}=e,{caps:l}=e,{chars:u}=e,{regex:d}=e;if("object"==typeof t.invites&&Array.isArray(i)&&i.length>0){const e=t.invites,a="boolean"==typeof e.vanityUrl&&e.vanityUrl,s="boolean"==typeof e.self&&e.self,o="object"==typeof e.whitelist&&Array.isArray(e.whitelist.guilds)&&e.whitelist.guilds.length>0?e.whitelist.guilds:null,r="object"==typeof e.blacklist&&Array.isArray(e.blacklist.guilds)?e.blacklist.guilds:[],l="object"==typeof e.whitelist&&Array.isArray(e.whitelist.codes)&&e.whitelist.codes.length>0?e.whitelist.codes:null,u="object"==typeof e.blacklist&&Array.isArray(e.blacklist.codes)?e.blacklist.codes:[];if(i.length>5)return new jr(!0,Pr.INVITE,U.modules.censor.too_many_codes,void 0,n);for(let e=0;e<i.length;e++){const t=i[e];if(t instanceof discord.Invite){if(t.guild){if(Array.isArray(o)&&!o.includes(t.guild.id)&&!(t.guild.id===p&&!0===s||null!==t.guild.vanityUrlCode&&"string"==typeof t.guild.vanityUrlCode&&t.guild.vanityUrlCode.length>=2&&!0===a))return new jr(!0,Pr.INVITE,U.modules.censor.guild_not_allowed,t.guild.id,n);if(r.length>0&&r.includes(t.guild.id))return new jr(!0,Pr.INVITE,U.modules.censor.guild_in_blocklist,t.guild.id,n);if(Array.isArray(l)&&!l.includes(t)&&!(t.guild.id===p&&!0===s||null!==t.guild.vanityUrlCode&&"string"==typeof t.guild.vanityUrlCode&&t.guild.vanityUrlCode.length>=2&&!0===a))return new jr(!0,Pr.INVITE,U.modules.censor.invite_not_allowed,t.guild.id,n);if(u.length>0&&u.includes(t))return new jr(!0,Pr.INVITE,U.modules.censor.invite_in_blocklist,t.guild.id,n)}}else if(u.length>0&&u.includes(t))return new jr(!0,Pr.INVITE,U.modules.censor.invite_in_blocklist,t,n)}}if("object"==typeof t.urls&&Array.isArray(a)&&a.length>0){const e=t.urls,i="boolean"==typeof e.allowSubdomains&&e.allowSubdomains,s="object"==typeof e.whitelist&&Array.isArray(e.whitelist)&&e.whitelist.length>0?e.whitelist:null,o="object"==typeof e.blacklist&&Array.isArray(e.blacklist)?e.blacklist:[];for(let e=0;e<a.length;e+=1){const t=a[e].hostname;if(o.includes(t))return new jr(!0,Pr.URL,U.modules.censor.domain_in_blocklist,t,n);if(Array.isArray(s)&&!s.includes(t)){if(!0===i&&t.includes(".")&&t.split(".").length>2){const e=t.split("."),n=`${e[e.length-2]}.${e[e.length-1]}`;if(s.includes(n)&&!o.includes(n))continue}return new jr(!0,Pr.URL,U.modules.censor.domain_not_allowed,t,n)}}}return("object"==typeof t.zalgo||!0===t.zalgo)&&Array.isArray(s)&&s.length>0?new jr(!0,Pr.ZALGO,U.modules.censor.zalgo_found,s.length.toString(),n):"object"==typeof t.words&&Array.isArray(o)&&o.length>0?new jr(!0,Pr.WORD,U.modules.censor.blocked_words,o.join(", "),n):"object"==typeof t.tokens&&Array.isArray(r)&&r.length>0?new jr(!0,Pr.TOKEN,U.modules.censor.blocked_tokens,r.join(", "),n):"object"==typeof t.caps&&Array.isArray(l)&&l.length>0?new jr(!0,Pr.CAPS,U.modules.censor.too_many_caps,l.join(", "),n):"object"==typeof t.chars&&Array.isArray(u)&&u.length>0?new jr(!0,Pr.CHAR,U.modules.censor.illegal_chars,u.join(", "),n):"object"==typeof t.regex&&Array.isArray(d)&&d.length>0?new jr(!0,Pr.REGEX,U.modules.censor.invalid_regex,d.join(", "),n):new jr(!1,void 0,void 0,void 0,n)}async function qr(e,t,n,i){await Vr(e,i._key,t.user.id);const a=await t.getGuild(),s=await Hr(0,!1,i._key,t.user.id,i);if(!1===s)return;if(null===await a.getMember(t.user.id))return;const o=[],{action:r,actionDuration:l,actionValue:u,individuals:d}=s;switch(r){case"KICK":await Yo(t,null,U.modules.censor.action_reason);break;case"SOFTBAN":await Jo(t,null,"number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,U.modules.censor.action_reason);break;case"MUTE":await Vo(t,null,U.modules.censor.action_reason);break;case"BAN":await Wo(t,null,"number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,U.modules.censor.action_reason);break;case"TEMPMUTE":await Ho(t,null,l,U.modules.censor.action_reason);break;case"TEMPBAN":await qo(t,null,"number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,l,U.modules.censor.action_reason);break;case"SLOWMODE":await Qi(null,n,u,Kn(l),U.modules.censor.action_reason);break;case"LOCK_CHANNEL":await Zi(null,n,!0,Kn(l),U.modules.censor.action_reason);break;case"LOCK_GUILD":await Xi(null,!0,Kn(l),U.modules.censor.action_reason);break;case"MASSBAN":await Promise.all(d.map((async e=>{const t=await a.getMember(e);if(null!==t)return void o.push(t);const n=await H(e);null!==n&&o.push(n)}))),await zo(o,null,"number"==typeof f.modules.infractions.defaultDeleteDays?f.modules.infractions.defaultDeleteDays:0,U.modules.censor.action_reason)}}async function Jr(e,t,n){const i=await e.getChannel();i&&(await qr(e.id,e.member,i,n),await e.delete(),gn("CENSOR","CENSORED_MESSAGE",new Map([["CENSOR_TP",t.type],["CENSOR_MESSAGE",t.message],["CENSOR_TARGET",void 0!==t.target?t.target:"unknown"],["MESSAGE_ID",e.id],["CHANNEL_ID",e.channelId],["USERTAG",ue(e.member)],["USER_ID",e.author.id]])))}async function Qr(e){if(!(null!==e.guildId&&e.member instanceof discord.GuildMember&&0===e.type&&null===e.webhookId&&e.author&&!0!==e.author.bot&&0===e.flags))return;if(!(e instanceof discord.GuildMemberMessage))return;if(yn(e.author.id)&&"307927177154789386"!==p)return;if(e.author.id===discord.getBotId())return;const t=await e.getChannel();if(null===t)return;const n=await(await t.getGuild()).getMember(discord.getBotId());if(!n)return;if(!t.canMember(n,8192))return;const i=Kr(e.member,t);let a=!1,s=!1,o=!1,r=!1,l=!1,u=!1,d=!1,c=!1;for(let e=0;e<i.length;e+=1){const t=i[e];if("object"==typeof t.invites&&(a=!0),"object"==typeof t.urls&&(s=!0),"object"!=typeof t.zalgo&&!0!==t.zalgo||(o=!0),Array.isArray(t.words)&&(r=!0),Array.isArray(t.tokens)&&(l=!0),"object"==typeof t.caps&&(u=!0),"object"==typeof t.chars&&(d=!0),"object"==typeof t.regex&&(c=!0),"boolean"==typeof t.stop&&!0===t.stop)break}const m=await Yr(e.content,a,s,o),g={};e.attachments.length>0&&await Promise.all(e.attachments.map((async e=>{if(void 0!==g[e.filename])return;const t=await Yr(e.filename,a,s,o);g[e.filename]=t})));for(let t=0;t<i.length;t+=1){const n=await Wr(e.content,i[t],r,l,u,d,c);if(Object.keys(g).length>0)for(const n in g){const a=zr({...g[n],...await Wr(n,i[t],r,l,u,d,c)},i[t]);if(a instanceof jr){if(!0===a.check)return await Jr(e,a,i[t]),!1;if(!0===a.stop)break}}const a=zr({...m,...n},i[t]);if(a instanceof jr){if(!0===a.check)return await Jr(e,a,i[t]),!1;if(!0===a.stop)break}}}async function Zr(e,t){if(yn(t.user.id)&&"307927177154789386"!==p)return;if(t.user.id===discord.getBotId())return;const n=await t.getGuild();if(null===n)return;const i=await n.getMember(discord.getBotId());if(null===i)return;if(!i.can(134217728))return;const a=await Z(i),s=await Z(t);if(a.position<=s.position)return;const o="string"==typeof t.nick&&t.nick.length>0?t.nick:t.user.username,r=f.modules.censor;if("object"!=typeof r.nameChecks)return;const l=[],u=pn(t);Object.keys(r.nameChecks).map((e=>Yn(e)&&Fn(e)?parseInt(e,10):-1)).sort().reverse().map((e=>{"number"==typeof e&&e>=u&&e>=0&&l.push(r.nameChecks[e])}));let d=!1,c=!1,m=!1,g=!1,h=!1,w=!1,y=!1,E=!1;for(let e=0;e<l.length;e+=1){const t=l[e];if("object"==typeof t.invites&&(d=!0),"object"==typeof t.urls&&(c=!0),"object"!=typeof t.zalgo&&!0!==t.zalgo||(m=!0),Array.isArray(t.words)&&(g=!0),Array.isArray(t.tokens)&&(h=!0),"object"==typeof t.caps&&(w=!0),"object"==typeof t.chars&&(y=!0),"object"==typeof t.regex&&(E=!0),"boolean"==typeof t.stop&&!0===t.stop)break}const D=await Yr(o,d,c,m);for(let n=0;n<l.length;n+=1){const i=zr({...D,...await Wr(o,l[n],g,h,w,y,E)},l[n]);if(i instanceof jr){if(!0===i.check)return await t.edit({nick:B(U.modules.censor.censored_name,["number",Math.floor(Math.min(9999,1e3+1e4*Math.random())).toString()])}),gn("CENSOR","CENSORED_USERNAME",new Map([["CENSOR_TP",i.type],["CENSOR_MESSAGE",i.message],["OLD_NAME",Qn(o,!0)],["CENSOR_TARGET",void 0!==i.target?i.target:"unknown"],["USERTAG",ue(t)],["USER_ID",t.user.id]])),await qr(e,t,void 0,l[n]),!1;if(!0===i.stop)break}}}var Xr=Object.freeze({__proto__:null,kvPool:Br,getViolations:xr,checkViolations:Hr,addViolation:Vr,getApplicableConfigs:Kr,getCensorshipData:Yr,getDataFromConfig:Wr,checkCensors:zr,processViolations:qr,censorMessage:Jr,checkMessage:Qr,OnMessageCreate:async function(e,t,n){return await Qr(n)},OnMessageUpdate:async function(e,t,n,i){if(null===i||n.content===i.content)return;return await Qr(n)},checkName:Zr,AL_OnGuildMemberAdd:async function(e,t,n,i){if(n instanceof discord.AuditLogEntry)return;return await Zr(e,i)},AL_OnGuildMemberUpdate:async function(e,t,n,i,a){if(!(n instanceof discord.AuditLogEntry)||null===a||!0===i.user.bot)return;if(n.userId!==i.user.id)return;if(i.user.username===a.user.username&&i.nick===a.nick)return;if(("string"==typeof i.nick&&i.nick.length>0?i.nick:i.user.username)===("string"==typeof a.nick&&a.nick.length>0?a.nick:a.user.username))return;return await Zr(e,i)}});const el=new li({name:"tags",idProperty:"id",local:!1});class tl{constructor(e,t,n){return this.uses=0,this.id=e,this.authorId=t,this.content=n,this.ts=Date.now(),this}}async function nl(e,t){zi(await e.inlineReply((async()=>{const e=t.toLowerCase(),n=await el.getById(e);if(!n)return{content:U.modules.tags.tag_not_found};el.editTransact(n.id,(e=>(e.uses+=1,e)));const i=await H(n.authorId),a=new discord.Embed;return null!==i&&a.setAuthor({name:i.getTag(),iconUrl:i.getAvatarUrl()}),a.setDescription(n.content),a.setTitle(`${U.modules.tags.tag}: ${n.id}`),a.setFooter({text:B(U.modules.tags.footer,["user_tag",i.getTag(),"user_id",i.id])}),a.setTimestamp((new Date).toISOString()),a.setColor(16414740),{content:"",embed:a}})))}const il=["show","create","set","define","make","delete","del","rm","remove","info","inf","list","all","removeall","clearall","edit"];function al(e){e.default((e=>({tagName:e.text()})),(async(...e)=>{await bi("tags",{permissions:{level:w.Guest,overrideableInfo:"tags.tag.show"}},(async(e,{tagName:t})=>{await nl(e,t)}),...e)})),Ai(e,"show",(e=>({tagName:e.text()})),(async(e,{tagName:t})=>{await nl(e,t)}),{permissions:{level:w.Guest,overrideableInfo:"tags.tag.show"}}),Ai(e,{name:"set",aliases:["set","define","make","edit","create"]},(e=>({tagName:e.string(),content:e.text()})),(async(e,{tagName:t,content:n})=>{zi(await e.inlineReply((async()=>{const i=t.toLowerCase().replace(/[a-zA-Z0-9_]+/g,""),a=t.toLowerCase();if(0!==i.length||a.length<2||a.length>20)return U.modules.tags.set.name_length;if(il.includes(a))return U.modules.tags.set.invalid_name;if("number"==typeof f.modules.tags.maxLength&&n.length>f.modules.tags.maxLength)return B(U.modules.tags.set.content_length,["max_length",f.modules.tags.maxLength]);const s=await el.getById(a);if(s&&s.authorId!==e.author.id){const t=pn(e.member);return"number"==typeof f.modules.tags.levelEditOthers&&t<f.modules.tags.levelEditOthers?U.modules.tags.cant_edit_others:(s.content,s.content=n,await el.editPool(a,s),B(U.modules.tags.set.edited_tag,["tag_name",a]))}const o=new tl(a,e.author.id,n);return await el.saveToPool(o),B(U.modules.tags.set.saved_tag,["tag_name",a])})))}),{permissions:{level:w.Guest,overrideableInfo:"tags.tag.set"}}),Ai(e,{name:"delete",aliases:["remove","rm","del"]},(e=>({tagName:e.string()})),(async(e,{tagName:t})=>{zi(await e.inlineReply((async()=>{const n=t.toLowerCase(),i=await el.getById(n);if(!i)return U.modules.tags.tag_not_found;if(i.authorId!==e.author.id){const t=pn(e.member);if("number"==typeof f.modules.tags.levelEditOthers&&t<f.modules.tags.levelEditOthers)return U.modules.tags.cant_edit_others}return await el.editPool(n,null),U.modules.tags.delete.deleted_tag})))}),{permissions:{level:w.Guest,overrideableInfo:"tags.tag.delete"}}),Ai(e,{name:"info",aliases:["inf"]},(e=>({tagName:e.string()})),(async(e,{tagName:t})=>{zi(await e.inlineReply((async()=>{const n=t.toLowerCase(),i=await el.getById(n);if(!i)return{content:U.modules.tags.tag_not_found};const a=await H(i.authorId),s=new discord.Embed;return s.setDescription(`\n**${U.modules.tags.info.by}**: ${null!==a?`${a.getTag()} `:""}[\`${i.authorId}\`]\n**${U.modules.tags.info.uses}**: **${i.uses}**\n**${U.modules.tags.info.created}**: ${new Date(i.ts).toLocaleDateString()}`),s.setTitle(`${U.modules.tags.tag}: ${i.id}`),s.setFooter({text:B(U.modules.tags.footer,["user_tag",e.author.getTag(),"user_id",e.author.id])}),s.setTimestamp((new Date).toISOString()),s.setColor(16414740),{content:"",embed:s}})))}),{permissions:{level:w.Guest,overrideableInfo:"tags.tag.info"}}),Ii(e,{name:"clearall",aliases:["removeall"]},(async e=>{zi(await e.inlineReply((async()=>(await el.getAll(),await el.clear(),U.modules.tags.clearall.cleared_tags))))}),{permissions:{level:w.Administrator,overrideableInfo:"tags.tag.clearall"}}),Ii(e,{name:"list",aliases:["all"]},(async e=>{zi(await e.inlineReply((async()=>{const e=await el.getAll();if(0===e.length)return{content:U.modules.tags.list.no_tags};const t=new discord.Embed,n=e.sort(((e,t)=>t.uses-e.uses)).map((e=>e.id));return t.setDescription(n.join(", ")),t.setTitle(U.modules.tags.list.tag_list),t.setColor(16414740),{content:"",embed:t}})))}),{permissions:{level:w.Authorized,overrideableInfo:"tags.tag.list"}})}const sl=Ei({name:"tag",description:"Tags commands"},{module:"tags"});sl&&(Di(sl,{name:"show",description:"Gets a tag's value",options:e=>({tag_name:e.string("The tag name to show")})},(async(e,{tag_name:t})=>{const n=t.toLowerCase(),i=await el.getById(n);if(!i)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.tags.tag_not_found),!1;await e.acknowledge({ephemeral:!1}),await el.editTransact(i.id,(e=>(e.uses+=1,e)));const a=await H(i.authorId),s=new discord.Embed;null!==a&&s.setAuthor({name:a.getTag(),iconUrl:a.getAvatarUrl()}),s.setDescription(i.content),s.setTitle(`Tag: ${i.id}`),s.setFooter({text:B(U.modules.tags.footer,["user_tag",a.getTag(),"user_id",a.id])}),s.setTimestamp((new Date).toISOString()),s.setColor(16414740),await _i(e,{embed:s})}),{permissions:{overrideableInfo:"tags.tag.show",level:w.Guest},module:"tags",parent:"tag"}),Di(sl,{name:"set",description:"Creates or edits a tag",options:e=>({tag_name:e.string("The tag name to edit"),value:e.string("The new value for this tag")})},(async(e,{tag_name:t,value:n})=>{const i=t.toLowerCase().replace(/[a-zA-Z0-9_]+/g,""),a=t.toLowerCase();if(0!==i.length||a.length<2||a.length>20)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.tags.set.name_length),!1;if(il.includes(a))return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.tags.set.invalid_name),!1;if("number"==typeof f.modules.tags.maxLength&&n.length>f.modules.tags.maxLength)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(B(U.modules.tags.set.content_length,["max_length",f.modules.tags.maxLength])),!1;const s=await el.getById(a);if(s&&s.authorId!==e.member.user.id){const t=pn(e.member);return"number"==typeof f.modules.tags.levelEditOthers&&t<f.modules.tags.levelEditOthers?(await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.tags.cant_edit_others),!1):(await e.acknowledge({ephemeral:!1}),s.content=n,await el.editPool(a,s),void await _i(e,B(U.modules.tags.set.edited_tag,["tag_name",a])))}await e.acknowledge({ephemeral:!1});const o=new tl(a,e.member.user.id,n);await el.saveToPool(o),await _i(e,B(U.modules.tags.set.saved_tag,["tag_name",a]))}),{permissions:{overrideableInfo:"tags.tag.set",level:w.Guest},module:"tags",parent:"tag"}),Di(sl,{name:"delete",description:"Deletes a tag",options:e=>({tag_name:e.string("The tag name to delete")})},(async(e,{tag_name:t})=>{const n=t.toLowerCase(),i=await el.getById(n);if(!i)return await e.acknowledge({ephemeral:!0}),void await e.respondEphemeral(U.modules.tags.tag_not_found);if(i.authorId!==e.member.user.id){const t=pn(e.member);if("number"==typeof f.modules.tags.levelEditOthers&&t<f.modules.tags.levelEditOthers)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.tags.cant_edit_others),!1}await e.acknowledge({ephemeral:!1}),await el.editPool(n,null),await _i(e,U.modules.tags.delete.deleted_tag)}),{permissions:{overrideableInfo:"tags.tag.delete",level:w.Guest},module:"tags",parent:"tag"}),Di(sl,{name:"info",description:"Gets statistics on a tag",options:e=>({tag_name:e.string("The tag name to get info on")})},(async(e,{tag_name:t})=>{const n=t.toLowerCase(),i=await el.getById(n);if(!i)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.tags.tag_not_found),!1;const a=await H(i.authorId),s=new discord.Embed;s.setDescription(`\n**${U.modules.tags.info.by}**: ${null!==a?`${a.getTag()} `:""}[\`${i.authorId}\`]\n**${U.modules.tags.info.uses}**: **${i.uses}**\n**${U.modules.tags.info.created}**: ${new Date(i.ts).toLocaleDateString()}`),s.setTitle(`Tag: ${i.id}`),s.setFooter({text:B(U.modules.tags.footer,["user_tag",a.getTag(),"user_id",a.id])}),s.setTimestamp((new Date).toISOString()),s.setColor(16414740),await _i(e,{content:"",embed:s})}),{permissions:{overrideableInfo:"tags.tag.info",level:w.Guest},module:"tags",parent:"tag"}),Di(sl,{name:"clearall",description:"Clears all tags on the server"},(async e=>{await el.getAll(),await el.clear(),await _i(e,U.modules.tags.clearall.cleared_tags)}),{staticAck:!0,permissions:{overrideableInfo:"tags.tag.clearall",level:w.Administrator},module:"tags",parent:"tag"}),Di(sl,{name:"list",description:"List all tags on the server"},(async e=>{const t=await el.getAll();if(0===t.length)return await e.acknowledge({ephemeral:!0}),await e.respondEphemeral(U.modules.tags.list.no_tags),!1;await e.acknowledge({ephemeral:!1});const n=new discord.Embed,i=t.sort(((e,t)=>t.uses-e.uses)).map((e=>e.id));n.setDescription(i.join(", ")),n.setTitle(U.modules.tags.list.tag_list),n.setColor(16414740),await _i(e,{content:"",embed:n})}),{permissions:{overrideableInfo:"tags.tag.list",level:w.Authorized},module:"tags",parent:"tag"}));const ol={internal:Xs,logging:Kt,admin:Aa,antiSpam:Qa,censor:Xr,antiPing:wr,counting:Ar,roleManagement:Lr,infractions:Xo,utilities:xs,starboard:Pa,tags:Object.freeze({__proto__:null,showTag:nl,subTags:al,InitializeCommands:function(){const e=Oo({description:"Tag Commands"}),t=new discord.command.CommandGroup(e);return vi(t,"tag",al,!1),t}}),translation:_s,reddit:Ws,commands:Ri,customCode:co},rl=["logging"],ll={GUILD_ROLE_CREATE:function(e){return[e.role]},GUILD_ROLE_UPDATE:function(e,t){return[e.role,t]},GUILD_ROLE_DELETE:function(e,t){return[t]}},ul={CHANNEL_CREATE:{targetId:e=>e[0].id,getCompareData:e=>e[0],10:(e,t)=>e[0].id===t.targetId,auditLogEntries:10,store:{ignoreFound:!0}},CHANNEL_DELETE:{targetId:e=>e[0].id,getCompareData:e=>e[0],auditLogEntries:12,store:{ignoreFound:!0}},CHANNEL_UPDATE:{targetId:e=>e[0].id,getCompareData:e=>[e[0],e[1]],13(e,t){const n=J(e[0],e[1]),i=t.changes.deny&&void 0!==t.changes.deny.newValue?new ee(t.changes.denyNew?t.changes.denyNew.newValue:t.changes.deny.newValue).bitfield:null,a=t.changes.allow&&void 0!==t.changes.allow.newValue?new ee(t.changes.allowNew?t.changes.allowNew.newValue:t.changes.allow.newValue).bitfield:null;if(1===n.added.length){const e=n.added[0];if(e.id===t.options.id&&(e.type===t.options.type||0==e.type&&"role"===t.options.type||1==e.type&&"member"===t.options.type)&&a===e.allow&&i===e.deny)return!0}return!1},14(e,t){const n=J(e[0],e[1]),i=t.changes.deny&&void 0!==t.changes.deny.oldValue?new ee(t.changes.denyNew?t.changes.denyNew.oldValue:t.changes.deny.oldValue).bitfield:null,a=t.changes.deny&&void 0!==t.changes.deny.newValue?new ee(t.changes.denyNew?t.changes.denyNew.newValue:t.changes.deny.newValue).bitfield:null,s=t.changes.allow&&void 0!==t.changes.allow.oldValue?new ee(t.changes.allowNew?t.changes.allowNew.oldValue:t.changes.allow.oldValue).bitfield:null,o=t.changes.allow&&void 0!==t.changes.allow.newValue?new ee(t.changes.allowNew?t.changes.allowNew.newValue:t.changes.allow.newValue).bitfield:null;if(1===n.changed.length){const r=n.changed[0];if(r.id===t.options.id&&(r.type===t.options.type||0==r.type&&"role"===t.options.type||1==r.type&&"member"===t.options.type)){const n=e[1].permissionOverwrites.find((e=>e.id===r.id));return!!n&&(n.allow=new ee(n.allow).bitfield,n.deny=new ee(n.deny).bitfield,(!t.changes.allow||!(o&&o!==r.allow||s&&s!==n.allow))&&(!t.changes.deny||!(a&&a!==r.deny||i&&i!==n.deny)))}}return!1},15(e,t){const n=J(e[0],e[1]),i=t.changes.deny&&void 0!==t.changes.deny.oldValue?new ee(t.changes.denyNew?t.changes.denyNew.oldValue:t.changes.deny.oldValue).bitfield:null,a=t.changes.allow&&void 0!==t.changes.allow.oldValue?new ee(t.changes.allowNew?t.changes.allowNew.oldValue:t.changes.allow.oldValue).bitfield:null;if(1===n.removed.length){const e=n.removed[0];if(e.id===t.options.id&&(e.type===t.options.type||0==e.type&&"role"===t.options.type||1==e.type&&"member"===t.options.type)&&a===e.allow&&i===e.deny)return!0}return!1},auditLogEntries:[13,15,14,11],store:{ignoreFound:!0}},CHANNEL_PINS_UPDATE:{validate(e,t,n){const i=e[0];if(74!==t.actionType&&75!==t.actionType)return!1;if("object"==typeof t.options&&i.channelId!==t.options.channelId)return!1;if(void 0!==i.lastPinTimestamp&&74!==t.actionType)return!1;if(n instanceof discord.AuditLogEntry)return!1;if(void 0===i.lastPinTimestamp)return!0;{const e=q(t.id).timestamp-new Date(i.lastPinTimestamp).getTime();if(e<150&&e>-150)return!0}return!1},store:{entryFound:!0},auditLogEntries:[74,75]},GUILD_BAN_ADD:{targetId:e=>e[0].user.id,validate:(e,t)=>e[0].user.id===t.targetId,auditLogEntries:22,store:{ignoreFound:!0}},GUILD_BAN_REMOVE:{targetId:e=>e[0].user.id,validate:(e,t)=>e[0].user.id===t.targetId,auditLogEntries:23,store:{ignoreFound:!0}},GUILD_EMOJIS_UPDATE:{beforeFetch:e=>!!Array.isArray(e)&&2===e.length,60:(e,t)=>{const n=e[0].emojis.find((e=>e.id===t.targetId));if(void 0!==e[1].emojis.find((e=>e.id===t.targetId))||!(n instanceof discord.Emoji))return!1;if(n.id!==t.targetId)return!1;for(const e in t.changes){const i=t.changes[e];if(void 0!==n[e]&&n[e]!==i.newValue)return!1}return!0},61:(e,t)=>{const n=e[0].emojis.find((e=>e.id===t.targetId)),i=e[1].emojis.find((e=>e.id===t.targetId));if(!(n instanceof discord.Emoji&&i instanceof discord.Emoji))return!1;if(n.id!==i.id)return!1;for(const e in t.changes){const a=t.changes[e];if(void 0!==n[e]&&n[e]!==a.newValue)return!1;if(void 0!==i[e]&&i[e]!==a.oldValue)return!1}return!0},62:(e,t)=>{const n=e[0].emojis.find((e=>e.id===t.targetId)),i=e[1].emojis.find((e=>e.id===t.targetId));if(void 0!==n||!(i instanceof discord.Emoji))return!1;if(i.id!==t.targetId)return!1;for(const e in t.changes){const n=t.changes[e];if(void 0!==i[e]&&i[e]!==n.oldValue)return!1}return!0},auditLogEntries:[60,62,61],store:{ignoreFound:!0}},GUILD_MEMBER_ADD:{beforeFetch:e=>e[0].user.bot,targetId:e=>e[0].user.id,validate:(e,t)=>e[0].user.id===t.targetId,auditLogEntries:28,store:{ignoreFound:!0}},GUILD_MEMBER_UPDATE:{targetId:e=>e[0].user.id,getCompareData:e=>[e[0],e[1]],25:(e,t,n)=>{const i=e[0].roles,a=e[1].roles,s=i.filter((e=>{let t=a.find((t=>t===e));return void 0===t&&(t=!1),!t})),o=a.filter((e=>{let t=i.find((t=>t===e));return void 0===t&&(t=!1),!t}));let r=0;for(const e in t.changes){if("$add"!==e&&"$remove"!==e)continue;const n=t.changes[e].newValue;let i=s;"$remove"===e&&(i=o);void 0===n.find((e=>-1===i.indexOf(e.id)))&&(r+=1)}return r===Object.keys(t.changes).length},auditLogEntries:[24,25],store:{ignoreFound:!0}},GUILD_MEMBER_REMOVE:{targetId:e=>e[0].user.id,getCompareData:e=>e[0],auditLogEntries:[20,21,22],store:{ignoreFound:!0}},GUILD_ROLE_CREATE:{targetId:e=>e[0].id,getCompareData:e=>e[0],auditLogEntries:30,store:{ignoreFound:!0}},GUILD_ROLE_UPDATE:{targetId:e=>e[0].id,getCompareData:e=>[e[0],e[1]],auditLogEntries:31,store:{ignoreFound:!0}},GUILD_ROLE_DELETE:{targetId:e=>e[0].id,getCompareData:e=>e[1],auditLogEntries:32,store:{ignoreFound:!0}},GUILD_UPDATE:{getCompareData:e=>[e[0],e[1]],auditLogEntries:[1,80,81,82],store:{ignoreFound:!0}},MESSAGE_DELETE:{beforeFetch(e){if(2!==e.length)return!1;if(null===e[1])return!1;return 0===e[1].type},72:(e,t,n)=>{if(72!==t.actionType)return!1;if(null===e[1]||void 0===e[1])return!1;if(e[1].author.id!==t.targetId||e[0].channelId!==t.options.channelId)return!1;if("object"==typeof n){let e=n.options.count;"number"==typeof e&&(e=e.toString());let i=t.options.count;return"number"==typeof i&&(i=i.toString()),n.id===t.id&&e!==i}return!0},22:(e,t)=>{if(null===e[1]||void 0===e[1])return!1;const n=e[1].author.id;return t.targetId===n},73:(e,t,n)=>{if(e[0].channelId!==t.targetId)return!1;if(n&&"object"==typeof n){return+n.options.count+1===+t.options.count}return"1"===t.options.count},store:{entryFound:!0},auditLogEntries:[72,22,73]},MESSAGE_DELETE_BULK:{validate:(e,t,n)=>{if(e[0].channelId!==t.targetId)return!1;if("object"==typeof n){if(e[0].ids.length.toString()!==t.options.count.toString()){if(t.id===n.id)return!0;const i=+n.options.count,a=+t.options.count;if(i+e[0].ids.length===a)return!0}return!1}return e[0].ids.length.toString()===t.options.count.toString()},returnData:(e,t)=>{if("object"!=typeof t)return e;const n=+e.options.count-+t.options.count;return e.options.count=n.toString(),e},store:{entryFound:!0},auditLogEntries:[73]},VOICE_STATE_UPDATE:{beforeFetch(e){if(2!==e.length)return!1;if(null===e[1])return!1;const t=e[0],n=e[1];return t.channelId===n.channelId||t.mute===n.mute||t.deaf===n.deaf},24:(e,t)=>{const n=e[0],i=e[1];return t.userId!==n.userId&&(null!==n.channelId&&((n.mute!==i.mute||n.deaf!==i.deaf)&&(n.mute!==i.mute&&"object"==typeof t.changes.mute&&t.changes.mute.newValue===n.mute&&t.changes.mute.oldValue===i.mute||!(n.deaf===i.deaf||!t.changes.deaf||t.changes.deaf.newValue!==n.deaf||t.changes.deaf.oldValue!==i.deaf))))},26:(e,t,n)=>{const i=e[0],a=e[1];return t.userId!==i.userId&&(i.channelId!==a.channelId&&i.channelId===t.options.channelId&&(null!==i.channelId&&null!==a.channelId&&(!(n instanceof discord.AuditLogEntry.MemberMove)||n.id===t.id&&n.options.count!==t.options.count)))},27:(e,t,n)=>{const i=e[0],a=e[1];return t.userId!==i.userId&&(i.channelId!==a.channelId&&null===i.channelId&&(null!==a.channelId&&(!(n instanceof discord.AuditLogEntry.MemberDisconnect)||n.id===t.id&&n.options.count!==t.options.count)))},store:{entryFound:!0},auditLogEntries:[26,27,24]}},dl=new pylon.KVNamespace("auditLogMatcher"),cl=66e4,ml={22:400,23:400},gl=200,fl=[72,73,26,27],pl={null:[!1,0,""],false:[0,"",null],true:[1],"":[null]},hl={1:{iconHash:"icon",rulesChannelId:null,publicUpdatesChannelId:null,splashHash:"splash"},30:{permissionsNew:"permissions",permissions:null},31:{permissionsNew:"permissions",permissions:null},32:{permissionsNew:"permissions",permissions:null}},wl=[null,0,"0",!1,"permissions","permissionsNew"];async function yl(e){let t=await dl.get(e);return null!=t&&("string"==typeof t&&(t=JSON.parse(t)),t)}async function El(e){if(!1===await yl(e.id)){let t;(e instanceof discord.AuditLogEntry.MessageDelete||e instanceof discord.AuditLogEntry.MemberMove||e instanceof discord.AuditLogEntry.MemberDisconnect)&&(t=JSON.parse(JSON.stringify(e)),t.options.count=1),void 0===t&&(t=e),await dl.put(e.id,t,{ttl:cl})}else{let t;(e instanceof discord.AuditLogEntry.MessageDelete||e instanceof discord.AuditLogEntry.MemberMove||e instanceof discord.AuditLogEntry.MemberDisconnect)&&(t=JSON.parse(JSON.stringify(e)),t.options.count+=1,t.options.count>e.options.count&&(t.options.count=e.options.count)),void 0===t&&(t=e),await dl.put(e.id,t,{ttl:cl})}}function Dl(e){return{error:!0,message:e}}async function _l(e,t,n){const i=ul[e];if(i.validate instanceof Function&&!(i.getCompareData instanceof Function)){if("object"==typeof i.store){const e=await yl(n.id);return i.validate(t,n,e)}return i.validate(t,n)}if("function"==typeof i[n.actionType]){if("object"==typeof i.store){const e=await yl(n.id);return i[n.actionType](t,n,e)}return i[n.actionType](t,n)}const a=i.getCompareData(t);for(const e in i){if("targetId"!==e)continue;if(!(i[e]instanceof Function))continue;const a=i[e](t);if(void 0===a)return!1;if(n[e]!==a)return!1}const s=["newValue","oldValue"];for(const e in n.changes)if("object"==typeof n.changes[e])for(let t=0;t<s.length;t+=1){const i=n.changes[e][s[t]];if(void 0===i)continue;if(t>0&&!Array.isArray(a))continue;let o=a;if(Array.isArray(a)&&(o=a[t]),t>0&&void 0===o||null===o)continue;let r=o[e];const l=hl[n.actionType];if("object"==typeof l)if("string"==typeof l[e])r=o[l[e]];else if(null===l[e])continue;if(typeof r!=typeof i&&!["permissionOverwrites","permissions","permissionsNew"].includes(e)){if(wl.indexOf(r)>-1&&wl.indexOf(i)>-1)continue;if(void 0!==pl[i]&&pl[i].indexOf(o[e])>-1)continue;return Zn("auditlog.validate failed key type-check",e,r,pl[o[e]],n,i),!1}if("object"==typeof r&&null!==r){if(!si(r,i)){if("permissionOverwrites"===e&&Array.isArray(r)&&Array.isArray(i)){const e=r.filter((e=>{const t=i.find((t=>t.id===e.id));return!t||void 0===t||(t.allow!=e.allow||t.deny!=e.deny||t.type!=e.type)})),t=i.filter((e=>{const t=r.find((t=>t.id==e.id));return!t||void 0===t||(t.allow!=e.allow||t.deny!=e.deny||t.type!=e.type)}));return 0===e.length&&0===t.length}return Zn("validate failed obj Compare",e,n),!1}}else if(r!=i)return Zn("validate failed key Compare",e,n),!1}return!0}function bl(e){if("object"!=typeof ul[e])return!1;if(void 0===ul[e].auditLogEntries)return!1;if("function"!=typeof ul[e].getCompareData&&"function"!=typeof ul[e].validate){for(const t in ul[e].auditLogEntries){const n=ul[e].auditLogEntries[t];if("function"!=typeof ul[e][n])return!1}return!0}return!0}async function Al(e,t,n,i=3,a=2e3){if(!bl(e))return Dl("Audit logs not setup for this event");const s=ul[e];if("function"==typeof s.beforeFetch){const e=s.beforeFetch(n);if("boolean"==typeof e&&!e)return Dl("beforeFetch stopped audit logs from being fetched")}const{guildId:o}=f,r=await discord.getGuild(o);if("object"!=typeof r||null===r)return Dl("No guild found");let l=new Date(t-15e3).getTime();const u=(new Date).getTime()-t,d={limit:Math.min(500,Math.max(8,Math.ceil(u/1e3*17)))};let c=s.auditLogEntries;Array.isArray(c)||(c=[c]);let m=0,g=!1;c.forEach((e=>{fl.includes(e)&&(g=!0),"number"==typeof ml[e]&&ml[e]>m&&(m=ml[e])})),g&&(l=new Date((new Date).getTime()-66e4).getTime());const p=(new Date).getTime()-t;m>0&&p<m&&await sleep(Math.max(100,m-p));const h=(new Date).getTime()-t;let w;h<gl&&await sleep(Math.max(100,gl-h)),1===c.length&&(d.actionType=c[0]);for await(const t of r.iterAuditLogs(d)){if(!t)continue;if(new Date(q(t.id).timestamp).getTime()<l)break;if(-1!==c.indexOf(t.actionType)){try{if(!await _l(e,n,t))continue}catch(e){Zn(e)}if("object"==typeof s.store){if(("function"==typeof s.returnData||!0===s.store.ignoreFound)&&(w=await yl(t.id),w instanceof discord.AuditLogEntry&&!0===s.store.ignoreFound))continue;!0!==s.store.entryFound&&!0!==s.store.ignoreFound||await El(t)}return"function"==typeof s.returnData?s.returnData(t,w):t}}if(i>0){await sleep(a);return await Al(e,t,n,i-1,a)}return Dl("No entry found")}async function Il(e){const t=new Date;let n=new Array,i=!1,a=0;const{guildId:s}=f,o=await discord.getGuild(s);if(null===o)return;let r=(new Array).concat(e).map((e=>{if(!bl(e.eventName))return e.auditLogEntry=Dl("Audit logs not setup for this event"),e;const t=ul[e.eventName];if("function"==typeof t.beforeFetch){const n=t.beforeFetch(e.payload);"boolean"!=typeof n||n||(e.auditLogEntry=Dl("beforeFetch stopped audit logs from being fetched"))}e.guildId=s;let o=t.auditLogEntries;return Array.isArray(o)||(o=[o]),o.forEach((e=>{fl.includes(e)&&(i=!0),"number"==typeof ml[e]&&ml[e]>a&&(a=ml[e])})),n.push(e),e}));if(0===n.length)return r;let l="",u=0;if(l=z(q(n[n.length-1].id).timestamp),u=q(n[0].id).timestamp,!Array.isArray(n)||void 0===n)return;if("string"!=typeof l||"number"!=typeof u)return;let d=15e3;i&&(d=6e5),u=new Date(u).getTime()-d;const c={limit:Math.min(450,Math.floor(1.5*r.length)),before:l},m=(new Date).getTime()-t.getTime();a>0&&m<a&&await sleep(Math.max(50,a-m));const g=(new Date).getTime()-t.getTime();g<gl&&await sleep(Math.max(50,gl-g)),n=n.reverse();const p=new Array;for await(const e of o.iterAuditLogs(c)){if(!e)continue;if(new Date(q(e.id).timestamp).getTime()<u)break;let t;for(const i in n){const a=n[i];if(null!==a.auditLogEntry)continue;const s=ul[a.eventName];let o=s.auditLogEntries;if(Array.isArray(o)||(o=[o]),-1===o.indexOf(e.actionType))continue;if(await _l(a.eventName,a.payload,e)){if("object"==typeof s.store){if(("function"==typeof s.returnData||!0===s.store.ignoreFound)&&(t=await yl(e.id),!0===s.store.ignoreFound&&(p.includes(e.id)||t instanceof discord.AuditLogEntry)))continue;!0!==s.store.entryFound&&!0!==s.store.ignoreFound||(await El(e),p.includes(e.id)||p.push(e.id))}n[i].auditLogEntry=e,"function"==typeof s.returnData&&(n[i].auditLogEntry=s.returnData(e,t))}}}return n.forEach((e=>{const t=r.findIndex((t=>{e.id,t.id}));t>-1&&(r[t].auditLogEntry=e.auditLogEntry)})),r=r.map((e=>(null===e.auditLogEntry&&("string"!=typeof e.guildId?e.auditLogEntry=Dl("No guild found"):e.auditLogEntry=Dl("No entry found")),e))),r}const vl={global:{GUILD_UPDATE:(e,t)=>{if(si(e,t))return!0},GUILD_MEMBER_UPDATE:(e,t)=>{if(!(t instanceof discord.GuildMember))return!1;for(const n in e)if("roles"!==n&&"user"!==n&&(!si(e[n],t[n])||e[n]!==t[n]))return!1;if(e.roles.length!==t.roles.length)return!1;if(e.user.avatar!==t.user.avatar||e.user.discriminator!==t.user.discriminator||e.user.username!==t.user.username||e.premiumSince!==t.premiumSince)return!1;const n=e.roles.filter((e=>!t.roles.find((t=>t===e)))),i=t.roles.filter((t=>!e.roles.find((e=>e===t))));return 0===n.length&&0===i.length||void 0},GUILD_EMOJIS_UPDATE:(e,t)=>{if(si(e,t))return!0},GUILD_ROLE_UPDATE:(e,t)=>{if(si(e,t))return!0;const n=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(t));return["position"].map((e=>{delete n[e],delete i[e]})),!!si(n,i)||(e.name===t.name&&e.color===t.color&&e.hoist===t.hoist&&e.managed===t.managed&&e.mentionable===t.mentionable&&e.permissions===t.permissions||void 0)},CHANNEL_CREATE:e=>{if("object"==typeof E&&"string"==typeof E.masterGuild&&p!==E.masterGuild&&1===e.type)return!0},CHANNEL_UPDATE:(e,t)=>{if(null===e||null===t)return!0;if(si(e,t))return!0;const n=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(t));return["position"].map((e=>{delete n[e],delete i[e]})),!!si(n,i)||void 0},MESSAGE_CREATE:e=>!("object"!=typeof E||"string"!=typeof E.masterGuild||p===E.masterGuild||e.member instanceof discord.GuildMember)||(!1!==N(e)||void 0),MESSAGE_UPDATE:(e,t)=>!("object"!=typeof E||"string"!=typeof E.masterGuild||p===E.masterGuild||e.member instanceof discord.GuildMember)||(!!si(e,t)||(null!==t&&e.content===t.content||void 0)),MESSAGE_DELETE:(e,t)=>"object"==typeof E&&"string"==typeof E.masterGuild&&p!==E.masterGuild&&!e.guildId||(!(!t||!1===N(t))||void 0),TYPING_START:e=>"object"==typeof E&&"string"==typeof E.masterGuild&&p!==E.masterGuild&&!e.guildId||(e.userId===discord.getBotId()||void 0),VOICE_SERVER_UPDATE:e=>{if("object"==typeof E&&"string"==typeof E.masterGuild&&p!==E.masterGuild)return!0}},auditlog:{GUILD_EMOJIS_UPDATE:(...e)=>!Array.isArray(e)||(2!==e.length||void 0),GUILD_MEMBER_ADD:e=>{if(!e.user.bot)return!0},MESSAGE_DELETE:(e,t)=>{if(null===t)return!0;return 0!==t.type||void 0},VOICE_STATE_UPDATE:(e,t)=>null===e||null===t||(e.channelId!==t.channelId&&e.mute!==t.mute&&e.deaf!==t.deaf||void 0),GUILD_UPDATE:(e,t)=>{const n=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(t));if(["applicationId","features","maxPresences","maxMembers","memberCount","premiumSubscriptionCount","premiumTier"].map((e=>{delete n[e],delete i[e]})),si(n,i))return!0}}};function Cl(e,t,...n){if(vl[t][e]instanceof Function){const i=vl[t][e](...n);return void 0!==i&&i}return!1}let Sl,Ml=!1;async function Tl(e,t,...n){try{if(!f){if(!await O())return;Sl=f}if(Ml||await async function(){!0!==Ml&&(Ml=!0,Ro(),fn("BOT_STARTED"))}(),Sl!==f&&(Ro(),Sl=f),!function(e){const t=c[e];for(const e in ol){const n=ol[e];if("object"!=typeof n)continue;if(!Nl(e))continue;const i=n[t],a=n[d+t],s=n.OnBatchEvents,o=n.AL_OnBatchEvents;if(i instanceof Function||a instanceof Function||s instanceof Function||o instanceof Function)return!0}return!1}(e))return;(function(e){if(!(ll[e]instanceof Function))return!1;return!0})(e)&&(n=ll[e](...n)),Array.isArray(n)||(n=[n]);if(!0===Cl(e,"global",...n))return;let i=function(){if(void 0!==f&&!f.modules.queue)return!1;for(const e in ol){const t=ol[e];if("object"!=typeof t)continue;if(!Nl(e))continue;const n=t.OnBatchEvents,i=t.AL_OnBatchEvents;if(n instanceof Function||i instanceof Function)return!0}return!1}();const a=new Date(q(t).timestamp).getTime();await es(e,"global",a);let s=!1;const o=await ts(e,"global",a)||await ts(e,"event",a);Ll(e)&&bl(e)&&!Cl(e,"auditlog",...n)&&(await es(e,"auditlog",a),s=await ts(e,"auditlog",a)),i=i&&(o||s);const r=function(){let e=(new Array).concat(os);return e=e.filter((e=>!e.processed)),e.length}()>0;if(!i&&r&&await ls(),i){await ds(e,t,...n);return}Math.floor(await pylon.getCpuTime());await async function(e,t,n,...i){const a=new Date(q(t).timestamp).getTime();let s=t;const o=c[e];let r;Ll(e)&&(r=await async function(e,t,...n){let i;if(!bl(e))return Dl("Audit log pulling not configured for this event.");if(await ts(e,"auditlog",t))i=Dl("Data not fetched due to ratelimit");else if(Cl(e,"auditlog",...n))i=Dl("Data forcefully filtered out.");else{try{i=await Al(e,t,n)}catch(e){Zn(e),i=Dl("Routing errored whilst pulling audit logs")}"object"==typeof i[0]&&(i[0],discord.AuditLogEntry)}Array.isArray(i)&&(i=i.concat(n));return i}(e,a,...i),Array.isArray(r)&&r[0]instanceof discord.AuditLogEntry&&(s=r[0].id));const{guildId:l}=k;for(const t in ol){Math.floor(await pylon.getCpuTime());const a=ol[t];if("object"!=typeof a||null===a)continue;let u;try{if(!Nl(t))continue;if(null!==n&&t!==n)continue;const u=a[o],c=a.OnAnyEvent;if(c instanceof Function)if(rl.includes(t))c(e,s,l,...i);else{const t=await c(e,s,l,...i);if("boolean"==typeof t&&!1===t)return}if(u instanceof Function)if(rl.includes(t))u(s,l,...i);else{const e=await u(s,l,...i);if("boolean"==typeof e&&!1===e)return}if(void 0!==r){const e=a[d+o];if(e instanceof Function)if(u instanceof Function&&console.warn("WARNING: Dual AuditLog/Normal variants of the same event just ran in the same module!"),Array.isArray(r)||(r=[r,...i]),rl.includes(t))e(s,l,...r);else{const t=await e(s,l,...r);if("boolean"==typeof t&&!1===t)return}}}catch(n){if(Zn(n),!n||!n.stack)return;"string"!=typeof n.stack&&"object"==typeof n.stack&&(n.stack=JSON.stringify(n.stack,null,2)),u=`${e}.ExecuteModules.${t}.${o}\n${n.stack}`}if(u)throw new Error(u)}}(e,t,null,...n);Math.floor(await pylon.getCpuTime())}catch(n){const i=n;if(Zn(n),i.message)for(const e in di)if(i.message.toLowerCase().includes(di[e].toLowerCase()))return;fn("BOT_ERROR",new Map([["ERROR",`Error at event ${e}\n${i.stack}`]]),t)}}async function Ol(e){let t=[].concat(e);t=t.map((e=>Cl(e.eventName,"auditlog",...e.payload)?(e.auditLogEntry=Dl("Data forcefully filtered out."),e):bl(e.eventName)?(Ll(e.eventName)||(e.auditLogEntry=Dl("Audit log callback functions not defined for this event.")),e):(e.auditLogEntry=Dl("Audit log pulling not configured for this event."),e)));const n=t.filter((e=>{const t=Cl(e.eventName,"auditlog",...e.payload),n=bl(e.eventName),i=Ll(e.eventName);return!t&&n&&i&&null===e.auditLogEntry})),i=n.length;let a=new Array;if(n.length>0){if(i>=400){const e=function(e,t,n=!1){if(t<2)return[e];const i=e.length,a=[];let s,o=0;if(i%t==0)for(s=Math.floor(i/t);o<i;)a.push(e.slice(o,o+=s));else if(n)for(;o<i;)s=Math.ceil((i-o)/t--),a.push(e.slice(o,o+=s));else{for(t--,s=Math.floor(i/t),i%s==0&&s--;o<s*t;)a.push(e.slice(o,o+=s));a.push(e.slice(s*t))}return a}(n,Math.ceil(i/300),!0);for(let t=0;t<e.length;t+=1){const n=e[t];a=[...a,...await Il(n)]}}else a=await Il(n);a.forEach((e=>{const n=t.findIndex((t=>{e.id,t.id}));n>-1&&(t[n].auditLogEntry=e.auditLogEntry,t[n].guildId=e.guildId)}))}return t}async function Rl(e){const{guildId:t}=k;fn("RAW_EVENT",new Map([["EVENT","QUEUE_RUN"],["TIMESTAMP",(new Date).toISOString()],["QUEUE","N/A"]]));let n=(new Array).concat(e);n=n.sort(((e,t)=>q(e.id).timestamp-q(t.id).timestamp));let i=(new Array).concat(n);i=await Promise.all(i.filter((e=>!e.verified)).filter((e=>!e.processed))),kl()&&(i=await Ol(i));const a=[];for(const e in ol){const t=ol[e];if("object"!=typeof t||null===t)continue;if(!Nl(e))continue;const n=t._ForceIndividualEvents,i=t.OnBatchEvents,s=t.AL_OnBatchEvents;let o=i instanceof Function;o||(o=kl()&&s instanceof Function),("boolean"==typeof n&&!0===n||!o)&&a.push(e)}var s,o;i=i.map((e=>(e.guildId=t,e.processed=!0,e))),s=i,(o=(o=n).map((e=>{e.guildId=t;const n=s.find((t=>t.id===e.id));return n&&(e.processed=n.processed),e}))).filter((e=>!e.processed)),n=o;for(const e in ol){const s=ol[e];if("object"!=typeof s||null===s)continue;if(!Nl(e))continue;const o=s.OnBatchEvents,r=s.AL_OnBatchEvents;if(a.indexOf(e)>-1){await Promise.all(i.map((async n=>{const i=c[n.eventName],a=s[i],o=s[d+i];if(a instanceof Function){let s;try{if(rl.includes(e))a(n.id,t,...n.payload);else{const e=await a(n.id,t,...n.payload);if("boolean"==typeof e&&!1===e)return}}catch(t){s=new Error(`${n.eventName}.ExecuteQueuedModules.${e}.${i}\n${t.stack}`)}if(void 0!==s)throw s}if(o instanceof Function){let a;try{if(rl.includes(e))o(n.id,t,n.auditLogEntry,...n.payload);else{const e=await o(n.id,t,n.auditLogEntry,...n.payload);if("boolean"==typeof e&&!1===e)return}}catch(t){a=new Error(`${n.eventName}.ExecuteQueuedModules.${e}.AL_${i}\n${t.stack}`)}if(void 0!==a)throw a}return n})));continue}let l;try{if(o instanceof Function){const e=await o(i);if("boolean"==typeof e&&!1===e)return n}}catch(t){l=new Error(`ExecuteQueuedModules.${e}.OnBatchEvents\n${t.stack}`)}if(void 0!==l)throw l;try{if(kl()&&r instanceof Function){o instanceof Function&&console.warn("WARNING: Dual AuditLog/Normal variants of batched events just ran in the same module!");const e=await r(i);if("boolean"==typeof e&&!1===e)return n}}catch(t){l=new Error(`ExecuteQueuedModules.${e}.AL_OnBatchEvents\n${t.stack}`)}if(void 0!==l)throw l}return n}function Nl(e){if("internal"===e)return!0;if(!f)throw new Error("tried to check module enable without config being enabled");if("string"!=typeof e||null===e)return!1;const t=f.modules[e];return"object"==typeof t&&("boolean"==typeof t.enabled&&t.enabled)}function Ll(e){const t=c[e];for(const e in ol){const n=ol[e];if("object"!=typeof n)continue;if(!Nl(e))continue;const i=n[d+t],a=n.AL_OnBatchEvents;if(i instanceof Function||a instanceof Function)return!0}return!1}function kl(){if(void 0!==f&&!f.modules.queue)return!1;for(const e in ol){const t=ol[e];if("object"!=typeof t)continue;if(!Nl(e))continue;if(t.AL_OnBatchEvents instanceof Function)return!0}return!1}function Gl(e){discord.on(m[e],(async(...t)=>{const n=z();await Tl(e,n,...t)}))}Object.keys(c).forEach(Gl),function(){for(const e in mo){const t=mo[e],n=t.name;!0!==t.started&&("string"==typeof n&&t.function instanceof Function&&(t.started=!0,pylon.tasks.cron(n,e,(async()=>{await go(n)}))))}}()}));
